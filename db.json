{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"themes/next_8.8/source/baidu_verify_code-hSpd2B5Lfx.html","path":"baidu_verify_code-hSpd2B5Lfx.html","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/google0634b644f1031b86.html","path":"google0634b644f1031b86.html","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/css/noscript.styl","path":"css/noscript.styl","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar.jpg","path":"images/avatar.jpg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar_100.jpg","path":"images/avatar_100.jpg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar_200.jpg","path":"images/avatar_200.jpg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar_300.jpg","path":"images/avatar_300.jpg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar_500.jpg","path":"images/avatar_500.jpg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/avatar_80.jpg","path":"images/avatar_80.jpg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/logo-algolia-nebula-blue-full.svg","path":"images/logo-algolia-nebula-blue-full.svg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/ye_16.ico","path":"images/ye_16.ico","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/images/ye_32.ico","path":"images/ye_32.ico","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/bookmark.js","path":"js/bookmark.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/comments-buttons.js","path":"js/comments-buttons.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/comments.js","path":"js/comments.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/config.js","path":"js/config.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/pjax.js","path":"js/pjax.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/schedule.js","path":"js/schedule.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/fancybox.js","path":"js/third-party/fancybox.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/pace.js","path":"js/third-party/pace.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/quicklink.js","path":"js/third-party/quicklink.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/rating.js","path":"js/third-party/rating.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/analytics/baidu-analytics.js","path":"js/third-party/analytics/baidu-analytics.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/analytics/google-analytics.js","path":"js/third-party/analytics/google-analytics.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/analytics/growingio.js","path":"js/third-party/analytics/growingio.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/chat/chatra.js","path":"js/third-party/chat/chatra.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/chat/gitter.js","path":"js/third-party/chat/gitter.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/chat/tidio.js","path":"js/third-party/chat/tidio.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/changyan.js","path":"js/third-party/comments/changyan.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/disqus.js","path":"js/third-party/comments/disqus.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/disqusjs.js","path":"js/third-party/comments/disqusjs.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/gitalk.js","path":"js/third-party/comments/gitalk.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/isso.js","path":"js/third-party/comments/isso.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/livere.js","path":"js/third-party/comments/livere.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/comments/utterances.js","path":"js/third-party/comments/utterances.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/math/katex.js","path":"js/third-party/math/katex.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/math/mathjax.js","path":"js/third-party/math/mathjax.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/search/algolia-search.js","path":"js/third-party/search/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/search/local-search.js","path":"js/third-party/search/local-search.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/statistics/firestore.js","path":"js/third-party/statistics/firestore.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/statistics/lean-analytics.js","path":"js/third-party/statistics/lean-analytics.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/tags/mermaid.js","path":"js/third-party/tags/mermaid.js","modified":0,"renderable":1},{"_id":"themes/next_8.8/source/js/third-party/tags/pdf.js","path":"js/third-party/tags/pdf.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"55c55444033af34e797e2d3cb1c1b4cf7889b3db","modified":1652948287325},{"_id":"source/_posts/Algorithm.md","hash":"d7a1364ff8586d4d46ec0c995005903faee34412","modified":1656301641949},{"_id":"source/_posts/An-Introduction-to-Git.md","hash":"497918f81b953b1183618cbd01c07ed56dbb9850","modified":1655105920678},{"_id":"source/_posts/Arch-Linux.md","hash":"2166c1e0fff4d5bd493420836ba4d5a1001f5c08","modified":1655204775885},{"_id":"source/_posts/Bash.md","hash":"b6f17cfcf4bcee1d07cc908b77e5b23f1bbcdea4","modified":1655105920678},{"_id":"source/_posts/C-Project.md","hash":"3b215a378dd37d0ec88413b9ed4a02dbaa436862","modified":1655105920681},{"_id":"source/_posts/Config-Vim.md","hash":"0a8767079d19c1dac4ff49554d20c2de2482cfb0","modified":1655105920681},{"_id":"source/_posts/Construct-Your-Blog-with-Hexo-and-Github.md","hash":"50b2e5f387f7de7ce7b790e39a6ac35e023d1e6e","modified":1655105920681},{"_id":"source/_posts/Experiments.md","hash":"09a735ab7a6d997e958c4852b06218190a6e091e","modified":1655105920684},{"_id":"source/_posts/First-Step-to-RL.md","hash":"b0d67691a7886e31320264c85efebfd1778d341e","modified":1656062060990},{"_id":"source/_posts/Fish-Shell.md","hash":"4b3fd7e1af065fd79d35a566537814927c61d794","modified":1655105920684},{"_id":"source/_posts/Foundation-for-Topological-Data-Analysis.md","hash":"7048feeebeee443b31e0912453e3020a78861d74","modified":1655105920688},{"_id":"source/_posts/Hexo.md","hash":"f7b4f5c325145b2579b4963fc86ed1fcba9f14ab","modified":1655108392221},{"_id":"source/_posts/How-to-Blance-Losses-in-Multi-Task-Training.md","hash":"c2fa2b48b2fd0fe4b3c7520b6e6060484a70142e","modified":1655105920688},{"_id":"source/_posts/Make-and-Cmake.md","hash":"820d160b53e8377cfd50f38f3aca41bb1524ce70","modified":1655105920688},{"_id":"source/_posts/Personal-Thought.md","hash":"e0667a59c30ecf301c7fce57241cd2bdcc01eed7","modified":1655105920691},{"_id":"source/_posts/Regex.md","hash":"d4b8fc5e4f2d16fd5243ca7cd5f2ac0de61ebb11","modified":1655105920691},{"_id":"source/_posts/Revealjs.md","hash":"3aa1986a70d520e69f1a41f3c852d16ea291d46e","modified":1655105920691},{"_id":"source/_posts/Shorcut-on-Linux.md","hash":"b5c0887dc566108dfa6ce1d4cdc85fc1c452726e","modified":1655105920691},{"_id":"source/_posts/The-First-Step-to-GAN.md","hash":"e493a299b04d36e3a92faa8ed74ad4ebe7affac2","modified":1655105920691},{"_id":"source/_posts/Tips-in-Papers.md","hash":"1eacf333d231d12977c856184939d7dc3820b940","modified":1655105920694},{"_id":"source/_posts/Transformer-and-BERT.md","hash":"69387f72ea2501f3f719c069df8b34b0359fe3f6","modified":1655105920694},{"_id":"source/_posts/Windows.md","hash":"4abe851288d417e990fa289e587d20ae4a58eb4b","modified":1655105920694},{"_id":"source/about/index.md","hash":"9aab11db0791297a1fa5e1b1767eb3a05bfb42ef","modified":1652948287331},{"_id":"source/categories/index.md","hash":"408ea9b07f3b1a1339731fe7b364d88bc5644aff","modified":1652948287331},{"_id":"source/tags/index.md","hash":"3207ebf9794561395cf0c54633880ab070040ade","modified":1652948287331},{"_id":"source/_posts/Arch-Linux/init.png","hash":"ce9408b49df290f533e154259838d2c75e2e3cf9","modified":1652948287328},{"_id":"source/_posts/Arch-Linux/init.png:Zone.Identifier","hash":"ae356a67d337afa5933e3e679e84854deeace048","modified":1652948287328},{"_id":"source/_posts/First-Step-to-RL/q_learning.py","hash":"3a68ec1153d26f2c18c9d34ee5deb5e495b8dca9","modified":1652948287328},{"_id":"source/_posts/First-Step-to-RL/policy_network.py","hash":"b3e8f06360cad0084a0656edaed4539f1b01e327","modified":1652948287328},{"_id":"source/_posts/Tips-in-Papers/ADCM.jpg","hash":"ee5b75f3a063e07624c5f03111f98902d885cd8e","modified":1652948287331},{"_id":"source/_posts/Tips-in-Papers/Saccader_eq1.jpg","hash":"2ea2a74f960377a6a9d0bc98ecfadd8ba09cd316","modified":1652948287331},{"_id":"source/_posts/Tips-in-Papers/Saccader_eq2.jpg","hash":"cf5832e89b29e39275d2fa4a2e39592e97f9a39e","modified":1652948287331},{"_id":"source/_posts/Tips-in-Papers/Saccader_eq3.jpg","hash":"8fa845242bb6f737736d91485ca237e7132e19b5","modified":1652948287331},{"_id":"source/_posts/Tips-in-Papers/Saccader_gl.jpg","hash":"fb8050f8b71a7c667cfa85672b505b3340d2231b","modified":1652948287331},{"_id":"source/_posts/Tips-in-Papers/Saccader_Cell.jpg","hash":"b17e79bf86bb3422527bf51d200ceceeb53ce936","modified":1652948287331},{"_id":"source/_posts/Tips-in-Papers/Saccader_Over.jpg","hash":"deaccd942ffca9e163a9f2c9bdfb69251d1004cb","modified":1652948287331},{"_id":"source/_posts/Tips-in-Papers/Tnet_over.jpg","hash":"ed04ca4049c6f909b0bf51ea57ffa9a2b445e1c8","modified":1652948287331},{"_id":"source/_posts/An-Introduction-to-Git/git.jpg","hash":"db9ed8bb86df7e73d5be3bcae4cc8656e4a7a0ed","modified":1652948287328},{"_id":"themes/next_8.8/.eslintrc.json","hash":"9c0762486f24a8c5e60f8b6c875e4c4728942649","modified":1652948287501},{"_id":"themes/next_8.8/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1652948287501},{"_id":"themes/next_8.8/.stylintrc","hash":"2cf4d637b56d8eb423f59656a11f6403aa90f550","modified":1652948287505},{"_id":"themes/next_8.8/LICENSE.md","hash":"68fc9a03d50fd4b5ea97092b05967d1819dea2c4","modified":1652948287505},{"_id":"themes/next_8.8/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1652948287505},{"_id":"themes/next_8.8/README.md","hash":"fab15a85d9d8d90ecd8879525b9b74fb1c197978","modified":1652948287505},{"_id":"themes/next_8.8/renovate.json","hash":"cb29cc16e61b0b8a6dac34657d76822ae29ad5aa","modified":1652948287508},{"_id":"themes/next_8.8/package.json","hash":"cc9a8e5bd83dd293552ed7cc1d0d2304a6b448ba","modified":1652948287508},{"_id":"themes/next_8.8/_vendors.yml","hash":"c88f3a82361ddb32cf62846a2ae1b7192b7e3af2","modified":1652948287505},{"_id":"themes/next_8.8/.githooks/install.js","hash":"4d77dbddf2eac1f3fc78f151d12ed22208ed655b","modified":1652948287501},{"_id":"themes/next_8.8/.githooks/pre-commit","hash":"f473eac1aaaa96c947d67988bbed140bbab1a821","modified":1652948287501},{"_id":"themes/next_8.8/.github/PULL_REQUEST_TEMPLATE.md","hash":"3e9fbb78e3dee0ca1dc886d0c28b0148ba0ca499","modified":1652948287501},{"_id":"themes/next_8.8/.github/config.yml","hash":"7984e665e9de481a0e0e51fca5668337713f810b","modified":1652948287505},{"_id":"themes/next_8.8/.github/CODE_OF_CONDUCT.md","hash":"21cbff565a0445d3a880fff1ee417e309740a9ab","modified":1652948287501},{"_id":"themes/next_8.8/.github/issue_label_bot.yaml","hash":"fca600ddef6f80c5e61aeed21722d191e5606e5b","modified":1652948287505},{"_id":"themes/next_8.8/.github/labeler.yml","hash":"5c4bc2bd561e6d9b33ee118cc12218c5de46f72d","modified":1652948287505},{"_id":"themes/next_8.8/.github/CONTRIBUTING.md","hash":"330656d93b6c03df9fb1f2f0e3534c971969473b","modified":1652948287501},{"_id":"themes/next_8.8/.github/label-commenter-config.yml","hash":"1097fc47beeacfc1edb0248c27b17bf64bde3565","modified":1652948287505},{"_id":"themes/next_8.8/_config.yml","hash":"7750440a5897f82d5eef99534ecb65865577a778","modified":1656050911390},{"_id":"themes/next_8.8/.github/release-drafter.yml","hash":"423275ec021104b263cd88776936a8c8d6872b66","modified":1652948287505},{"_id":"themes/next_8.8/languages/README.md","hash":"b2567e32805dda79601157351a07e5ca9fe01315","modified":1652948287505},{"_id":"themes/next_8.8/docs/LICENSE.txt","hash":"f5b14f791b7cfa1d16da981d929152e088a5d1b8","modified":1652948287505},{"_id":"themes/next_8.8/docs/AUTHORS.md","hash":"a648823121563c34a177ae91f5a774b5e29f01a0","modified":1652948287505},{"_id":"themes/next_8.8/languages/ar.yml","hash":"bca66db21c015dbd32970d8708b898518a773e1e","modified":1652948287505},{"_id":"themes/next_8.8/languages/default.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1652948287505},{"_id":"themes/next_8.8/languages/de.yml","hash":"4be7b8b76c81bf1853eb36d2e874b17546a0e792","modified":1652948287505},{"_id":"themes/next_8.8/languages/en.yml","hash":"814d81c27fed736055ee300e0a6505b26ff4313c","modified":1652948287505},{"_id":"themes/next_8.8/languages/es.yml","hash":"651e3b33d86a7cdb9fd7895ca28279f8b1a24faa","modified":1652948287505},{"_id":"themes/next_8.8/languages/fa.yml","hash":"6456d40dd42f44101d9d6e7054e9884e9163f948","modified":1652948287505},{"_id":"themes/next_8.8/languages/fr.yml","hash":"b15dc05afdc94de02e5d3fee4f8d3dc5594dd37e","modified":1652948287505},{"_id":"themes/next_8.8/languages/id.yml","hash":"14e794db4eca36b257994d81eb513e61d1edcbd6","modified":1652948287505},{"_id":"themes/next_8.8/languages/ja.yml","hash":"d48c4157e0e02e847aac7b513580d3364c81948c","modified":1652948287505},{"_id":"themes/next_8.8/languages/it.yml","hash":"c1eeab4992c76bfd436bb205ce58b1cfeef55ee6","modified":1652948287505},{"_id":"themes/next_8.8/languages/ko.yml","hash":"6387357ac2dd498e8b8d630d27050a59180d7e8f","modified":1652948287505},{"_id":"themes/next_8.8/languages/nl.yml","hash":"ecb8e39c6225f3c068a5fdd569ee7dafd5c41a1f","modified":1652948287505},{"_id":"themes/next_8.8/languages/pt-BR.yml","hash":"a1f27b3a592fc58f17d247f5563ff4a90a3da5f2","modified":1652948287505},{"_id":"themes/next_8.8/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1652948287505},{"_id":"themes/next_8.8/languages/ru.yml","hash":"e9af1afe529ca747a04b801401d394b2ad696fde","modified":1652948287505},{"_id":"themes/next_8.8/languages/si.yml","hash":"615d18d044f44df476d6bfbf73f7b0edc2632168","modified":1652948287505},{"_id":"themes/next_8.8/languages/pt.yml","hash":"63a3e1e728ba5e6e22150de7331bb8a654f34960","modified":1652948287505},{"_id":"themes/next_8.8/languages/uk.yml","hash":"7dd24580c0865c5a7bc4d391855045366a598936","modified":1652948287505},{"_id":"themes/next_8.8/languages/tr.yml","hash":"0bebba73d6f06c7dad61f80c0d7ad5f6f1791a01","modified":1652948287505},{"_id":"themes/next_8.8/languages/vi.yml","hash":"c669c34da544a563ceae3e196addc9df6a78e024","modified":1652948287505},{"_id":"themes/next_8.8/languages/zh-CN.yml","hash":"5a3ab21210304efef736e96bad254f789f42c567","modified":1652948287505},{"_id":"themes/next_8.8/languages/zh-HK.yml","hash":"f195bb0502ffe66e850077a1af1033455ea65f93","modified":1652948287505},{"_id":"themes/next_8.8/layout/category.njk","hash":"c68b7343d0f8145010f93351908cc36ef6212ec1","modified":1652948287508},{"_id":"themes/next_8.8/layout/index.njk","hash":"dd63e488ae8cc144335a5958acedf6a16edd7a92","modified":1652948287508},{"_id":"themes/next_8.8/layout/page.njk","hash":"6c40aa438c658eb7f0cd0f6a759f18b43e7e8f93","modified":1652948287508},{"_id":"themes/next_8.8/layout/post.njk","hash":"6abeb85fb3e4c382ed4bb6049b12a807e6226e67","modified":1652948287508},{"_id":"themes/next_8.8/layout/tag.njk","hash":"9e16ba20c28a7f2c6bc75aa427f48122301a30aa","modified":1652948287508},{"_id":"themes/next_8.8/layout/_layout.njk","hash":"20e4160cd0deb4fa272cc3aed0f43520b3cf4a9c","modified":1652948287505},{"_id":"themes/next_8.8/source/baidu_verify_code-hSpd2B5Lfx.html","hash":"39bdf7866b924b617ed930c89d2b5b4a51e99522","modified":1655195200648},{"_id":"themes/next_8.8/languages/zh-TW.yml","hash":"92256b90028de9a1e79c6bc0e5885b93e7fb4b17","modified":1652948287505},{"_id":"themes/next_8.8/source/google0634b644f1031b86.html","hash":"da2e69e3c8a923450ce9571bd6c874c4d48a3c80","modified":1655106308948},{"_id":"themes/next_8.8/layout/archive.njk","hash":"d759f4d2cf5ddc6875ea250113a00662c1caf6d1","modified":1652948287508},{"_id":"themes/next_8.8/.github/ISSUE_TEMPLATE/bug-report.md","hash":"fc4dce84ed9a5d21d3a8833ff6d776c46f876115","modified":1652948287501},{"_id":"themes/next_8.8/test/index.js","hash":"6bf0289846538be3e9a63809af98f00e1fbdd90b","modified":1652948287515},{"_id":"themes/next_8.8/.github/ISSUE_TEMPLATE/feature-request.md","hash":"4ecac91716eac59d7c2bc53cf6e95612d44da97b","modified":1652948287501},{"_id":"themes/next_8.8/.github/ISSUE_TEMPLATE/config.yml","hash":"c40ae7903b6cc99f94c9d45ac7ba8c2850bb1309","modified":1652948287501},{"_id":"themes/next_8.8/.github/ISSUE_TEMPLATE/other.md","hash":"8cc5b5c116f6a052865a324512362f145d699202","modified":1652948287501},{"_id":"themes/next_8.8/.github/workflows/label-commenter.yml","hash":"44405477660289d4ed9beba1d054b15bb67bba06","modified":1652948287505},{"_id":"themes/next_8.8/.github/workflows/linter.yml","hash":"276a91c7179926f410c784c99fa635dc0a016c2d","modified":1652948287505},{"_id":"themes/next_8.8/.github/workflows/labeler.yml","hash":"8b73c439dc796be141d521a4546bcfb7a5485534","modified":1652948287505},{"_id":"themes/next_8.8/.github/workflows/lock.yml","hash":"e48d1ced9a673d3f0911a700d3e68c0f4ca79263","modified":1652948287505},{"_id":"themes/next_8.8/.github/workflows/release-drafter.yml","hash":"4f3af81009cb922be91f718a67425377515ea69d","modified":1652948287505},{"_id":"themes/next_8.8/.github/workflows/stale.yml","hash":"0feb3e1afd1b2dca9dbc7811ce4cf5520e2d186c","modified":1652948287505},{"_id":"themes/next_8.8/.github/workflows/tester.yml","hash":"22aaaa3eba1a7ebcf0f78417fd9a7113ee7b6c6c","modified":1652948287505},{"_id":"themes/next_8.8/docs/ru/README.md","hash":"87edab5a3eb7577a409c01df3f1631de40f8956f","modified":1652948287505},{"_id":"themes/next_8.8/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"7a06d443f374bd1e84294067a0ac796afd9fbe60","modified":1652948287505},{"_id":"themes/next_8.8/docs/zh-CN/README.md","hash":"02bafc6ee86263790603861e356596f0c916e392","modified":1652948287505},{"_id":"themes/next_8.8/docs/zh-CN/CONTRIBUTING.md","hash":"a089f7a8368ab0b7d7b9b7ec0ac3767a453435df","modified":1652948287505},{"_id":"themes/next_8.8/layout/_macro/post-collapse.njk","hash":"1a30d751871dabfa80940042ddb1f77d07d830b9","modified":1652948287505},{"_id":"themes/next_8.8/layout/_macro/sidebar.njk","hash":"a1575da8a34d7b7b8cf37e23ffb5d0ed2edee0fe","modified":1652948287505},{"_id":"themes/next_8.8/layout/_macro/post.njk","hash":"d0ed41b9b05254e19d051b5f91fdcaa125ee7ca6","modified":1652948287505},{"_id":"themes/next_8.8/layout/_macro/sidebar.njk_backup","hash":"eb786e8b35e354287cda345c524cd35ec955f692","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/comments.njk","hash":"c12f8a7497596441503f2541d2f746f2ee7dd594","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/footer.njk","hash":"a6197cc0d418d87919f929905a5e90e21b969ffa","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/languages.njk","hash":"e43f22198cccb5f6e306b1ce0d28d12a4fb891f8","modified":1652948287505},{"_id":"themes/next_8.8/layout/_scripts/index.njk","hash":"6668878a0f9a1166c6a879755f54a08d942da870","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/pagination.njk","hash":"9876dbfc15713c7a47d4bcaa301f4757bd978269","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/widgets.njk","hash":"852a750524decf1efa587cd52b09e387ed8315de","modified":1652948287505},{"_id":"themes/next_8.8/layout/_scripts/vendors.njk","hash":"be80b9fe415a9a09d74c28e230995fd292dfc123","modified":1652948287505},{"_id":"themes/next_8.8/layout/_third-party/fancybox.njk","hash":"844559f46e2ff1c8be234d5763703106e2072a7b","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/index.njk","hash":"d41eeb262978e34de4679d8971a9e7ac5d90ecbc","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/pace.njk","hash":"d7ad5714079f7f65446f880baf14722435ca9061","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/rating.njk","hash":"1bcdbc7fde26d6d9ef4e7fa43ffcff5a9506b20e","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/quicklink.njk","hash":"0efed71ed530447718c4ea5bbd5fc8695b0b0d5f","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/minify.js","hash":"0af64049db8188d5f8cc226b353e0d7909819feb","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/default-injects.js","hash":"872f01cb10e422a648ea505436532e776e92926b","modified":1652948287508},{"_id":"themes/next_8.8/scripts/events/index.js","hash":"1ce12eda88fa5df7e76ec7b78b8463fc6618410c","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/locals.js","hash":"0cd7da6755459d60779f0a7ccf311e26e184d55d","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/number.js","hash":"63735cb9d02921e25b2606490340a70db89abbec","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/post.js","hash":"ab8bb12e4d55640b1ac4252514468ce37ebcb0b0","modified":1652948287508},{"_id":"themes/next_8.8/scripts/helpers/engine.js","hash":"b9785bc737470e9b8e910e7da9e8c45c2ead58fa","modified":1652948287508},{"_id":"themes/next_8.8/scripts/helpers/font.js","hash":"3394185a7f0393c16ce52c8028f90da3e9239c55","modified":1652948287508},{"_id":"themes/next_8.8/scripts/helpers/next-config.js","hash":"9a07f2d979fc8fe0c5e07d48304187b9b03ea7ff","modified":1652948287508},{"_id":"themes/next_8.8/scripts/helpers/next-url.js","hash":"a11b71ba0c5012e2cdcab31c15439156b215563e","modified":1652948287508},{"_id":"themes/next_8.8/scripts/helpers/next-vendors.js","hash":"afdd6a188a74c188f0dd154fac70efd4080ca262","modified":1652948287508},{"_id":"themes/next_8.8/scripts/tags/caniuse.js","hash":"935a311142a409c1896b3ae3f01fe7a9e2db1134","modified":1652948287508},{"_id":"themes/next_8.8/scripts/tags/button.js","hash":"c6ad2ed544fbb25ecb5d820c36e76302504271b7","modified":1652948287508},{"_id":"themes/next_8.8/scripts/tags/center-quote.js","hash":"92c19d796bdb3320df9caea59bf52df7a95d9da9","modified":1652948287508},{"_id":"themes/next_8.8/scripts/tags/label.js","hash":"8a73348186113bae0a51ea2f891c1bb882fab05a","modified":1652948287508},{"_id":"themes/next_8.8/scripts/tags/group-pictures.js","hash":"9ed799c329abf830f623689d7e136991256a24ca","modified":1652948287508},{"_id":"themes/next_8.8/scripts/tags/index.js","hash":"17f9451ce1f10f78437f52218757d38d4e1591b0","modified":1652948287508},{"_id":"themes/next_8.8/scripts/tags/link-grid.js","hash":"18a483c2d5afd701f6080ffdddf2d1321370336c","modified":1652948287508},{"_id":"themes/next_8.8/scripts/tags/mermaid.js","hash":"4fb01ca650fa8b256b8d48f50dc1b18350bd3d6d","modified":1652948287508},{"_id":"themes/next_8.8/scripts/tags/note.js","hash":"7b94ddb46b7d4b0fe815f2fbe4bd375f07f55363","modified":1652948287508},{"_id":"themes/next_8.8/scripts/tags/pdf.js","hash":"344636b6fd7e27e8831c1e194039afc0d61931cd","modified":1652948287508},{"_id":"themes/next_8.8/scripts/tags/tabs.js","hash":"0eabe51da40b4b13e16419c8fe02452d9a4fef73","modified":1652948287508},{"_id":"themes/next_8.8/scripts/tags/video.js","hash":"2ee926448583be8f95af1f2884ae2c9c4830151d","modified":1652948287508},{"_id":"themes/next_8.8/source/css/main.styl","hash":"78ce791cc4ac95386cf6839ca72f5f7b51f86ee9","modified":1652948287511},{"_id":"themes/next_8.8/source/css/noscript.styl","hash":"76bba5d7916e9930e68215a0fce3a7d81c44510f","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_mixins.styl","hash":"acef5acc728f24cb657be8d7010d836b4d556b0e","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_colors.styl","hash":"3c6798c10cc220d83481cb3f3782e78558cee789","modified":1652948287508},{"_id":"themes/next_8.8/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1652948287511},{"_id":"themes/next_8.8/source/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1652948287511},{"_id":"themes/next_8.8/source/images/avatar_200.jpg","hash":"4a76d1527e511350c9112e899046a34be59ad278","modified":1652948287511},{"_id":"themes/next_8.8/source/images/avatar_100.jpg","hash":"a0f0a00c9326c57a5cc181aeb80dfda8e947920a","modified":1652948287511},{"_id":"themes/next_8.8/source/images/avatar_80.jpg","hash":"465e53598964df3852f08794cb73c5e459855e92","modified":1652948287515},{"_id":"themes/next_8.8/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1652948287515},{"_id":"themes/next_8.8/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1652948287515},{"_id":"themes/next_8.8/source/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1652948287515},{"_id":"themes/next_8.8/source/images/ye_16.ico","hash":"b8fb01b5361da89831d232a831a1532e9822bd72","modified":1652948287515},{"_id":"themes/next_8.8/source/images/logo.svg","hash":"2cb74fd3ea2635e015eabc58a8d488aed6cf6417","modified":1652948287515},{"_id":"themes/next_8.8/source/images/ye_32.ico","hash":"375c99cd785d93dd989c36604ffbd10ada71322a","modified":1652948287515},{"_id":"themes/next_8.8/source/js/bookmark.js","hash":"0f563ffbf05fad30e854e413ab17ff7164ab5a53","modified":1652948287515},{"_id":"themes/next_8.8/source/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1652948287515},{"_id":"themes/next_8.8/source/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1652948287515},{"_id":"themes/next_8.8/source/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1652948287515},{"_id":"themes/next_8.8/source/js/motion.js","hash":"9c4c861dfb080b6244d4d9eba33ac686735754f3","modified":1652948287515},{"_id":"themes/next_8.8/source/js/next-boot.js","hash":"48497e2156a10155dc42311633a110c9685692c9","modified":1652948287515},{"_id":"themes/next_8.8/source/js/pjax.js","hash":"919f5281c4a04d11cfd94573ecf57b3dbabd3cc8","modified":1652948287515},{"_id":"themes/next_8.8/source/js/schedule.js","hash":"2b43e2d576a308289880befc27580dbb2aa34439","modified":1652948287515},{"_id":"themes/next_8.8/source/js/utils.js","hash":"e447160d342b1f93df5214b6a733441039ced439","modified":1652948287515},{"_id":"themes/next_8.8/test/helpers/index.js","hash":"63ba28afed697f7b3574436b1133b8ecc9c0c357","modified":1652948287515},{"_id":"themes/next_8.8/test/helpers/font.js","hash":"342ef3c6fd2dcca2a8802a516ed6d7f389fd2ca2","modified":1652948287515},{"_id":"themes/next_8.8/test/helpers/next-url.js","hash":"a91d880cb75e0a8e65a7be4c7362b2c8ebfb7c4f","modified":1652948287515},{"_id":"themes/next_8.8/test/tags/button.js","hash":"48f2aa4c513e9e24bd6a811410520b74cd7ea88b","modified":1652948287515},{"_id":"themes/next_8.8/test/tags/caniuse.js","hash":"aa5e728445caeaf7c2ccd0f3fcb2cad0c93ca6d1","modified":1652948287515},{"_id":"themes/next_8.8/test/tags/center-quote.js","hash":"7667342fd1a1417eaf6a254012b84ae40e8d13dd","modified":1652948287515},{"_id":"themes/next_8.8/test/tags/index.js","hash":"e8779e54f0979b221858f8bb74dd081bb503b910","modified":1652948287515},{"_id":"themes/next_8.8/test/tags/group-pictures.js","hash":"5c68ae0184f9da6e00ba199f2554d503d8e6da71","modified":1652948287515},{"_id":"themes/next_8.8/test/tags/label.js","hash":"4ebf3698c258ca978b997acbdd0dece44069c09d","modified":1652948287515},{"_id":"themes/next_8.8/test/tags/link-grid.js","hash":"43d298fafb7c45a874b766d443843bd26346e689","modified":1652948287515},{"_id":"themes/next_8.8/test/tags/mermaid.js","hash":"ab77be5f3c6d9a57c7b9dda6decf1906a736fef9","modified":1652948287515},{"_id":"themes/next_8.8/test/tags/note.js","hash":"3dcfcd65bf9f326972ea7571fdb1444200f5d07e","modified":1652948287515},{"_id":"themes/next_8.8/test/tags/pdf.js","hash":"fd6ea5123560a90f7e7c1eface23dbe1455db25f","modified":1652948287515},{"_id":"themes/next_8.8/test/tags/tabs.js","hash":"d63722919f9da2e44d6b952801e10a2915ea9c12","modified":1652948287515},{"_id":"themes/next_8.8/test/tags/video.js","hash":"b796fc4dceb20a30e730c322bb5474c0162464cc","modified":1652948287515},{"_id":"themes/next_8.8/test/validate/index.js","hash":"5a95ccc8598667535bd022e988055c0e019f3670","modified":1652948287515},{"_id":"themes/next_8.8/layout/_partials/head/head.njk","hash":"d3c094aaef1431fbc9df333529a7b1789ccd134c","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/head/head-unique.njk","hash":"9167e429a459686c9fc140790124a46d677e6b15","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/header/brand.njk","hash":"aff4613756456be26415febc668860fdab8d33c5","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/header/index.njk","hash":"650de421a8ce4cf685428ffbe0087ff84cbd1356","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/header/menu-item.njk","hash":"b46f412c0b4f775fd329d50357f722f5d7c1a3ba","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/header/sub-menu.njk","hash":"75a158a5b54a3a76ee6590f5e0e2dd4a9f0be869","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/header/menu.njk","hash":"8561e4125b227e5134cb058e2a76fb2e5233ca29","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/page/breadcrumb.njk","hash":"edb3bb6d644b7407673c5ef3a426a244e98fcf89","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/page/categories.njk","hash":"17156d99941f28a225951ffdcfa9a115e20dc2d2","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/page/page-header.njk","hash":"7ed4f102a1825195cff8d7995bf9219f323a9034","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/page/schedule.njk","hash":"ca2ccf3cf1874c45712f192ad45dea96fbd9920d","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/page/tags.njk","hash":"a18d1598e36cc72f2b0b24c3cc3c5990dfaa3254","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/post/post-followme.njk","hash":"154df0bb323c332d8c25343f258ee865e5553423","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/post/post-copyright.njk","hash":"133942922e34abae9e4de7ea5591d77c0caa4b37","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/post/post-footer.njk","hash":"bde2c7356d9362972bde41cc206d5816f8ed714d","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/post/post-meta.njk","hash":"9fa47e4fb342811da590ee4adc91cf81118c0a39","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/post/post-related.njk","hash":"7384e6390067ef2a84e7310d6adb3f6104ed62e2","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/post/post-reward.njk","hash":"002b51d0cae3f2e2e008bdc58be90c728282de5b","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/search/algolia-search.njk","hash":"efb2b6f19df02ba5ae623a1f274fff52aed21e6f","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/search/index.njk","hash":"8f6f256ab3b351ffc80f1f3f1d9834e9a7cfac31","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/search/localsearch.njk","hash":"661f7acae43f0be694266323320f977d84119abe","modified":1652948287505},{"_id":"themes/next_8.8/layout/_partials/sidebar/site-overview.njk","hash":"3d8591bb92df77ceb9d5b07bc76da1ca89e5bd76","modified":1652948287505},{"_id":"themes/next_8.8/layout/_third-party/analytics/baidu-analytics.njk","hash":"6215309aee028dcb734452beec448c5afb6c63fc","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/analytics/cloudflare.njk","hash":"c978e9efd472c4825f93b83524b11f1c4f7efaab","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/analytics/google-analytics.njk","hash":"d89066ff53879693f023e540d59c86137172c529","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/analytics/growingio.njk","hash":"8afaa772c390bd9d53a5cff9645ac3168334eb98","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/analytics/index.njk","hash":"2d36a481a70d5f450f1f166dc556ac1218b18537","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/chat/chatra.njk","hash":"d7263fca16d0278ccf1f6aa1c6df6902a6344a09","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/chat/gitter.njk","hash":"f8cc14b7aa949999a1faaeb7855e2f20b59a386d","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/chat/tidio.njk","hash":"02aab857c27fc103216029be991688b12a73a525","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/comments/changyan.njk","hash":"d1c950f8fbdf85e7a3eae5463767a89e858e8220","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/comments/disqus.njk","hash":"9375b19a89b7fa9474e558d085af5448d4c5c50c","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/comments/disqusjs.njk","hash":"0749cb6902baecdfd01f779a2a2513f6d2f6a823","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/comments/gitalk.njk","hash":"b63b7e2ede0d3e66e732fa1a06bda9b19e1e85d4","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/comments/isso.njk","hash":"64cc3bdaf644fd32c0d0a247f29f5b6904da9af3","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/comments/livere.njk","hash":"3b13b09fba84ec6000886890a6710736a2b8fafe","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/comments/utterances.njk","hash":"5a94032bc3512a10ad4328fc19ec07b819a1d687","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/math/index.njk","hash":"abf37fc55aa86702118e8fdf5bf2d389dd589aa0","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/math/katex.njk","hash":"d82c24136bbd3443b85f07f5579845833b594684","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/math/mathjax.njk","hash":"3677017fd4572b158311f5f5d870590ab25184e0","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/search/algolia-search.njk","hash":"24ed76e0c72a25ac152820c750a05826a706b6f4","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/search/localsearch.njk","hash":"e45ea3542cdc9ed7ec8447b5e6f35df4c5e82758","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/statistics/busuanzi-counter.njk","hash":"a4bc501da0f22f7e420f0ca47e83988ce90b1368","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/statistics/firestore.njk","hash":"d32ebe94560fa95824478ebbff531bffc47b194d","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/statistics/index.njk","hash":"568ddf7955d11d93fb5e842b403a7ac8b1b7fdb1","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/statistics/lean-analytics.njk","hash":"2446e748cdc102c78492216319ac02148db7daf6","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/tags/mermaid.njk","hash":"099e031f52fb8e47b3af5b2684737efc9e643ee7","modified":1652948287508},{"_id":"themes/next_8.8/layout/_third-party/tags/pdf.njk","hash":"2c81984cc4f5123103460442f6e046f5b6c97127","modified":1652948287508},{"_id":"themes/next_8.8/scripts/events/lib/config.js","hash":"b0ced2583fdd505da3ef27a9db9c55cc7b936732","modified":1652948287508},{"_id":"themes/next_8.8/scripts/events/lib/highlight.js","hash":"6aec7b2c38c50989a23bfaa0d560e75c7f553e12","modified":1652948287508},{"_id":"themes/next_8.8/scripts/events/lib/utils.js","hash":"b281be775b693f9bf32766c8f6ef703c72ac9b00","modified":1652948287508},{"_id":"themes/next_8.8/scripts/events/lib/injects.js","hash":"d987709267a1bc6e5014411e9983d7c49c102c16","modified":1652948287508},{"_id":"themes/next_8.8/scripts/events/lib/vendors.js","hash":"08dac57e15c9f06c7cf54884b045f2362595f9d2","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/comment/changyan.js","hash":"aa05e6b3d613a756178b8ba06832ad27499d4c14","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/comment/common.js","hash":"2486f3e0150c753e5f3af1a3665d074704b8ee2c","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/comment/default-config.js","hash":"93ee5f9109dad885dc38c49bcee630c10f9dce6e","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/comment/disqus.js","hash":"7f71d6b271ba65ff333d5682e7575711d368c0d2","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/comment/gitalk.js","hash":"7bb7dafdd7f6bca8464b54e17e552ce7f1714195","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/comment/disqusjs.js","hash":"135b87d151055eefdbc711d9e704b112b3214a84","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/comment/isso.js","hash":"ff8b5b5145220a17d0ecd9508ba9bd2d3b2da47d","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/comment/livere.js","hash":"5a07d8bb52bc1d51a624ca8db54be144566c306b","modified":1652948287508},{"_id":"themes/next_8.8/scripts/filters/comment/utterances.js","hash":"d3bded697bc32dace689d2a6dfb6eb7514169d15","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_variables/Gemini.styl","hash":"96e0a7c2a65ce68215e17e369085b2ea2f1334f2","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_variables/Mist.styl","hash":"e1fbf169b9b6a194b518240cbd06ec3c48b83d61","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_variables/Muse.styl","hash":"e3be898f5ebcf435a26542653a9297ff2c71aeb0","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_variables/Pisces.styl","hash":"c65536a128b9bc9dbe2fbb1b235a3cded2891002","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_variables/base.styl","hash":"163c7441d777bee87042d475e6ce0fde199add28","modified":1652948287511},{"_id":"themes/next_8.8/source/js/schemes/muse.js","hash":"9a836d2bcc3defe4bd1ee51f5f4eb7006ebdd41b","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/fancybox.js","hash":"c098d14e65dd170537134358d4b8359ad0539c2c","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/quicklink.js","hash":"6f58cd7aa8f6f1ab92d5a96551add293f4e55312","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/rating.js","hash":"4e92c2d107ba47b47826829f9668030d5ea9bfb8","modified":1652948287515},{"_id":"themes/next_8.8/source/css/_common/components/back-to-top.styl","hash":"bab653bcf226311381e8411a0492202f1bf1fce9","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/index.styl","hash":"fe1868f47681e00a33a96199302be85377282f63","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/reading-progress.styl","hash":"90a86045a33c1bae49fc2f6fa1e1b53170c7f77b","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/outline/index.styl","hash":"8e34df131830d4fa3725e4590a672ba1cf1903e5","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/outline/mobile.styl","hash":"64775c729512b30b144ab5ae9dc4a4dfd4e13f35","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/base.styl","hash":"0805d7db96b6c83b31e8d023d1ae88f6d2969133","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/base.styl_backup","hash":"d0a7c99095f490b0d2ed6b1be43d435960798cec","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/buttons.styl","hash":"a042571d85ff7265f799004239a45f36b716b8a6","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/comments.styl","hash":"e4fecc889ba3317a64e9abba5842c79dff9b7827","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/index.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/pagination.styl","hash":"b5c7782368889fa9fd93807d28ff2daf270e3703","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/toggles.styl","hash":"572a41499391677d84b16d8dbd6a996a3d5ce041","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Gemini/index.styl","hash":"fd49b521d67eaccc629f77b4e095cb7310327565","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tables.styl","hash":"e840b23d33023e6d45e018f6e84b683dd56efd8d","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Mist/_header.styl","hash":"4817e77577896ab5c0da434549917ee703a3f4cf","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Mist/_menu.styl","hash":"357b899ac0f0dfbbbebf1ea972030c7cefa463ce","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Mist/index.styl","hash":"ab16a3dcdc0393b9b582ef59dcc13db9320e917c","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Mist/_layout.styl","hash":"5604ac1e161099a4d3e5657d53507268866dc717","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Mist/_posts-expand.styl","hash":"b332868d76d9f1651efd65abfc0d3c9d699b1a45","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Muse/_header.styl","hash":"06080fd963c904d96c00eff098a284e337953013","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Muse/_layout.styl","hash":"82a29572dd90451f75358a2ee2522b87304a0bb8","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Muse/_menu.styl","hash":"8a70d51d8f7cd113e5fbc9f0e70c46a072f282c8","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Muse/_sidebar.styl","hash":"944364893bd7160d954c10ba931af641c91515a4","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Pisces/_header.styl","hash":"b741ab96e73370711c63a6581159f2ea8b5bfa1b","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Pisces/_layout.styl","hash":"6eee86c8f0175d6c09e434053516cd8556f78d44","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Pisces/_menu.styl","hash":"72dc825c50357402c342d62ab60fc0c478ab6bc1","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Pisces/_sidebar.styl","hash":"d9141e6e14a56b5952488101e9a8388c2170e270","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Pisces/index.styl","hash":"8000075b227749a7495eaf417cac6ccfbe441580","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_schemes/Pisces/_sub-menu.styl","hash":"778ed2ad5643b93970c95626b325defeb586733f","modified":1652948287511},{"_id":"themes/next_8.8/source/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/analytics/google-analytics.js","hash":"59684383385059dc4f8a1ff85dbbeb703bcdbcb5","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/chat/gitter.js","hash":"cc38c94125f90dadde11b5ebac7d8bf99a1a08a2","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/comments/changyan.js","hash":"8c8ebec444c727b704ea41ad88b0b96ed2e4b8d4","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/comments/disqusjs.js","hash":"b6c58f098473b526d6a3cd35655caf34b77f7cff","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/comments/disqus.js","hash":"e1cc671b0d524864fd445e3ab4ade9ee6d07e565","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/search/local-search.js","hash":"45c485f82258d246f37deb66884bd2643323ef3a","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/search/algolia-search.js","hash":"ac401e3736d56a3c9cb85ab885744cce0b813c55","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/statistics/lean-analytics.js","hash":"5a928990856b8e456f0663cf3b6b406733672e39","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/statistics/firestore.js","hash":"0960f16107ed61452fb0dffc6ed22dc143de34ef","modified":1652948287515},{"_id":"themes/next_8.8/source/css/_common/components/pages/breadcrumb.styl","hash":"8afdc311c6b8db121758371f95cf1c5e77354f42","modified":1652948287508},{"_id":"themes/next_8.8/source/js/third-party/tags/mermaid.js","hash":"3dc4628efa6debd6490fc0ebddff2424a7b319d8","modified":1652948287515},{"_id":"themes/next_8.8/source/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1652948287515},{"_id":"themes/next_8.8/source/css/_common/components/pages/categories.styl","hash":"b6e2eb1550a7845cb2adf86081a4ab6c7bde1e68","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/pages/index.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/pages/tag-cloud.styl","hash":"1a81d1a71fcf0699629ce6e72dfd0a15f3a2dd0a","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/pages/schedule.styl","hash":"6b816c2511242ee503fb5f34cd3e4dcdafc06b85","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/post/index.styl","hash":"d0805a763176b3c0003967401644f41dfe3bc9e8","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/post/post-body.styl","hash":"ea351936d71e0b6259febac3d7d56d1be6927bf9","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/post/post-collapse.styl","hash":"ec37a36e94ba791663607a5022f763915778578f","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/post/post-followme.styl","hash":"fc1a7bac6493f24aa50665574f37f3dd954f210c","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/post/post-gallery.styl","hash":"aa366d37389760c8595529b850f461569577a1c5","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/post/post-footer.styl","hash":"1d284f3ea03ba9b4feb76b375e539a8e0bccf1c3","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/post/post-header.styl","hash":"010c901e4ef49a606f8a350efbf09044e76d2ff3","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/post/post-nav.styl","hash":"9ac6f477177264c26a46e8333b8456720a0444dc","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/post/post-reward.styl","hash":"07cff69f2d57e6321595f64c16d8b763dc88df6a","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/third-party/gitalk.styl","hash":"070737d101e7cd58e997e8c7af09958268c43a21","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/third-party/disqusjs.styl","hash":"c2326ee3e8b724d99c24a818ddee32813ea5bf89","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/post/post-widgets.styl","hash":"b6677dc2a2368084ab82bb4f145ac79e5966c150","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/third-party/related-posts.styl","hash":"41ed817e1eb64078074e245e771446ee041e5790","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/third-party/math.styl","hash":"9d995eb4871a6c273d9d51558676a1fdabf69e72","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/third-party/index.styl","hash":"fb0b9eaca498be8af0bc430171a17becf87f8554","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/third-party/utterances.styl","hash":"56d90ae0559caa55b75f3c300ff2711f9ed65fc4","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/components/third-party/search.styl","hash":"e72799ce3f9b79753e365b2f8c8ef6c310668d4a","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/outline/footer/index.styl","hash":"8b9407e5cfd0571ef8de7df19022b268f962fa2f","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/outline/header/github-banner.styl","hash":"38c64c2d04e46848382bfa246a0e9c508294767b","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/outline/header/bookmark.styl","hash":"e74f4bb47a101b014ee2a1783c87f3b87323f9a0","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/outline/header/index.styl","hash":"650ed4ad6df1b6ff04647e7b6d568304e4d3ed2e","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/outline/header/menu.styl","hash":"392fd53a8dd4e3f33a853ebb24290a622300e0ff","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/outline/header/site-meta.styl","hash":"759e582d34d08e3386c55d87a835a9523608619f","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/index.styl","hash":"cee43480eba028c37d51cb620c2d81486aa24e01","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/outline/header/site-nav.styl","hash":"bf3ad8b4268f763a1e26377681644887694bc009","modified":1652948287508},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"5b38ac4a0f1ade0e681aff0e3366c481d9cf3dcd","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"52fc98b1435129eb3edb9293ced9e507741f1350","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-dimmer.styl","hash":"fbdb63c6a8887d19b7137325ba7d6806f728139c","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"9950c3188a28e1c63b5498b7bdcd14b12ace3e28","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"b926e368f702f8686aaa2eb98d3d2e533418958c","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"ee94a1a27090ad24e3ed579093088d97ff96d77d","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"021a37cf178440cc341940a299d3bca359996c6b","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/site-state.styl","hash":"26dd0adfcb1db6df29c6090c8d7e9b5a43583fb0","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"3103b81fc76b59e1e2c161e2c484625c770ed66f","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/highlight/index.styl","hash":"0b3e2696eca39781c3524b2c5a2555ebc616e6e8","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"83ee4993710fc8daa1c8dbfccd5d5091fd244c30","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/index.styl","hash":"3f76c73a891bbc10679753e702feba9e8a5ffdd2","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"d6418fd2bbfba7b73ddf11ec62db9637fdf5d8af","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"393ff96234e4196b569d4b11496774eb78e147de","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/label.styl","hash":"debee14539272fbe3835a7d3853af2230baa3501","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/link-grid.styl","hash":"7f8a7345e6537a62cd9e9a94c8f7065b541d9b04","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/mermaid.styl","hash":"48d35dba575a7c9e8845b16652e76b7d4a4646de","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/note.styl","hash":"d27fbf7799695295dd5860a161a13ac4d90c5ba4","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/pdf.styl","hash":"b6654a1d7cf82577d8263faffee8af3ad4a5c0e8","modified":1652948287511},{"_id":"themes/next_8.8/source/css/_common/scaffolding/tags/tabs.styl","hash":"9b34143aec49e390e18f380026a45096f7477722","modified":1652948287511},{"_id":"themes/next_8.8/source/images/avatar.jpg","hash":"ed5dde31684ebfd99e9965da1140fb919496f1d3","modified":1652948287511},{"_id":"themes/next_8.8/source/images/avatar_300.jpg","hash":"13b3ca4593cd3c96d4f973b26ec9dbe51e28ed29","modified":1652948287511},{"_id":"themes/next_8.8/source/images/avatar_500.jpg","hash":"fa083b4b1260c2ee43810fc4819e958196ff7d49","modified":1652948287511},{"_id":"public/baidusitemap.xml","hash":"0a5920ddd8b556d5e166cd66f068d83ab2793a08","modified":1656299245609},{"_id":"public/sitemap.xml","hash":"e4d92c3644bfe6c0d901ceb75347f21474948974","modified":1656299245609},{"_id":"public/about/index.html","hash":"7526cdc4ace51e23e022f9a04a97c39b81f73d0e","modified":1656060677832},{"_id":"public/categories/index.html","hash":"de9fb4934930e37b42a05de74137de1fbdb28857","modified":1656060677832},{"_id":"public/tags/index.html","hash":"d931fc6618e69950d1e811fe18ad9cee2e4bf35d","modified":1656060677832},{"_id":"public/posts/1174cd5f/index.html","hash":"0040aa1bc8e4be13799f27fe306ff21eb92abb8c","modified":1656060677832},{"_id":"public/posts/b34f5ff8/index.html","hash":"fc2cd3a33242b1e578a85a7a4db254eee924f859","modified":1656060677832},{"_id":"public/posts/85027f36/index.html","hash":"6b7f9b0ff2df21ebda4b050b2dab8547b6b2d55b","modified":1656060677832},{"_id":"public/posts/5fb5d34d/index.html","hash":"40d8822d17cd1c1e65bd91fb1f0115520f35b4fb","modified":1656060677832},{"_id":"public/posts/e537690a/index.html","hash":"d190b7fd0726572cecb4b4596028a83663f90a69","modified":1656060677832},{"_id":"public/archives/page/3/index.html","hash":"98c8dec2d5a2aaffd257838e3bc96a7eebdfde05","modified":1656060677832},{"_id":"public/archives/2021/index.html","hash":"0b1296a091b66e6f400c2247c28769c11bdc467d","modified":1656060677832},{"_id":"public/archives/2021/12/index.html","hash":"9218f6c7f726a535c228c4ecde846dc7f452b3f0","modified":1656060677832},{"_id":"public/archives/2022/page/2/index.html","hash":"7a9b61fa0984c4f307f5f2e922723b2a7f47028c","modified":1656060677832},{"_id":"public/archives/2022/01/index.html","hash":"4e8edea62d7234efd093602527d8d9a755c37334","modified":1656060677832},{"_id":"public/archives/2022/02/index.html","hash":"4100720bc5b97a1307aec361bcf65a5f19b77052","modified":1656060677832},{"_id":"public/archives/2022/04/index.html","hash":"035b28ada6301e04c10cfd98c3c720c61b2af534","modified":1656060677832},{"_id":"public/archives/2022/05/index.html","hash":"94f23b66adf446da29b38abbe52ab5ab3e7bbbbc","modified":1656060677832},{"_id":"public/archives/2022/06/index.html","hash":"40b55e07821809f3e3a6e4052e23eb0255311521","modified":1656060677832},{"_id":"public/categories/Programming/page/2/index.html","hash":"be0504026fa3ce424cc221cc7fc8a534e931941f","modified":1656060677832},{"_id":"public/categories/Programming/Tools/index.html","hash":"f40b37c5bd685fdf12703543d5eb13400230a747","modified":1656060677832},{"_id":"public/categories/Programming/Algorithm/index.html","hash":"53522b9ced58d7640d84afd3d784c23e7c10660e","modified":1656060677832},{"_id":"public/categories/Programming/Open-Source-Project/index.html","hash":"234f3f34333cf06f6629be193d8aa9e71c7ebb3f","modified":1656060677832},{"_id":"public/categories/Machine-Learning/index.html","hash":"489281451dcc653a9227c2fcdf040e37341fef9a","modified":1656060677832},{"_id":"public/categories/Programming/Tools/Shell/index.html","hash":"07dce33a19c50fce3550fcc64e783f2a2c4931d1","modified":1656060677832},{"_id":"public/categories/Programming/Tools/Hexo/index.html","hash":"83fb55962c14ab5a007b3cf79949a81de32291ae","modified":1656060677832},{"_id":"public/categories/Programming/Utile/index.html","hash":"c851a902d4d96eb1417ba6148df600a95a812f8d","modified":1656060677832},{"_id":"public/categories/Programming/Open-Source-Project/C/index.html","hash":"ddd0eec9172b890fa2859e28125e853e7769bd9a","modified":1656060677832},{"_id":"public/categories/Programming/Tools/Vim/index.html","hash":"8ac6abcbc207ec563568c65af5af6a9636b2ed7f","modified":1656060677832},{"_id":"public/categories/Programming/Tools/Revealjs/index.html","hash":"a6c78bd19db59c809675725e821be6335d092a5c","modified":1656060677832},{"_id":"public/categories/Programming/Tools/Linux/index.html","hash":"22432c650c8ab0e5b6dd8959eb09b891e2b06f7d","modified":1656060677832},{"_id":"public/categories/Programming/Tools/Git/index.html","hash":"cf5eb0f702bc89b4cbeb1f1a830fae2ffb2ff7fb","modified":1656060677832},{"_id":"public/categories/Programming/Tools/Windows/index.html","hash":"af5efb6707cf649ce17e0fcc438425503aa7437c","modified":1656060677832},{"_id":"public/categories/Machine-Learning/Experiments/index.html","hash":"90ae64392ad0d818e1fc2e18aff26717c5811548","modified":1656060677832},{"_id":"public/categories/Machine-Learning/Methods/index.html","hash":"ac52a0ff93f6cdc69df470a975411303b1c1e183","modified":1656060677832},{"_id":"public/categories/Programming/Utile/Compile/index.html","hash":"0f39d6c718839e9096d4acfd2fc5d1c69d08c3e4","modified":1656060677832},{"_id":"public/categories/Machine-Learning/Paper-Reading/index.html","hash":"aa5e62374c36517352cfc3d9baf68881745e7191","modified":1656060677832},{"_id":"public/categories/Programming/Utile/Regex/index.html","hash":"c7b834a339c35abc5de7b0960ebda955653effb9","modified":1656060677832},{"_id":"public/categories/Machine-Learning/Applications/index.html","hash":"c88b09e0e61397f1a48a6bf860052e65e3ecfe2b","modified":1656060677832},{"_id":"public/categories/Machine-Learning/Methods/Reinforcement-Learning/index.html","hash":"a7c79682cae62d69f8d03cbb8efe0125fd013da7","modified":1656060677832},{"_id":"public/categories/Machine-Learning/Methods/Topological-Data-Analysis/index.html","hash":"b1546a2f0444b1d8425582a9c29ed67008154f29","modified":1656060677832},{"_id":"public/categories/Machine-Learning/Methods/Optimization/index.html","hash":"cd3473b44fd045f4cc023d0f3a287e6065f30bf2","modified":1656060677832},{"_id":"public/categories/Machine-Learning/Methods/Generative-Adversarial-Network/index.html","hash":"7522090bcab3b036e455f8548e51c2e9b3d5f7bf","modified":1656060677832},{"_id":"public/categories/Machine-Learning/Applications/Natural-Language-Processing/index.html","hash":"88447ba764541e09aad0975f5b73e34c00d80268","modified":1656060677832},{"_id":"public/page/3/index.html","hash":"9ce13346ca58e5edc1aa788460389b42b3bdefa5","modified":1656060677832},{"_id":"public/tags/Algorithm/index.html","hash":"27969dd146d76020efd689b3da5c995959963013","modified":1656060677832},{"_id":"public/tags/Programming/index.html","hash":"4249936ee3d7939551c03424e27c9b4ab33e32a0","modified":1656060677832},{"_id":"public/tags/Git/index.html","hash":"41012b9c00281d36a7e87bdba09f1854bebfcf6a","modified":1656060677832},{"_id":"public/tags/Arch-Linux/index.html","hash":"11f3c45b6d9bd6f92feddaa66c4604f5bb82b62d","modified":1656060677832},{"_id":"public/tags/Bash/index.html","hash":"ff31301797230fd3febd1a06bfcb22e2465663b5","modified":1656060677832},{"_id":"public/tags/C/index.html","hash":"0bc93975a20c733a1ac95480248f44cb31ccbd16","modified":1656060677832},{"_id":"public/tags/Vim/index.html","hash":"ae3df78e74e2ecff65b8854fcce9fbef234614f6","modified":1656060677832},{"_id":"public/tags/Hexo/index.html","hash":"71bcb7e5740604180b2187e6b9d2739cb2fa4d4f","modified":1656060677832},{"_id":"public/tags/Personal-Thought/index.html","hash":"81c6e97aafd92f609388f71de12da79df5004e6b","modified":1656060677832},{"_id":"public/tags/Experiments/index.html","hash":"9a87820b47163c9319faf7c68002c3cfe56098cd","modified":1656060677832},{"_id":"public/tags/private/index.html","hash":"fdc680d5019450f981c75ffd899e353e61e03dcc","modified":1656060677832},{"_id":"public/tags/Reinforcement-Learning/index.html","hash":"0e97fe95c0edf632f83a7fe0ababc454e145c4c4","modified":1656060677832},{"_id":"public/tags/Fish/index.html","hash":"195f375ada5733fdd62103ff4eeab45ef96e6e58","modified":1656060677832},{"_id":"public/tags/Topological-Data-Analysis/index.html","hash":"7a547da3269feff1aa4d03c72f79619aa86185e8","modified":1656060677832},{"_id":"public/tags/Blog/index.html","hash":"7813c13bc490e0483fa0ef02b8ca32b45a7cef76","modified":1656060677832},{"_id":"public/tags/Multi-Task-Training/index.html","hash":"d076848e31b051d06ea5912317e621184c5c9ea9","modified":1656060677832},{"_id":"public/tags/Compile/index.html","hash":"753cc23695693444f0406877ce2d14d8a0a15ecd","modified":1656060677832},{"_id":"public/tags/Paper-Reading/index.html","hash":"a866210352ee8d88dfc772ae1800756cc298600e","modified":1656060677832},{"_id":"public/tags/Regex/index.html","hash":"be611ed65e99e092e1e2fe1921412328054d11d0","modified":1656060677832},{"_id":"public/tags/Revealjs/index.html","hash":"4b468818b527901628703e2e2ef88c0f563055b4","modified":1656060677832},{"_id":"public/tags/PPT/index.html","hash":"0a4c712bd291f8a1532a413a73b65c4e0e2d8f10","modified":1656060677832},{"_id":"public/tags/Linux/index.html","hash":"ccf12634e509ed1be2e9f82da3e50f0342c2f3a0","modified":1656060677832},{"_id":"public/tags/Generative-Adversarial-Network/index.html","hash":"f57e5ae05f6024c875a7e9c5f83c6ef451351197","modified":1656060677832},{"_id":"public/tags/Natural-Language-Processing/index.html","hash":"bc14137101eced9f7dbe645033372029b212e1c9","modified":1656060677832},{"_id":"public/tags/Transformer/index.html","hash":"904852b5061776e22d782834081152eb5e260b44","modified":1656060677832},{"_id":"public/tags/BERT/index.html","hash":"dccef8ddde0a53af713338f9dc4370c339ee7869","modified":1656060677832},{"_id":"public/tags/Windows/index.html","hash":"b26c43eadc4838ef556ad3961883c39925f00bda","modified":1656060677832},{"_id":"public/posts/b132932/index.html","hash":"35750c553ed48fc8cb2b1fc5557b1cb935048d43","modified":1656060677832},{"_id":"public/posts/2c5abc07/index.html","hash":"7e3030974be527897da7195fd94b81977c246133","modified":1656060677832},{"_id":"public/posts/38c4d001/index.html","hash":"3edeed27498296d0e91ea0746a2529aaea2d0884","modified":1656060677832},{"_id":"public/posts/5f500d1b/index.html","hash":"bac6fbe2ddf91740c35a05ee0c42781b384b00d8","modified":1656060677832},{"_id":"public/posts/1e372de2/index.html","hash":"88887d491f994243d81d0627d2795327732c7f0c","modified":1656060677832},{"_id":"public/posts/83c5d7ce/index.html","hash":"3c7b571e8116516ef1aef446f973cf8373bdff59","modified":1656060677832},{"_id":"public/posts/6d8ab470/index.html","hash":"85dde75c1f50f5cffb746bb41f65158817fe85cf","modified":1656060677832},{"_id":"public/posts/730c940e/index.html","hash":"f45054c5fbed85417eadc9810e0402f49c4a42a6","modified":1656060677832},{"_id":"public/posts/6e9b1d38/index.html","hash":"47dbe2e8825fe8cca3409a56f183f8cc2a6a516f","modified":1656060677832},{"_id":"public/posts/617f6293/index.html","hash":"09be74cfc92e310328286e1dc5170925f6505ea4","modified":1656060677832},{"_id":"public/posts/17f44e1a/index.html","hash":"39a6c3f972e6760cb20b82eb2b8f4ed238df0c48","modified":1656301646206},{"_id":"public/posts/b8eefd24/index.html","hash":"b1414f583c692d9c3118938ed4c783595b3fab67","modified":1656060677832},{"_id":"public/posts/bf6e579a/index.html","hash":"fc68b274a23d41664edc2b6550d2a7e273dff5da","modified":1656060677832},{"_id":"public/posts/c94b2364/index.html","hash":"025447e1b56a9172f8b2e3e04f74d85e035657de","modified":1656060677832},{"_id":"public/posts/d13cd4ec/index.html","hash":"bab2a2172143b952e7d3757ad406ba3dfb1e9fc9","modified":1656060677832},{"_id":"public/posts/1e331e4a/index.html","hash":"c374c6fa2bcbbc1c5a70c2480a704017e782dbe3","modified":1656062738809},{"_id":"public/posts/e526ae32/index.html","hash":"488766b403632c4b36b802bae5204ff9efdf5ed1","modified":1656060677832},{"_id":"public/archives/index.html","hash":"6cb15788d442f768ad85fbc9fa8ebac0ac5c6675","modified":1656060677832},{"_id":"public/archives/page/2/index.html","hash":"1bf37bbdbfa75dbf216184c05095e49918f33de3","modified":1656060677832},{"_id":"public/archives/2022/index.html","hash":"b058099202984524128e6f60da92cf3798ee3bfe","modified":1656060677832},{"_id":"public/categories/Programming/index.html","hash":"26ac0590410f562c239464045d71d60643485093","modified":1656060677832},{"_id":"public/index.html","hash":"a279a72fd66abc8235c7997373f5dfb280ad1e02","modified":1656301646206},{"_id":"public/page/2/index.html","hash":"e4357c6736d39c41af6f1576118001799f6eec9a","modified":1656060930919},{"_id":"public/CNAME","hash":"55c55444033af34e797e2d3cb1c1b4cf7889b3db","modified":1656060677832},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1656060677832},{"_id":"public/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1656060677832},{"_id":"public/images/avatar_200.jpg","hash":"4a76d1527e511350c9112e899046a34be59ad278","modified":1656060677832},{"_id":"public/images/avatar_80.jpg","hash":"465e53598964df3852f08794cb73c5e459855e92","modified":1656060677832},{"_id":"public/images/avatar_100.jpg","hash":"a0f0a00c9326c57a5cc181aeb80dfda8e947920a","modified":1656060677832},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1656060677832},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1656060677832},{"_id":"public/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1656060677832},{"_id":"public/images/logo.svg","hash":"2cb74fd3ea2635e015eabc58a8d488aed6cf6417","modified":1656060677832},{"_id":"public/images/ye_16.ico","hash":"b8fb01b5361da89831d232a831a1532e9822bd72","modified":1656060677832},{"_id":"public/images/ye_32.ico","hash":"375c99cd785d93dd989c36604ffbd10ada71322a","modified":1656060677832},{"_id":"public/posts/38c4d001/init.png","hash":"ce9408b49df290f533e154259838d2c75e2e3cf9","modified":1656060677832},{"_id":"public/posts/38c4d001/init.png:Zone.Identifier","hash":"ae356a67d337afa5933e3e679e84854deeace048","modified":1656060677832},{"_id":"public/posts/1e331e4a/policy_network.py","hash":"b3e8f06360cad0084a0656edaed4539f1b01e327","modified":1656060677832},{"_id":"public/posts/1e331e4a/q_learning.py","hash":"3a68ec1153d26f2c18c9d34ee5deb5e495b8dca9","modified":1656060677832},{"_id":"public/posts/c94b2364/ADCM.jpg","hash":"ee5b75f3a063e07624c5f03111f98902d885cd8e","modified":1656060677832},{"_id":"public/posts/c94b2364/Saccader_eq1.jpg","hash":"2ea2a74f960377a6a9d0bc98ecfadd8ba09cd316","modified":1656060677832},{"_id":"public/posts/c94b2364/Saccader_eq2.jpg","hash":"cf5832e89b29e39275d2fa4a2e39592e97f9a39e","modified":1656060677832},{"_id":"public/posts/c94b2364/Saccader_eq3.jpg","hash":"8fa845242bb6f737736d91485ca237e7132e19b5","modified":1656060677832},{"_id":"public/posts/c94b2364/Saccader_gl.jpg","hash":"fb8050f8b71a7c667cfa85672b505b3340d2231b","modified":1656060677832},{"_id":"public/css/hbe.style.css","hash":"b0a0077cb588c0941823905fcc383aa7509ade73","modified":1656060677832},{"_id":"public/lib/hbe.js","hash":"136dba00826bdd086153bf0acb5473aea7183ad1","modified":1656060677832},{"_id":"public/images/avatar.jpg","hash":"ed5dde31684ebfd99e9965da1140fb919496f1d3","modified":1656060677832},{"_id":"public/images/avatar_300.jpg","hash":"13b3ca4593cd3c96d4f973b26ec9dbe51e28ed29","modified":1656060677832},{"_id":"public/posts/c94b2364/Saccader_Cell.jpg","hash":"b17e79bf86bb3422527bf51d200ceceeb53ce936","modified":1656060677832},{"_id":"public/posts/c94b2364/Saccader_Over.jpg","hash":"deaccd942ffca9e163a9f2c9bdfb69251d1004cb","modified":1656060677832},{"_id":"public/baidu_verify_code-hSpd2B5Lfx.html","hash":"39bdf7866b924b617ed930c89d2b5b4a51e99522","modified":1656060677832},{"_id":"public/google0634b644f1031b86.html","hash":"da2e69e3c8a923450ce9571bd6c874c4d48a3c80","modified":1656060677832},{"_id":"public/js/bookmark.js","hash":"0f563ffbf05fad30e854e413ab17ff7164ab5a53","modified":1656060677832},{"_id":"public/css/noscript.css","hash":"54d14cd43dc297950a4a8d39ec9644dd5fc3499f","modified":1656060677832},{"_id":"public/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1656060677832},{"_id":"public/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1656060677832},{"_id":"public/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1656060677832},{"_id":"public/js/motion.js","hash":"9c4c861dfb080b6244d4d9eba33ac686735754f3","modified":1656060677832},{"_id":"public/js/next-boot.js","hash":"48497e2156a10155dc42311633a110c9685692c9","modified":1656060677832},{"_id":"public/js/pjax.js","hash":"919f5281c4a04d11cfd94573ecf57b3dbabd3cc8","modified":1656060677832},{"_id":"public/js/schedule.js","hash":"2b43e2d576a308289880befc27580dbb2aa34439","modified":1656060677832},{"_id":"public/js/utils.js","hash":"e447160d342b1f93df5214b6a733441039ced439","modified":1656060677832},{"_id":"public/js/schemes/muse.js","hash":"9a836d2bcc3defe4bd1ee51f5f4eb7006ebdd41b","modified":1656060677832},{"_id":"public/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1656060677832},{"_id":"public/js/third-party/rating.js","hash":"4e92c2d107ba47b47826829f9668030d5ea9bfb8","modified":1656060677832},{"_id":"public/js/third-party/fancybox.js","hash":"c098d14e65dd170537134358d4b8359ad0539c2c","modified":1656060677832},{"_id":"public/js/third-party/quicklink.js","hash":"6f58cd7aa8f6f1ab92d5a96551add293f4e55312","modified":1656060677832},{"_id":"public/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1656060677832},{"_id":"public/js/third-party/analytics/google-analytics.js","hash":"59684383385059dc4f8a1ff85dbbeb703bcdbcb5","modified":1656060677832},{"_id":"public/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1656060677832},{"_id":"public/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1656060677832},{"_id":"public/js/third-party/chat/gitter.js","hash":"cc38c94125f90dadde11b5ebac7d8bf99a1a08a2","modified":1656060677832},{"_id":"public/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1656060677832},{"_id":"public/js/third-party/comments/changyan.js","hash":"8c8ebec444c727b704ea41ad88b0b96ed2e4b8d4","modified":1656060677832},{"_id":"public/js/third-party/comments/disqus.js","hash":"e1cc671b0d524864fd445e3ab4ade9ee6d07e565","modified":1656060677832},{"_id":"public/js/third-party/comments/disqusjs.js","hash":"b6c58f098473b526d6a3cd35655caf34b77f7cff","modified":1656060677832},{"_id":"public/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1656060677832},{"_id":"public/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1656060677832},{"_id":"public/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1656060677832},{"_id":"public/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1656060677832},{"_id":"public/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1656060677832},{"_id":"public/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1656060677832},{"_id":"public/js/third-party/search/algolia-search.js","hash":"ac401e3736d56a3c9cb85ab885744cce0b813c55","modified":1656060677832},{"_id":"public/js/third-party/search/local-search.js","hash":"45c485f82258d246f37deb66884bd2643323ef3a","modified":1656060677832},{"_id":"public/js/third-party/statistics/firestore.js","hash":"0960f16107ed61452fb0dffc6ed22dc143de34ef","modified":1656060677832},{"_id":"public/js/third-party/statistics/lean-analytics.js","hash":"5a928990856b8e456f0663cf3b6b406733672e39","modified":1656060677832},{"_id":"public/js/third-party/tags/mermaid.js","hash":"3dc4628efa6debd6490fc0ebddff2424a7b319d8","modified":1656060677832},{"_id":"public/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1656060677832},{"_id":"public/css/main.css","hash":"783fbb6fb3d98f3a3d8e424614ab375f886ad00e","modified":1656060677832},{"_id":"public/images/avatar_500.jpg","hash":"fa083b4b1260c2ee43810fc4819e958196ff7d49","modified":1656060677832},{"_id":"public/posts/c94b2364/Tnet_over.jpg","hash":"ed04ca4049c6f909b0bf51ea57ffa9a2b445e1c8","modified":1656060677832},{"_id":"public/posts/d13cd4ec/git.jpg","hash":"db9ed8bb86df7e73d5be3bcae4cc8656e4a7a0ed","modified":1656060677832}],"Category":[{"name":"Programming","_id":"cl4s7rpg50004y7ml42kb04be"},{"name":"Tools","parent":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rpgj000jy7ml79i3g4yk"},{"name":"Algorithm","parent":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rpgm000py7mles300ti3"},{"name":"Open Source Project","parent":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rpgo000uy7mlaasg7smp"},{"name":"Little Things","_id":"cl4s7rpgw001by7ml2fk3g6y7"},{"name":"Machine Learning","_id":"cl4s7rpgy001hy7ml8i3b4zzk"},{"name":"Shell","parent":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rph0001ny7mlhdb4aznq"},{"name":"Hexo","parent":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rph30020y7ml685xhevj"},{"name":"Utile","parent":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rph60029y7mlfiju084b"},{"name":"C","parent":"cl4s7rpgo000uy7mlaasg7smp","_id":"cl4s7rph7002iy7ml3xxwafov"},{"name":"Vim","parent":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rph9002ny7ml2lewfq9k"},{"name":"Revealjs","parent":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rpha002ty7ml34ed565o"},{"name":"Linux","parent":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rphb002yy7ml17x3gsui"},{"name":"Git","parent":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rphd0037y7ml24rs3hnu"},{"name":"Hexo","parent":"cl4s7rpgw001by7ml2fk3g6y7","_id":"cl4s7rphg003ny7mlctaf8wx7"},{"name":"Windows","parent":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rphh003ry7ml51fqezk0"},{"name":"Experiments","parent":"cl4s7rpgy001hy7ml8i3b4zzk","_id":"cl4s7rphh003uy7mlg6kjd4uy"},{"name":"Methods","parent":"cl4s7rpgy001hy7ml8i3b4zzk","_id":"cl4s7rphj0043y7mldhuqa3p0"},{"name":"Compile","parent":"cl4s7rph60029y7mlfiju084b","_id":"cl4s7rphk004ey7ml6hdp1na2"},{"name":"Paper Reading","parent":"cl4s7rpgy001hy7ml8i3b4zzk","_id":"cl4s7rphk004fy7mlad594ooh"},{"name":"Regex","parent":"cl4s7rph60029y7mlfiju084b","_id":"cl4s7rphl004hy7mlcija7onq"},{"name":"Applications","parent":"cl4s7rpgy001hy7ml8i3b4zzk","_id":"cl4s7rphm004qy7mle0abcuwj"},{"name":"Reinforcement Learning","parent":"cl4s7rphj0043y7mldhuqa3p0","_id":"cl4s7rphn004ty7ml0mp74hcb"},{"name":"Topological Data Analysis","parent":"cl4s7rphj0043y7mldhuqa3p0","_id":"cl4s7rphn004vy7ml361y58ay"},{"name":"Optimization","parent":"cl4s7rphj0043y7mldhuqa3p0","_id":"cl4s7rpho004xy7ml9dqv7g2z"},{"name":"Generative Adversarial Network","parent":"cl4s7rphj0043y7mldhuqa3p0","_id":"cl4s7rpho0050y7mlbqo06kk3"},{"name":"Natural Language Processing","parent":"cl4s7rphm004qy7mle0abcuwj","_id":"cl4s7rphp0053y7mlab1xg1gl"}],"Data":[],"Page":[{"title":"about","date":"2021-12-12T13:52:49.000Z","_content":"\n\n\n<!-- I received the B.S. degree in the School of Engineering and Technology, China University of Geosciences (Beijing) in 2015. I am currently working towards the Ph.D degree in the Beijing Key Laboratory of Work Safety Intelligent Monitoring, the Department of EE, BUPT. -->\n\n<!-- I major in deep learning, computer vision, natural language processing, and reinforcement learning. -->\n\n<!-- I am also interested in high performance computing. -->\n\n<br/>\n\n<br/>\n\n---\n\n<br/>\n\n<br/>\n\n> ​     *There is a pleasure in the pathless woods;*\n> ​     *there is a rapture on the lonely shore;*\n> ​     *there is society, where none intrudes,*\n> ​     *by the deep sea, and music in its roar;*\n> ​     *I love not man the less, but nature more...*\n> ​                          *by George Gordon Byron* \n\n","source":"about/index.md","raw":"---\ntitle: about\ndate: 2021-12-12 21:52:49\n---\n\n\n\n<!-- I received the B.S. degree in the School of Engineering and Technology, China University of Geosciences (Beijing) in 2015. I am currently working towards the Ph.D degree in the Beijing Key Laboratory of Work Safety Intelligent Monitoring, the Department of EE, BUPT. -->\n\n<!-- I major in deep learning, computer vision, natural language processing, and reinforcement learning. -->\n\n<!-- I am also interested in high performance computing. -->\n\n<br/>\n\n<br/>\n\n---\n\n<br/>\n\n<br/>\n\n> ​     *There is a pleasure in the pathless woods;*\n> ​     *there is a rapture on the lonely shore;*\n> ​     *there is society, where none intrudes,*\n> ​     *by the deep sea, and music in its roar;*\n> ​     *I love not man the less, but nature more...*\n> ​                          *by George Gordon Byron* \n\n","updated":"2022-05-19T08:18:07.331Z","path":"about/index.html","comments":1,"layout":"page","_id":"cl4s7rpfv0000y7mle9ky9drx","content":"<!-- I received the B.S. degree in the School of Engineering and Technology, China University of Geosciences (Beijing) in 2015. I am currently working towards the Ph.D degree in the Beijing Key Laboratory of Work Safety Intelligent Monitoring, the Department of EE, BUPT. --><!-- I major in deep learning, computer vision, natural language processing, and reinforcement learning. --><!-- I am also interested in high performance computing. --><html><head></head><body><br>\n<br>\n<hr>\n<br>\n<br>\n<blockquote>\n<p>​     <em>There is a pleasure in the pathless woods;</em>\n​     <em>there is a rapture on the lonely shore;</em>\n​     <em>there is society, where none intrudes,</em>\n​     <em>by the deep sea, and music in its roar;</em>\n​     <em>I love not man the less, but nature more…</em>\n​                          <em>by George Gordon Byron</em></p>\n</blockquote>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<!-- I received the B.S. degree in the School of Engineering and Technology, China University of Geosciences (Beijing) in 2015. I am currently working towards the Ph.D degree in the Beijing Key Laboratory of Work Safety Intelligent Monitoring, the Department of EE, BUPT. -->\n<!-- I major in deep learning, computer vision, natural language processing, and reinforcement learning. -->\n<!-- I am also interested in high performance computing. -->\n<br/>\n<br/>\n<hr />\n<br/>\n<br/>\n<blockquote>\n<p>​     <em>There is a pleasure in the pathless woods;</em>\n​     <em>there is a rapture on the lonely shore;</em>\n​     <em>there is society, where none intrudes,</em>\n​     <em>by the deep sea, and music in its roar;</em>\n​     <em>I love not man the less, but nature more…</em>\n​                          <em>by George Gordon Byron</em></p>\n</blockquote>\n"},{"title":"categories","date":"2021-11-24T11:46:36.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2021-11-24 19:46:36\ntype: \"categories\"\n---\n","updated":"2022-05-19T08:18:07.331Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cl4s7rpg30002y7ml0zg6hygl","content":"<html><head></head><body></body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":""},{"title":"tags","date":"2021-12-08T06:48:06.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2021-12-08 14:48:06\ntype: \"tags\"\n---\n","updated":"2022-05-19T08:18:07.331Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cl4s7rpg70006y7mlf4x1g62i","content":"<html><head></head><body></body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":""}],"Post":[{"title":"Algorithm","top":false,"cover":false,"toc":true,"mathjax":true,"description":"遇到过精巧的算法设计","abbrlink":"17f44e1a","date":"2021-12-17T08:26:10.000Z","password":null,"summary":null,"_content":"\n# Backtrack\n\nWe can cope with only simple tasks. But there is only a complex task.\n\nIf we can transfer it into a relative simpler one, do it again and again till we\ncan cope with it.\n\nWhen transfer, the simpler task may have some relationship with the complex one,\ne.g., the complex task gives some restrictions to to the simpler one.\n\n## N-Queens II <font color=magenta>[2022-06-20]</font>\n\n[Hard](https://leetcode.cn/problems/n-queens-ii/)\n\n```python\nclass Solution:\n    def totalNQueens(self, n: int) -> int:\n        def backtrack(row: int) -> int:\n            # fill the row\n            # two kinds of return\n\n            # when row == n, the last row (n - 1) is filled\n            # thus it must be only 1 solution to reach here so return 1\n\n            # if row < n - 1, the solution there is may be multiple solutions\n            # clear the count (count = 0), then find the number of solutions\n            # and return it\n\n            # thus this function calculates the number of  solutions when the first\n            # row - 1 rows is filled, how they are filled are recorded by columns,\n            # diagonal1 and giagonal2\n\n            # two key points:\n            # 1. How the backtrack end: that is the condition return 1\n            # 2. How to transfer the task to a smaller one, that is else.\n\n            # we can crop it if  and only if row == n, thus we only need\n            # to transfer the task to a simpler one till we can crop it\n            if row == n:\n                return 1\n            else:\n                count = 0\n                for i in range(n):\n                    # i is the columns if it is used continue\n                    # two position A and B, if their row -/+ i is the same number\n                    # they are in one diagonal then continue\n                    if i in columns or row - i in diagonal1 or row + i in diagonal2:\n                        continue\n                    columns.add(i)\n                    diagonal1.add(row - i)\n                    diagonal2.add(row + i)\n                    count += backtrack(row + 1)\n                    columns.remove(i)\n                    diagonal1.remove(row - i)\n                    diagonal2.remove(row + i)\n                return count\n\n        columns = set()\n        diagonal1 = set()\n        diagonal2 = set()\n        return backtrack(0)\n```\n\n# Depth First Search\n\n## Find All Possible Recipes from Given Supplies <font color=magenta>[2022-06-24]</font>\n\n[Medium](https://leetcode.cn/problems/find-all-possible-recipes-from-given-supplies/)\n\n```python\nclass Solution:\n    def findAllRecipes(self, recipes: List[str], ingredients: List[List[str]], supplies: List[str]) -> List[str]:\n        res = []\n        def remove_cur(cur_supplies):\n            nex_supplies = set()\n            for i, cur_ingredients in enumerate(ingredients):\n                if cur_ingredients:\n                   # Be careful. How to remove items in a loop\n                    # https://segmentfault.com/a/1190000007214571\n                    cur_ingredients = list(filter(lambda x: x not in cur_supplies, cur_ingredients))\n                    ingredients[i] = cur_ingredients\n                    if not cur_ingredients:\n                        nex_supplies.add(recipes[i])\n                        res.append(recipes[i])\n                        recipes[i] = None\n                        ingredients[i] = None\n            return nex_supplies\n\n        supplies = set(supplies)\n        while supplies:\n            supplies = remove_cur(supplies)\n        return res\n```\n\n## Longest Increasing Path in a Matrix\n\nGiven an $m \\times n$ integers matrix, return the length of the longest\nincreasing path in matrix.\n\nMove direction: left, right, up, or down.\n\n```python\nclass Solution:\n\n    DIRS = [(-1, 0), (1, 0), (0, -1), (0, 1)]\n\n    def longestIncreasingPath(self, matrix: List[List[int]]) -> int:\n        if not matrix:\n            return 0\n\n        @lru_cache(None) # save  the storage\n        def find_max(i, j):\n        # find the next value and try the four directions\n        # return the longest direction.\n            max_ = 1\n            for dr in Solution.DIRS:\n                try_i = i + dr[0]\n                try_j = j + dr[1]\n                # the direction will be discarded if do not meet the condition\n                # and a direction meet the condition will be searched for the next\n                # value first.\n                if 0 <= try_i and try_i < n and 0<= try_j and try_j < m and \\\n                matrix[i][j] < matrix[try_i][try_j]:\n                    max_ = max(max_, find_max(try_i, try_j) + 1)\n                    # The value is increasing, so by setting `matrix[i][j] \\\n                    # < matrix[try_i][try_j]`, a searched position will never\n                    # be searched again.\n            return max_\n\n        n, m = len(matrix), len(matrix[0])\n        res = 0\n        for i in range(n):\n            for j in  range(m):\n                res = max(res, find_max(i, j))\n        return res\n\n```\n\n## Keyboard\n\nA keyboard only have 26 keys, `a~z`. Each key can be only typed `k` times at\nmost.\n\nHow many possible content there is, when the keyboard is typed `n` times?\n\n### Method 1: dfs\n\n```python\n class Solution:\n    # depth first search: from the first letter to the last letter\n    # fill the n positions.\n    def keyboard(self, k: int, n: int) -> int:\n        MOD = 1000000007\n\n        # c is the number of remain letters\n        # n is the number of letters needed to type in\n        # k is the max number that each letter can type\n        @lru_cache(None)\n        def dfs(c, n, k):\n            if n == 0:\n                # no letters is needed any more\n                # only 1 way: type nothing\n                # pick 0 letters\n                return 1\n            if c <= 0:\n                # no letter remained but n is not 0\n                # this is a failed type scheme\n                return 0\n            res = 0\n            for i in range(0, min(n, k) + 1):\n            # there are math.comb(n, i) ways to put i letters\n            # into n position.\n                res += math.comb(n, i) * dfs(c-1, n - i, k) % MOD\n            return res % MOD\n        ans = dfs(26, n, k)\n        return ans % MOD\n```\n\n### Method 2: dynamic programming\n\n```python\nclass Solution:\n    def keyboard(self, k: int, n: int) -> int:\n        MOD = 1000000007\n        res = [[0 for _ in range(27)] for _ in range(n + 1)]\n        # res[i][j] is the number of possibilities when first j letters\n        # is used to fill i positions.\n        # when the position is 0, no matter how many letters are used.\n        # there is only one possibility, i.e., filling nothing.\n        # thus, res[0][i] are all 1.\n        res[0][0] = 1\n        for i in range(27):\n            res[0][i] = 1\n\n        # res[i][j] can be divided into several possibilities.\n        # When 0 letter is filled for the $j^{th}$ letter, res[i][j-1]\n        # when 1 letter is filled for the j-th letter, res[i-1][j-1]\n        # * C_i^1\n        # when 2 letters are filled for the j-th letter, res[i-2][j-1]\n        # * C_i^2\n        # C_i^m represent how many possibilities there are filling m of\n        # the same letters into i positions.\n        # m can be 0, but can not be larger than k or i.\n        for i in range(1, n + 1):\n            for j in range(1, 27):\n                for m in range(min(i + 1, k + 1)):\n                    res[i][j] += res[i - m][j - 1] * math.comb(i, m)\n                    res[i][j] %= MOD\n\n        return res[-1][-1] % MOD\n```\n\n# Dynamic Programming\n\n## Minimum One Bit Operations to Make Integers Zero <font color=magenta>[2022-06-27]</font>\n\n[Really Hard](https://leetcode.cn/problems/minimum-one-bit-operations-to-make-integers-zero/)\n\n```python\nclass Solution:\n    def minimumOneBitOperations(self, n):\n        dp1 = [0 for _ in range(32)]\n    #dp1[i] 表示 仅第 i 位 为 1 时 将 第 i 位变为 0 的最小修改次数\n        res = 0\n        dp1[0] = 1\n        for i  in range(1,32):\n            dp1[i] = dp1[i - 1] + 1 + dp1[i - 1]\n        f = True\n        # 1. 0 变位仅i位为1的过程中，其后每一位都需要经历若干次从0到1,再从1到0的变化\n        # 2. 其后位中若原本就为1,则不会经历第一次从0到1的变化，因为它本身就是1\n        # 所以若把第i位从1变为0,记为dp[i]，是多记录了，因为其后有1\n        # 所以如果其后遇到1的要减去。但是减去的话又多减了，因为其后还有1,所以又加上\n        for i in range(31, -1, -1):\n            if n >> i & 1:\n                if f:\n                    res += dp1[i]\n                    f = False\n                else:\n                    res -= dp1[i]\n                    f = True\n        return res\n```\n\n## The number of palindromes\n\nGiven a string return the number of the palindromes. The substrings are regarded\nas different strings if they are start and end at different position.\n\n```python\nclass Solution:\n    def countSubstrings(self, s: str) -> int:\n        n = len(s)\n        res = [[False for _ in range(n)] for _ in range(n)]\n        # if n == 0, there are 0 palindromes.\n        # if n == 1, there are 1 palindromes.\n        if not n or n == 1:\n            return n\n        ans = n\n\n        for i in range(n):\n            res[0][i] = True\n\n        for i in range(n - 1):\n            res[1][i] = s[i] == s[i + 1]\n            if res[1][i]:\n                ans += 1\n# if n == 2 it will not enter the following circle.\n# if n > 2 it will contnue to caculate palindromes whose length is larger than 2\n        for l in range(2, n):\n            for st in range(n - l):\n                res[l][st] = res[l - 2][st + 1] and s[st] == s[st + l]\n                if res[l][st]:\n                    ans += 1\n        return ans\n```\n\n## Knight Dialer\n\nThe topic is [here](https://leetcode-cn.com/problems/knight-dialer/).\n\n```python\nclass Solution(object):\n    def knightDialer(self, N):\n        MOD = 10**9 + 7\n        # From 0 can reach 4 and 6\n        # From 1 can reach 6 and 8\n        moves = [[4,6],[6,8],[7,9],[4,8],[3,9,0],[],\n                     [1,7,0],[2,6],[1,3],[2,4]]\n\n        # There is dp[i]==1 ways to reach i by one step\n        dp = [1] * 10\n        for hops in range(N-1):\n            dp2 = [0] * 10\n            for node, count in enumerate(dp):\n              # There are count way to reach node by hops + 1 steps\n                for nei in moves[node]:\n                    dp2[nei] += count\n                    dp2[nei] %= MOD\n              # There are dp2[nei] way to reach nei by hops + 2 steps\n            dp = dp2\n        return sum(dp) % MOD\n```\n\n# Linked List\n\n## Find The Minimum and Maximum Number of Nodes Between Critical Points <font color=magenta>[2022-06-18]</font>\n\n[Medium](https://leetcode.cn/problems/find-the-minimum-and-maximum-number-of-nodes-between-critical-points/)\n\n```python\nclass Solution:\n    def nodesBetweenCriticalPoints(self, head: Optional[ListNode]) -> List[int]:\n        import numpy as np\n        cur = head\n        left_sign = 0\n        pre_idx = None\n        start_idx = None\n        min_distance = float('inf')\n        idx = 0\n\n        while cur.next:\n            right_sign = np.sign(cur.next.val - cur.val)\n            if left_sign * right_sign == -1:\n                if not start_idx:\n                    start_idx = idx\n                if pre_idx and idx - pre_idx < min_distance:\n                    min_distance = idx - pre_idx\n\n                pre_idx = idx\n            cur = cur.next\n            left_sign = right_sign\n            idx += 1\n\n        if pre_idx != start_idx:\n            return [min_distance, pre_idx - start_idx]\n        return [-1, -1]\n```\n\n## Reverse a Linked List <font color=magenta>[2022-06-16]</font>\n\n```python\nclass Solution:\n    def reverseList(self, head: ListNode) -> ListNode:\n        if not head or not head.next:\n            return head\n        cur = head.next\n        start = head\n        # head is the last node\n        start.next = None\n        while cur:\n            next_cur = cur.next\n            cur.next = start\n            start = cur\n            cur = next_cur\n        return start\n```\n\n## Reverse Nodes in K-Group <font color=magenta>[2022-06-10]</font>\n\nGiven the head of a linked list, reverse the nodes of the list `k` at a time and\nreturn the modified list.\n\nPython\n\n```python\nclass Solution:\n      # reverse a link node, the length is k\n    def reverse(self, head: ListNode, tail: ListNode, k):\n        current = head\n        crop = head.next\n        for i in range(k - 1):\n            follow = crop.next\n            crop.next = current\n            current = crop\n            crop = follow\n        return current, head\n\n\n    def reverseKGroup(self, head: ListNode, k: int) -> ListNode:\n        dump = ListNode(0)\n        dump.next = head\n\n        current = dump\n        end = current\n\n# while the end has next, check if it has k nodes followed\n        while end.next:\n            start = end.next\n            # check if followed k nodes\n            for i in range(k):\n                end = end.next\n                 # do not have k nodes followed, then do not reverse\n                 # and also the link node have been done, and return.\n                if not end:\n                    return dump.next\n\n# if have k nodes followed\n            follow = end.next\n             # reverse the k nodes and return the reversed start and end\n            r_start, r_end = self.reverse(start, end, k)\n             # connect the reversed k nodes with the original nodes\n            current.next = r_start\n            r_end.next = follow\n            current = r_end\n            end = current\n            # the length of the link node is a multiple of k, and end.next is None, return\n        return dump.next\n```\n\nc++\n\n```c++\nclass Solution {\npublic:\n    // 翻转一个子链表，并且返回新的头与尾\n    pair<ListNode*, ListNode*> myReverse(ListNode* head, ListNode* tail) {\n        ListNode* prev = tail->next;\n        ListNode* p = head;\n        while (prev != tail) {\n            ListNode* nex = p->next;\n            p->next = prev;\n            prev = p;\n            p = nex;\n        }\n        return {tail, head};\n    }\n\n    ListNode* reverseKGroup(ListNode* head, int k) {\n        ListNode* hair = new ListNode(0);\n        hair->next = head;\n        ListNode* pre = hair;\n\n        while (head) {\n            ListNode* tail = pre;\n            // 查看剩余部分长度是否大于等于 k\n            for (int i = 0; i < k; ++i) {\n                tail = tail->next;\n                if (!tail) {\n                    return hair->next;\n                }\n            }\n            ListNode* nex = tail->next;\n            // 这里是 C++17 的写法，也可以写成\n            // pair<ListNode*, ListNode*> result = myReverse(head, tail);\n            // head = result.first;\n            // tail = result.second;\n            tie(head, tail) = myReverse(head, tail);\n            // 把子链表重新接回原链表\n            pre->next = head;\n            tail->next = nex;\n            pre = tail;\n            head = tail->next;\n        }\n\n        return hair->next;\n    }\n};\n\n```\n\n## Palindrome Linked List\n\nGiven the `head` of a singly linked list, return `true` if it is a Palindrome.\n\n```python\nclass Solution:\n    def isPalindrome(self, head: ListNode) -> bool:\n        res = []\n        if not head:\n            return True\n        num = 0\n        first = head\n        while first.next:\n            res.append(first.val)\n            num += 1 # count the length of the linked list\n            first = first.next\n        res.append(first.val) # store all the node value\n        for i in range(num // 2 + 1): # does not need to check all the nodes\n            if res[i] != res[num - i]:\n                return False\n        return True\n```\n\nIf one want only use O(n) time and O(1) storage, must reverse the last half of\nthe linked list.\n\n```python\nclass Solution:\n    def isPalindrome(self, head: ListNode) -> bool:\n        if not head or not head.next:\n            return True\n        def find_the_middle(node):\n            slow = node\n            fast = node\n            while fast.next and fast.next.next:\n                slow = slow.next\n                fast = fast.next.next\n            second_start = slow.next\n            slow.next = None\n            return second_start\n        second_start = find_the_middle(head)\n        def reverse(node):\n            start = node\n            pre = node.next\n            start.next = None\n            while pre:\n                cur = pre\n                pre = pre.next\n                cur.next = start\n                start = cur\n            return start\n        new_start = reverse(second_start)\n        while head and new_start:\n            if head.val != new_start.val:\n                return False\n            head = head.next\n            new_start = new_start.next\n        return True\n```\n\n# String\n\n## Strong Password Checker II <font color=magenta>[2022-06-22]</font>\n\n[Simple](https://leetcode.cn/problems/strong-password-checker-ii/)\n\n```python\nclass Solution:\n    def strongPasswordCheckerII(self, password: str) -> bool:\n        n = len(password)\n\n        if_length = n >= 8\n\n        contain_lower = False\n        contain_upper = False\n        contain_number = False\n        contain_special = False\n        contain_twosame = False\n\n        special = set(\"!@#$%^&*()-+\")\n        pre_char = ''\n        for i in password:\n            if i == pre_char:\n                contain_twosame = True\n            pre_char = i\n            if not contain_lower and i.islower():\n                contain_lower = True\n                continue\n            if not contain_upper and i.isupper():\n                contain_upper = True\n                continue\n            if not contain_number and i.isdigit():\n                contain_number = True\n                continue\n            if not contain_special and i in special:\n                contain_special = True\n                continue\n        return if_length and contain_lower and contain_upper and contain_number and contain_special and not contain_twosame\n```\n\n## Minimum Changes to Make Alternating Binary String\n\nYou are given a string `s` consisting only of the characters `0` and `1`. In one\noperation, you can change any `0` to `1` or vice versa.\n\nThe string is called alternating if no two adjacent characters are equal. Return\nthe minimum number of operations needed to make `s` alternating.\n\n```python\nclass Solution:\n    def minOperations(self, s: str) -> int:\n        n = len(s)\n        # The ans is the operation needed to turn s into `010101`\n        ans = 0\n        for i in range(n):\n            if i % 2 and s[i] != \"1\":\n              ans += 1\n            if not i % 2 and s[i] != \"0\":\n                ans += 1\n        return min(ans, n - ans)\n```\n\n# Sort\n\n## Sort Integers by the Number of 1 Bits <font color=magenta>[2022-06-16]</font>\n\n[here](https://leetcode.cn/problems/sort-integers-by-the-number-of-1-bits/)\n\n```python\nclass Solution:\n    def sortByBits(self, arr: List[int]) -> List[int]:\n        res = []\n        for i in arr:\n            c = 0\n            for s in bin(i):\n                if s == '1':\n                    c += 1\n\n            res.append([c, i])\n        res.sort()\n        return [a[1] for a in res]\n```\n\n```python\nfrom collections import defaultdict as d\n\nclass Solution:\n    def sortByBits(self, arr: List[int]) -> List[int]:\n        dic = d(list)\n\n        for i in arr:\n            c = 0\n            for s in str(bin(i)):\n                if s == \"1\":\n                    c += 1\n            dic[c].append(i)\n\n        output = []\n# The range of integer is less than 0b111111111111111.\n        for j in range(15):\n            if dic[j]:\n                for temp in sorted(dic[j]):\n                    output.append(temp)\n\n        return output\n```\n\n## K Highest Ranked Items Within a Price Range <font color=magenta>[2022-06-13]</font>\n\nThe topic is\n[here](https://leetcode.cn/problems/k-highest-ranked-items-within-a-price-range/).\n\n```python\nclass Solution:\n    def highestRankedKItems(self, grid: List[List[int]], pricing: List[int], start: List[int], k: int) -> List[List[int]]:\n        res = []\n\n        curs = [\n            [0, grid[start[0]][start[1]], start[0], start[1]]\n            ]\n\n# gird set to 0 is to avoid visiting a coordinate for multiple time.\n# The position to set the grid to be 0 is important.\n# in  this example, the price of a coordinate is set to 0 when it is visited by curs.\n# also can set the price to be 0, when it is checked if within the price range.\n# However, this is time expensive, for a position maybe append to curs many times before it is checked.\n# It is the best to set the price to be 0, once it is visited by curs. The curs will not visits it again.\n        grid[start[0]][start[1]] = 0\n\n        r = len(grid)\n        c = len(grid[0])\n\n        dirctions = [[0, 1], [1, 0], [0, -1], [-1, 0]]\n\n        while curs:\n            cur = curs.pop(0)\n            cur_step = cur[0]\n            cur_price = cur[1]\n            cur_row = cur[2]\n            cur_cln = cur[3]\n\n            if pricing[0] <= cur_price <= pricing[1]:\n               res.append(cur)\n\n            for dirction in dirctions:\n                next_step = cur_step + 1\n                next_row = cur_row + dirction[0]\n                next_cln = cur_cln + dirction[1]\n                if 0 <= next_row < r and 0 <= next_cln < c:\n                    next_price = grid[next_row][next_cln]\n                    grid[next_row][next_cln] = 0\n                    if next_price > 0:\n                        curs.append([next_step, next_price,next_row, next_cln])\n\n        res.sort()\n        return [res[2:] for res in res[:k]]\n```\n\n## Wiggle Sort 2\n\nGiven an integer array `nums`, recorder it such that\n`nums[0] < nums[1] > nums[2] < nums[3] > ...`. You may assume the input array\nalways has a valid answer.\n\n```python\nclass Solution:\n    def wiggleSort(self, nums: List[int]) -> None:\n        \"\"\"\n        Do not return anything, modify nums in-place instead.\n        \"\"\"\n        res = []\n        for i in nums:\n            res.append(i)\n        res.sort()\n        n = len(nums)\n        # Because the smaller number is always filled first,\n        # let len(smaller numbers) - len(larger numbers) == 1\n        # if the len(nums) is odd.\n        # if n is even, the small half from 0 to n // 2 - 1\n        # the large half from n // 2 to n - 1\n        # if n is odd, small number from 0 to n // 2\n        # large number from n // 2 + 1 to n - 1,\n        # Thus, no matter n is odd or even, small number from 0 to\n        # (n + 1) // 2 - 1, large number from (n + 1) // 2 to n - 1\n        half = (n + 1) // 2\n        # to avoid that the last small number is equal to the first large\n        # number, fill the small number from *last* to first,\n        # also, fill the large number from last to *first*\n        # ** means that the number should try to be apart.\n\n        # if n is even, half * 2 == n\n        # if n is odd, half * 2 == n + 1\n        for i in range(half):\n            nums[2 * i] = res[half - 1 -i]\n            # len(large number) is smaller than len(small number),\n            # thus, the when i = half -1, maybe no large number anymore\n            try:\n                nums[2 * i + 1] = res[n - 1 - i]\n            except:\n                pass\n```\n\n## Rank Teams by Votes\n\nIn a special ranking system, each voter gives a rank from highest to lowest to\nall teams participated in the competition, e.g., one gives `ABC`, one gives\n`BCA`.\n\nThe ordering of teams is decided by who received the most position-one votes. If\n`A` received the most 1-st place Then `A` is the first. If `B` received the same\nfirst place as `A` then compare the number of second place they received. If `A`\nand `B` received all the places the same number then ordered them by their\nletter, i.e., `A` is in front of `B`.\n\n```python\nclass Solution:\n    def rankTeams(self, votes: List[str]) -> str:\n        n = len(votes[0])\n        # initialization of a hash map, the default value is list [0, 0, ..., 0]\n        # NOTE: How to set defaultdict by lambda without input, it is indeed a function factory.\n        ranking = collections.defaultdict(lambda: [0] * n)\n         # count the vote situation for each team, vid is the name of teams.\n        for vote in votes:\n            for i, vid in enumerate(vote):\n                ranking[vid][i] += 1\n\n        # result is a list, e.g., [('A', [5, 0, 0]), ('B', [0, 2, 3]), ('C', [0, 3, 2])]\n        result = list(ranking.items())\n        # sort the order of letter -ord(x[0]) is regard as the last criterion\n        result.sort(key=lambda x: (x[1], -ord(x[0])), reverse=True)\n        # return the ordered vid\n        return \"\".join([vid for vid, rank in result])\n```\n\n## Number Game\n\nGive a list of numbers. You can `+ 1` or `- 1` at position `i` which is regarded\nas one operator at position `i`. Please return the minimum operators for\nposition `i` to make the list of numbers satisfying\n`nums[a] + 1 == nums[a + 1], 0 <= a <= i`. The original topic is\n[here](https://leetcode.cn/problems/5TxKeK/).\n\n### Analysis\n\nTo satisfying `nums[a] + 1 == nums[a + 1]`, we do not know which number it is\nfor position `i` which makes the operators minimum.\n\nThus we can transform this problem, we make `nums[a] = nums[a] - a`. Then we\nonly need to make each position of the `nums` all equal to the same number. Then\nthe minimum way is to set the number as the median number of `nums`.\n\n<font color=red>NOTE:</font> it is the median number, not the mean value. If the\nlength of the list is even then the median is the mean of the middle two\nnumbers.\n\nIt is easy to prove that the mean value can not bring the minimum operators. For\nexamples, for list `[1, 3, 8]` the mean value is `4` and it needs\n`3 + 1 + 4 = 8` operators to make the list into `[4, 4, 4]`. The median is `3`\nand it needs only `2 + 0 + 5 = 7` operators to make the list into `[3, 3, 3]`.\n\n<font color=blue>The reason for why it is the median.</font>\n\nLet `s` be the value that each position will reach and `m` be the median. If `s`\nis large than `m`, then `#(nums[i] > s) < #(nums[i] < s)`. If set `s = s - 1`,\n`nums[i]` will add `1` operator if `nums[i] > s` and `nums[i]` will decrease `1`\noperator if `nums[i] < s`. For `#(nums[i] > s) < #(nums[i] < s)`, the total\nnumber of operators will decrease. It will always decrease until `s == m`, i.e.,\n`#(nums[i] > s) = #(nums[i] < s)`.\n\n```python\nfrom typing import List\nfrom heapq import heappush, heappushpop\n\n\nclass MedianFinder:\n    def __init__(self):\n        self.small = []  # 大顶堆\n        self.large = []  # 小顶堆\n        self.leftSum = 0\n        self.rightSum = 0\n\n    def add(self, num: int) -> None:\n        # if #small == #large then put the num in large\n        # How to push it in large.\n        # NOTE: not put it in large directly, find the largest value then put it in to the large.\n        # This ensure that large is always larger than small.\n        # #small always smaller than #large and only larger than 1\n        if len(self.small) == len(self.large):\n            leftMax = -heappushpop(self.small, -num)\n            heappush(self.large, leftMax)\n            self.leftSum += num - leftMax\n            self.rightSum += leftMax\n        elif len(self.small) < len(self.large):\n            rightMin = heappushpop(self.large, num)\n            heappush(self.small, -rightMin)\n            self.leftSum += rightMin\n            self.rightSum += num - rightMin\n\n    def getMedian(self) -> float:\n     # self.large[0] is the smallest value in large\n     # -self.small[0] is the largest value in small\n     # get the median if the length is odd, else the mean of the two middle numbers\n        if len(self.small) == len(self.large):\n            return (self.large[0] - self.small[0]) / 2\n        else:\n            return self.large[0]\n\n    def getDiffSum(self) -> float:\n        median = self.getMedian()\n        return self.rightSum - len(self.large) * median + len(self.small) * median - self.leftSum\n\n\nclass Solution:\n    def numsGame(self, nums: List[int]) -> List[int]:\n        MOD = int(1e9 + 7)\n        res = []\n        medianFinder = MedianFinder()\n        for i in range(len(nums)):\n            normalized = nums[i] - i\n            medianFinder.add(normalized)\n            res.append(int(medianFinder.getDiffSum() % MOD))\n        return res\n```\n\n# Dichotomy\n\n## Minimum Garden Perimeter to Collect Enough Apples <font color=magenta>[2022-06-22]</font>\n\n[Medium](https://leetcode.cn/problems/minimum-garden-perimeter-to-collect-enough-apples/)\n\n```python\nclass Solution:\n    def minimumPerimeter(self, neededApples: int) -> int:\n        left, right, ans = 1, 100000, 0\n        while left <= right:\n            mid = (left + right) // 2\n            if 2 * mid * (mid + 1) * (mid * 2 + 1) >= neededApples:\n                ans = mid\n                right = mid - 1\n            else:\n                left = mid + 1\n        return ans * 8\n```\n\n# Greedy\n\n## Longest Chunked Palindrome Decomposition <font color=magenta>[2022-06-19]</font>\n\n[hard](https://leetcode.cn/problems/longest-chunked-palindrome-decomposition/)\n\n```python\nclass Solution:\n    def longestDecomposition(self, text: str) -> int:\n        def get_sub_str(s):\n            n = len(s)\n            for i in range(1 , n // 2 + 1):\n                if s[ : i] == s[n - i : ]:\n                    return i\n            return 0\n\n        ans = 0\n        while text:\n            cur_sub_length = get_sub_str(text)\n            if not cur_sub_length:\n                return ans + 1\n\n            text_length = len(text)\n            text = text[cur_sub_length : text_length  - cur_sub_length]\n            ans += 2\n        return ans\n```\n\n## Orderly Queue <font color=magenta>[2022-06-17]</font>\n\n[Hard](https://leetcode.cn/problems/orderly-queue/)\n\nWhen K >= 2 the minimum queue can be obtained, thus only need to sort it and do\nnot need to know how the minimum queue is obtained.\n\n```python\nclass Solution(object):\n    def orderlyQueue(self, S, K):\n        if K == 1:\n            return min(S[i:] + S[:i] for i in range(len(S)))\n        return \"\".join(sorted(S))\n```\n\n# Brute Force Search\n\n## Number of String That Appear as Substrings in Word <font color=magenta>[2022-06-17]</font>\n\n[Simple](https://leetcode.cn/problems/number-of-strings-that-appear-as-substrings-in-word/)\n\n```python\nclass Solution:\n    def numOfStrings(self, patterns: List[str], word: str) -> int:\n        ans = 0\n        n = len(word)\n        def check(pa):\n            m = len(pa)\n            for i in range(n - m + 1):\n                if word[i : i + m] == pa:\n                    return 1\n            return 0\n\n        for pa in patterns:\n            ans += check(pa)\n        return ans\n```\n\n## Coordinate with Maximum Network Quality <font color=magenta>[2022-05-10]</font>\n\nAn array of network towers `towers` is given, where\n$towers[i] = [x_i, y_i, q_i]$. $x_i$ and $y_i$ are the integral coordinates of\nthe network tower location and $q_i$ is the network quality factor. The network\nquality of `towers[i]` at $(x, y)$ is $q_i / (1 + d)$ where\n$d = \\sqrt{(x - x_i)^2 + (y - y_i)^2}$.\n\nYou are also given an integer `radius`. All the tower is not reachable if and\nonly if `d > radius`.\n\nThe network quality of a location is the sum of network qualities from all\ntowers. Return the location with the maximum network quality.\n\nIf there are multiple coordinates with the same network quality, return the\nlexicographically minimum non-negative coordinate.\n\nConstraints:\n\n1. 1 <= towers.length <= 50\n2. towers[i].length == 3\n3. 0 <= $x_i$, $y_i$, $q_i$ <=50\n4. 1 <= radius <= 50\n\n### Analysis\n\nFor 0 <= $x_i$, $y_i$, $q_i$ <=50, if x or y is large than 51, it can not be the\nanswer. All the network quality will be stronger when x or y is smaller. Thus,\nwe do only need to search within [0, 51].\n\n```python\nimport math\nclass Solution:\n    def bestCoordinate(self, towers: List[List[int]], radius: int) -> List[int]:\n        max_signal, x, y = 0, 0, 0\n        # search from small coordinate to large then we will get the small coordinate first\n        for i in range(51):\n            for j in range(51):\n                signal_ij = 0\n                for tower in towers:\n                    delta_x, delta_y = tower[0] - i, tower[1] - j\n                    d = math.sqrt(delta_x * delta_x + delta_y * delta_y)\n                    # if > radius no quality\n                    if d > radius:\n                        continue\n                      # use floor\n                    signal_ij += math.floor(tower[2] / (1 + d))\n                if signal_ij > max_signal:\n                    max_signal, x, y = signal_ij, i, j\n        return [x, y]\n```\n\n# Flip the Char\n\n## Flip the Char <font color=magenta>[2022-06-16]</font>\n\n[here](https://leetcode.cn/problems/cyJERH/)\n\nThe position 'max_idx' that the number of `0` on the left hand - the number of\n`1` on the left hand get the maximum is the dividing line of `0` and `1`.\n\n```python\nclass Solution:\n    def minFlipsMonoIncr(self, s: str) -> int:\n        num_0 = 0\n        num_1 = 0\n        max_off_set = 0\n        max_num_0 = 0\n        max_num_1 = 0\n        for idx, num in enumerate(s):\n            if num == \"0\":\n                num_0 += 1\n                off_set = num_0 - num_1\n                if off_set > max_off_set:\n                    max_off_set = off_set\n                    max_idx = idx\n                    max_num_0 = num_0\n                    max_num_1 = num_1\n            else:\n                num_1 += 1\n        return num_0 - max_num_0 + max_num_1\n```\n\n# Stack\n\n## Valid Parentheses <font color=magenta>[2022-06-17]</font>\n\n[here](https://leetcode.cn/problems/valid-parentheses/)\n\n```python\nclass Solution:\n    def isValid(self, s: str) -> bool:\n        dic = {')' : '(',\n        '}' : '{',\n        ']' : '['\n        }\n        res = []\n        for i in s:\n            if i in dic:\n                if not res:\n                    return False\n                cur = res.pop()\n                if cur != dic[i]:\n                    return False\n            else:\n                res.append(i)\n        if res:\n            return False\n        return True\n```\n\n# Other\n\n## Random Pick with Weight <font color=magenta>[2022-06-26]</font>\n\n[Medium](https://leetcode.cn/problems/random-pick-with-weight/)\n\n```python\nclass Solution:\n\n    def __init__(self, w: List[int]):\n        self.array = []\n        res = 0\n        for i in w:\n            res += i\n            self.array.append(res)\n        self.sum = res\n\n    def pickIndex(self) -> int:\n        import numpy as np\n        import bisect\n        num = np.random.uniform(0, self.sum, 1)\n        return bisect.bisect_left/right(self.array, num)\n```\n\n## Intersections of Two Arrays II <font color=magenta>[2022-06-25]</font>\n\n[Simple](https://leetcode.cn/problems/intersection-of-two-arrays-ii/)\n\n```python\nclass Solution:\n    def intersect(self, nums1: List[int], nums2: List[int]) -> List[int]:\n        ans = []\n        res1 = defaultdict(lambda : 0)\n        res2 = defaultdict(lambda : 0)\n        for i in nums1:\n            res1[i] += 1\n        for i in nums2:\n            res2[i] += 1\n        for key in res1:\n            if key in res2:\n                num = min(res1[key], res2[key])\n                ans += [key] * num\n        return ans\n```\n\n## Check if There is a Valid Path in a Grid <font color=magenta>[2022-06-21]</font>\n\n[medium](https://leetcode.cn/problems/check-if-there-is-a-valid-path-in-a-grid/)\n\n```python\nclass Solution:\n    def hasValidPath(self, grid: List[List[int]]) -> bool:\n        res = {\n        1 :[[0, -1], [0, 1]],\n        2: [[-1, 0], [1, 0]],\n        3: [[0, -1], [1, 0]],\n        4: [[0, 1], [1, 0]],\n        5: [[0, -1], [-1, 0]],\n        6: [[0, 1], [-1, 0]],\n        }\n        n = len(grid)\n        m = len(grid[0])\n        if n == m == 1:\n            return True\n\n        def to_position(position, direction):\n            return [position[0] + direction[0], position[1] + direction[1]]\n\n        def reach(cur):\n            pre = [0, 0]\n            while cur != [0, 0] and 0 <= cur[0] < n and 0 <= cur[1] < m:\n                nex1 = to_position(cur, res[grid[cur[0]][cur[1]]][0])\n                nex2 = to_position(cur, res[grid[cur[0]][cur[1]]][1])\n                if nex1 != pre and nex2 != pre:\n                    return False\n                # be careful about the position of checking if reach the destination\n                # can not be after `cur = nex`, because it can be reachable only\n                 # checked nex1 or nex2 == pre\n                if cur == [n - 1, m - 1]:\n                    return True\n                nex = nex1 if nex1 != pre else nex2\n                pre = cur\n                cur = nex\n            return False\n        start = [0, 0]\n        cur1 = to_position(start, res[grid[0][0]][0])\n        cur2 = to_position(start, res[grid[0][0]][1])\n        return reach(cur1) or reach(cur2)\n```\n\n## Maximum Number of Visible Points <font color=magenta>[2022-06-19]</font>\n\n[hard](https://leetcode.cn/problems/maximum-number-of-visible-points/)\n\n```python\nclass Solution:\n    def visiblePoints(self, points: List[List[int]], angle: int, location: List[int]) -> int:\n        sameCnt = 0\n        polarDegrees = []\n        for p in points:\n            if p == location:\n                sameCnt += 1\n            else:\n                # obain all the angles the range is (-pi, pi]\n                polarDegrees.append(atan2(p[1] - location[1], p[0] - location[0]))\n\n        polarDegrees.sort()\n\n        n = len(polarDegrees)\n        # and 2 pi, the -pi will changed to pi, and thus -pi and pi\n        # will be adjoined to each other\n        # deg and deg + 2pi are both counted only if the angle is 2pi\n        polarDegrees += [deg + 2 * pi for deg in polarDegrees]\n\n        # change the degree into pi\n        degree = angle * pi / 180\n        # bisect_right/bisect_left require from bisect import xxxx\n        # both bisect_right or bisect_left return the index that the val\n        # placed in to the array and keeps the array ranked.\n\n        # when there are numbers equal to val bisect_right places the val to the right\n        # side of the equaled numbers, thus the returned value is the number of digits\n        # smaller and equil to val in the array\n\n        # bisect_left places the val to the left side of the equaled numbers. Thus the\n        # returned value is the number of digits smaller to the val in the array\n\n        # here bisect_right should be used\n        maxCnt = max((bisect_right(polarDegrees, polarDegrees[i] + degree) - i for i in range(n)), default=0)\n        return maxCnt + sameCnt\n```\n\n## Number of Different Integers in a String <font color=magenta>[2022-06-17]</font>\n\n[here](https://leetcode.cn/problems/number-of-different-integers-in-a-string/)\n\n```python\nclass Solution:\n    def numDifferentIntegers(self, word: str) -> int:\n        res = set()\n        cur = 0\n        word += 'a'\n        flag = False\n        for i in word:\n            if i.isdigit():\n                flag = True\n                cur = cur * 10 + int(i)\n            else:\n                if flag:\n                    res.add(cur)\n                    cur = 0\n                    flag = False\n        return len(res)\n```\n\n## Max Length of Pair Chain <font color=magenta>[2022-06-16]</font>\n\n[here](https://leetcode.cn/problems/maximum-length-of-pair-chain/)\n\n```python\nclass Solution:\n    def findLongestChain(self, pairs: List[List[int]]) -> int:\n        res  = sorted(pairs, key = lambda a: a[1])\n        ans = [res[0]]\n        n = len(res)\n        for i in range(1, n):\n            if ans[-1][-1] < res[i][0]:\n                ans.append(res[i])\n        return len(ans)\n```\n\n## Two City Scheduling <font color=magenta>[2022-06-16]</font>\n\n[here](https://leetcode.cn/problems/two-city-scheduling/)\n\nThink about how to divide these people.\n\n- The gain of changing the people from one city to another is only related to\n  the difference between the costs of a and b.\n- Thus, we can set the cost of a always 0, and set the cost of b to cost(b) -\n  cost(a).\n- The cost of a is always 0 and we only need to pick n people to b which reach\n  the minimum cost.\n\n```python\nclass Solution:\n    def twoCitySchedCost(self, costs: List[List[int]]) -> int:\n        res = [a[1] - a[0] for a in costs]\n        nn = len(res)\n        sort_idx = sorted(range(nn), key = lambda k: res[k], reverse = False)\n        cost = 0\n        for i in range(nn // 2):\n            cost += costs[sort_idx[i]][1]\n        for i in range(nn // 2, nn):\n            cost += costs[sort_idx[i]][0]\n        return cost\n```\n\n## Exchange LCCI <font color=magenta>[2022-06-16]</font>\n\n[here](https://leetcode.cn/problems/exchange-lcci/)\n\n```python\nclass Solution:\n    def exchangeBits(self, num: int) -> int:\n        num_bin = bin(num)\n        n = len(num_bin)\n        res = ''\n        start = 2\n        if n % 2:\n            res += '10'\n            start = 3\n        for i in range(start, n, 2):\n            res += num_bin[i + 1]\n            res += num_bin[i]\n        return int(res, 2)\n```\n\n## The First Char which Only Appears once <font color=magenta>[2022-06-16]</font>\n\nThe topic is\n[here](https://leetcode.cn/problems/di-yi-ge-zhi-chu-xian-yi-ci-de-zi-fu-lcof/).\n\n```python\nclass Solution:\n    def firstUniqChar(self, s: str) -> str:\n        res = collections.defaultdict(lambda: [0, 1])\n        for idx, c in enumerate(s):\n            if not c in res:\n                res[c][0] = idx\n            else:\n                res[c][1] += 1\n        ans = \" \"\n        min_idx = len(s)\n        for i in res:\n            if res[i][1] == 1 and res[i][0] < min_idx:\n                min_idx = res[i][0]\n                ans = i\n        return ans\n```\n\n## The Gas Station\n\nThere are `n` stations along a circular route, where the amount of gas at the\n$i^{th}$ station is gas[i].\n\nA car costs cost[i] of gas to travel from the $i^{th}$ station to its next\n$(i + 1)^{th}$ station.\n\nCan the car run a circle. If can, return the start station. If not, return -1.\nIf there exists a solution, it is guaranteed to be the unique.\n\n```python\nclass Solution:\n    def canCompleteCircuit(self, gas: List[int], cost: List[int]) -> int\n        n = len(gas)\n        res = [0] * n\n        # a car pass station i, it can get gas[i] and cost\n        # cost[i]. Thus gets gas[i] - cost[i].\n\n        # if in station i, gas[i] - cost[i] >= 0, it can\n        # arrive the next station.\n        # after arrive the next station, and gets the station\n        # if the remain >= 0 it can gets the next next station.\n        for i in range(n):\n            res[i] = gas[i] - cost[i]\n        first = 0\n        second = 0\n        sum_ = res[0]\n        key = False\n        # second represents the station the car already getting.\n        # first represents the starting station.\n        # sum_ represents if the car can get the next staion.\n        # if sum_ >= 0, it can, else, it can not.\n        while True:\n            if sum_ >= 0:\n                second += 1\n                if second == n:\n                    second = 0\n                    key = True\n                if key and second == first:\n                    return first\n                sum_ += res[second]\n            else:\n                sum_ -= res[first]\n                first += 1\n                # from 0 to n, first do not find an answer, return -1.\n                if first == n:\n                    return -1\n                else:\n                    if first > second:\n                        second += 1\n                        sum_ += res[second\n```\n\nConsider this, if y is the first station that the car can not arrive from x.\nThat is to say $\\sum_{i = y}^x res[i] < 0$. For a station z between x and y. It\ncan arrive z from x, which means the sum $> 0$. Then from z to y, the sum is\ndefinitely $< 0$. It can not arrive y from z.\n\nThus, if a car can not arrive y from x, it can not arrive y from any station\nbetween x and y. It is no need to search such stations.\n\n```python\nclass Solution:\n    def canCompleteCircuit(self, gas: List[int], cost: List[int]) -> int:\n        n = len(gas)\n        res = [0] * n\n        for i in range(n):\n            res[i] = gas[i] - cost[i]\n        first = 0\n        second = 0\n        sum_ = res[0]\n        key = False\n        while True:\n            if sum_ >= 0:\n                second += 1\n                if second == n:\n                    second = 0\n                    key = True\n                if key and second == first:\n                    return first\n                sum_ += res[second]\n            else:\n            # if can not arrive second + 1, then\n            # starting from second + 1\n                second += 1\n                first = second\n                # if the new starting point equal or bigger than\n                # n, first move from 0 to n fails to find.\n                # if key is True, second + 1 is actually larger than\n                # n, first move from 0 to n fails to find.\n                if first == n or key:\n                    return -1\n                sum_ = res[first]\n```\n\n## Maximum Number of Tasks You Can Assign <font color=magenta>[2022-05-11]</font>\n\nThe topic is\n[here](https://leetcode.cn/problems/maximum-number-of-tasks-you-can-assign/).\n\n### Analysis\n\n1. The task need small strength is preferred.\n2. The worker with large strength is preferred\n\nA wrong code\n\n```python\nclass Solution:\n    def maxTaskAssign(self, tasks: List[int], workers: List[int], pills: int, strength: int) -> int:\n        tasks.sort()\n        workers.sort()\n        n =  len(tasks)\n        m =  len(workers)\n        ans = 0\n        j = 0\n        for i in range(m):\n            if j < n:\n                # A new worker waiting for task\n                if workers[i] >= tasks[j]:\n                    ans += 1\n                    # the task has been assigned, consider the next task\n                    j += 1\n                else:\n                    # if there is pills avaliable\n                    if pills and workers[i] + strength >= tasks[j]:\n                        # use this pill\n                        pills -= 1\n                        ans += 1\n                        j += 1\n        return ans\n```\n\nThis code prefers to use small strength workers, which is wrong. When the\nworkers can do `k` tasks, it must be the top `k` strength workers taking the\nbottom `k` tasks.\n\nThe final answer.\n\n```python\nfrom sortedcontainers import SortedList\n\n\nclass Solution:\n    def maxTaskAssign(self, tasks, workers, pills, strength):\n        n, m = len(tasks), len(workers)\n        tasks.sort()\n        workers.sort()\n\n        def check(mid: int) -> bool:\n            p = pills\n            #  the workers needed to be check\n            ws = SortedList(workers[m - mid:])\n            # tasks from large to small\n            for i in range(mid - 1, -1, -1):\n                if ws[-1] >= tasks[i]:\n                    # tasks[i] is assigned to ws[-1]\n                    ws.pop()\n                else:\n                    if p == 0:\n                        # if does not have pills anymore\n                        return False\n                    # has pills\n                    # Note: find the smallest worker can take the task by pill\n                    rep = ws.bisect_left(tasks[i] - strength)\n                    if rep == len(ws):\n                        return False\n                    p -= 1\n                    ws.pop(rep)\n            return True\n\n        # The scope of k needed to be checked if 1 checked false, answer is 0\n        # if right = min(m, n) checked true, answer is right\n        left, right, ans = 1, min(m, n), 0\n        while left <= right:\n            mid = (left + right) // 2\n            if check(mid):\n                # if mid is true, then ans is larger than mid\n                # find it in [mid + 1, right]\n                ans = mid\n                left = mid + 1\n            else:\n                # if mid is false, then ans is smaller than mid\n                # find it in [left, mid - 1]\n                right = mid - 1\n\n        return ans\n```\n","source":"_posts/Algorithm.md","raw":"---\ntitle: Algorithm\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndescription: 遇到过精巧的算法设计\ncategories:\n  - Programming\n  - Algorithm\ntags:\n  - Algorithm\n  - Programming\nabbrlink: 17f44e1a\ndate: 2021-12-17 16:26:10\npassword:\nsummary:\n---\n\n# Backtrack\n\nWe can cope with only simple tasks. But there is only a complex task.\n\nIf we can transfer it into a relative simpler one, do it again and again till we\ncan cope with it.\n\nWhen transfer, the simpler task may have some relationship with the complex one,\ne.g., the complex task gives some restrictions to to the simpler one.\n\n## N-Queens II <font color=magenta>[2022-06-20]</font>\n\n[Hard](https://leetcode.cn/problems/n-queens-ii/)\n\n```python\nclass Solution:\n    def totalNQueens(self, n: int) -> int:\n        def backtrack(row: int) -> int:\n            # fill the row\n            # two kinds of return\n\n            # when row == n, the last row (n - 1) is filled\n            # thus it must be only 1 solution to reach here so return 1\n\n            # if row < n - 1, the solution there is may be multiple solutions\n            # clear the count (count = 0), then find the number of solutions\n            # and return it\n\n            # thus this function calculates the number of  solutions when the first\n            # row - 1 rows is filled, how they are filled are recorded by columns,\n            # diagonal1 and giagonal2\n\n            # two key points:\n            # 1. How the backtrack end: that is the condition return 1\n            # 2. How to transfer the task to a smaller one, that is else.\n\n            # we can crop it if  and only if row == n, thus we only need\n            # to transfer the task to a simpler one till we can crop it\n            if row == n:\n                return 1\n            else:\n                count = 0\n                for i in range(n):\n                    # i is the columns if it is used continue\n                    # two position A and B, if their row -/+ i is the same number\n                    # they are in one diagonal then continue\n                    if i in columns or row - i in diagonal1 or row + i in diagonal2:\n                        continue\n                    columns.add(i)\n                    diagonal1.add(row - i)\n                    diagonal2.add(row + i)\n                    count += backtrack(row + 1)\n                    columns.remove(i)\n                    diagonal1.remove(row - i)\n                    diagonal2.remove(row + i)\n                return count\n\n        columns = set()\n        diagonal1 = set()\n        diagonal2 = set()\n        return backtrack(0)\n```\n\n# Depth First Search\n\n## Find All Possible Recipes from Given Supplies <font color=magenta>[2022-06-24]</font>\n\n[Medium](https://leetcode.cn/problems/find-all-possible-recipes-from-given-supplies/)\n\n```python\nclass Solution:\n    def findAllRecipes(self, recipes: List[str], ingredients: List[List[str]], supplies: List[str]) -> List[str]:\n        res = []\n        def remove_cur(cur_supplies):\n            nex_supplies = set()\n            for i, cur_ingredients in enumerate(ingredients):\n                if cur_ingredients:\n                   # Be careful. How to remove items in a loop\n                    # https://segmentfault.com/a/1190000007214571\n                    cur_ingredients = list(filter(lambda x: x not in cur_supplies, cur_ingredients))\n                    ingredients[i] = cur_ingredients\n                    if not cur_ingredients:\n                        nex_supplies.add(recipes[i])\n                        res.append(recipes[i])\n                        recipes[i] = None\n                        ingredients[i] = None\n            return nex_supplies\n\n        supplies = set(supplies)\n        while supplies:\n            supplies = remove_cur(supplies)\n        return res\n```\n\n## Longest Increasing Path in a Matrix\n\nGiven an $m \\times n$ integers matrix, return the length of the longest\nincreasing path in matrix.\n\nMove direction: left, right, up, or down.\n\n```python\nclass Solution:\n\n    DIRS = [(-1, 0), (1, 0), (0, -1), (0, 1)]\n\n    def longestIncreasingPath(self, matrix: List[List[int]]) -> int:\n        if not matrix:\n            return 0\n\n        @lru_cache(None) # save  the storage\n        def find_max(i, j):\n        # find the next value and try the four directions\n        # return the longest direction.\n            max_ = 1\n            for dr in Solution.DIRS:\n                try_i = i + dr[0]\n                try_j = j + dr[1]\n                # the direction will be discarded if do not meet the condition\n                # and a direction meet the condition will be searched for the next\n                # value first.\n                if 0 <= try_i and try_i < n and 0<= try_j and try_j < m and \\\n                matrix[i][j] < matrix[try_i][try_j]:\n                    max_ = max(max_, find_max(try_i, try_j) + 1)\n                    # The value is increasing, so by setting `matrix[i][j] \\\n                    # < matrix[try_i][try_j]`, a searched position will never\n                    # be searched again.\n            return max_\n\n        n, m = len(matrix), len(matrix[0])\n        res = 0\n        for i in range(n):\n            for j in  range(m):\n                res = max(res, find_max(i, j))\n        return res\n\n```\n\n## Keyboard\n\nA keyboard only have 26 keys, `a~z`. Each key can be only typed `k` times at\nmost.\n\nHow many possible content there is, when the keyboard is typed `n` times?\n\n### Method 1: dfs\n\n```python\n class Solution:\n    # depth first search: from the first letter to the last letter\n    # fill the n positions.\n    def keyboard(self, k: int, n: int) -> int:\n        MOD = 1000000007\n\n        # c is the number of remain letters\n        # n is the number of letters needed to type in\n        # k is the max number that each letter can type\n        @lru_cache(None)\n        def dfs(c, n, k):\n            if n == 0:\n                # no letters is needed any more\n                # only 1 way: type nothing\n                # pick 0 letters\n                return 1\n            if c <= 0:\n                # no letter remained but n is not 0\n                # this is a failed type scheme\n                return 0\n            res = 0\n            for i in range(0, min(n, k) + 1):\n            # there are math.comb(n, i) ways to put i letters\n            # into n position.\n                res += math.comb(n, i) * dfs(c-1, n - i, k) % MOD\n            return res % MOD\n        ans = dfs(26, n, k)\n        return ans % MOD\n```\n\n### Method 2: dynamic programming\n\n```python\nclass Solution:\n    def keyboard(self, k: int, n: int) -> int:\n        MOD = 1000000007\n        res = [[0 for _ in range(27)] for _ in range(n + 1)]\n        # res[i][j] is the number of possibilities when first j letters\n        # is used to fill i positions.\n        # when the position is 0, no matter how many letters are used.\n        # there is only one possibility, i.e., filling nothing.\n        # thus, res[0][i] are all 1.\n        res[0][0] = 1\n        for i in range(27):\n            res[0][i] = 1\n\n        # res[i][j] can be divided into several possibilities.\n        # When 0 letter is filled for the $j^{th}$ letter, res[i][j-1]\n        # when 1 letter is filled for the j-th letter, res[i-1][j-1]\n        # * C_i^1\n        # when 2 letters are filled for the j-th letter, res[i-2][j-1]\n        # * C_i^2\n        # C_i^m represent how many possibilities there are filling m of\n        # the same letters into i positions.\n        # m can be 0, but can not be larger than k or i.\n        for i in range(1, n + 1):\n            for j in range(1, 27):\n                for m in range(min(i + 1, k + 1)):\n                    res[i][j] += res[i - m][j - 1] * math.comb(i, m)\n                    res[i][j] %= MOD\n\n        return res[-1][-1] % MOD\n```\n\n# Dynamic Programming\n\n## Minimum One Bit Operations to Make Integers Zero <font color=magenta>[2022-06-27]</font>\n\n[Really Hard](https://leetcode.cn/problems/minimum-one-bit-operations-to-make-integers-zero/)\n\n```python\nclass Solution:\n    def minimumOneBitOperations(self, n):\n        dp1 = [0 for _ in range(32)]\n    #dp1[i] 表示 仅第 i 位 为 1 时 将 第 i 位变为 0 的最小修改次数\n        res = 0\n        dp1[0] = 1\n        for i  in range(1,32):\n            dp1[i] = dp1[i - 1] + 1 + dp1[i - 1]\n        f = True\n        # 1. 0 变位仅i位为1的过程中，其后每一位都需要经历若干次从0到1,再从1到0的变化\n        # 2. 其后位中若原本就为1,则不会经历第一次从0到1的变化，因为它本身就是1\n        # 所以若把第i位从1变为0,记为dp[i]，是多记录了，因为其后有1\n        # 所以如果其后遇到1的要减去。但是减去的话又多减了，因为其后还有1,所以又加上\n        for i in range(31, -1, -1):\n            if n >> i & 1:\n                if f:\n                    res += dp1[i]\n                    f = False\n                else:\n                    res -= dp1[i]\n                    f = True\n        return res\n```\n\n## The number of palindromes\n\nGiven a string return the number of the palindromes. The substrings are regarded\nas different strings if they are start and end at different position.\n\n```python\nclass Solution:\n    def countSubstrings(self, s: str) -> int:\n        n = len(s)\n        res = [[False for _ in range(n)] for _ in range(n)]\n        # if n == 0, there are 0 palindromes.\n        # if n == 1, there are 1 palindromes.\n        if not n or n == 1:\n            return n\n        ans = n\n\n        for i in range(n):\n            res[0][i] = True\n\n        for i in range(n - 1):\n            res[1][i] = s[i] == s[i + 1]\n            if res[1][i]:\n                ans += 1\n# if n == 2 it will not enter the following circle.\n# if n > 2 it will contnue to caculate palindromes whose length is larger than 2\n        for l in range(2, n):\n            for st in range(n - l):\n                res[l][st] = res[l - 2][st + 1] and s[st] == s[st + l]\n                if res[l][st]:\n                    ans += 1\n        return ans\n```\n\n## Knight Dialer\n\nThe topic is [here](https://leetcode-cn.com/problems/knight-dialer/).\n\n```python\nclass Solution(object):\n    def knightDialer(self, N):\n        MOD = 10**9 + 7\n        # From 0 can reach 4 and 6\n        # From 1 can reach 6 and 8\n        moves = [[4,6],[6,8],[7,9],[4,8],[3,9,0],[],\n                     [1,7,0],[2,6],[1,3],[2,4]]\n\n        # There is dp[i]==1 ways to reach i by one step\n        dp = [1] * 10\n        for hops in range(N-1):\n            dp2 = [0] * 10\n            for node, count in enumerate(dp):\n              # There are count way to reach node by hops + 1 steps\n                for nei in moves[node]:\n                    dp2[nei] += count\n                    dp2[nei] %= MOD\n              # There are dp2[nei] way to reach nei by hops + 2 steps\n            dp = dp2\n        return sum(dp) % MOD\n```\n\n# Linked List\n\n## Find The Minimum and Maximum Number of Nodes Between Critical Points <font color=magenta>[2022-06-18]</font>\n\n[Medium](https://leetcode.cn/problems/find-the-minimum-and-maximum-number-of-nodes-between-critical-points/)\n\n```python\nclass Solution:\n    def nodesBetweenCriticalPoints(self, head: Optional[ListNode]) -> List[int]:\n        import numpy as np\n        cur = head\n        left_sign = 0\n        pre_idx = None\n        start_idx = None\n        min_distance = float('inf')\n        idx = 0\n\n        while cur.next:\n            right_sign = np.sign(cur.next.val - cur.val)\n            if left_sign * right_sign == -1:\n                if not start_idx:\n                    start_idx = idx\n                if pre_idx and idx - pre_idx < min_distance:\n                    min_distance = idx - pre_idx\n\n                pre_idx = idx\n            cur = cur.next\n            left_sign = right_sign\n            idx += 1\n\n        if pre_idx != start_idx:\n            return [min_distance, pre_idx - start_idx]\n        return [-1, -1]\n```\n\n## Reverse a Linked List <font color=magenta>[2022-06-16]</font>\n\n```python\nclass Solution:\n    def reverseList(self, head: ListNode) -> ListNode:\n        if not head or not head.next:\n            return head\n        cur = head.next\n        start = head\n        # head is the last node\n        start.next = None\n        while cur:\n            next_cur = cur.next\n            cur.next = start\n            start = cur\n            cur = next_cur\n        return start\n```\n\n## Reverse Nodes in K-Group <font color=magenta>[2022-06-10]</font>\n\nGiven the head of a linked list, reverse the nodes of the list `k` at a time and\nreturn the modified list.\n\nPython\n\n```python\nclass Solution:\n      # reverse a link node, the length is k\n    def reverse(self, head: ListNode, tail: ListNode, k):\n        current = head\n        crop = head.next\n        for i in range(k - 1):\n            follow = crop.next\n            crop.next = current\n            current = crop\n            crop = follow\n        return current, head\n\n\n    def reverseKGroup(self, head: ListNode, k: int) -> ListNode:\n        dump = ListNode(0)\n        dump.next = head\n\n        current = dump\n        end = current\n\n# while the end has next, check if it has k nodes followed\n        while end.next:\n            start = end.next\n            # check if followed k nodes\n            for i in range(k):\n                end = end.next\n                 # do not have k nodes followed, then do not reverse\n                 # and also the link node have been done, and return.\n                if not end:\n                    return dump.next\n\n# if have k nodes followed\n            follow = end.next\n             # reverse the k nodes and return the reversed start and end\n            r_start, r_end = self.reverse(start, end, k)\n             # connect the reversed k nodes with the original nodes\n            current.next = r_start\n            r_end.next = follow\n            current = r_end\n            end = current\n            # the length of the link node is a multiple of k, and end.next is None, return\n        return dump.next\n```\n\nc++\n\n```c++\nclass Solution {\npublic:\n    // 翻转一个子链表，并且返回新的头与尾\n    pair<ListNode*, ListNode*> myReverse(ListNode* head, ListNode* tail) {\n        ListNode* prev = tail->next;\n        ListNode* p = head;\n        while (prev != tail) {\n            ListNode* nex = p->next;\n            p->next = prev;\n            prev = p;\n            p = nex;\n        }\n        return {tail, head};\n    }\n\n    ListNode* reverseKGroup(ListNode* head, int k) {\n        ListNode* hair = new ListNode(0);\n        hair->next = head;\n        ListNode* pre = hair;\n\n        while (head) {\n            ListNode* tail = pre;\n            // 查看剩余部分长度是否大于等于 k\n            for (int i = 0; i < k; ++i) {\n                tail = tail->next;\n                if (!tail) {\n                    return hair->next;\n                }\n            }\n            ListNode* nex = tail->next;\n            // 这里是 C++17 的写法，也可以写成\n            // pair<ListNode*, ListNode*> result = myReverse(head, tail);\n            // head = result.first;\n            // tail = result.second;\n            tie(head, tail) = myReverse(head, tail);\n            // 把子链表重新接回原链表\n            pre->next = head;\n            tail->next = nex;\n            pre = tail;\n            head = tail->next;\n        }\n\n        return hair->next;\n    }\n};\n\n```\n\n## Palindrome Linked List\n\nGiven the `head` of a singly linked list, return `true` if it is a Palindrome.\n\n```python\nclass Solution:\n    def isPalindrome(self, head: ListNode) -> bool:\n        res = []\n        if not head:\n            return True\n        num = 0\n        first = head\n        while first.next:\n            res.append(first.val)\n            num += 1 # count the length of the linked list\n            first = first.next\n        res.append(first.val) # store all the node value\n        for i in range(num // 2 + 1): # does not need to check all the nodes\n            if res[i] != res[num - i]:\n                return False\n        return True\n```\n\nIf one want only use O(n) time and O(1) storage, must reverse the last half of\nthe linked list.\n\n```python\nclass Solution:\n    def isPalindrome(self, head: ListNode) -> bool:\n        if not head or not head.next:\n            return True\n        def find_the_middle(node):\n            slow = node\n            fast = node\n            while fast.next and fast.next.next:\n                slow = slow.next\n                fast = fast.next.next\n            second_start = slow.next\n            slow.next = None\n            return second_start\n        second_start = find_the_middle(head)\n        def reverse(node):\n            start = node\n            pre = node.next\n            start.next = None\n            while pre:\n                cur = pre\n                pre = pre.next\n                cur.next = start\n                start = cur\n            return start\n        new_start = reverse(second_start)\n        while head and new_start:\n            if head.val != new_start.val:\n                return False\n            head = head.next\n            new_start = new_start.next\n        return True\n```\n\n# String\n\n## Strong Password Checker II <font color=magenta>[2022-06-22]</font>\n\n[Simple](https://leetcode.cn/problems/strong-password-checker-ii/)\n\n```python\nclass Solution:\n    def strongPasswordCheckerII(self, password: str) -> bool:\n        n = len(password)\n\n        if_length = n >= 8\n\n        contain_lower = False\n        contain_upper = False\n        contain_number = False\n        contain_special = False\n        contain_twosame = False\n\n        special = set(\"!@#$%^&*()-+\")\n        pre_char = ''\n        for i in password:\n            if i == pre_char:\n                contain_twosame = True\n            pre_char = i\n            if not contain_lower and i.islower():\n                contain_lower = True\n                continue\n            if not contain_upper and i.isupper():\n                contain_upper = True\n                continue\n            if not contain_number and i.isdigit():\n                contain_number = True\n                continue\n            if not contain_special and i in special:\n                contain_special = True\n                continue\n        return if_length and contain_lower and contain_upper and contain_number and contain_special and not contain_twosame\n```\n\n## Minimum Changes to Make Alternating Binary String\n\nYou are given a string `s` consisting only of the characters `0` and `1`. In one\noperation, you can change any `0` to `1` or vice versa.\n\nThe string is called alternating if no two adjacent characters are equal. Return\nthe minimum number of operations needed to make `s` alternating.\n\n```python\nclass Solution:\n    def minOperations(self, s: str) -> int:\n        n = len(s)\n        # The ans is the operation needed to turn s into `010101`\n        ans = 0\n        for i in range(n):\n            if i % 2 and s[i] != \"1\":\n              ans += 1\n            if not i % 2 and s[i] != \"0\":\n                ans += 1\n        return min(ans, n - ans)\n```\n\n# Sort\n\n## Sort Integers by the Number of 1 Bits <font color=magenta>[2022-06-16]</font>\n\n[here](https://leetcode.cn/problems/sort-integers-by-the-number-of-1-bits/)\n\n```python\nclass Solution:\n    def sortByBits(self, arr: List[int]) -> List[int]:\n        res = []\n        for i in arr:\n            c = 0\n            for s in bin(i):\n                if s == '1':\n                    c += 1\n\n            res.append([c, i])\n        res.sort()\n        return [a[1] for a in res]\n```\n\n```python\nfrom collections import defaultdict as d\n\nclass Solution:\n    def sortByBits(self, arr: List[int]) -> List[int]:\n        dic = d(list)\n\n        for i in arr:\n            c = 0\n            for s in str(bin(i)):\n                if s == \"1\":\n                    c += 1\n            dic[c].append(i)\n\n        output = []\n# The range of integer is less than 0b111111111111111.\n        for j in range(15):\n            if dic[j]:\n                for temp in sorted(dic[j]):\n                    output.append(temp)\n\n        return output\n```\n\n## K Highest Ranked Items Within a Price Range <font color=magenta>[2022-06-13]</font>\n\nThe topic is\n[here](https://leetcode.cn/problems/k-highest-ranked-items-within-a-price-range/).\n\n```python\nclass Solution:\n    def highestRankedKItems(self, grid: List[List[int]], pricing: List[int], start: List[int], k: int) -> List[List[int]]:\n        res = []\n\n        curs = [\n            [0, grid[start[0]][start[1]], start[0], start[1]]\n            ]\n\n# gird set to 0 is to avoid visiting a coordinate for multiple time.\n# The position to set the grid to be 0 is important.\n# in  this example, the price of a coordinate is set to 0 when it is visited by curs.\n# also can set the price to be 0, when it is checked if within the price range.\n# However, this is time expensive, for a position maybe append to curs many times before it is checked.\n# It is the best to set the price to be 0, once it is visited by curs. The curs will not visits it again.\n        grid[start[0]][start[1]] = 0\n\n        r = len(grid)\n        c = len(grid[0])\n\n        dirctions = [[0, 1], [1, 0], [0, -1], [-1, 0]]\n\n        while curs:\n            cur = curs.pop(0)\n            cur_step = cur[0]\n            cur_price = cur[1]\n            cur_row = cur[2]\n            cur_cln = cur[3]\n\n            if pricing[0] <= cur_price <= pricing[1]:\n               res.append(cur)\n\n            for dirction in dirctions:\n                next_step = cur_step + 1\n                next_row = cur_row + dirction[0]\n                next_cln = cur_cln + dirction[1]\n                if 0 <= next_row < r and 0 <= next_cln < c:\n                    next_price = grid[next_row][next_cln]\n                    grid[next_row][next_cln] = 0\n                    if next_price > 0:\n                        curs.append([next_step, next_price,next_row, next_cln])\n\n        res.sort()\n        return [res[2:] for res in res[:k]]\n```\n\n## Wiggle Sort 2\n\nGiven an integer array `nums`, recorder it such that\n`nums[0] < nums[1] > nums[2] < nums[3] > ...`. You may assume the input array\nalways has a valid answer.\n\n```python\nclass Solution:\n    def wiggleSort(self, nums: List[int]) -> None:\n        \"\"\"\n        Do not return anything, modify nums in-place instead.\n        \"\"\"\n        res = []\n        for i in nums:\n            res.append(i)\n        res.sort()\n        n = len(nums)\n        # Because the smaller number is always filled first,\n        # let len(smaller numbers) - len(larger numbers) == 1\n        # if the len(nums) is odd.\n        # if n is even, the small half from 0 to n // 2 - 1\n        # the large half from n // 2 to n - 1\n        # if n is odd, small number from 0 to n // 2\n        # large number from n // 2 + 1 to n - 1,\n        # Thus, no matter n is odd or even, small number from 0 to\n        # (n + 1) // 2 - 1, large number from (n + 1) // 2 to n - 1\n        half = (n + 1) // 2\n        # to avoid that the last small number is equal to the first large\n        # number, fill the small number from *last* to first,\n        # also, fill the large number from last to *first*\n        # ** means that the number should try to be apart.\n\n        # if n is even, half * 2 == n\n        # if n is odd, half * 2 == n + 1\n        for i in range(half):\n            nums[2 * i] = res[half - 1 -i]\n            # len(large number) is smaller than len(small number),\n            # thus, the when i = half -1, maybe no large number anymore\n            try:\n                nums[2 * i + 1] = res[n - 1 - i]\n            except:\n                pass\n```\n\n## Rank Teams by Votes\n\nIn a special ranking system, each voter gives a rank from highest to lowest to\nall teams participated in the competition, e.g., one gives `ABC`, one gives\n`BCA`.\n\nThe ordering of teams is decided by who received the most position-one votes. If\n`A` received the most 1-st place Then `A` is the first. If `B` received the same\nfirst place as `A` then compare the number of second place they received. If `A`\nand `B` received all the places the same number then ordered them by their\nletter, i.e., `A` is in front of `B`.\n\n```python\nclass Solution:\n    def rankTeams(self, votes: List[str]) -> str:\n        n = len(votes[0])\n        # initialization of a hash map, the default value is list [0, 0, ..., 0]\n        # NOTE: How to set defaultdict by lambda without input, it is indeed a function factory.\n        ranking = collections.defaultdict(lambda: [0] * n)\n         # count the vote situation for each team, vid is the name of teams.\n        for vote in votes:\n            for i, vid in enumerate(vote):\n                ranking[vid][i] += 1\n\n        # result is a list, e.g., [('A', [5, 0, 0]), ('B', [0, 2, 3]), ('C', [0, 3, 2])]\n        result = list(ranking.items())\n        # sort the order of letter -ord(x[0]) is regard as the last criterion\n        result.sort(key=lambda x: (x[1], -ord(x[0])), reverse=True)\n        # return the ordered vid\n        return \"\".join([vid for vid, rank in result])\n```\n\n## Number Game\n\nGive a list of numbers. You can `+ 1` or `- 1` at position `i` which is regarded\nas one operator at position `i`. Please return the minimum operators for\nposition `i` to make the list of numbers satisfying\n`nums[a] + 1 == nums[a + 1], 0 <= a <= i`. The original topic is\n[here](https://leetcode.cn/problems/5TxKeK/).\n\n### Analysis\n\nTo satisfying `nums[a] + 1 == nums[a + 1]`, we do not know which number it is\nfor position `i` which makes the operators minimum.\n\nThus we can transform this problem, we make `nums[a] = nums[a] - a`. Then we\nonly need to make each position of the `nums` all equal to the same number. Then\nthe minimum way is to set the number as the median number of `nums`.\n\n<font color=red>NOTE:</font> it is the median number, not the mean value. If the\nlength of the list is even then the median is the mean of the middle two\nnumbers.\n\nIt is easy to prove that the mean value can not bring the minimum operators. For\nexamples, for list `[1, 3, 8]` the mean value is `4` and it needs\n`3 + 1 + 4 = 8` operators to make the list into `[4, 4, 4]`. The median is `3`\nand it needs only `2 + 0 + 5 = 7` operators to make the list into `[3, 3, 3]`.\n\n<font color=blue>The reason for why it is the median.</font>\n\nLet `s` be the value that each position will reach and `m` be the median. If `s`\nis large than `m`, then `#(nums[i] > s) < #(nums[i] < s)`. If set `s = s - 1`,\n`nums[i]` will add `1` operator if `nums[i] > s` and `nums[i]` will decrease `1`\noperator if `nums[i] < s`. For `#(nums[i] > s) < #(nums[i] < s)`, the total\nnumber of operators will decrease. It will always decrease until `s == m`, i.e.,\n`#(nums[i] > s) = #(nums[i] < s)`.\n\n```python\nfrom typing import List\nfrom heapq import heappush, heappushpop\n\n\nclass MedianFinder:\n    def __init__(self):\n        self.small = []  # 大顶堆\n        self.large = []  # 小顶堆\n        self.leftSum = 0\n        self.rightSum = 0\n\n    def add(self, num: int) -> None:\n        # if #small == #large then put the num in large\n        # How to push it in large.\n        # NOTE: not put it in large directly, find the largest value then put it in to the large.\n        # This ensure that large is always larger than small.\n        # #small always smaller than #large and only larger than 1\n        if len(self.small) == len(self.large):\n            leftMax = -heappushpop(self.small, -num)\n            heappush(self.large, leftMax)\n            self.leftSum += num - leftMax\n            self.rightSum += leftMax\n        elif len(self.small) < len(self.large):\n            rightMin = heappushpop(self.large, num)\n            heappush(self.small, -rightMin)\n            self.leftSum += rightMin\n            self.rightSum += num - rightMin\n\n    def getMedian(self) -> float:\n     # self.large[0] is the smallest value in large\n     # -self.small[0] is the largest value in small\n     # get the median if the length is odd, else the mean of the two middle numbers\n        if len(self.small) == len(self.large):\n            return (self.large[0] - self.small[0]) / 2\n        else:\n            return self.large[0]\n\n    def getDiffSum(self) -> float:\n        median = self.getMedian()\n        return self.rightSum - len(self.large) * median + len(self.small) * median - self.leftSum\n\n\nclass Solution:\n    def numsGame(self, nums: List[int]) -> List[int]:\n        MOD = int(1e9 + 7)\n        res = []\n        medianFinder = MedianFinder()\n        for i in range(len(nums)):\n            normalized = nums[i] - i\n            medianFinder.add(normalized)\n            res.append(int(medianFinder.getDiffSum() % MOD))\n        return res\n```\n\n# Dichotomy\n\n## Minimum Garden Perimeter to Collect Enough Apples <font color=magenta>[2022-06-22]</font>\n\n[Medium](https://leetcode.cn/problems/minimum-garden-perimeter-to-collect-enough-apples/)\n\n```python\nclass Solution:\n    def minimumPerimeter(self, neededApples: int) -> int:\n        left, right, ans = 1, 100000, 0\n        while left <= right:\n            mid = (left + right) // 2\n            if 2 * mid * (mid + 1) * (mid * 2 + 1) >= neededApples:\n                ans = mid\n                right = mid - 1\n            else:\n                left = mid + 1\n        return ans * 8\n```\n\n# Greedy\n\n## Longest Chunked Palindrome Decomposition <font color=magenta>[2022-06-19]</font>\n\n[hard](https://leetcode.cn/problems/longest-chunked-palindrome-decomposition/)\n\n```python\nclass Solution:\n    def longestDecomposition(self, text: str) -> int:\n        def get_sub_str(s):\n            n = len(s)\n            for i in range(1 , n // 2 + 1):\n                if s[ : i] == s[n - i : ]:\n                    return i\n            return 0\n\n        ans = 0\n        while text:\n            cur_sub_length = get_sub_str(text)\n            if not cur_sub_length:\n                return ans + 1\n\n            text_length = len(text)\n            text = text[cur_sub_length : text_length  - cur_sub_length]\n            ans += 2\n        return ans\n```\n\n## Orderly Queue <font color=magenta>[2022-06-17]</font>\n\n[Hard](https://leetcode.cn/problems/orderly-queue/)\n\nWhen K >= 2 the minimum queue can be obtained, thus only need to sort it and do\nnot need to know how the minimum queue is obtained.\n\n```python\nclass Solution(object):\n    def orderlyQueue(self, S, K):\n        if K == 1:\n            return min(S[i:] + S[:i] for i in range(len(S)))\n        return \"\".join(sorted(S))\n```\n\n# Brute Force Search\n\n## Number of String That Appear as Substrings in Word <font color=magenta>[2022-06-17]</font>\n\n[Simple](https://leetcode.cn/problems/number-of-strings-that-appear-as-substrings-in-word/)\n\n```python\nclass Solution:\n    def numOfStrings(self, patterns: List[str], word: str) -> int:\n        ans = 0\n        n = len(word)\n        def check(pa):\n            m = len(pa)\n            for i in range(n - m + 1):\n                if word[i : i + m] == pa:\n                    return 1\n            return 0\n\n        for pa in patterns:\n            ans += check(pa)\n        return ans\n```\n\n## Coordinate with Maximum Network Quality <font color=magenta>[2022-05-10]</font>\n\nAn array of network towers `towers` is given, where\n$towers[i] = [x_i, y_i, q_i]$. $x_i$ and $y_i$ are the integral coordinates of\nthe network tower location and $q_i$ is the network quality factor. The network\nquality of `towers[i]` at $(x, y)$ is $q_i / (1 + d)$ where\n$d = \\sqrt{(x - x_i)^2 + (y - y_i)^2}$.\n\nYou are also given an integer `radius`. All the tower is not reachable if and\nonly if `d > radius`.\n\nThe network quality of a location is the sum of network qualities from all\ntowers. Return the location with the maximum network quality.\n\nIf there are multiple coordinates with the same network quality, return the\nlexicographically minimum non-negative coordinate.\n\nConstraints:\n\n1. 1 <= towers.length <= 50\n2. towers[i].length == 3\n3. 0 <= $x_i$, $y_i$, $q_i$ <=50\n4. 1 <= radius <= 50\n\n### Analysis\n\nFor 0 <= $x_i$, $y_i$, $q_i$ <=50, if x or y is large than 51, it can not be the\nanswer. All the network quality will be stronger when x or y is smaller. Thus,\nwe do only need to search within [0, 51].\n\n```python\nimport math\nclass Solution:\n    def bestCoordinate(self, towers: List[List[int]], radius: int) -> List[int]:\n        max_signal, x, y = 0, 0, 0\n        # search from small coordinate to large then we will get the small coordinate first\n        for i in range(51):\n            for j in range(51):\n                signal_ij = 0\n                for tower in towers:\n                    delta_x, delta_y = tower[0] - i, tower[1] - j\n                    d = math.sqrt(delta_x * delta_x + delta_y * delta_y)\n                    # if > radius no quality\n                    if d > radius:\n                        continue\n                      # use floor\n                    signal_ij += math.floor(tower[2] / (1 + d))\n                if signal_ij > max_signal:\n                    max_signal, x, y = signal_ij, i, j\n        return [x, y]\n```\n\n# Flip the Char\n\n## Flip the Char <font color=magenta>[2022-06-16]</font>\n\n[here](https://leetcode.cn/problems/cyJERH/)\n\nThe position 'max_idx' that the number of `0` on the left hand - the number of\n`1` on the left hand get the maximum is the dividing line of `0` and `1`.\n\n```python\nclass Solution:\n    def minFlipsMonoIncr(self, s: str) -> int:\n        num_0 = 0\n        num_1 = 0\n        max_off_set = 0\n        max_num_0 = 0\n        max_num_1 = 0\n        for idx, num in enumerate(s):\n            if num == \"0\":\n                num_0 += 1\n                off_set = num_0 - num_1\n                if off_set > max_off_set:\n                    max_off_set = off_set\n                    max_idx = idx\n                    max_num_0 = num_0\n                    max_num_1 = num_1\n            else:\n                num_1 += 1\n        return num_0 - max_num_0 + max_num_1\n```\n\n# Stack\n\n## Valid Parentheses <font color=magenta>[2022-06-17]</font>\n\n[here](https://leetcode.cn/problems/valid-parentheses/)\n\n```python\nclass Solution:\n    def isValid(self, s: str) -> bool:\n        dic = {')' : '(',\n        '}' : '{',\n        ']' : '['\n        }\n        res = []\n        for i in s:\n            if i in dic:\n                if not res:\n                    return False\n                cur = res.pop()\n                if cur != dic[i]:\n                    return False\n            else:\n                res.append(i)\n        if res:\n            return False\n        return True\n```\n\n# Other\n\n## Random Pick with Weight <font color=magenta>[2022-06-26]</font>\n\n[Medium](https://leetcode.cn/problems/random-pick-with-weight/)\n\n```python\nclass Solution:\n\n    def __init__(self, w: List[int]):\n        self.array = []\n        res = 0\n        for i in w:\n            res += i\n            self.array.append(res)\n        self.sum = res\n\n    def pickIndex(self) -> int:\n        import numpy as np\n        import bisect\n        num = np.random.uniform(0, self.sum, 1)\n        return bisect.bisect_left/right(self.array, num)\n```\n\n## Intersections of Two Arrays II <font color=magenta>[2022-06-25]</font>\n\n[Simple](https://leetcode.cn/problems/intersection-of-two-arrays-ii/)\n\n```python\nclass Solution:\n    def intersect(self, nums1: List[int], nums2: List[int]) -> List[int]:\n        ans = []\n        res1 = defaultdict(lambda : 0)\n        res2 = defaultdict(lambda : 0)\n        for i in nums1:\n            res1[i] += 1\n        for i in nums2:\n            res2[i] += 1\n        for key in res1:\n            if key in res2:\n                num = min(res1[key], res2[key])\n                ans += [key] * num\n        return ans\n```\n\n## Check if There is a Valid Path in a Grid <font color=magenta>[2022-06-21]</font>\n\n[medium](https://leetcode.cn/problems/check-if-there-is-a-valid-path-in-a-grid/)\n\n```python\nclass Solution:\n    def hasValidPath(self, grid: List[List[int]]) -> bool:\n        res = {\n        1 :[[0, -1], [0, 1]],\n        2: [[-1, 0], [1, 0]],\n        3: [[0, -1], [1, 0]],\n        4: [[0, 1], [1, 0]],\n        5: [[0, -1], [-1, 0]],\n        6: [[0, 1], [-1, 0]],\n        }\n        n = len(grid)\n        m = len(grid[0])\n        if n == m == 1:\n            return True\n\n        def to_position(position, direction):\n            return [position[0] + direction[0], position[1] + direction[1]]\n\n        def reach(cur):\n            pre = [0, 0]\n            while cur != [0, 0] and 0 <= cur[0] < n and 0 <= cur[1] < m:\n                nex1 = to_position(cur, res[grid[cur[0]][cur[1]]][0])\n                nex2 = to_position(cur, res[grid[cur[0]][cur[1]]][1])\n                if nex1 != pre and nex2 != pre:\n                    return False\n                # be careful about the position of checking if reach the destination\n                # can not be after `cur = nex`, because it can be reachable only\n                 # checked nex1 or nex2 == pre\n                if cur == [n - 1, m - 1]:\n                    return True\n                nex = nex1 if nex1 != pre else nex2\n                pre = cur\n                cur = nex\n            return False\n        start = [0, 0]\n        cur1 = to_position(start, res[grid[0][0]][0])\n        cur2 = to_position(start, res[grid[0][0]][1])\n        return reach(cur1) or reach(cur2)\n```\n\n## Maximum Number of Visible Points <font color=magenta>[2022-06-19]</font>\n\n[hard](https://leetcode.cn/problems/maximum-number-of-visible-points/)\n\n```python\nclass Solution:\n    def visiblePoints(self, points: List[List[int]], angle: int, location: List[int]) -> int:\n        sameCnt = 0\n        polarDegrees = []\n        for p in points:\n            if p == location:\n                sameCnt += 1\n            else:\n                # obain all the angles the range is (-pi, pi]\n                polarDegrees.append(atan2(p[1] - location[1], p[0] - location[0]))\n\n        polarDegrees.sort()\n\n        n = len(polarDegrees)\n        # and 2 pi, the -pi will changed to pi, and thus -pi and pi\n        # will be adjoined to each other\n        # deg and deg + 2pi are both counted only if the angle is 2pi\n        polarDegrees += [deg + 2 * pi for deg in polarDegrees]\n\n        # change the degree into pi\n        degree = angle * pi / 180\n        # bisect_right/bisect_left require from bisect import xxxx\n        # both bisect_right or bisect_left return the index that the val\n        # placed in to the array and keeps the array ranked.\n\n        # when there are numbers equal to val bisect_right places the val to the right\n        # side of the equaled numbers, thus the returned value is the number of digits\n        # smaller and equil to val in the array\n\n        # bisect_left places the val to the left side of the equaled numbers. Thus the\n        # returned value is the number of digits smaller to the val in the array\n\n        # here bisect_right should be used\n        maxCnt = max((bisect_right(polarDegrees, polarDegrees[i] + degree) - i for i in range(n)), default=0)\n        return maxCnt + sameCnt\n```\n\n## Number of Different Integers in a String <font color=magenta>[2022-06-17]</font>\n\n[here](https://leetcode.cn/problems/number-of-different-integers-in-a-string/)\n\n```python\nclass Solution:\n    def numDifferentIntegers(self, word: str) -> int:\n        res = set()\n        cur = 0\n        word += 'a'\n        flag = False\n        for i in word:\n            if i.isdigit():\n                flag = True\n                cur = cur * 10 + int(i)\n            else:\n                if flag:\n                    res.add(cur)\n                    cur = 0\n                    flag = False\n        return len(res)\n```\n\n## Max Length of Pair Chain <font color=magenta>[2022-06-16]</font>\n\n[here](https://leetcode.cn/problems/maximum-length-of-pair-chain/)\n\n```python\nclass Solution:\n    def findLongestChain(self, pairs: List[List[int]]) -> int:\n        res  = sorted(pairs, key = lambda a: a[1])\n        ans = [res[0]]\n        n = len(res)\n        for i in range(1, n):\n            if ans[-1][-1] < res[i][0]:\n                ans.append(res[i])\n        return len(ans)\n```\n\n## Two City Scheduling <font color=magenta>[2022-06-16]</font>\n\n[here](https://leetcode.cn/problems/two-city-scheduling/)\n\nThink about how to divide these people.\n\n- The gain of changing the people from one city to another is only related to\n  the difference between the costs of a and b.\n- Thus, we can set the cost of a always 0, and set the cost of b to cost(b) -\n  cost(a).\n- The cost of a is always 0 and we only need to pick n people to b which reach\n  the minimum cost.\n\n```python\nclass Solution:\n    def twoCitySchedCost(self, costs: List[List[int]]) -> int:\n        res = [a[1] - a[0] for a in costs]\n        nn = len(res)\n        sort_idx = sorted(range(nn), key = lambda k: res[k], reverse = False)\n        cost = 0\n        for i in range(nn // 2):\n            cost += costs[sort_idx[i]][1]\n        for i in range(nn // 2, nn):\n            cost += costs[sort_idx[i]][0]\n        return cost\n```\n\n## Exchange LCCI <font color=magenta>[2022-06-16]</font>\n\n[here](https://leetcode.cn/problems/exchange-lcci/)\n\n```python\nclass Solution:\n    def exchangeBits(self, num: int) -> int:\n        num_bin = bin(num)\n        n = len(num_bin)\n        res = ''\n        start = 2\n        if n % 2:\n            res += '10'\n            start = 3\n        for i in range(start, n, 2):\n            res += num_bin[i + 1]\n            res += num_bin[i]\n        return int(res, 2)\n```\n\n## The First Char which Only Appears once <font color=magenta>[2022-06-16]</font>\n\nThe topic is\n[here](https://leetcode.cn/problems/di-yi-ge-zhi-chu-xian-yi-ci-de-zi-fu-lcof/).\n\n```python\nclass Solution:\n    def firstUniqChar(self, s: str) -> str:\n        res = collections.defaultdict(lambda: [0, 1])\n        for idx, c in enumerate(s):\n            if not c in res:\n                res[c][0] = idx\n            else:\n                res[c][1] += 1\n        ans = \" \"\n        min_idx = len(s)\n        for i in res:\n            if res[i][1] == 1 and res[i][0] < min_idx:\n                min_idx = res[i][0]\n                ans = i\n        return ans\n```\n\n## The Gas Station\n\nThere are `n` stations along a circular route, where the amount of gas at the\n$i^{th}$ station is gas[i].\n\nA car costs cost[i] of gas to travel from the $i^{th}$ station to its next\n$(i + 1)^{th}$ station.\n\nCan the car run a circle. If can, return the start station. If not, return -1.\nIf there exists a solution, it is guaranteed to be the unique.\n\n```python\nclass Solution:\n    def canCompleteCircuit(self, gas: List[int], cost: List[int]) -> int\n        n = len(gas)\n        res = [0] * n\n        # a car pass station i, it can get gas[i] and cost\n        # cost[i]. Thus gets gas[i] - cost[i].\n\n        # if in station i, gas[i] - cost[i] >= 0, it can\n        # arrive the next station.\n        # after arrive the next station, and gets the station\n        # if the remain >= 0 it can gets the next next station.\n        for i in range(n):\n            res[i] = gas[i] - cost[i]\n        first = 0\n        second = 0\n        sum_ = res[0]\n        key = False\n        # second represents the station the car already getting.\n        # first represents the starting station.\n        # sum_ represents if the car can get the next staion.\n        # if sum_ >= 0, it can, else, it can not.\n        while True:\n            if sum_ >= 0:\n                second += 1\n                if second == n:\n                    second = 0\n                    key = True\n                if key and second == first:\n                    return first\n                sum_ += res[second]\n            else:\n                sum_ -= res[first]\n                first += 1\n                # from 0 to n, first do not find an answer, return -1.\n                if first == n:\n                    return -1\n                else:\n                    if first > second:\n                        second += 1\n                        sum_ += res[second\n```\n\nConsider this, if y is the first station that the car can not arrive from x.\nThat is to say $\\sum_{i = y}^x res[i] < 0$. For a station z between x and y. It\ncan arrive z from x, which means the sum $> 0$. Then from z to y, the sum is\ndefinitely $< 0$. It can not arrive y from z.\n\nThus, if a car can not arrive y from x, it can not arrive y from any station\nbetween x and y. It is no need to search such stations.\n\n```python\nclass Solution:\n    def canCompleteCircuit(self, gas: List[int], cost: List[int]) -> int:\n        n = len(gas)\n        res = [0] * n\n        for i in range(n):\n            res[i] = gas[i] - cost[i]\n        first = 0\n        second = 0\n        sum_ = res[0]\n        key = False\n        while True:\n            if sum_ >= 0:\n                second += 1\n                if second == n:\n                    second = 0\n                    key = True\n                if key and second == first:\n                    return first\n                sum_ += res[second]\n            else:\n            # if can not arrive second + 1, then\n            # starting from second + 1\n                second += 1\n                first = second\n                # if the new starting point equal or bigger than\n                # n, first move from 0 to n fails to find.\n                # if key is True, second + 1 is actually larger than\n                # n, first move from 0 to n fails to find.\n                if first == n or key:\n                    return -1\n                sum_ = res[first]\n```\n\n## Maximum Number of Tasks You Can Assign <font color=magenta>[2022-05-11]</font>\n\nThe topic is\n[here](https://leetcode.cn/problems/maximum-number-of-tasks-you-can-assign/).\n\n### Analysis\n\n1. The task need small strength is preferred.\n2. The worker with large strength is preferred\n\nA wrong code\n\n```python\nclass Solution:\n    def maxTaskAssign(self, tasks: List[int], workers: List[int], pills: int, strength: int) -> int:\n        tasks.sort()\n        workers.sort()\n        n =  len(tasks)\n        m =  len(workers)\n        ans = 0\n        j = 0\n        for i in range(m):\n            if j < n:\n                # A new worker waiting for task\n                if workers[i] >= tasks[j]:\n                    ans += 1\n                    # the task has been assigned, consider the next task\n                    j += 1\n                else:\n                    # if there is pills avaliable\n                    if pills and workers[i] + strength >= tasks[j]:\n                        # use this pill\n                        pills -= 1\n                        ans += 1\n                        j += 1\n        return ans\n```\n\nThis code prefers to use small strength workers, which is wrong. When the\nworkers can do `k` tasks, it must be the top `k` strength workers taking the\nbottom `k` tasks.\n\nThe final answer.\n\n```python\nfrom sortedcontainers import SortedList\n\n\nclass Solution:\n    def maxTaskAssign(self, tasks, workers, pills, strength):\n        n, m = len(tasks), len(workers)\n        tasks.sort()\n        workers.sort()\n\n        def check(mid: int) -> bool:\n            p = pills\n            #  the workers needed to be check\n            ws = SortedList(workers[m - mid:])\n            # tasks from large to small\n            for i in range(mid - 1, -1, -1):\n                if ws[-1] >= tasks[i]:\n                    # tasks[i] is assigned to ws[-1]\n                    ws.pop()\n                else:\n                    if p == 0:\n                        # if does not have pills anymore\n                        return False\n                    # has pills\n                    # Note: find the smallest worker can take the task by pill\n                    rep = ws.bisect_left(tasks[i] - strength)\n                    if rep == len(ws):\n                        return False\n                    p -= 1\n                    ws.pop(rep)\n            return True\n\n        # The scope of k needed to be checked if 1 checked false, answer is 0\n        # if right = min(m, n) checked true, answer is right\n        left, right, ans = 1, min(m, n), 0\n        while left <= right:\n            mid = (left + right) // 2\n            if check(mid):\n                # if mid is true, then ans is larger than mid\n                # find it in [mid + 1, right]\n                ans = mid\n                left = mid + 1\n            else:\n                # if mid is false, then ans is smaller than mid\n                # find it in [left, mid - 1]\n                right = mid - 1\n\n        return ans\n```\n","slug":"Algorithm","published":1,"updated":"2022-06-27T03:47:21.949Z","_id":"cl4s7rpfz0001y7mler7n4299","comments":1,"layout":"post","photos":[],"link":"","content":"<html><head></head><body><h1 id=\"backtrack\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#backtrack\"></a> Backtrack</h1>\n<p>We can cope with only simple tasks. But there is only a complex task.</p>\n<p>If we can transfer it into a relative simpler one, do it again and again till we\ncan cope with it.</p>\n<p>When transfer, the simpler task may have some relationship with the complex one,\ne.g., the complex task gives some restrictions to to the simpler one.</p>\n<h2 id=\"n-queens-ii-font-colormagenta2022-06-20font\"><span class=\"post-title-index\">1.1. </span><a class=\"markdownIt-Anchor\" href=\"#n-queens-ii-font-colormagenta2022-06-20font\"></a> N-Queens II <font color=\"magenta\">[2022-06-20]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/n-queens-ii/\">Hard</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">totalNQueens</span>(<span class=\"params\">self, n: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">backtrack</span>(<span class=\"params\">row: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">            <span class=\"comment\"># fill the row</span></span><br><span class=\"line\">            <span class=\"comment\"># two kinds of return</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># when row == n, the last row (n - 1) is filled</span></span><br><span class=\"line\">            <span class=\"comment\"># thus it must be only 1 solution to reach here so return 1</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># if row &lt; n - 1, the solution there is may be multiple solutions</span></span><br><span class=\"line\">            <span class=\"comment\"># clear the count (count = 0), then find the number of solutions</span></span><br><span class=\"line\">            <span class=\"comment\"># and return it</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># thus this function calculates the number of  solutions when the first</span></span><br><span class=\"line\">            <span class=\"comment\"># row - 1 rows is filled, how they are filled are recorded by columns,</span></span><br><span class=\"line\">            <span class=\"comment\"># diagonal1 and giagonal2</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># two key points:</span></span><br><span class=\"line\">            <span class=\"comment\"># 1. How the backtrack end: that is the condition return 1</span></span><br><span class=\"line\">            <span class=\"comment\"># 2. How to transfer the task to a smaller one, that is else.</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># we can crop it if  and only if row == n, thus we only need</span></span><br><span class=\"line\">            <span class=\"comment\"># to transfer the task to a simpler one till we can crop it</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> row == n:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                count = <span class=\"number\">0</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">                    <span class=\"comment\"># i is the columns if it is used continue</span></span><br><span class=\"line\">                    <span class=\"comment\"># two position A and B, if their row -/+ i is the same number</span></span><br><span class=\"line\">                    <span class=\"comment\"># they are in one diagonal then continue</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> i <span class=\"keyword\">in</span> columns <span class=\"keyword\">or</span> row - i <span class=\"keyword\">in</span> diagonal1 <span class=\"keyword\">or</span> row + i <span class=\"keyword\">in</span> diagonal2:</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span></span><br><span class=\"line\">                    columns.add(i)</span><br><span class=\"line\">                    diagonal1.add(row - i)</span><br><span class=\"line\">                    diagonal2.add(row + i)</span><br><span class=\"line\">                    count += backtrack(row + <span class=\"number\">1</span>)</span><br><span class=\"line\">                    columns.remove(i)</span><br><span class=\"line\">                    diagonal1.remove(row - i)</span><br><span class=\"line\">                    diagonal2.remove(row + i)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> count</span><br><span class=\"line\"></span><br><span class=\"line\">        columns = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        diagonal1 = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        diagonal2 = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> backtrack(<span class=\"number\">0</span>)</span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"depth-first-search\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#depth-first-search\"></a> Depth First Search</h1>\n<h2 id=\"find-all-possible-recipes-from-given-supplies-font-colormagenta2022-06-24font\"><span class=\"post-title-index\">2.1. </span><a class=\"markdownIt-Anchor\" href=\"#find-all-possible-recipes-from-given-supplies-font-colormagenta2022-06-24font\"></a> Find All Possible Recipes from Given Supplies <font color=\"magenta\">[2022-06-24]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/find-all-possible-recipes-from-given-supplies/\">Medium</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">findAllRecipes</span>(<span class=\"params\">self, recipes: <span class=\"type\">List</span>[<span class=\"built_in\">str</span>], ingredients: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">str</span>]], supplies: <span class=\"type\">List</span>[<span class=\"built_in\">str</span>]</span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">str</span>]:</span></span><br><span class=\"line\">        res = []</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">remove_cur</span>(<span class=\"params\">cur_supplies</span>):</span></span><br><span class=\"line\">            nex_supplies = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i, cur_ingredients <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(ingredients):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> cur_ingredients:</span><br><span class=\"line\">                   <span class=\"comment\"># Be careful. How to remove items in a loop</span></span><br><span class=\"line\">                    <span class=\"comment\"># https://segmentfault.com/a/1190000007214571</span></span><br><span class=\"line\">                    cur_ingredients = <span class=\"built_in\">list</span>(<span class=\"built_in\">filter</span>(<span class=\"keyword\">lambda</span> x: x <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> cur_supplies, cur_ingredients))</span><br><span class=\"line\">                    ingredients[i] = cur_ingredients</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> cur_ingredients:</span><br><span class=\"line\">                        nex_supplies.add(recipes[i])</span><br><span class=\"line\">                        res.append(recipes[i])</span><br><span class=\"line\">                        recipes[i] = <span class=\"literal\">None</span></span><br><span class=\"line\">                        ingredients[i] = <span class=\"literal\">None</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> nex_supplies</span><br><span class=\"line\"></span><br><span class=\"line\">        supplies = <span class=\"built_in\">set</span>(supplies)</span><br><span class=\"line\">        <span class=\"keyword\">while</span> supplies:</span><br><span class=\"line\">            supplies = remove_cur(supplies)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"longest-increasing-path-in-a-matrix\"><span class=\"post-title-index\">2.2. </span><a class=\"markdownIt-Anchor\" href=\"#longest-increasing-path-in-a-matrix\"></a> Longest Increasing Path in a Matrix</h2>\n<p>Given an <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">m \\times n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> integers matrix, return the length of the longest\nincreasing path in matrix.</p>\n<p>Move direction: left, right, up, or down.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    DIRS = [(-<span class=\"number\">1</span>, <span class=\"number\">0</span>), (<span class=\"number\">1</span>, <span class=\"number\">0</span>), (<span class=\"number\">0</span>, -<span class=\"number\">1</span>), (<span class=\"number\">0</span>, <span class=\"number\">1</span>)]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">longestIncreasingPath</span>(<span class=\"params\">self, matrix: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> matrix:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">        @lru_cache(<span class=\"params\"><span class=\"literal\">None</span></span>) </span><span class=\"comment\"># save  the storage</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">find_max</span>(<span class=\"params\">i, j</span>):</span></span><br><span class=\"line\">        <span class=\"comment\"># find the next value and try the four directions</span></span><br><span class=\"line\">        <span class=\"comment\"># return the longest direction.</span></span><br><span class=\"line\">            max_ = <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> dr <span class=\"keyword\">in</span> Solution.DIRS:</span><br><span class=\"line\">                try_i = i + dr[<span class=\"number\">0</span>]</span><br><span class=\"line\">                try_j = j + dr[<span class=\"number\">1</span>]</span><br><span class=\"line\">                <span class=\"comment\"># the direction will be discarded if do not meet the condition</span></span><br><span class=\"line\">                <span class=\"comment\"># and a direction meet the condition will be searched for the next</span></span><br><span class=\"line\">                <span class=\"comment\"># value first.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"number\">0</span> &lt;= try_i <span class=\"keyword\">and</span> try_i &lt; n <span class=\"keyword\">and</span> <span class=\"number\">0</span>&lt;= try_j <span class=\"keyword\">and</span> try_j &lt; m <span class=\"keyword\">and</span> \\</span><br><span class=\"line\">                matrix[i][j] &lt; matrix[try_i][try_j]:</span><br><span class=\"line\">                    max_ = <span class=\"built_in\">max</span>(max_, find_max(try_i, try_j) + <span class=\"number\">1</span>)</span><br><span class=\"line\">                    <span class=\"comment\"># The value is increasing, so by setting `matrix[i][j] \\</span></span><br><span class=\"line\">                    <span class=\"comment\"># &lt; matrix[try_i][try_j]`, a searched position will never</span></span><br><span class=\"line\">                    <span class=\"comment\"># be searched again.</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> max_</span><br><span class=\"line\"></span><br><span class=\"line\">        n, m = <span class=\"built_in\">len</span>(matrix), <span class=\"built_in\">len</span>(matrix[<span class=\"number\">0</span>])</span><br><span class=\"line\">        res = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span>  <span class=\"built_in\">range</span>(m):</span><br><span class=\"line\">                res = <span class=\"built_in\">max</span>(res, find_max(i, j))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res</span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"keyboard\"><span class=\"post-title-index\">2.3. </span><a class=\"markdownIt-Anchor\" href=\"#keyboard\"></a> Keyboard</h2>\n<p>A keyboard only have 26 keys, <code>a~z</code>. Each key can be only typed <code>k</code> times at\nmost.</p>\n<p>How many possible content there is, when the keyboard is typed <code>n</code> times?</p>\n<h3 id=\"method-1-dfs\"><span class=\"post-title-index\">2.3.1. </span><a class=\"markdownIt-Anchor\" href=\"#method-1-dfs\"></a> Method 1: dfs</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">   <span class=\"comment\"># depth first search: from the first letter to the last letter</span></span><br><span class=\"line\">   <span class=\"comment\"># fill the n positions.</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">keyboard</span>(<span class=\"params\">self, k: <span class=\"built_in\">int</span>, n: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">       MOD = <span class=\"number\">1000000007</span></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\"># c is the number of remain letters</span></span><br><span class=\"line\">       <span class=\"comment\"># n is the number of letters needed to type in</span></span><br><span class=\"line\">       <span class=\"comment\"># k is the max number that each letter can type</span></span><br><span class=\"line\"><span class=\"meta\">       @lru_cache(<span class=\"params\"><span class=\"literal\">None</span></span>)</span></span><br><span class=\"line\">       <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">dfs</span>(<span class=\"params\">c, n, k</span>):</span></span><br><span class=\"line\">           <span class=\"keyword\">if</span> n == <span class=\"number\">0</span>:</span><br><span class=\"line\">               <span class=\"comment\"># no letters is needed any more</span></span><br><span class=\"line\">               <span class=\"comment\"># only 1 way: type nothing</span></span><br><span class=\"line\">               <span class=\"comment\"># pick 0 letters</span></span><br><span class=\"line\">               <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">           <span class=\"keyword\">if</span> c &lt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">               <span class=\"comment\"># no letter remained but n is not 0</span></span><br><span class=\"line\">               <span class=\"comment\"># this is a failed type scheme</span></span><br><span class=\"line\">               <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\">           res = <span class=\"number\">0</span></span><br><span class=\"line\">           <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">min</span>(n, k) + <span class=\"number\">1</span>):</span><br><span class=\"line\">           <span class=\"comment\"># there are math.comb(n, i) ways to put i letters</span></span><br><span class=\"line\">           <span class=\"comment\"># into n position.</span></span><br><span class=\"line\">               res += math.comb(n, i) * dfs(c-<span class=\"number\">1</span>, n - i, k) % MOD</span><br><span class=\"line\">           <span class=\"keyword\">return</span> res % MOD</span><br><span class=\"line\">       ans = dfs(<span class=\"number\">26</span>, n, k)</span><br><span class=\"line\">       <span class=\"keyword\">return</span> ans % MOD</span><br></pre></td></tr></tbody></table></figure>\n<h3 id=\"method-2-dynamic-programming\"><span class=\"post-title-index\">2.3.2. </span><a class=\"markdownIt-Anchor\" href=\"#method-2-dynamic-programming\"></a> Method 2: dynamic programming</h3>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">keyboard</span>(<span class=\"params\">self, k: <span class=\"built_in\">int</span>, n: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        MOD = <span class=\"number\">1000000007</span></span><br><span class=\"line\">        res = [[<span class=\"number\">0</span> <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">27</span>)] <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n + <span class=\"number\">1</span>)]</span><br><span class=\"line\">        <span class=\"comment\"># res[i][j] is the number of possibilities when first j letters</span></span><br><span class=\"line\">        <span class=\"comment\"># is used to fill i positions.</span></span><br><span class=\"line\">        <span class=\"comment\"># when the position is 0, no matter how many letters are used.</span></span><br><span class=\"line\">        <span class=\"comment\"># there is only one possibility, i.e., filling nothing.</span></span><br><span class=\"line\">        <span class=\"comment\"># thus, res[0][i] are all 1.</span></span><br><span class=\"line\">        res[<span class=\"number\">0</span>][<span class=\"number\">0</span>] = <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">27</span>):</span><br><span class=\"line\">            res[<span class=\"number\">0</span>][i] = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># res[i][j] can be divided into several possibilities.</span></span><br><span class=\"line\">        <span class=\"comment\"># When 0 letter is filled for the $j^{th}$ letter, res[i][j-1]</span></span><br><span class=\"line\">        <span class=\"comment\"># when 1 letter is filled for the j-th letter, res[i-1][j-1]</span></span><br><span class=\"line\">        <span class=\"comment\"># * C_i^1</span></span><br><span class=\"line\">        <span class=\"comment\"># when 2 letters are filled for the j-th letter, res[i-2][j-1]</span></span><br><span class=\"line\">        <span class=\"comment\"># * C_i^2</span></span><br><span class=\"line\">        <span class=\"comment\"># C_i^m represent how many possibilities there are filling m of</span></span><br><span class=\"line\">        <span class=\"comment\"># the same letters into i positions.</span></span><br><span class=\"line\">        <span class=\"comment\"># m can be 0, but can not be larger than k or i.</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, n + <span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"number\">27</span>):</span><br><span class=\"line\">                <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">min</span>(i + <span class=\"number\">1</span>, k + <span class=\"number\">1</span>)):</span><br><span class=\"line\">                    res[i][j] += res[i - m][j - <span class=\"number\">1</span>] * math.comb(i, m)</span><br><span class=\"line\">                    res[i][j] %= MOD</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> res[-<span class=\"number\">1</span>][-<span class=\"number\">1</span>] % MOD</span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"dynamic-programming\"><span class=\"post-title-index\">3. </span><a class=\"markdownIt-Anchor\" href=\"#dynamic-programming\"></a> Dynamic Programming</h1>\n<h2 id=\"minimum-one-bit-operations-to-make-integers-zero-font-colormagenta2022-06-27font\"><span class=\"post-title-index\">3.1. </span><a class=\"markdownIt-Anchor\" href=\"#minimum-one-bit-operations-to-make-integers-zero-font-colormagenta2022-06-27font\"></a> Minimum One Bit Operations to Make Integers Zero <font color=\"magenta\">[2022-06-27]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/minimum-one-bit-operations-to-make-integers-zero/\">Really Hard</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">minimumOneBitOperations</span>(<span class=\"params\">self, n</span>):</span></span><br><span class=\"line\">        dp1 = [<span class=\"number\">0</span> <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">32</span>)]</span><br><span class=\"line\">    <span class=\"comment\">#dp1[i] 表示 仅第 i 位 为 1 时 将 第 i 位变为 0 的最小修改次数</span></span><br><span class=\"line\">        res = <span class=\"number\">0</span></span><br><span class=\"line\">        dp1[<span class=\"number\">0</span>] = <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i  <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">32</span>):</span><br><span class=\"line\">            dp1[i] = dp1[i - <span class=\"number\">1</span>] + <span class=\"number\">1</span> + dp1[i - <span class=\"number\">1</span>]</span><br><span class=\"line\">        f = <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"comment\"># 1. 0 变位仅i位为1的过程中，其后每一位都需要经历若干次从0到1,再从1到0的变化</span></span><br><span class=\"line\">        <span class=\"comment\"># 2. 其后位中若原本就为1,则不会经历第一次从0到1的变化，因为它本身就是1</span></span><br><span class=\"line\">        <span class=\"comment\"># 所以若把第i位从1变为0,记为dp[i]，是多记录了，因为其后有1</span></span><br><span class=\"line\">        <span class=\"comment\"># 所以如果其后遇到1的要减去。但是减去的话又多减了，因为其后还有1,所以又加上</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">31</span>, -<span class=\"number\">1</span>, -<span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> n &gt;&gt; i &amp; <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> f:</span><br><span class=\"line\">                    res += dp1[i]</span><br><span class=\"line\">                    f = <span class=\"literal\">False</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    res -= dp1[i]</span><br><span class=\"line\">                    f = <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> res</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"the-number-of-palindromes\"><span class=\"post-title-index\">3.2. </span><a class=\"markdownIt-Anchor\" href=\"#the-number-of-palindromes\"></a> The number of palindromes</h2>\n<p>Given a string return the number of the palindromes. The substrings are regarded\nas different strings if they are start and end at different position.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">countSubstrings</span>(<span class=\"params\">self, s: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(s)</span><br><span class=\"line\">        res = [[<span class=\"literal\">False</span> <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n)] <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n)]</span><br><span class=\"line\">        <span class=\"comment\"># if n == 0, there are 0 palindromes.</span></span><br><span class=\"line\">        <span class=\"comment\"># if n == 1, there are 1 palindromes.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> n <span class=\"keyword\">or</span> n == <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> n</span><br><span class=\"line\">        ans = n</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">            res[<span class=\"number\">0</span>][i] = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n - <span class=\"number\">1</span>):</span><br><span class=\"line\">            res[<span class=\"number\">1</span>][i] = s[i] == s[i + <span class=\"number\">1</span>]</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res[<span class=\"number\">1</span>][i]:</span><br><span class=\"line\">                ans += <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"comment\"># if n == 2 it will not enter the following circle.</span></span><br><span class=\"line\"><span class=\"comment\"># if n &gt; 2 it will contnue to caculate palindromes whose length is larger than 2</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> l <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">2</span>, n):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> st <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n - l):</span><br><span class=\"line\">                res[l][st] = res[l - <span class=\"number\">2</span>][st + <span class=\"number\">1</span>] <span class=\"keyword\">and</span> s[st] == s[st + l]</span><br><span class=\"line\">                <span class=\"keyword\">if</span> res[l][st]:</span><br><span class=\"line\">                    ans += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"knight-dialer\"><span class=\"post-title-index\">3.3. </span><a class=\"markdownIt-Anchor\" href=\"#knight-dialer\"></a> Knight Dialer</h2>\n<p>The topic is <a href=\"https://leetcode-cn.com/problems/knight-dialer/\">here</a>.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">knightDialer</span>(<span class=\"params\">self, N</span>):</span></span><br><span class=\"line\">        MOD = <span class=\"number\">10</span>**<span class=\"number\">9</span> + <span class=\"number\">7</span></span><br><span class=\"line\">        <span class=\"comment\"># From 0 can reach 4 and 6</span></span><br><span class=\"line\">        <span class=\"comment\"># From 1 can reach 6 and 8</span></span><br><span class=\"line\">        moves = [[<span class=\"number\">4</span>,<span class=\"number\">6</span>],[<span class=\"number\">6</span>,<span class=\"number\">8</span>],[<span class=\"number\">7</span>,<span class=\"number\">9</span>],[<span class=\"number\">4</span>,<span class=\"number\">8</span>],[<span class=\"number\">3</span>,<span class=\"number\">9</span>,<span class=\"number\">0</span>],[],</span><br><span class=\"line\">                     [<span class=\"number\">1</span>,<span class=\"number\">7</span>,<span class=\"number\">0</span>],[<span class=\"number\">2</span>,<span class=\"number\">6</span>],[<span class=\"number\">1</span>,<span class=\"number\">3</span>],[<span class=\"number\">2</span>,<span class=\"number\">4</span>]]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># There is dp[i]==1 ways to reach i by one step</span></span><br><span class=\"line\">        dp = [<span class=\"number\">1</span>] * <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> hops <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(N-<span class=\"number\">1</span>):</span><br><span class=\"line\">            dp2 = [<span class=\"number\">0</span>] * <span class=\"number\">10</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> node, count <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(dp):</span><br><span class=\"line\">              <span class=\"comment\"># There are count way to reach node by hops + 1 steps</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> nei <span class=\"keyword\">in</span> moves[node]:</span><br><span class=\"line\">                    dp2[nei] += count</span><br><span class=\"line\">                    dp2[nei] %= MOD</span><br><span class=\"line\">              <span class=\"comment\"># There are dp2[nei] way to reach nei by hops + 2 steps</span></span><br><span class=\"line\">            dp = dp2</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">sum</span>(dp) % MOD</span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"linked-list\"><span class=\"post-title-index\">4. </span><a class=\"markdownIt-Anchor\" href=\"#linked-list\"></a> Linked List</h1>\n<h2 id=\"find-the-minimum-and-maximum-number-of-nodes-between-critical-points-font-colormagenta2022-06-18font\"><span class=\"post-title-index\">4.1. </span><a class=\"markdownIt-Anchor\" href=\"#find-the-minimum-and-maximum-number-of-nodes-between-critical-points-font-colormagenta2022-06-18font\"></a> Find The Minimum and Maximum Number of Nodes Between Critical Points <font color=\"magenta\">[2022-06-18]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/find-the-minimum-and-maximum-number-of-nodes-between-critical-points/\">Medium</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">nodesBetweenCriticalPoints</span>(<span class=\"params\">self, head: <span class=\"type\">Optional</span>[ListNode]</span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]:</span></span><br><span class=\"line\">        <span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\">        cur = head</span><br><span class=\"line\">        left_sign = <span class=\"number\">0</span></span><br><span class=\"line\">        pre_idx = <span class=\"literal\">None</span></span><br><span class=\"line\">        start_idx = <span class=\"literal\">None</span></span><br><span class=\"line\">        min_distance = <span class=\"built_in\">float</span>(<span class=\"string\">'inf'</span>)</span><br><span class=\"line\">        idx = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> cur.<span class=\"built_in\">next</span>:</span><br><span class=\"line\">            right_sign = np.sign(cur.<span class=\"built_in\">next</span>.val - cur.val)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> left_sign * right_sign == -<span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> start_idx:</span><br><span class=\"line\">                    start_idx = idx</span><br><span class=\"line\">                <span class=\"keyword\">if</span> pre_idx <span class=\"keyword\">and</span> idx - pre_idx &lt; min_distance:</span><br><span class=\"line\">                    min_distance = idx - pre_idx</span><br><span class=\"line\"></span><br><span class=\"line\">                pre_idx = idx</span><br><span class=\"line\">            cur = cur.<span class=\"built_in\">next</span></span><br><span class=\"line\">            left_sign = right_sign</span><br><span class=\"line\">            idx += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> pre_idx != start_idx:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [min_distance, pre_idx - start_idx]</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [-<span class=\"number\">1</span>, -<span class=\"number\">1</span>]</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"reverse-a-linked-list-font-colormagenta2022-06-16font\"><span class=\"post-title-index\">4.2. </span><a class=\"markdownIt-Anchor\" href=\"#reverse-a-linked-list-font-colormagenta2022-06-16font\"></a> Reverse a Linked List <font color=\"magenta\">[2022-06-16]</font></h2>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reverseList</span>(<span class=\"params\">self, head: ListNode</span>) -&gt; ListNode:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> head <span class=\"keyword\">or</span> <span class=\"keyword\">not</span> head.<span class=\"built_in\">next</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> head</span><br><span class=\"line\">        cur = head.<span class=\"built_in\">next</span></span><br><span class=\"line\">        start = head</span><br><span class=\"line\">        <span class=\"comment\"># head is the last node</span></span><br><span class=\"line\">        start.<span class=\"built_in\">next</span> = <span class=\"literal\">None</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> cur:</span><br><span class=\"line\">            next_cur = cur.<span class=\"built_in\">next</span></span><br><span class=\"line\">            cur.<span class=\"built_in\">next</span> = start</span><br><span class=\"line\">            start = cur</span><br><span class=\"line\">            cur = next_cur</span><br><span class=\"line\">        <span class=\"keyword\">return</span> start</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"reverse-nodes-in-k-group-font-colormagenta2022-06-10font\"><span class=\"post-title-index\">4.3. </span><a class=\"markdownIt-Anchor\" href=\"#reverse-nodes-in-k-group-font-colormagenta2022-06-10font\"></a> Reverse Nodes in K-Group <font color=\"magenta\">[2022-06-10]</font></h2>\n<p>Given the head of a linked list, reverse the nodes of the list <code>k</code> at a time and\nreturn the modified list.</p>\n<p>Python</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">      <span class=\"comment\"># reverse a link node, the length is k</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reverse</span>(<span class=\"params\">self, head: ListNode, tail: ListNode, k</span>):</span></span><br><span class=\"line\">        current = head</span><br><span class=\"line\">        crop = head.<span class=\"built_in\">next</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(k - <span class=\"number\">1</span>):</span><br><span class=\"line\">            follow = crop.<span class=\"built_in\">next</span></span><br><span class=\"line\">            crop.<span class=\"built_in\">next</span> = current</span><br><span class=\"line\">            current = crop</span><br><span class=\"line\">            crop = follow</span><br><span class=\"line\">        <span class=\"keyword\">return</span> current, head</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reverseKGroup</span>(<span class=\"params\">self, head: ListNode, k: <span class=\"built_in\">int</span></span>) -&gt; ListNode:</span></span><br><span class=\"line\">        dump = ListNode(<span class=\"number\">0</span>)</span><br><span class=\"line\">        dump.<span class=\"built_in\">next</span> = head</span><br><span class=\"line\"></span><br><span class=\"line\">        current = dump</span><br><span class=\"line\">        end = current</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># while the end has next, check if it has k nodes followed</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> end.<span class=\"built_in\">next</span>:</span><br><span class=\"line\">            start = end.<span class=\"built_in\">next</span></span><br><span class=\"line\">            <span class=\"comment\"># check if followed k nodes</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(k):</span><br><span class=\"line\">                end = end.<span class=\"built_in\">next</span></span><br><span class=\"line\">                 <span class=\"comment\"># do not have k nodes followed, then do not reverse</span></span><br><span class=\"line\">                 <span class=\"comment\"># and also the link node have been done, and return.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> end:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> dump.<span class=\"built_in\">next</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># if have k nodes followed</span></span><br><span class=\"line\">            follow = end.<span class=\"built_in\">next</span></span><br><span class=\"line\">             <span class=\"comment\"># reverse the k nodes and return the reversed start and end</span></span><br><span class=\"line\">            r_start, r_end = self.reverse(start, end, k)</span><br><span class=\"line\">             <span class=\"comment\"># connect the reversed k nodes with the original nodes</span></span><br><span class=\"line\">            current.<span class=\"built_in\">next</span> = r_start</span><br><span class=\"line\">            r_end.<span class=\"built_in\">next</span> = follow</span><br><span class=\"line\">            current = r_end</span><br><span class=\"line\">            end = current</span><br><span class=\"line\">            <span class=\"comment\"># the length of the link node is a multiple of k, and end.next is None, return</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> dump.<span class=\"built_in\">next</span></span><br></pre></td></tr></tbody></table></figure>\n<p>c++</p>\n<figure class=\"highlight c++\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span> {</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"comment\">// 翻转一个子链表，并且返回新的头与尾</span></span><br><span class=\"line\">    <span class=\"function\">pair&lt;ListNode*, ListNode*&gt; <span class=\"title\">myReverse</span><span class=\"params\">(ListNode* head, ListNode* tail)</span> </span>{</span><br><span class=\"line\">        ListNode* prev = tail-&gt;next;</span><br><span class=\"line\">        ListNode* p = head;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (prev != tail) {</span><br><span class=\"line\">            ListNode* nex = p-&gt;next;</span><br><span class=\"line\">            p-&gt;next = prev;</span><br><span class=\"line\">            prev = p;</span><br><span class=\"line\">            p = nex;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"keyword\">return</span> {tail, head};</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">ListNode* <span class=\"title\">reverseKGroup</span><span class=\"params\">(ListNode* head, <span class=\"keyword\">int</span> k)</span> </span>{</span><br><span class=\"line\">        ListNode* hair = <span class=\"keyword\">new</span> <span class=\"built_in\">ListNode</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        hair-&gt;next = head;</span><br><span class=\"line\">        ListNode* pre = hair;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (head) {</span><br><span class=\"line\">            ListNode* tail = pre;</span><br><span class=\"line\">            <span class=\"comment\">// 查看剩余部分长度是否大于等于 k</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; k; ++i) {</span><br><span class=\"line\">                tail = tail-&gt;next;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!tail) {</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> hair-&gt;next;</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">            ListNode* nex = tail-&gt;next;</span><br><span class=\"line\">            <span class=\"comment\">// 这里是 C++17 的写法，也可以写成</span></span><br><span class=\"line\">            <span class=\"comment\">// pair&lt;ListNode*, ListNode*&gt; result = myReverse(head, tail);</span></span><br><span class=\"line\">            <span class=\"comment\">// head = result.first;</span></span><br><span class=\"line\">            <span class=\"comment\">// tail = result.second;</span></span><br><span class=\"line\">            <span class=\"built_in\">tie</span>(head, tail) = <span class=\"built_in\">myReverse</span>(head, tail);</span><br><span class=\"line\">            <span class=\"comment\">// 把子链表重新接回原链表</span></span><br><span class=\"line\">            pre-&gt;next = head;</span><br><span class=\"line\">            tail-&gt;next = nex;</span><br><span class=\"line\">            pre = tail;</span><br><span class=\"line\">            head = tail-&gt;next;</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> hair-&gt;next;</span><br><span class=\"line\">    }</span><br><span class=\"line\">};</span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"palindrome-linked-list\"><span class=\"post-title-index\">4.4. </span><a class=\"markdownIt-Anchor\" href=\"#palindrome-linked-list\"></a> Palindrome Linked List</h2>\n<p>Given the <code>head</code> of a singly linked list, return <code>true</code> if it is a Palindrome.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">isPalindrome</span>(<span class=\"params\">self, head: ListNode</span>) -&gt; <span class=\"built_in\">bool</span>:</span></span><br><span class=\"line\">        res = []</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> head:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">        num = <span class=\"number\">0</span></span><br><span class=\"line\">        first = head</span><br><span class=\"line\">        <span class=\"keyword\">while</span> first.<span class=\"built_in\">next</span>:</span><br><span class=\"line\">            res.append(first.val)</span><br><span class=\"line\">            num += <span class=\"number\">1</span> <span class=\"comment\"># count the length of the linked list</span></span><br><span class=\"line\">            first = first.<span class=\"built_in\">next</span></span><br><span class=\"line\">        res.append(first.val) <span class=\"comment\"># store all the node value</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(num // <span class=\"number\">2</span> + <span class=\"number\">1</span>): <span class=\"comment\"># does not need to check all the nodes</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> res[i] != res[num - i]:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br></pre></td></tr></tbody></table></figure>\n<p>If one want only use O(n) time and O(1) storage, must reverse the last half of\nthe linked list.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">isPalindrome</span>(<span class=\"params\">self, head: ListNode</span>) -&gt; <span class=\"built_in\">bool</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> head <span class=\"keyword\">or</span> <span class=\"keyword\">not</span> head.<span class=\"built_in\">next</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">find_the_middle</span>(<span class=\"params\">node</span>):</span></span><br><span class=\"line\">            slow = node</span><br><span class=\"line\">            fast = node</span><br><span class=\"line\">            <span class=\"keyword\">while</span> fast.<span class=\"built_in\">next</span> <span class=\"keyword\">and</span> fast.<span class=\"built_in\">next</span>.<span class=\"built_in\">next</span>:</span><br><span class=\"line\">                slow = slow.<span class=\"built_in\">next</span></span><br><span class=\"line\">                fast = fast.<span class=\"built_in\">next</span>.<span class=\"built_in\">next</span></span><br><span class=\"line\">            second_start = slow.<span class=\"built_in\">next</span></span><br><span class=\"line\">            slow.<span class=\"built_in\">next</span> = <span class=\"literal\">None</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> second_start</span><br><span class=\"line\">        second_start = find_the_middle(head)</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reverse</span>(<span class=\"params\">node</span>):</span></span><br><span class=\"line\">            start = node</span><br><span class=\"line\">            pre = node.<span class=\"built_in\">next</span></span><br><span class=\"line\">            start.<span class=\"built_in\">next</span> = <span class=\"literal\">None</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> pre:</span><br><span class=\"line\">                cur = pre</span><br><span class=\"line\">                pre = pre.<span class=\"built_in\">next</span></span><br><span class=\"line\">                cur.<span class=\"built_in\">next</span> = start</span><br><span class=\"line\">                start = cur</span><br><span class=\"line\">            <span class=\"keyword\">return</span> start</span><br><span class=\"line\">        new_start = reverse(second_start)</span><br><span class=\"line\">        <span class=\"keyword\">while</span> head <span class=\"keyword\">and</span> new_start:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> head.val != new_start.val:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">            head = head.<span class=\"built_in\">next</span></span><br><span class=\"line\">            new_start = new_start.<span class=\"built_in\">next</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"string\"><span class=\"post-title-index\">5. </span><a class=\"markdownIt-Anchor\" href=\"#string\"></a> String</h1>\n<h2 id=\"strong-password-checker-ii-font-colormagenta2022-06-22font\"><span class=\"post-title-index\">5.1. </span><a class=\"markdownIt-Anchor\" href=\"#strong-password-checker-ii-font-colormagenta2022-06-22font\"></a> Strong Password Checker II <font color=\"magenta\">[2022-06-22]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/strong-password-checker-ii/\">Simple</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">strongPasswordCheckerII</span>(<span class=\"params\">self, password: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">bool</span>:</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(password)</span><br><span class=\"line\"></span><br><span class=\"line\">        if_length = n &gt;= <span class=\"number\">8</span></span><br><span class=\"line\"></span><br><span class=\"line\">        contain_lower = <span class=\"literal\">False</span></span><br><span class=\"line\">        contain_upper = <span class=\"literal\">False</span></span><br><span class=\"line\">        contain_number = <span class=\"literal\">False</span></span><br><span class=\"line\">        contain_special = <span class=\"literal\">False</span></span><br><span class=\"line\">        contain_twosame = <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\">        special = <span class=\"built_in\">set</span>(<span class=\"string\">\"!@#$%^&amp;*()-+\"</span>)</span><br><span class=\"line\">        pre_char = <span class=\"string\">''</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> password:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> i == pre_char:</span><br><span class=\"line\">                contain_twosame = <span class=\"literal\">True</span></span><br><span class=\"line\">            pre_char = i</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> contain_lower <span class=\"keyword\">and</span> i.islower():</span><br><span class=\"line\">                contain_lower = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> contain_upper <span class=\"keyword\">and</span> i.isupper():</span><br><span class=\"line\">                contain_upper = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> contain_number <span class=\"keyword\">and</span> i.isdigit():</span><br><span class=\"line\">                contain_number = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> contain_special <span class=\"keyword\">and</span> i <span class=\"keyword\">in</span> special:</span><br><span class=\"line\">                contain_special = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> if_length <span class=\"keyword\">and</span> contain_lower <span class=\"keyword\">and</span> contain_upper <span class=\"keyword\">and</span> contain_number <span class=\"keyword\">and</span> contain_special <span class=\"keyword\">and</span> <span class=\"keyword\">not</span> contain_twosame</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"minimum-changes-to-make-alternating-binary-string\"><span class=\"post-title-index\">5.2. </span><a class=\"markdownIt-Anchor\" href=\"#minimum-changes-to-make-alternating-binary-string\"></a> Minimum Changes to Make Alternating Binary String</h2>\n<p>You are given a string <code>s</code> consisting only of the characters <code>0</code> and <code>1</code>. In one\noperation, you can change any <code>0</code> to <code>1</code> or vice versa.</p>\n<p>The string is called alternating if no two adjacent characters are equal. Return\nthe minimum number of operations needed to make <code>s</code> alternating.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">minOperations</span>(<span class=\"params\">self, s: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(s)</span><br><span class=\"line\">        <span class=\"comment\"># The ans is the operation needed to turn s into `010101`</span></span><br><span class=\"line\">        ans = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> i % <span class=\"number\">2</span> <span class=\"keyword\">and</span> s[i] != <span class=\"string\">\"1\"</span>:</span><br><span class=\"line\">              ans += <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> i % <span class=\"number\">2</span> <span class=\"keyword\">and</span> s[i] != <span class=\"string\">\"0\"</span>:</span><br><span class=\"line\">                ans += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">min</span>(ans, n - ans)</span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"sort\"><span class=\"post-title-index\">6. </span><a class=\"markdownIt-Anchor\" href=\"#sort\"></a> Sort</h1>\n<h2 id=\"sort-integers-by-the-number-of-1-bits-font-colormagenta2022-06-16font\"><span class=\"post-title-index\">6.1. </span><a class=\"markdownIt-Anchor\" href=\"#sort-integers-by-the-number-of-1-bits-font-colormagenta2022-06-16font\"></a> Sort Integers by the Number of 1 Bits <font color=\"magenta\">[2022-06-16]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/sort-integers-by-the-number-of-1-bits/\">here</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">sortByBits</span>(<span class=\"params\">self, arr: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]:</span></span><br><span class=\"line\">        res = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> arr:</span><br><span class=\"line\">            c = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> <span class=\"built_in\">bin</span>(i):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> s == <span class=\"string\">'1'</span>:</span><br><span class=\"line\">                    c += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">            res.append([c, i])</span><br><span class=\"line\">        res.sort()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [a[<span class=\"number\">1</span>] <span class=\"keyword\">for</span> a <span class=\"keyword\">in</span> res]</span><br></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> collections <span class=\"keyword\">import</span> defaultdict <span class=\"keyword\">as</span> d</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">sortByBits</span>(<span class=\"params\">self, arr: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]:</span></span><br><span class=\"line\">        dic = d(<span class=\"built_in\">list</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> arr:</span><br><span class=\"line\">            c = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> <span class=\"built_in\">str</span>(<span class=\"built_in\">bin</span>(i)):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> s == <span class=\"string\">\"1\"</span>:</span><br><span class=\"line\">                    c += <span class=\"number\">1</span></span><br><span class=\"line\">            dic[c].append(i)</span><br><span class=\"line\"></span><br><span class=\"line\">        output = []</span><br><span class=\"line\"><span class=\"comment\"># The range of integer is less than 0b111111111111111.</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">15</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> dic[j]:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> temp <span class=\"keyword\">in</span> <span class=\"built_in\">sorted</span>(dic[j]):</span><br><span class=\"line\">                    output.append(temp)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> output</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"k-highest-ranked-items-within-a-price-range-font-colormagenta2022-06-13font\"><span class=\"post-title-index\">6.2. </span><a class=\"markdownIt-Anchor\" href=\"#k-highest-ranked-items-within-a-price-range-font-colormagenta2022-06-13font\"></a> K Highest Ranked Items Within a Price Range <font color=\"magenta\">[2022-06-13]</font></h2>\n<p>The topic is\n<a href=\"https://leetcode.cn/problems/k-highest-ranked-items-within-a-price-range/\">here</a>.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">highestRankedKItems</span>(<span class=\"params\">self, grid: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]], pricing: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], start: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], k: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]]:</span></span><br><span class=\"line\">        res = []</span><br><span class=\"line\"></span><br><span class=\"line\">        curs = [</span><br><span class=\"line\">            [<span class=\"number\">0</span>, grid[start[<span class=\"number\">0</span>]][start[<span class=\"number\">1</span>]], start[<span class=\"number\">0</span>], start[<span class=\"number\">1</span>]]</span><br><span class=\"line\">            ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># gird set to 0 is to avoid visiting a coordinate for multiple time.</span></span><br><span class=\"line\"><span class=\"comment\"># The position to set the grid to be 0 is important.</span></span><br><span class=\"line\"><span class=\"comment\"># in  this example, the price of a coordinate is set to 0 when it is visited by curs.</span></span><br><span class=\"line\"><span class=\"comment\"># also can set the price to be 0, when it is checked if within the price range.</span></span><br><span class=\"line\"><span class=\"comment\"># However, this is time expensive, for a position maybe append to curs many times before it is checked.</span></span><br><span class=\"line\"><span class=\"comment\"># It is the best to set the price to be 0, once it is visited by curs. The curs will not visits it again.</span></span><br><span class=\"line\">        grid[start[<span class=\"number\">0</span>]][start[<span class=\"number\">1</span>]] = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        r = <span class=\"built_in\">len</span>(grid)</span><br><span class=\"line\">        c = <span class=\"built_in\">len</span>(grid[<span class=\"number\">0</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">        dirctions = [[<span class=\"number\">0</span>, <span class=\"number\">1</span>], [<span class=\"number\">1</span>, <span class=\"number\">0</span>], [<span class=\"number\">0</span>, -<span class=\"number\">1</span>], [-<span class=\"number\">1</span>, <span class=\"number\">0</span>]]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> curs:</span><br><span class=\"line\">            cur = curs.pop(<span class=\"number\">0</span>)</span><br><span class=\"line\">            cur_step = cur[<span class=\"number\">0</span>]</span><br><span class=\"line\">            cur_price = cur[<span class=\"number\">1</span>]</span><br><span class=\"line\">            cur_row = cur[<span class=\"number\">2</span>]</span><br><span class=\"line\">            cur_cln = cur[<span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> pricing[<span class=\"number\">0</span>] &lt;= cur_price &lt;= pricing[<span class=\"number\">1</span>]:</span><br><span class=\"line\">               res.append(cur)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span> dirction <span class=\"keyword\">in</span> dirctions:</span><br><span class=\"line\">                next_step = cur_step + <span class=\"number\">1</span></span><br><span class=\"line\">                next_row = cur_row + dirction[<span class=\"number\">0</span>]</span><br><span class=\"line\">                next_cln = cur_cln + dirction[<span class=\"number\">1</span>]</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"number\">0</span> &lt;= next_row &lt; r <span class=\"keyword\">and</span> <span class=\"number\">0</span> &lt;= next_cln &lt; c:</span><br><span class=\"line\">                    next_price = grid[next_row][next_cln]</span><br><span class=\"line\">                    grid[next_row][next_cln] = <span class=\"number\">0</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> next_price &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">                        curs.append([next_step, next_price,next_row, next_cln])</span><br><span class=\"line\"></span><br><span class=\"line\">        res.sort()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [res[<span class=\"number\">2</span>:] <span class=\"keyword\">for</span> res <span class=\"keyword\">in</span> res[:k]]</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"wiggle-sort-2\"><span class=\"post-title-index\">6.3. </span><a class=\"markdownIt-Anchor\" href=\"#wiggle-sort-2\"></a> Wiggle Sort 2</h2>\n<p>Given an integer array <code>nums</code>, recorder it such that\n<code>nums[0] &lt; nums[1] &gt; nums[2] &lt; nums[3] &gt; ...</code>. You may assume the input array\nalways has a valid answer.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wiggleSort</span>(<span class=\"params\">self, nums: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"literal\">None</span>:</span></span><br><span class=\"line\">        <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">        Do not return anything, modify nums in-place instead.</span></span><br><span class=\"line\"><span class=\"string\">        \"\"\"</span></span><br><span class=\"line\">        res = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> nums:</span><br><span class=\"line\">            res.append(i)</span><br><span class=\"line\">        res.sort()</span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(nums)</span><br><span class=\"line\">        <span class=\"comment\"># Because the smaller number is always filled first,</span></span><br><span class=\"line\">        <span class=\"comment\"># let len(smaller numbers) - len(larger numbers) == 1</span></span><br><span class=\"line\">        <span class=\"comment\"># if the len(nums) is odd.</span></span><br><span class=\"line\">        <span class=\"comment\"># if n is even, the small half from 0 to n // 2 - 1</span></span><br><span class=\"line\">        <span class=\"comment\"># the large half from n // 2 to n - 1</span></span><br><span class=\"line\">        <span class=\"comment\"># if n is odd, small number from 0 to n // 2</span></span><br><span class=\"line\">        <span class=\"comment\"># large number from n // 2 + 1 to n - 1,</span></span><br><span class=\"line\">        <span class=\"comment\"># Thus, no matter n is odd or even, small number from 0 to</span></span><br><span class=\"line\">        <span class=\"comment\"># (n + 1) // 2 - 1, large number from (n + 1) // 2 to n - 1</span></span><br><span class=\"line\">        half = (n + <span class=\"number\">1</span>) // <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"comment\"># to avoid that the last small number is equal to the first large</span></span><br><span class=\"line\">        <span class=\"comment\"># number, fill the small number from *last* to first,</span></span><br><span class=\"line\">        <span class=\"comment\"># also, fill the large number from last to *first*</span></span><br><span class=\"line\">        <span class=\"comment\"># ** means that the number should try to be apart.</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># if n is even, half * 2 == n</span></span><br><span class=\"line\">        <span class=\"comment\"># if n is odd, half * 2 == n + 1</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(half):</span><br><span class=\"line\">            nums[<span class=\"number\">2</span> * i] = res[half - <span class=\"number\">1</span> -i]</span><br><span class=\"line\">            <span class=\"comment\"># len(large number) is smaller than len(small number),</span></span><br><span class=\"line\">            <span class=\"comment\"># thus, the when i = half -1, maybe no large number anymore</span></span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                nums[<span class=\"number\">2</span> * i + <span class=\"number\">1</span>] = res[n - <span class=\"number\">1</span> - i]</span><br><span class=\"line\">            <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                <span class=\"keyword\">pass</span></span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"rank-teams-by-votes\"><span class=\"post-title-index\">6.4. </span><a class=\"markdownIt-Anchor\" href=\"#rank-teams-by-votes\"></a> Rank Teams by Votes</h2>\n<p>In a special ranking system, each voter gives a rank from highest to lowest to\nall teams participated in the competition, e.g., one gives <code>ABC</code>, one gives\n<code>BCA</code>.</p>\n<p>The ordering of teams is decided by who received the most position-one votes. If\n<code>A</code> received the most 1-st place Then <code>A</code> is the first. If <code>B</code> received the same\nfirst place as <code>A</code> then compare the number of second place they received. If <code>A</code>\nand <code>B</code> received all the places the same number then ordered them by their\nletter, i.e., <code>A</code> is in front of <code>B</code>.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">rankTeams</span>(<span class=\"params\">self, votes: <span class=\"type\">List</span>[<span class=\"built_in\">str</span>]</span>) -&gt; <span class=\"built_in\">str</span>:</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(votes[<span class=\"number\">0</span>])</span><br><span class=\"line\">        <span class=\"comment\"># initialization of a hash map, the default value is list [0, 0, ..., 0]</span></span><br><span class=\"line\">        <span class=\"comment\"># <span class=\"doctag\">NOTE:</span> How to set defaultdict by lambda without input, it is indeed a function factory.</span></span><br><span class=\"line\">        ranking = collections.defaultdict(<span class=\"keyword\">lambda</span>: [<span class=\"number\">0</span>] * n)</span><br><span class=\"line\">         <span class=\"comment\"># count the vote situation for each team, vid is the name of teams.</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> vote <span class=\"keyword\">in</span> votes:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i, vid <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(vote):</span><br><span class=\"line\">                ranking[vid][i] += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># result is a list, e.g., [('A', [5, 0, 0]), ('B', [0, 2, 3]), ('C', [0, 3, 2])]</span></span><br><span class=\"line\">        result = <span class=\"built_in\">list</span>(ranking.items())</span><br><span class=\"line\">        <span class=\"comment\"># sort the order of letter -ord(x[0]) is regard as the last criterion</span></span><br><span class=\"line\">        result.sort(key=<span class=\"keyword\">lambda</span> x: (x[<span class=\"number\">1</span>], -<span class=\"built_in\">ord</span>(x[<span class=\"number\">0</span>])), reverse=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        <span class=\"comment\"># return the ordered vid</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"\"</span>.join([vid <span class=\"keyword\">for</span> vid, rank <span class=\"keyword\">in</span> result])</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"number-game\"><span class=\"post-title-index\">6.5. </span><a class=\"markdownIt-Anchor\" href=\"#number-game\"></a> Number Game</h2>\n<p>Give a list of numbers. You can <code>+ 1</code> or <code>- 1</code> at position <code>i</code> which is regarded\nas one operator at position <code>i</code>. Please return the minimum operators for\nposition <code>i</code> to make the list of numbers satisfying\n<code>nums[a] + 1 == nums[a + 1], 0 &lt;= a &lt;= i</code>. The original topic is\n<a href=\"https://leetcode.cn/problems/5TxKeK/\">here</a>.</p>\n<h3 id=\"analysis\"><span class=\"post-title-index\">6.5.1. </span><a class=\"markdownIt-Anchor\" href=\"#analysis\"></a> Analysis</h3>\n<p>To satisfying <code>nums[a] + 1 == nums[a + 1]</code>, we do not know which number it is\nfor position <code>i</code> which makes the operators minimum.</p>\n<p>Thus we can transform this problem, we make <code>nums[a] = nums[a] - a</code>. Then we\nonly need to make each position of the <code>nums</code> all equal to the same number. Then\nthe minimum way is to set the number as the median number of <code>nums</code>.</p>\n<p><font color=\"red\">NOTE:</font> it is the median number, not the mean value. If the\nlength of the list is even then the median is the mean of the middle two\nnumbers.</p>\n<p>It is easy to prove that the mean value can not bring the minimum operators. For\nexamples, for list <code>[1, 3, 8]</code> the mean value is <code>4</code> and it needs\n<code>3 + 1 + 4 = 8</code> operators to make the list into <code>[4, 4, 4]</code>. The median is <code>3</code>\nand it needs only <code>2 + 0 + 5 = 7</code> operators to make the list into <code>[3, 3, 3]</code>.</p>\n<p><font color=\"blue\">The reason for why it is the median.</font></p>\n<p>Let <code>s</code> be the value that each position will reach and <code>m</code> be the median. If <code>s</code>\nis large than <code>m</code>, then <code>#(nums[i] &gt; s) &lt; #(nums[i] &lt; s)</code>. If set <code>s = s - 1</code>,\n<code>nums[i]</code> will add <code>1</code> operator if <code>nums[i] &gt; s</code> and <code>nums[i]</code> will decrease <code>1</code>\noperator if <code>nums[i] &lt; s</code>. For <code>#(nums[i] &gt; s) &lt; #(nums[i] &lt; s)</code>, the total\nnumber of operators will decrease. It will always decrease until <code>s == m</code>, i.e.,\n<code>#(nums[i] &gt; s) = #(nums[i] &lt; s)</code>.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">List</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> heapq <span class=\"keyword\">import</span> heappush, heappushpop</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MedianFinder</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        self.small = []  <span class=\"comment\"># 大顶堆</span></span><br><span class=\"line\">        self.large = []  <span class=\"comment\"># 小顶堆</span></span><br><span class=\"line\">        self.leftSum = <span class=\"number\">0</span></span><br><span class=\"line\">        self.rightSum = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span>(<span class=\"params\">self, num: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"literal\">None</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># if #small == #large then put the num in large</span></span><br><span class=\"line\">        <span class=\"comment\"># How to push it in large.</span></span><br><span class=\"line\">        <span class=\"comment\"># <span class=\"doctag\">NOTE:</span> not put it in large directly, find the largest value then put it in to the large.</span></span><br><span class=\"line\">        <span class=\"comment\"># This ensure that large is always larger than small.</span></span><br><span class=\"line\">        <span class=\"comment\"># #small always smaller than #large and only larger than 1</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(self.small) == <span class=\"built_in\">len</span>(self.large):</span><br><span class=\"line\">            leftMax = -heappushpop(self.small, -num)</span><br><span class=\"line\">            heappush(self.large, leftMax)</span><br><span class=\"line\">            self.leftSum += num - leftMax</span><br><span class=\"line\">            self.rightSum += leftMax</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> <span class=\"built_in\">len</span>(self.small) &lt; <span class=\"built_in\">len</span>(self.large):</span><br><span class=\"line\">            rightMin = heappushpop(self.large, num)</span><br><span class=\"line\">            heappush(self.small, -rightMin)</span><br><span class=\"line\">            self.leftSum += rightMin</span><br><span class=\"line\">            self.rightSum += num - rightMin</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getMedian</span>(<span class=\"params\">self</span>) -&gt; <span class=\"built_in\">float</span>:</span></span><br><span class=\"line\">     <span class=\"comment\"># self.large[0] is the smallest value in large</span></span><br><span class=\"line\">     <span class=\"comment\"># -self.small[0] is the largest value in small</span></span><br><span class=\"line\">     <span class=\"comment\"># get the median if the length is odd, else the mean of the two middle numbers</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(self.small) == <span class=\"built_in\">len</span>(self.large):</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (self.large[<span class=\"number\">0</span>] - self.small[<span class=\"number\">0</span>]) / <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self.large[<span class=\"number\">0</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getDiffSum</span>(<span class=\"params\">self</span>) -&gt; <span class=\"built_in\">float</span>:</span></span><br><span class=\"line\">        median = self.getMedian()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.rightSum - <span class=\"built_in\">len</span>(self.large) * median + <span class=\"built_in\">len</span>(self.small) * median - self.leftSum</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">numsGame</span>(<span class=\"params\">self, nums: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]:</span></span><br><span class=\"line\">        MOD = <span class=\"built_in\">int</span>(<span class=\"number\">1e9</span> + <span class=\"number\">7</span>)</span><br><span class=\"line\">        res = []</span><br><span class=\"line\">        medianFinder = MedianFinder()</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(nums)):</span><br><span class=\"line\">            normalized = nums[i] - i</span><br><span class=\"line\">            medianFinder.add(normalized)</span><br><span class=\"line\">            res.append(<span class=\"built_in\">int</span>(medianFinder.getDiffSum() % MOD))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res</span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"dichotomy\"><span class=\"post-title-index\">7. </span><a class=\"markdownIt-Anchor\" href=\"#dichotomy\"></a> Dichotomy</h1>\n<h2 id=\"minimum-garden-perimeter-to-collect-enough-apples-font-colormagenta2022-06-22font\"><span class=\"post-title-index\">7.1. </span><a class=\"markdownIt-Anchor\" href=\"#minimum-garden-perimeter-to-collect-enough-apples-font-colormagenta2022-06-22font\"></a> Minimum Garden Perimeter to Collect Enough Apples <font color=\"magenta\">[2022-06-22]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/minimum-garden-perimeter-to-collect-enough-apples/\">Medium</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">minimumPerimeter</span>(<span class=\"params\">self, neededApples: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        left, right, ans = <span class=\"number\">1</span>, <span class=\"number\">100000</span>, <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) // <span class=\"number\">2</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"number\">2</span> * mid * (mid + <span class=\"number\">1</span>) * (mid * <span class=\"number\">2</span> + <span class=\"number\">1</span>) &gt;= neededApples:</span><br><span class=\"line\">                ans = mid</span><br><span class=\"line\">                right = mid - <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                left = mid + <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans * <span class=\"number\">8</span></span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"greedy\"><span class=\"post-title-index\">8. </span><a class=\"markdownIt-Anchor\" href=\"#greedy\"></a> Greedy</h1>\n<h2 id=\"longest-chunked-palindrome-decomposition-font-colormagenta2022-06-19font\"><span class=\"post-title-index\">8.1. </span><a class=\"markdownIt-Anchor\" href=\"#longest-chunked-palindrome-decomposition-font-colormagenta2022-06-19font\"></a> Longest Chunked Palindrome Decomposition <font color=\"magenta\">[2022-06-19]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/longest-chunked-palindrome-decomposition/\">hard</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">longestDecomposition</span>(<span class=\"params\">self, text: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_sub_str</span>(<span class=\"params\">s</span>):</span></span><br><span class=\"line\">            n = <span class=\"built_in\">len</span>(s)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span> , n // <span class=\"number\">2</span> + <span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> s[ : i] == s[n - i : ]:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> i</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        ans = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> text:</span><br><span class=\"line\">            cur_sub_length = get_sub_str(text)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> cur_sub_length:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> ans + <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">            text_length = <span class=\"built_in\">len</span>(text)</span><br><span class=\"line\">            text = text[cur_sub_length : text_length  - cur_sub_length]</span><br><span class=\"line\">            ans += <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"orderly-queue-font-colormagenta2022-06-17font\"><span class=\"post-title-index\">8.2. </span><a class=\"markdownIt-Anchor\" href=\"#orderly-queue-font-colormagenta2022-06-17font\"></a> Orderly Queue <font color=\"magenta\">[2022-06-17]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/orderly-queue/\">Hard</a></p>\n<p>When K &gt;= 2 the minimum queue can be obtained, thus only need to sort it and do\nnot need to know how the minimum queue is obtained.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">orderlyQueue</span>(<span class=\"params\">self, S, K</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> K == <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">min</span>(S[i:] + S[:i] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(S)))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"\"</span>.join(<span class=\"built_in\">sorted</span>(S))</span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"brute-force-search\"><span class=\"post-title-index\">9. </span><a class=\"markdownIt-Anchor\" href=\"#brute-force-search\"></a> Brute Force Search</h1>\n<h2 id=\"number-of-string-that-appear-as-substrings-in-word-font-colormagenta2022-06-17font\"><span class=\"post-title-index\">9.1. </span><a class=\"markdownIt-Anchor\" href=\"#number-of-string-that-appear-as-substrings-in-word-font-colormagenta2022-06-17font\"></a> Number of String That Appear as Substrings in Word <font color=\"magenta\">[2022-06-17]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/number-of-strings-that-appear-as-substrings-in-word/\">Simple</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">numOfStrings</span>(<span class=\"params\">self, patterns: <span class=\"type\">List</span>[<span class=\"built_in\">str</span>], word: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        ans = <span class=\"number\">0</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(word)</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">check</span>(<span class=\"params\">pa</span>):</span></span><br><span class=\"line\">            m = <span class=\"built_in\">len</span>(pa)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n - m + <span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> word[i : i + m] == pa:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> pa <span class=\"keyword\">in</span> patterns:</span><br><span class=\"line\">            ans += check(pa)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"coordinate-with-maximum-network-quality-font-colormagenta2022-05-10font\"><span class=\"post-title-index\">9.2. </span><a class=\"markdownIt-Anchor\" href=\"#coordinate-with-maximum-network-quality-font-colormagenta2022-05-10font\"></a> Coordinate with Maximum Network Quality <font color=\"magenta\">[2022-05-10]</font></h2>\n<p>An array of network towers <code>towers</code> is given, where\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>y</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>q</mi><mi>i</mi></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">towers[i] = [x_i, y_i, q_i]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\" style=\"margin-right:0.02691em;\">w</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\">s</span><span class=\"mopen\">[</span><span class=\"mord mathdefault\">i</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>. <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> are the integral coordinates of\nthe network tower location and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>q</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">q_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> is the network quality factor. The network\nquality of <code>towers[i]</code> at <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(x, y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span> is <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>q</mi><mi>i</mi></msub><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo>+</mo><mi>d</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">q_i / (1 + d)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">d</span><span class=\"mclose\">)</span></span></span></span> where\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>d</mi><mo>=</mo><msqrt><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><mi>y</mi><mo>−</mo><msub><mi>y</mi><mi>i</mi></msub><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">d = \\sqrt{(x - x_i)^2 + (y - y_i)^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">d</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.24em;vertical-align:-0.30499999999999994em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.935em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.740108em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.740108em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.8950000000000005em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,\n158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067\nc4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,\n175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71\nc-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,\n-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26\ns76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30499999999999994em;\"><span></span></span></span></span></span></span></span></span>.</p>\n<p>You are also given an integer <code>radius</code>. All the tower is not reachable if and\nonly if <code>d &gt; radius</code>.</p>\n<p>The network quality of a location is the sum of network qualities from all\ntowers. Return the location with the maximum network quality.</p>\n<p>If there are multiple coordinates with the same network quality, return the\nlexicographically minimum non-negative coordinate.</p>\n<p>Constraints:</p>\n<ol>\n<li>1 &lt;= towers.length &lt;= 50</li>\n<li>towers[i].length == 3</li>\n<li>0 &lt;= <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>q</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">q_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> &lt;=50</li>\n<li>1 &lt;= radius &lt;= 50</li>\n</ol>\n<h3 id=\"analysis-2\"><span class=\"post-title-index\">9.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#analysis-2\"></a> Analysis</h3>\n<p>For 0 &lt;= <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>q</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">q_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> &lt;=50, if x or y is large than 51, it can not be the\nanswer. All the network quality will be stronger when x or y is smaller. Thus,\nwe do only need to search within [0, 51].</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> math</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">bestCoordinate</span>(<span class=\"params\">self, towers: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]], radius: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]:</span></span><br><span class=\"line\">        max_signal, x, y = <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"comment\"># search from small coordinate to large then we will get the small coordinate first</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">51</span>):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">51</span>):</span><br><span class=\"line\">                signal_ij = <span class=\"number\">0</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> tower <span class=\"keyword\">in</span> towers:</span><br><span class=\"line\">                    delta_x, delta_y = tower[<span class=\"number\">0</span>] - i, tower[<span class=\"number\">1</span>] - j</span><br><span class=\"line\">                    d = math.sqrt(delta_x * delta_x + delta_y * delta_y)</span><br><span class=\"line\">                    <span class=\"comment\"># if &gt; radius no quality</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> d &gt; radius:</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span></span><br><span class=\"line\">                      <span class=\"comment\"># use floor</span></span><br><span class=\"line\">                    signal_ij += math.floor(tower[<span class=\"number\">2</span>] / (<span class=\"number\">1</span> + d))</span><br><span class=\"line\">                <span class=\"keyword\">if</span> signal_ij &gt; max_signal:</span><br><span class=\"line\">                    max_signal, x, y = signal_ij, i, j</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [x, y]</span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"flip-the-char\"><span class=\"post-title-index\">10. </span><a class=\"markdownIt-Anchor\" href=\"#flip-the-char\"></a> Flip the Char</h1>\n<h2 id=\"flip-the-char-font-colormagenta2022-06-16font\"><span class=\"post-title-index\">10.1. </span><a class=\"markdownIt-Anchor\" href=\"#flip-the-char-font-colormagenta2022-06-16font\"></a> Flip the Char <font color=\"magenta\">[2022-06-16]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/cyJERH/\">here</a></p>\n<p>The position ‘max_idx’ that the number of <code>0</code> on the left hand - the number of\n<code>1</code> on the left hand get the maximum is the dividing line of <code>0</code> and <code>1</code>.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">minFlipsMonoIncr</span>(<span class=\"params\">self, s: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        num_0 = <span class=\"number\">0</span></span><br><span class=\"line\">        num_1 = <span class=\"number\">0</span></span><br><span class=\"line\">        max_off_set = <span class=\"number\">0</span></span><br><span class=\"line\">        max_num_0 = <span class=\"number\">0</span></span><br><span class=\"line\">        max_num_1 = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> idx, num <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(s):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> num == <span class=\"string\">\"0\"</span>:</span><br><span class=\"line\">                num_0 += <span class=\"number\">1</span></span><br><span class=\"line\">                off_set = num_0 - num_1</span><br><span class=\"line\">                <span class=\"keyword\">if</span> off_set &gt; max_off_set:</span><br><span class=\"line\">                    max_off_set = off_set</span><br><span class=\"line\">                    max_idx = idx</span><br><span class=\"line\">                    max_num_0 = num_0</span><br><span class=\"line\">                    max_num_1 = num_1</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                num_1 += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> num_0 - max_num_0 + max_num_1</span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"stack\"><span class=\"post-title-index\">11. </span><a class=\"markdownIt-Anchor\" href=\"#stack\"></a> Stack</h1>\n<h2 id=\"valid-parentheses-font-colormagenta2022-06-17font\"><span class=\"post-title-index\">11.1. </span><a class=\"markdownIt-Anchor\" href=\"#valid-parentheses-font-colormagenta2022-06-17font\"></a> Valid Parentheses <font color=\"magenta\">[2022-06-17]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/valid-parentheses/\">here</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">isValid</span>(<span class=\"params\">self, s: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">bool</span>:</span></span><br><span class=\"line\">        dic = {<span class=\"string\">')'</span> : <span class=\"string\">'('</span>,</span><br><span class=\"line\">        <span class=\"string\">'}'</span> : <span class=\"string\">'{'</span>,</span><br><span class=\"line\">        <span class=\"string\">']'</span> : <span class=\"string\">'['</span></span><br><span class=\"line\">        }</span><br><span class=\"line\">        res = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> s:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> i <span class=\"keyword\">in</span> dic:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> res:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">                cur = res.pop()</span><br><span class=\"line\">                <span class=\"keyword\">if</span> cur != dic[i]:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                res.append(i)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> res:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"other\"><span class=\"post-title-index\">12. </span><a class=\"markdownIt-Anchor\" href=\"#other\"></a> Other</h1>\n<h2 id=\"random-pick-with-weight-font-colormagenta2022-06-26font\"><span class=\"post-title-index\">12.1. </span><a class=\"markdownIt-Anchor\" href=\"#random-pick-with-weight-font-colormagenta2022-06-26font\"></a> Random Pick with Weight <font color=\"magenta\">[2022-06-26]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/random-pick-with-weight/\">Medium</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, w: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>):</span></span><br><span class=\"line\">        self.array = []</span><br><span class=\"line\">        res = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> w:</span><br><span class=\"line\">            res += i</span><br><span class=\"line\">            self.array.append(res)</span><br><span class=\"line\">        self.<span class=\"built_in\">sum</span> = res</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">pickIndex</span>(<span class=\"params\">self</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\">        <span class=\"keyword\">import</span> bisect</span><br><span class=\"line\">        num = np.random.uniform(<span class=\"number\">0</span>, self.<span class=\"built_in\">sum</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> bisect.bisect_left/right(self.array, num)</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"intersections-of-two-arrays-ii-font-colormagenta2022-06-25font\"><span class=\"post-title-index\">12.2. </span><a class=\"markdownIt-Anchor\" href=\"#intersections-of-two-arrays-ii-font-colormagenta2022-06-25font\"></a> Intersections of Two Arrays II <font color=\"magenta\">[2022-06-25]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/intersection-of-two-arrays-ii/\">Simple</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">intersect</span>(<span class=\"params\">self, nums1: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], nums2: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]:</span></span><br><span class=\"line\">        ans = []</span><br><span class=\"line\">        res1 = defaultdict(<span class=\"keyword\">lambda</span> : <span class=\"number\">0</span>)</span><br><span class=\"line\">        res2 = defaultdict(<span class=\"keyword\">lambda</span> : <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> nums1:</span><br><span class=\"line\">            res1[i] += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> nums2:</span><br><span class=\"line\">            res2[i] += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> res1:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> key <span class=\"keyword\">in</span> res2:</span><br><span class=\"line\">                num = <span class=\"built_in\">min</span>(res1[key], res2[key])</span><br><span class=\"line\">                ans += [key] * num</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"check-if-there-is-a-valid-path-in-a-grid-font-colormagenta2022-06-21font\"><span class=\"post-title-index\">12.3. </span><a class=\"markdownIt-Anchor\" href=\"#check-if-there-is-a-valid-path-in-a-grid-font-colormagenta2022-06-21font\"></a> Check if There is a Valid Path in a Grid <font color=\"magenta\">[2022-06-21]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/check-if-there-is-a-valid-path-in-a-grid/\">medium</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hasValidPath</span>(<span class=\"params\">self, grid: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]]</span>) -&gt; <span class=\"built_in\">bool</span>:</span></span><br><span class=\"line\">        res = {</span><br><span class=\"line\">        <span class=\"number\">1</span> :[[<span class=\"number\">0</span>, -<span class=\"number\">1</span>], [<span class=\"number\">0</span>, <span class=\"number\">1</span>]],</span><br><span class=\"line\">        <span class=\"number\">2</span>: [[-<span class=\"number\">1</span>, <span class=\"number\">0</span>], [<span class=\"number\">1</span>, <span class=\"number\">0</span>]],</span><br><span class=\"line\">        <span class=\"number\">3</span>: [[<span class=\"number\">0</span>, -<span class=\"number\">1</span>], [<span class=\"number\">1</span>, <span class=\"number\">0</span>]],</span><br><span class=\"line\">        <span class=\"number\">4</span>: [[<span class=\"number\">0</span>, <span class=\"number\">1</span>], [<span class=\"number\">1</span>, <span class=\"number\">0</span>]],</span><br><span class=\"line\">        <span class=\"number\">5</span>: [[<span class=\"number\">0</span>, -<span class=\"number\">1</span>], [-<span class=\"number\">1</span>, <span class=\"number\">0</span>]],</span><br><span class=\"line\">        <span class=\"number\">6</span>: [[<span class=\"number\">0</span>, <span class=\"number\">1</span>], [-<span class=\"number\">1</span>, <span class=\"number\">0</span>]],</span><br><span class=\"line\">        }</span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(grid)</span><br><span class=\"line\">        m = <span class=\"built_in\">len</span>(grid[<span class=\"number\">0</span>])</span><br><span class=\"line\">        <span class=\"keyword\">if</span> n == m == <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">to_position</span>(<span class=\"params\">position, direction</span>):</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> [position[<span class=\"number\">0</span>] + direction[<span class=\"number\">0</span>], position[<span class=\"number\">1</span>] + direction[<span class=\"number\">1</span>]]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reach</span>(<span class=\"params\">cur</span>):</span></span><br><span class=\"line\">            pre = [<span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            <span class=\"keyword\">while</span> cur != [<span class=\"number\">0</span>, <span class=\"number\">0</span>] <span class=\"keyword\">and</span> <span class=\"number\">0</span> &lt;= cur[<span class=\"number\">0</span>] &lt; n <span class=\"keyword\">and</span> <span class=\"number\">0</span> &lt;= cur[<span class=\"number\">1</span>] &lt; m:</span><br><span class=\"line\">                nex1 = to_position(cur, res[grid[cur[<span class=\"number\">0</span>]][cur[<span class=\"number\">1</span>]]][<span class=\"number\">0</span>])</span><br><span class=\"line\">                nex2 = to_position(cur, res[grid[cur[<span class=\"number\">0</span>]][cur[<span class=\"number\">1</span>]]][<span class=\"number\">1</span>])</span><br><span class=\"line\">                <span class=\"keyword\">if</span> nex1 != pre <span class=\"keyword\">and</span> nex2 != pre:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">                <span class=\"comment\"># be careful about the position of checking if reach the destination</span></span><br><span class=\"line\">                <span class=\"comment\"># can not be after `cur = nex`, because it can be reachable only</span></span><br><span class=\"line\">                 <span class=\"comment\"># checked nex1 or nex2 == pre</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> cur == [n - <span class=\"number\">1</span>, m - <span class=\"number\">1</span>]:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">                nex = nex1 <span class=\"keyword\">if</span> nex1 != pre <span class=\"keyword\">else</span> nex2</span><br><span class=\"line\">                pre = cur</span><br><span class=\"line\">                cur = nex</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">        start = [<span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">        cur1 = to_position(start, res[grid[<span class=\"number\">0</span>][<span class=\"number\">0</span>]][<span class=\"number\">0</span>])</span><br><span class=\"line\">        cur2 = to_position(start, res[grid[<span class=\"number\">0</span>][<span class=\"number\">0</span>]][<span class=\"number\">1</span>])</span><br><span class=\"line\">        <span class=\"keyword\">return</span> reach(cur1) <span class=\"keyword\">or</span> reach(cur2)</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"maximum-number-of-visible-points-font-colormagenta2022-06-19font\"><span class=\"post-title-index\">12.4. </span><a class=\"markdownIt-Anchor\" href=\"#maximum-number-of-visible-points-font-colormagenta2022-06-19font\"></a> Maximum Number of Visible Points <font color=\"magenta\">[2022-06-19]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/maximum-number-of-visible-points/\">hard</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">visiblePoints</span>(<span class=\"params\">self, points: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]], angle: <span class=\"built_in\">int</span>, location: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        sameCnt = <span class=\"number\">0</span></span><br><span class=\"line\">        polarDegrees = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> p <span class=\"keyword\">in</span> points:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> p == location:</span><br><span class=\"line\">                sameCnt += <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"comment\"># obain all the angles the range is (-pi, pi]</span></span><br><span class=\"line\">                polarDegrees.append(atan2(p[<span class=\"number\">1</span>] - location[<span class=\"number\">1</span>], p[<span class=\"number\">0</span>] - location[<span class=\"number\">0</span>]))</span><br><span class=\"line\"></span><br><span class=\"line\">        polarDegrees.sort()</span><br><span class=\"line\"></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(polarDegrees)</span><br><span class=\"line\">        <span class=\"comment\"># and 2 pi, the -pi will changed to pi, and thus -pi and pi</span></span><br><span class=\"line\">        <span class=\"comment\"># will be adjoined to each other</span></span><br><span class=\"line\">        <span class=\"comment\"># deg and deg + 2pi are both counted only if the angle is 2pi</span></span><br><span class=\"line\">        polarDegrees += [deg + <span class=\"number\">2</span> * pi <span class=\"keyword\">for</span> deg <span class=\"keyword\">in</span> polarDegrees]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># change the degree into pi</span></span><br><span class=\"line\">        degree = angle * pi / <span class=\"number\">180</span></span><br><span class=\"line\">        <span class=\"comment\"># bisect_right/bisect_left require from bisect import xxxx</span></span><br><span class=\"line\">        <span class=\"comment\"># both bisect_right or bisect_left return the index that the val</span></span><br><span class=\"line\">        <span class=\"comment\"># placed in to the array and keeps the array ranked.</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># when there are numbers equal to val bisect_right places the val to the right</span></span><br><span class=\"line\">        <span class=\"comment\"># side of the equaled numbers, thus the returned value is the number of digits</span></span><br><span class=\"line\">        <span class=\"comment\"># smaller and equil to val in the array</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># bisect_left places the val to the left side of the equaled numbers. Thus the</span></span><br><span class=\"line\">        <span class=\"comment\"># returned value is the number of digits smaller to the val in the array</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># here bisect_right should be used</span></span><br><span class=\"line\">        maxCnt = <span class=\"built_in\">max</span>((bisect_right(polarDegrees, polarDegrees[i] + degree) - i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n)), default=<span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> maxCnt + sameCnt</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"number-of-different-integers-in-a-string-font-colormagenta2022-06-17font\"><span class=\"post-title-index\">12.5. </span><a class=\"markdownIt-Anchor\" href=\"#number-of-different-integers-in-a-string-font-colormagenta2022-06-17font\"></a> Number of Different Integers in a String <font color=\"magenta\">[2022-06-17]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/number-of-different-integers-in-a-string/\">here</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">numDifferentIntegers</span>(<span class=\"params\">self, word: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        res = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        cur = <span class=\"number\">0</span></span><br><span class=\"line\">        word += <span class=\"string\">'a'</span></span><br><span class=\"line\">        flag = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> word:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> i.isdigit():</span><br><span class=\"line\">                flag = <span class=\"literal\">True</span></span><br><span class=\"line\">                cur = cur * <span class=\"number\">10</span> + <span class=\"built_in\">int</span>(i)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> flag:</span><br><span class=\"line\">                    res.add(cur)</span><br><span class=\"line\">                    cur = <span class=\"number\">0</span></span><br><span class=\"line\">                    flag = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">len</span>(res)</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"max-length-of-pair-chain-font-colormagenta2022-06-16font\"><span class=\"post-title-index\">12.6. </span><a class=\"markdownIt-Anchor\" href=\"#max-length-of-pair-chain-font-colormagenta2022-06-16font\"></a> Max Length of Pair Chain <font color=\"magenta\">[2022-06-16]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/maximum-length-of-pair-chain/\">here</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">findLongestChain</span>(<span class=\"params\">self, pairs: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        res  = <span class=\"built_in\">sorted</span>(pairs, key = <span class=\"keyword\">lambda</span> a: a[<span class=\"number\">1</span>])</span><br><span class=\"line\">        ans = [res[<span class=\"number\">0</span>]]</span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(res)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, n):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ans[-<span class=\"number\">1</span>][-<span class=\"number\">1</span>] &lt; res[i][<span class=\"number\">0</span>]:</span><br><span class=\"line\">                ans.append(res[i])</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">len</span>(ans)</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"two-city-scheduling-font-colormagenta2022-06-16font\"><span class=\"post-title-index\">12.7. </span><a class=\"markdownIt-Anchor\" href=\"#two-city-scheduling-font-colormagenta2022-06-16font\"></a> Two City Scheduling <font color=\"magenta\">[2022-06-16]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/two-city-scheduling/\">here</a></p>\n<p>Think about how to divide these people.</p>\n<ul>\n<li>The gain of changing the people from one city to another is only related to\nthe difference between the costs of a and b.</li>\n<li>Thus, we can set the cost of a always 0, and set the cost of b to cost(b) -\ncost(a).</li>\n<li>The cost of a is always 0 and we only need to pick n people to b which reach\nthe minimum cost.</li>\n</ul>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">twoCitySchedCost</span>(<span class=\"params\">self, costs: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        res = [a[<span class=\"number\">1</span>] - a[<span class=\"number\">0</span>] <span class=\"keyword\">for</span> a <span class=\"keyword\">in</span> costs]</span><br><span class=\"line\">        nn = <span class=\"built_in\">len</span>(res)</span><br><span class=\"line\">        sort_idx = <span class=\"built_in\">sorted</span>(<span class=\"built_in\">range</span>(nn), key = <span class=\"keyword\">lambda</span> k: res[k], reverse = <span class=\"literal\">False</span>)</span><br><span class=\"line\">        cost = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(nn // <span class=\"number\">2</span>):</span><br><span class=\"line\">            cost += costs[sort_idx[i]][<span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(nn // <span class=\"number\">2</span>, nn):</span><br><span class=\"line\">            cost += costs[sort_idx[i]][<span class=\"number\">0</span>]</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cost</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"exchange-lcci-font-colormagenta2022-06-16font\"><span class=\"post-title-index\">12.8. </span><a class=\"markdownIt-Anchor\" href=\"#exchange-lcci-font-colormagenta2022-06-16font\"></a> Exchange LCCI <font color=\"magenta\">[2022-06-16]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/exchange-lcci/\">here</a></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">exchangeBits</span>(<span class=\"params\">self, num: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        num_bin = <span class=\"built_in\">bin</span>(num)</span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(num_bin)</span><br><span class=\"line\">        res = <span class=\"string\">''</span></span><br><span class=\"line\">        start = <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> n % <span class=\"number\">2</span>:</span><br><span class=\"line\">            res += <span class=\"string\">'10'</span></span><br><span class=\"line\">            start = <span class=\"number\">3</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(start, n, <span class=\"number\">2</span>):</span><br><span class=\"line\">            res += num_bin[i + <span class=\"number\">1</span>]</span><br><span class=\"line\">            res += num_bin[i]</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">int</span>(res, <span class=\"number\">2</span>)</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"the-first-char-which-only-appears-once-font-colormagenta2022-06-16font\"><span class=\"post-title-index\">12.9. </span><a class=\"markdownIt-Anchor\" href=\"#the-first-char-which-only-appears-once-font-colormagenta2022-06-16font\"></a> The First Char which Only Appears once <font color=\"magenta\">[2022-06-16]</font></h2>\n<p>The topic is\n<a href=\"https://leetcode.cn/problems/di-yi-ge-zhi-chu-xian-yi-ci-de-zi-fu-lcof/\">here</a>.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">firstUniqChar</span>(<span class=\"params\">self, s: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">str</span>:</span></span><br><span class=\"line\">        res = collections.defaultdict(<span class=\"keyword\">lambda</span>: [<span class=\"number\">0</span>, <span class=\"number\">1</span>])</span><br><span class=\"line\">        <span class=\"keyword\">for</span> idx, c <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(s):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> c <span class=\"keyword\">in</span> res:</span><br><span class=\"line\">                res[c][<span class=\"number\">0</span>] = idx</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                res[c][<span class=\"number\">1</span>] += <span class=\"number\">1</span></span><br><span class=\"line\">        ans = <span class=\"string\">\" \"</span></span><br><span class=\"line\">        min_idx = <span class=\"built_in\">len</span>(s)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> res:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res[i][<span class=\"number\">1</span>] == <span class=\"number\">1</span> <span class=\"keyword\">and</span> res[i][<span class=\"number\">0</span>] &lt; min_idx:</span><br><span class=\"line\">                min_idx = res[i][<span class=\"number\">0</span>]</span><br><span class=\"line\">                ans = i</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"the-gas-station\"><span class=\"post-title-index\">12.10. </span><a class=\"markdownIt-Anchor\" href=\"#the-gas-station\"></a> The Gas Station</h2>\n<p>There are <code>n</code> stations along a circular route, where the amount of gas at the\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">i^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.849108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mord mathdefault mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span> station is gas[i].</p>\n<p>A car costs cost[i] of gas to travel from the <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">i^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.849108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mord mathdefault mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span> station to its next\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><msup><mo stretchy=\"false\">)</mo><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">(i + 1)^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.099108em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mord mathdefault mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span> station.</p>\n<p>Can the car run a circle. If can, return the start station. If not, return -1.\nIf there exists a solution, it is guaranteed to be the unique.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">canCompleteCircuit</span>(<span class=\"params\">self, gas: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], cost: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"built_in\">int</span></span></span><br><span class=\"line\"><span class=\"function\">        n = <span class=\"built_in\">len</span>(gas)</span></span><br><span class=\"line\"><span class=\"function\">        res = [0] * n</span></span><br><span class=\"line\"><span class=\"function\">        # a car <span class=\"keyword\">pass</span> station i, it can get gas[i] <span class=\"keyword\">and</span> cost</span></span><br><span class=\"line\"><span class=\"function\">        # cost[i]. Thus gets gas[i] - cost[i].</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">        # <span class=\"keyword\">if</span> <span class=\"keyword\">in</span> station i, gas[i] - cost[i] &gt;= 0, it can</span></span><br><span class=\"line\"><span class=\"function\">        # arrive the <span class=\"built_in\">next</span> station.</span></span><br><span class=\"line\"><span class=\"function\">        # after arrive the <span class=\"built_in\">next</span> station, <span class=\"keyword\">and</span> gets the station</span></span><br><span class=\"line\"><span class=\"function\">        # <span class=\"keyword\">if</span> the remain &gt;= 0 it can gets the <span class=\"built_in\">next</span> <span class=\"built_in\">next</span> station.</span></span><br><span class=\"line\"><span class=\"function\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span></span><br><span class=\"line\">            res[i] = gas[i] - cost[i]</span><br><span class=\"line\">        first = <span class=\"number\">0</span></span><br><span class=\"line\">        second = <span class=\"number\">0</span></span><br><span class=\"line\">        sum_ = res[<span class=\"number\">0</span>]</span><br><span class=\"line\">        key = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"comment\"># second represents the station the car already getting.</span></span><br><span class=\"line\">        <span class=\"comment\"># first represents the starting station.</span></span><br><span class=\"line\">        <span class=\"comment\"># sum_ represents if the car can get the next staion.</span></span><br><span class=\"line\">        <span class=\"comment\"># if sum_ &gt;= 0, it can, else, it can not.</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> sum_ &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                second += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> second == n:</span><br><span class=\"line\">                    second = <span class=\"number\">0</span></span><br><span class=\"line\">                    key = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> key <span class=\"keyword\">and</span> second == first:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> first</span><br><span class=\"line\">                sum_ += res[second]</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                sum_ -= res[first]</span><br><span class=\"line\">                first += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"comment\"># from 0 to n, first do not find an answer, return -1.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> first == n:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> -<span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> first &gt; second:</span><br><span class=\"line\">                        second += <span class=\"number\">1</span></span><br><span class=\"line\">                        sum_ += res[second</span><br></pre></td></tr></tbody></table></figure>\n<p>Consider this, if y is the first station that the car can not arrive from x.\nThat is to say <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mi>y</mi></mrow><mi>x</mi></msubsup><mi>r</mi><mi>e</mi><mi>s</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">\\sum_{i = y}^x res[i] &lt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.24011em;vertical-align:-0.43581800000000004em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.804292em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.43581800000000004em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">s</span><span class=\"mopen\">[</span><span class=\"mord mathdefault\">i</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>. For a station z between x and y. It\ncan arrive z from x, which means the sum <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">&gt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>. Then from z to y, the sum is\ndefinitely <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">&lt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>. It can not arrive y from z.</p>\n<p>Thus, if a car can not arrive y from x, it can not arrive y from any station\nbetween x and y. It is no need to search such stations.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">canCompleteCircuit</span>(<span class=\"params\">self, gas: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], cost: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(gas)</span><br><span class=\"line\">        res = [<span class=\"number\">0</span>] * n</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">            res[i] = gas[i] - cost[i]</span><br><span class=\"line\">        first = <span class=\"number\">0</span></span><br><span class=\"line\">        second = <span class=\"number\">0</span></span><br><span class=\"line\">        sum_ = res[<span class=\"number\">0</span>]</span><br><span class=\"line\">        key = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> sum_ &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                second += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> second == n:</span><br><span class=\"line\">                    second = <span class=\"number\">0</span></span><br><span class=\"line\">                    key = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> key <span class=\"keyword\">and</span> second == first:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> first</span><br><span class=\"line\">                sum_ += res[second]</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># if can not arrive second + 1, then</span></span><br><span class=\"line\">            <span class=\"comment\"># starting from second + 1</span></span><br><span class=\"line\">                second += <span class=\"number\">1</span></span><br><span class=\"line\">                first = second</span><br><span class=\"line\">                <span class=\"comment\"># if the new starting point equal or bigger than</span></span><br><span class=\"line\">                <span class=\"comment\"># n, first move from 0 to n fails to find.</span></span><br><span class=\"line\">                <span class=\"comment\"># if key is True, second + 1 is actually larger than</span></span><br><span class=\"line\">                <span class=\"comment\"># n, first move from 0 to n fails to find.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> first == n <span class=\"keyword\">or</span> key:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> -<span class=\"number\">1</span></span><br><span class=\"line\">                sum_ = res[first]</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"maximum-number-of-tasks-you-can-assign-font-colormagenta2022-05-11font\"><span class=\"post-title-index\">12.11. </span><a class=\"markdownIt-Anchor\" href=\"#maximum-number-of-tasks-you-can-assign-font-colormagenta2022-05-11font\"></a> Maximum Number of Tasks You Can Assign <font color=\"magenta\">[2022-05-11]</font></h2>\n<p>The topic is\n<a href=\"https://leetcode.cn/problems/maximum-number-of-tasks-you-can-assign/\">here</a>.</p>\n<h3 id=\"analysis-3\"><span class=\"post-title-index\">12.11.1. </span><a class=\"markdownIt-Anchor\" href=\"#analysis-3\"></a> Analysis</h3>\n<ol>\n<li>The task need small strength is preferred.</li>\n<li>The worker with large strength is preferred</li>\n</ol>\n<p>A wrong code</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">maxTaskAssign</span>(<span class=\"params\">self, tasks: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], workers: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], pills: <span class=\"built_in\">int</span>, strength: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        tasks.sort()</span><br><span class=\"line\">        workers.sort()</span><br><span class=\"line\">        n =  <span class=\"built_in\">len</span>(tasks)</span><br><span class=\"line\">        m =  <span class=\"built_in\">len</span>(workers)</span><br><span class=\"line\">        ans = <span class=\"number\">0</span></span><br><span class=\"line\">        j = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(m):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> j &lt; n:</span><br><span class=\"line\">                <span class=\"comment\"># A new worker waiting for task</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> workers[i] &gt;= tasks[j]:</span><br><span class=\"line\">                    ans += <span class=\"number\">1</span></span><br><span class=\"line\">                    <span class=\"comment\"># the task has been assigned, consider the next task</span></span><br><span class=\"line\">                    j += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"comment\"># if there is pills avaliable</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> pills <span class=\"keyword\">and</span> workers[i] + strength &gt;= tasks[j]:</span><br><span class=\"line\">                        <span class=\"comment\"># use this pill</span></span><br><span class=\"line\">                        pills -= <span class=\"number\">1</span></span><br><span class=\"line\">                        ans += <span class=\"number\">1</span></span><br><span class=\"line\">                        j += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></tbody></table></figure>\n<p>This code prefers to use small strength workers, which is wrong. When the\nworkers can do <code>k</code> tasks, it must be the top <code>k</code> strength workers taking the\nbottom <code>k</code> tasks.</p>\n<p>The final answer.</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> sortedcontainers <span class=\"keyword\">import</span> SortedList</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">maxTaskAssign</span>(<span class=\"params\">self, tasks, workers, pills, strength</span>):</span></span><br><span class=\"line\">        n, m = <span class=\"built_in\">len</span>(tasks), <span class=\"built_in\">len</span>(workers)</span><br><span class=\"line\">        tasks.sort()</span><br><span class=\"line\">        workers.sort()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">check</span>(<span class=\"params\">mid: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">bool</span>:</span></span><br><span class=\"line\">            p = pills</span><br><span class=\"line\">            <span class=\"comment\">#  the workers needed to be check</span></span><br><span class=\"line\">            ws = SortedList(workers[m - mid:])</span><br><span class=\"line\">            <span class=\"comment\"># tasks from large to small</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(mid - <span class=\"number\">1</span>, -<span class=\"number\">1</span>, -<span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ws[-<span class=\"number\">1</span>] &gt;= tasks[i]:</span><br><span class=\"line\">                    <span class=\"comment\"># tasks[i] is assigned to ws[-1]</span></span><br><span class=\"line\">                    ws.pop()</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> p == <span class=\"number\">0</span>:</span><br><span class=\"line\">                        <span class=\"comment\"># if does not have pills anymore</span></span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">                    <span class=\"comment\"># has pills</span></span><br><span class=\"line\">                    <span class=\"comment\"># Note: find the smallest worker can take the task by pill</span></span><br><span class=\"line\">                    rep = ws.bisect_left(tasks[i] - strength)</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> rep == <span class=\"built_in\">len</span>(ws):</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">                    p -= <span class=\"number\">1</span></span><br><span class=\"line\">                    ws.pop(rep)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># The scope of k needed to be checked if 1 checked false, answer is 0</span></span><br><span class=\"line\">        <span class=\"comment\"># if right = min(m, n) checked true, answer is right</span></span><br><span class=\"line\">        left, right, ans = <span class=\"number\">1</span>, <span class=\"built_in\">min</span>(m, n), <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) // <span class=\"number\">2</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> check(mid):</span><br><span class=\"line\">                <span class=\"comment\"># if mid is true, then ans is larger than mid</span></span><br><span class=\"line\">                <span class=\"comment\"># find it in [mid + 1, right]</span></span><br><span class=\"line\">                ans = mid</span><br><span class=\"line\">                left = mid + <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"comment\"># if mid is false, then ans is smaller than mid</span></span><br><span class=\"line\">                <span class=\"comment\"># find it in [left, mid - 1]</span></span><br><span class=\"line\">                right = mid - <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></tbody></table></figure>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"backtrack\"><a class=\"markdownIt-Anchor\" href=\"#backtrack\"></a> Backtrack</h1>\n<p>We can cope with only simple tasks. But there is only a complex task.</p>\n<p>If we can transfer it into a relative simpler one, do it again and again till we\ncan cope with it.</p>\n<p>When transfer, the simpler task may have some relationship with the complex one,\ne.g., the complex task gives some restrictions to to the simpler one.</p>\n<h2 id=\"n-queens-ii-font-colormagenta2022-06-20font\"><a class=\"markdownIt-Anchor\" href=\"#n-queens-ii-font-colormagenta2022-06-20font\"></a> N-Queens II <font color=magenta>[2022-06-20]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/n-queens-ii/\">Hard</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">totalNQueens</span>(<span class=\"params\">self, n: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">backtrack</span>(<span class=\"params\">row: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">            <span class=\"comment\"># fill the row</span></span><br><span class=\"line\">            <span class=\"comment\"># two kinds of return</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># when row == n, the last row (n - 1) is filled</span></span><br><span class=\"line\">            <span class=\"comment\"># thus it must be only 1 solution to reach here so return 1</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># if row &lt; n - 1, the solution there is may be multiple solutions</span></span><br><span class=\"line\">            <span class=\"comment\"># clear the count (count = 0), then find the number of solutions</span></span><br><span class=\"line\">            <span class=\"comment\"># and return it</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># thus this function calculates the number of  solutions when the first</span></span><br><span class=\"line\">            <span class=\"comment\"># row - 1 rows is filled, how they are filled are recorded by columns,</span></span><br><span class=\"line\">            <span class=\"comment\"># diagonal1 and giagonal2</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># two key points:</span></span><br><span class=\"line\">            <span class=\"comment\"># 1. How the backtrack end: that is the condition return 1</span></span><br><span class=\"line\">            <span class=\"comment\"># 2. How to transfer the task to a smaller one, that is else.</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># we can crop it if  and only if row == n, thus we only need</span></span><br><span class=\"line\">            <span class=\"comment\"># to transfer the task to a simpler one till we can crop it</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> row == n:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                count = <span class=\"number\">0</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">                    <span class=\"comment\"># i is the columns if it is used continue</span></span><br><span class=\"line\">                    <span class=\"comment\"># two position A and B, if their row -/+ i is the same number</span></span><br><span class=\"line\">                    <span class=\"comment\"># they are in one diagonal then continue</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> i <span class=\"keyword\">in</span> columns <span class=\"keyword\">or</span> row - i <span class=\"keyword\">in</span> diagonal1 <span class=\"keyword\">or</span> row + i <span class=\"keyword\">in</span> diagonal2:</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span></span><br><span class=\"line\">                    columns.add(i)</span><br><span class=\"line\">                    diagonal1.add(row - i)</span><br><span class=\"line\">                    diagonal2.add(row + i)</span><br><span class=\"line\">                    count += backtrack(row + <span class=\"number\">1</span>)</span><br><span class=\"line\">                    columns.remove(i)</span><br><span class=\"line\">                    diagonal1.remove(row - i)</span><br><span class=\"line\">                    diagonal2.remove(row + i)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> count</span><br><span class=\"line\"></span><br><span class=\"line\">        columns = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        diagonal1 = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        diagonal2 = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> backtrack(<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n<h1 id=\"depth-first-search\"><a class=\"markdownIt-Anchor\" href=\"#depth-first-search\"></a> Depth First Search</h1>\n<h2 id=\"find-all-possible-recipes-from-given-supplies-font-colormagenta2022-06-24font\"><a class=\"markdownIt-Anchor\" href=\"#find-all-possible-recipes-from-given-supplies-font-colormagenta2022-06-24font\"></a> Find All Possible Recipes from Given Supplies <font color=magenta>[2022-06-24]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/find-all-possible-recipes-from-given-supplies/\">Medium</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">findAllRecipes</span>(<span class=\"params\">self, recipes: <span class=\"type\">List</span>[<span class=\"built_in\">str</span>], ingredients: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">str</span>]], supplies: <span class=\"type\">List</span>[<span class=\"built_in\">str</span>]</span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">str</span>]:</span></span><br><span class=\"line\">        res = []</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">remove_cur</span>(<span class=\"params\">cur_supplies</span>):</span></span><br><span class=\"line\">            nex_supplies = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i, cur_ingredients <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(ingredients):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> cur_ingredients:</span><br><span class=\"line\">                   <span class=\"comment\"># Be careful. How to remove items in a loop</span></span><br><span class=\"line\">                    <span class=\"comment\"># https://segmentfault.com/a/1190000007214571</span></span><br><span class=\"line\">                    cur_ingredients = <span class=\"built_in\">list</span>(<span class=\"built_in\">filter</span>(<span class=\"keyword\">lambda</span> x: x <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> cur_supplies, cur_ingredients))</span><br><span class=\"line\">                    ingredients[i] = cur_ingredients</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> cur_ingredients:</span><br><span class=\"line\">                        nex_supplies.add(recipes[i])</span><br><span class=\"line\">                        res.append(recipes[i])</span><br><span class=\"line\">                        recipes[i] = <span class=\"literal\">None</span></span><br><span class=\"line\">                        ingredients[i] = <span class=\"literal\">None</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> nex_supplies</span><br><span class=\"line\"></span><br><span class=\"line\">        supplies = <span class=\"built_in\">set</span>(supplies)</span><br><span class=\"line\">        <span class=\"keyword\">while</span> supplies:</span><br><span class=\"line\">            supplies = remove_cur(supplies)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res</span><br></pre></td></tr></table></figure>\n<h2 id=\"longest-increasing-path-in-a-matrix\"><a class=\"markdownIt-Anchor\" href=\"#longest-increasing-path-in-a-matrix\"></a> Longest Increasing Path in a Matrix</h2>\n<p>Given an <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">m \\times n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> integers matrix, return the length of the longest\nincreasing path in matrix.</p>\n<p>Move direction: left, right, up, or down.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    DIRS = [(-<span class=\"number\">1</span>, <span class=\"number\">0</span>), (<span class=\"number\">1</span>, <span class=\"number\">0</span>), (<span class=\"number\">0</span>, -<span class=\"number\">1</span>), (<span class=\"number\">0</span>, <span class=\"number\">1</span>)]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">longestIncreasingPath</span>(<span class=\"params\">self, matrix: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> matrix:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">        @lru_cache(<span class=\"params\"><span class=\"literal\">None</span></span>) </span><span class=\"comment\"># save  the storage</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">find_max</span>(<span class=\"params\">i, j</span>):</span></span><br><span class=\"line\">        <span class=\"comment\"># find the next value and try the four directions</span></span><br><span class=\"line\">        <span class=\"comment\"># return the longest direction.</span></span><br><span class=\"line\">            max_ = <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> dr <span class=\"keyword\">in</span> Solution.DIRS:</span><br><span class=\"line\">                try_i = i + dr[<span class=\"number\">0</span>]</span><br><span class=\"line\">                try_j = j + dr[<span class=\"number\">1</span>]</span><br><span class=\"line\">                <span class=\"comment\"># the direction will be discarded if do not meet the condition</span></span><br><span class=\"line\">                <span class=\"comment\"># and a direction meet the condition will be searched for the next</span></span><br><span class=\"line\">                <span class=\"comment\"># value first.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"number\">0</span> &lt;= try_i <span class=\"keyword\">and</span> try_i &lt; n <span class=\"keyword\">and</span> <span class=\"number\">0</span>&lt;= try_j <span class=\"keyword\">and</span> try_j &lt; m <span class=\"keyword\">and</span> \\</span><br><span class=\"line\">                matrix[i][j] &lt; matrix[try_i][try_j]:</span><br><span class=\"line\">                    max_ = <span class=\"built_in\">max</span>(max_, find_max(try_i, try_j) + <span class=\"number\">1</span>)</span><br><span class=\"line\">                    <span class=\"comment\"># The value is increasing, so by setting `matrix[i][j] \\</span></span><br><span class=\"line\">                    <span class=\"comment\"># &lt; matrix[try_i][try_j]`, a searched position will never</span></span><br><span class=\"line\">                    <span class=\"comment\"># be searched again.</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> max_</span><br><span class=\"line\"></span><br><span class=\"line\">        n, m = <span class=\"built_in\">len</span>(matrix), <span class=\"built_in\">len</span>(matrix[<span class=\"number\">0</span>])</span><br><span class=\"line\">        res = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span>  <span class=\"built_in\">range</span>(m):</span><br><span class=\"line\">                res = <span class=\"built_in\">max</span>(res, find_max(i, j))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"keyboard\"><a class=\"markdownIt-Anchor\" href=\"#keyboard\"></a> Keyboard</h2>\n<p>A keyboard only have 26 keys, <code>a~z</code>. Each key can be only typed <code>k</code> times at\nmost.</p>\n<p>How many possible content there is, when the keyboard is typed <code>n</code> times?</p>\n<h3 id=\"method-1-dfs\"><a class=\"markdownIt-Anchor\" href=\"#method-1-dfs\"></a> Method 1: dfs</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">   <span class=\"comment\"># depth first search: from the first letter to the last letter</span></span><br><span class=\"line\">   <span class=\"comment\"># fill the n positions.</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">keyboard</span>(<span class=\"params\">self, k: <span class=\"built_in\">int</span>, n: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">       MOD = <span class=\"number\">1000000007</span></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\"># c is the number of remain letters</span></span><br><span class=\"line\">       <span class=\"comment\"># n is the number of letters needed to type in</span></span><br><span class=\"line\">       <span class=\"comment\"># k is the max number that each letter can type</span></span><br><span class=\"line\"><span class=\"meta\">       @lru_cache(<span class=\"params\"><span class=\"literal\">None</span></span>)</span></span><br><span class=\"line\">       <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">dfs</span>(<span class=\"params\">c, n, k</span>):</span></span><br><span class=\"line\">           <span class=\"keyword\">if</span> n == <span class=\"number\">0</span>:</span><br><span class=\"line\">               <span class=\"comment\"># no letters is needed any more</span></span><br><span class=\"line\">               <span class=\"comment\"># only 1 way: type nothing</span></span><br><span class=\"line\">               <span class=\"comment\"># pick 0 letters</span></span><br><span class=\"line\">               <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">           <span class=\"keyword\">if</span> c &lt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">               <span class=\"comment\"># no letter remained but n is not 0</span></span><br><span class=\"line\">               <span class=\"comment\"># this is a failed type scheme</span></span><br><span class=\"line\">               <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\">           res = <span class=\"number\">0</span></span><br><span class=\"line\">           <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">min</span>(n, k) + <span class=\"number\">1</span>):</span><br><span class=\"line\">           <span class=\"comment\"># there are math.comb(n, i) ways to put i letters</span></span><br><span class=\"line\">           <span class=\"comment\"># into n position.</span></span><br><span class=\"line\">               res += math.comb(n, i) * dfs(c-<span class=\"number\">1</span>, n - i, k) % MOD</span><br><span class=\"line\">           <span class=\"keyword\">return</span> res % MOD</span><br><span class=\"line\">       ans = dfs(<span class=\"number\">26</span>, n, k)</span><br><span class=\"line\">       <span class=\"keyword\">return</span> ans % MOD</span><br></pre></td></tr></table></figure>\n<h3 id=\"method-2-dynamic-programming\"><a class=\"markdownIt-Anchor\" href=\"#method-2-dynamic-programming\"></a> Method 2: dynamic programming</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">keyboard</span>(<span class=\"params\">self, k: <span class=\"built_in\">int</span>, n: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        MOD = <span class=\"number\">1000000007</span></span><br><span class=\"line\">        res = [[<span class=\"number\">0</span> <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">27</span>)] <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n + <span class=\"number\">1</span>)]</span><br><span class=\"line\">        <span class=\"comment\"># res[i][j] is the number of possibilities when first j letters</span></span><br><span class=\"line\">        <span class=\"comment\"># is used to fill i positions.</span></span><br><span class=\"line\">        <span class=\"comment\"># when the position is 0, no matter how many letters are used.</span></span><br><span class=\"line\">        <span class=\"comment\"># there is only one possibility, i.e., filling nothing.</span></span><br><span class=\"line\">        <span class=\"comment\"># thus, res[0][i] are all 1.</span></span><br><span class=\"line\">        res[<span class=\"number\">0</span>][<span class=\"number\">0</span>] = <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">27</span>):</span><br><span class=\"line\">            res[<span class=\"number\">0</span>][i] = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># res[i][j] can be divided into several possibilities.</span></span><br><span class=\"line\">        <span class=\"comment\"># When 0 letter is filled for the $j^&#123;th&#125;$ letter, res[i][j-1]</span></span><br><span class=\"line\">        <span class=\"comment\"># when 1 letter is filled for the j-th letter, res[i-1][j-1]</span></span><br><span class=\"line\">        <span class=\"comment\"># * C_i^1</span></span><br><span class=\"line\">        <span class=\"comment\"># when 2 letters are filled for the j-th letter, res[i-2][j-1]</span></span><br><span class=\"line\">        <span class=\"comment\"># * C_i^2</span></span><br><span class=\"line\">        <span class=\"comment\"># C_i^m represent how many possibilities there are filling m of</span></span><br><span class=\"line\">        <span class=\"comment\"># the same letters into i positions.</span></span><br><span class=\"line\">        <span class=\"comment\"># m can be 0, but can not be larger than k or i.</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, n + <span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"number\">27</span>):</span><br><span class=\"line\">                <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">min</span>(i + <span class=\"number\">1</span>, k + <span class=\"number\">1</span>)):</span><br><span class=\"line\">                    res[i][j] += res[i - m][j - <span class=\"number\">1</span>] * math.comb(i, m)</span><br><span class=\"line\">                    res[i][j] %= MOD</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> res[-<span class=\"number\">1</span>][-<span class=\"number\">1</span>] % MOD</span><br></pre></td></tr></table></figure>\n<h1 id=\"dynamic-programming\"><a class=\"markdownIt-Anchor\" href=\"#dynamic-programming\"></a> Dynamic Programming</h1>\n<h2 id=\"minimum-one-bit-operations-to-make-integers-zero-font-colormagenta2022-06-27font\"><a class=\"markdownIt-Anchor\" href=\"#minimum-one-bit-operations-to-make-integers-zero-font-colormagenta2022-06-27font\"></a> Minimum One Bit Operations to Make Integers Zero <font color=magenta>[2022-06-27]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/minimum-one-bit-operations-to-make-integers-zero/\">Really Hard</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">minimumOneBitOperations</span>(<span class=\"params\">self, n</span>):</span></span><br><span class=\"line\">        dp1 = [<span class=\"number\">0</span> <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">32</span>)]</span><br><span class=\"line\">    <span class=\"comment\">#dp1[i] 表示 仅第 i 位 为 1 时 将 第 i 位变为 0 的最小修改次数</span></span><br><span class=\"line\">        res = <span class=\"number\">0</span></span><br><span class=\"line\">        dp1[<span class=\"number\">0</span>] = <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i  <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">32</span>):</span><br><span class=\"line\">            dp1[i] = dp1[i - <span class=\"number\">1</span>] + <span class=\"number\">1</span> + dp1[i - <span class=\"number\">1</span>]</span><br><span class=\"line\">        f = <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"comment\"># 1. 0 变位仅i位为1的过程中，其后每一位都需要经历若干次从0到1,再从1到0的变化</span></span><br><span class=\"line\">        <span class=\"comment\"># 2. 其后位中若原本就为1,则不会经历第一次从0到1的变化，因为它本身就是1</span></span><br><span class=\"line\">        <span class=\"comment\"># 所以若把第i位从1变为0,记为dp[i]，是多记录了，因为其后有1</span></span><br><span class=\"line\">        <span class=\"comment\"># 所以如果其后遇到1的要减去。但是减去的话又多减了，因为其后还有1,所以又加上</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">31</span>, -<span class=\"number\">1</span>, -<span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> n &gt;&gt; i &amp; <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> f:</span><br><span class=\"line\">                    res += dp1[i]</span><br><span class=\"line\">                    f = <span class=\"literal\">False</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    res -= dp1[i]</span><br><span class=\"line\">                    f = <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> res</span><br></pre></td></tr></table></figure>\n<h2 id=\"the-number-of-palindromes\"><a class=\"markdownIt-Anchor\" href=\"#the-number-of-palindromes\"></a> The number of palindromes</h2>\n<p>Given a string return the number of the palindromes. The substrings are regarded\nas different strings if they are start and end at different position.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">countSubstrings</span>(<span class=\"params\">self, s: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(s)</span><br><span class=\"line\">        res = [[<span class=\"literal\">False</span> <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n)] <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n)]</span><br><span class=\"line\">        <span class=\"comment\"># if n == 0, there are 0 palindromes.</span></span><br><span class=\"line\">        <span class=\"comment\"># if n == 1, there are 1 palindromes.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> n <span class=\"keyword\">or</span> n == <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> n</span><br><span class=\"line\">        ans = n</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">            res[<span class=\"number\">0</span>][i] = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n - <span class=\"number\">1</span>):</span><br><span class=\"line\">            res[<span class=\"number\">1</span>][i] = s[i] == s[i + <span class=\"number\">1</span>]</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res[<span class=\"number\">1</span>][i]:</span><br><span class=\"line\">                ans += <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"comment\"># if n == 2 it will not enter the following circle.</span></span><br><span class=\"line\"><span class=\"comment\"># if n &gt; 2 it will contnue to caculate palindromes whose length is larger than 2</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> l <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">2</span>, n):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> st <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n - l):</span><br><span class=\"line\">                res[l][st] = res[l - <span class=\"number\">2</span>][st + <span class=\"number\">1</span>] <span class=\"keyword\">and</span> s[st] == s[st + l]</span><br><span class=\"line\">                <span class=\"keyword\">if</span> res[l][st]:</span><br><span class=\"line\">                    ans += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></table></figure>\n<h2 id=\"knight-dialer\"><a class=\"markdownIt-Anchor\" href=\"#knight-dialer\"></a> Knight Dialer</h2>\n<p>The topic is <a href=\"https://leetcode-cn.com/problems/knight-dialer/\">here</a>.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">knightDialer</span>(<span class=\"params\">self, N</span>):</span></span><br><span class=\"line\">        MOD = <span class=\"number\">10</span>**<span class=\"number\">9</span> + <span class=\"number\">7</span></span><br><span class=\"line\">        <span class=\"comment\"># From 0 can reach 4 and 6</span></span><br><span class=\"line\">        <span class=\"comment\"># From 1 can reach 6 and 8</span></span><br><span class=\"line\">        moves = [[<span class=\"number\">4</span>,<span class=\"number\">6</span>],[<span class=\"number\">6</span>,<span class=\"number\">8</span>],[<span class=\"number\">7</span>,<span class=\"number\">9</span>],[<span class=\"number\">4</span>,<span class=\"number\">8</span>],[<span class=\"number\">3</span>,<span class=\"number\">9</span>,<span class=\"number\">0</span>],[],</span><br><span class=\"line\">                     [<span class=\"number\">1</span>,<span class=\"number\">7</span>,<span class=\"number\">0</span>],[<span class=\"number\">2</span>,<span class=\"number\">6</span>],[<span class=\"number\">1</span>,<span class=\"number\">3</span>],[<span class=\"number\">2</span>,<span class=\"number\">4</span>]]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># There is dp[i]==1 ways to reach i by one step</span></span><br><span class=\"line\">        dp = [<span class=\"number\">1</span>] * <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> hops <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(N-<span class=\"number\">1</span>):</span><br><span class=\"line\">            dp2 = [<span class=\"number\">0</span>] * <span class=\"number\">10</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> node, count <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(dp):</span><br><span class=\"line\">              <span class=\"comment\"># There are count way to reach node by hops + 1 steps</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> nei <span class=\"keyword\">in</span> moves[node]:</span><br><span class=\"line\">                    dp2[nei] += count</span><br><span class=\"line\">                    dp2[nei] %= MOD</span><br><span class=\"line\">              <span class=\"comment\"># There are dp2[nei] way to reach nei by hops + 2 steps</span></span><br><span class=\"line\">            dp = dp2</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">sum</span>(dp) % MOD</span><br></pre></td></tr></table></figure>\n<h1 id=\"linked-list\"><a class=\"markdownIt-Anchor\" href=\"#linked-list\"></a> Linked List</h1>\n<h2 id=\"find-the-minimum-and-maximum-number-of-nodes-between-critical-points-font-colormagenta2022-06-18font\"><a class=\"markdownIt-Anchor\" href=\"#find-the-minimum-and-maximum-number-of-nodes-between-critical-points-font-colormagenta2022-06-18font\"></a> Find The Minimum and Maximum Number of Nodes Between Critical Points <font color=magenta>[2022-06-18]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/find-the-minimum-and-maximum-number-of-nodes-between-critical-points/\">Medium</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">nodesBetweenCriticalPoints</span>(<span class=\"params\">self, head: <span class=\"type\">Optional</span>[ListNode]</span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]:</span></span><br><span class=\"line\">        <span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\">        cur = head</span><br><span class=\"line\">        left_sign = <span class=\"number\">0</span></span><br><span class=\"line\">        pre_idx = <span class=\"literal\">None</span></span><br><span class=\"line\">        start_idx = <span class=\"literal\">None</span></span><br><span class=\"line\">        min_distance = <span class=\"built_in\">float</span>(<span class=\"string\">&#x27;inf&#x27;</span>)</span><br><span class=\"line\">        idx = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> cur.<span class=\"built_in\">next</span>:</span><br><span class=\"line\">            right_sign = np.sign(cur.<span class=\"built_in\">next</span>.val - cur.val)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> left_sign * right_sign == -<span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> start_idx:</span><br><span class=\"line\">                    start_idx = idx</span><br><span class=\"line\">                <span class=\"keyword\">if</span> pre_idx <span class=\"keyword\">and</span> idx - pre_idx &lt; min_distance:</span><br><span class=\"line\">                    min_distance = idx - pre_idx</span><br><span class=\"line\"></span><br><span class=\"line\">                pre_idx = idx</span><br><span class=\"line\">            cur = cur.<span class=\"built_in\">next</span></span><br><span class=\"line\">            left_sign = right_sign</span><br><span class=\"line\">            idx += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> pre_idx != start_idx:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [min_distance, pre_idx - start_idx]</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [-<span class=\"number\">1</span>, -<span class=\"number\">1</span>]</span><br></pre></td></tr></table></figure>\n<h2 id=\"reverse-a-linked-list-font-colormagenta2022-06-16font\"><a class=\"markdownIt-Anchor\" href=\"#reverse-a-linked-list-font-colormagenta2022-06-16font\"></a> Reverse a Linked List <font color=magenta>[2022-06-16]</font></h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reverseList</span>(<span class=\"params\">self, head: ListNode</span>) -&gt; ListNode:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> head <span class=\"keyword\">or</span> <span class=\"keyword\">not</span> head.<span class=\"built_in\">next</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> head</span><br><span class=\"line\">        cur = head.<span class=\"built_in\">next</span></span><br><span class=\"line\">        start = head</span><br><span class=\"line\">        <span class=\"comment\"># head is the last node</span></span><br><span class=\"line\">        start.<span class=\"built_in\">next</span> = <span class=\"literal\">None</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> cur:</span><br><span class=\"line\">            next_cur = cur.<span class=\"built_in\">next</span></span><br><span class=\"line\">            cur.<span class=\"built_in\">next</span> = start</span><br><span class=\"line\">            start = cur</span><br><span class=\"line\">            cur = next_cur</span><br><span class=\"line\">        <span class=\"keyword\">return</span> start</span><br></pre></td></tr></table></figure>\n<h2 id=\"reverse-nodes-in-k-group-font-colormagenta2022-06-10font\"><a class=\"markdownIt-Anchor\" href=\"#reverse-nodes-in-k-group-font-colormagenta2022-06-10font\"></a> Reverse Nodes in K-Group <font color=magenta>[2022-06-10]</font></h2>\n<p>Given the head of a linked list, reverse the nodes of the list <code>k</code> at a time and\nreturn the modified list.</p>\n<p>Python</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">      <span class=\"comment\"># reverse a link node, the length is k</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reverse</span>(<span class=\"params\">self, head: ListNode, tail: ListNode, k</span>):</span></span><br><span class=\"line\">        current = head</span><br><span class=\"line\">        crop = head.<span class=\"built_in\">next</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(k - <span class=\"number\">1</span>):</span><br><span class=\"line\">            follow = crop.<span class=\"built_in\">next</span></span><br><span class=\"line\">            crop.<span class=\"built_in\">next</span> = current</span><br><span class=\"line\">            current = crop</span><br><span class=\"line\">            crop = follow</span><br><span class=\"line\">        <span class=\"keyword\">return</span> current, head</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reverseKGroup</span>(<span class=\"params\">self, head: ListNode, k: <span class=\"built_in\">int</span></span>) -&gt; ListNode:</span></span><br><span class=\"line\">        dump = ListNode(<span class=\"number\">0</span>)</span><br><span class=\"line\">        dump.<span class=\"built_in\">next</span> = head</span><br><span class=\"line\"></span><br><span class=\"line\">        current = dump</span><br><span class=\"line\">        end = current</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># while the end has next, check if it has k nodes followed</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> end.<span class=\"built_in\">next</span>:</span><br><span class=\"line\">            start = end.<span class=\"built_in\">next</span></span><br><span class=\"line\">            <span class=\"comment\"># check if followed k nodes</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(k):</span><br><span class=\"line\">                end = end.<span class=\"built_in\">next</span></span><br><span class=\"line\">                 <span class=\"comment\"># do not have k nodes followed, then do not reverse</span></span><br><span class=\"line\">                 <span class=\"comment\"># and also the link node have been done, and return.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> end:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> dump.<span class=\"built_in\">next</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># if have k nodes followed</span></span><br><span class=\"line\">            follow = end.<span class=\"built_in\">next</span></span><br><span class=\"line\">             <span class=\"comment\"># reverse the k nodes and return the reversed start and end</span></span><br><span class=\"line\">            r_start, r_end = self.reverse(start, end, k)</span><br><span class=\"line\">             <span class=\"comment\"># connect the reversed k nodes with the original nodes</span></span><br><span class=\"line\">            current.<span class=\"built_in\">next</span> = r_start</span><br><span class=\"line\">            r_end.<span class=\"built_in\">next</span> = follow</span><br><span class=\"line\">            current = r_end</span><br><span class=\"line\">            end = current</span><br><span class=\"line\">            <span class=\"comment\"># the length of the link node is a multiple of k, and end.next is None, return</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> dump.<span class=\"built_in\">next</span></span><br></pre></td></tr></table></figure>\n<p>c++</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span> &#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"comment\">// 翻转一个子链表，并且返回新的头与尾</span></span><br><span class=\"line\">    <span class=\"function\">pair&lt;ListNode*, ListNode*&gt; <span class=\"title\">myReverse</span><span class=\"params\">(ListNode* head, ListNode* tail)</span> </span>&#123;</span><br><span class=\"line\">        ListNode* prev = tail-&gt;next;</span><br><span class=\"line\">        ListNode* p = head;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (prev != tail) &#123;</span><br><span class=\"line\">            ListNode* nex = p-&gt;next;</span><br><span class=\"line\">            p-&gt;next = prev;</span><br><span class=\"line\">            prev = p;</span><br><span class=\"line\">            p = nex;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;tail, head&#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">ListNode* <span class=\"title\">reverseKGroup</span><span class=\"params\">(ListNode* head, <span class=\"keyword\">int</span> k)</span> </span>&#123;</span><br><span class=\"line\">        ListNode* hair = <span class=\"keyword\">new</span> <span class=\"built_in\">ListNode</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        hair-&gt;next = head;</span><br><span class=\"line\">        ListNode* pre = hair;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (head) &#123;</span><br><span class=\"line\">            ListNode* tail = pre;</span><br><span class=\"line\">            <span class=\"comment\">// 查看剩余部分长度是否大于等于 k</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; k; ++i) &#123;</span><br><span class=\"line\">                tail = tail-&gt;next;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!tail) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> hair-&gt;next;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            ListNode* nex = tail-&gt;next;</span><br><span class=\"line\">            <span class=\"comment\">// 这里是 C++17 的写法，也可以写成</span></span><br><span class=\"line\">            <span class=\"comment\">// pair&lt;ListNode*, ListNode*&gt; result = myReverse(head, tail);</span></span><br><span class=\"line\">            <span class=\"comment\">// head = result.first;</span></span><br><span class=\"line\">            <span class=\"comment\">// tail = result.second;</span></span><br><span class=\"line\">            <span class=\"built_in\">tie</span>(head, tail) = <span class=\"built_in\">myReverse</span>(head, tail);</span><br><span class=\"line\">            <span class=\"comment\">// 把子链表重新接回原链表</span></span><br><span class=\"line\">            pre-&gt;next = head;</span><br><span class=\"line\">            tail-&gt;next = nex;</span><br><span class=\"line\">            pre = tail;</span><br><span class=\"line\">            head = tail-&gt;next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> hair-&gt;next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"palindrome-linked-list\"><a class=\"markdownIt-Anchor\" href=\"#palindrome-linked-list\"></a> Palindrome Linked List</h2>\n<p>Given the <code>head</code> of a singly linked list, return <code>true</code> if it is a Palindrome.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">isPalindrome</span>(<span class=\"params\">self, head: ListNode</span>) -&gt; <span class=\"built_in\">bool</span>:</span></span><br><span class=\"line\">        res = []</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> head:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">        num = <span class=\"number\">0</span></span><br><span class=\"line\">        first = head</span><br><span class=\"line\">        <span class=\"keyword\">while</span> first.<span class=\"built_in\">next</span>:</span><br><span class=\"line\">            res.append(first.val)</span><br><span class=\"line\">            num += <span class=\"number\">1</span> <span class=\"comment\"># count the length of the linked list</span></span><br><span class=\"line\">            first = first.<span class=\"built_in\">next</span></span><br><span class=\"line\">        res.append(first.val) <span class=\"comment\"># store all the node value</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(num // <span class=\"number\">2</span> + <span class=\"number\">1</span>): <span class=\"comment\"># does not need to check all the nodes</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> res[i] != res[num - i]:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br></pre></td></tr></table></figure>\n<p>If one want only use O(n) time and O(1) storage, must reverse the last half of\nthe linked list.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">isPalindrome</span>(<span class=\"params\">self, head: ListNode</span>) -&gt; <span class=\"built_in\">bool</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> head <span class=\"keyword\">or</span> <span class=\"keyword\">not</span> head.<span class=\"built_in\">next</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">find_the_middle</span>(<span class=\"params\">node</span>):</span></span><br><span class=\"line\">            slow = node</span><br><span class=\"line\">            fast = node</span><br><span class=\"line\">            <span class=\"keyword\">while</span> fast.<span class=\"built_in\">next</span> <span class=\"keyword\">and</span> fast.<span class=\"built_in\">next</span>.<span class=\"built_in\">next</span>:</span><br><span class=\"line\">                slow = slow.<span class=\"built_in\">next</span></span><br><span class=\"line\">                fast = fast.<span class=\"built_in\">next</span>.<span class=\"built_in\">next</span></span><br><span class=\"line\">            second_start = slow.<span class=\"built_in\">next</span></span><br><span class=\"line\">            slow.<span class=\"built_in\">next</span> = <span class=\"literal\">None</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> second_start</span><br><span class=\"line\">        second_start = find_the_middle(head)</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reverse</span>(<span class=\"params\">node</span>):</span></span><br><span class=\"line\">            start = node</span><br><span class=\"line\">            pre = node.<span class=\"built_in\">next</span></span><br><span class=\"line\">            start.<span class=\"built_in\">next</span> = <span class=\"literal\">None</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> pre:</span><br><span class=\"line\">                cur = pre</span><br><span class=\"line\">                pre = pre.<span class=\"built_in\">next</span></span><br><span class=\"line\">                cur.<span class=\"built_in\">next</span> = start</span><br><span class=\"line\">                start = cur</span><br><span class=\"line\">            <span class=\"keyword\">return</span> start</span><br><span class=\"line\">        new_start = reverse(second_start)</span><br><span class=\"line\">        <span class=\"keyword\">while</span> head <span class=\"keyword\">and</span> new_start:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> head.val != new_start.val:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">            head = head.<span class=\"built_in\">next</span></span><br><span class=\"line\">            new_start = new_start.<span class=\"built_in\">next</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"string\"><a class=\"markdownIt-Anchor\" href=\"#string\"></a> String</h1>\n<h2 id=\"strong-password-checker-ii-font-colormagenta2022-06-22font\"><a class=\"markdownIt-Anchor\" href=\"#strong-password-checker-ii-font-colormagenta2022-06-22font\"></a> Strong Password Checker II <font color=magenta>[2022-06-22]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/strong-password-checker-ii/\">Simple</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">strongPasswordCheckerII</span>(<span class=\"params\">self, password: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">bool</span>:</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(password)</span><br><span class=\"line\"></span><br><span class=\"line\">        if_length = n &gt;= <span class=\"number\">8</span></span><br><span class=\"line\"></span><br><span class=\"line\">        contain_lower = <span class=\"literal\">False</span></span><br><span class=\"line\">        contain_upper = <span class=\"literal\">False</span></span><br><span class=\"line\">        contain_number = <span class=\"literal\">False</span></span><br><span class=\"line\">        contain_special = <span class=\"literal\">False</span></span><br><span class=\"line\">        contain_twosame = <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\">        special = <span class=\"built_in\">set</span>(<span class=\"string\">&quot;!@#$%^&amp;*()-+&quot;</span>)</span><br><span class=\"line\">        pre_char = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> password:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> i == pre_char:</span><br><span class=\"line\">                contain_twosame = <span class=\"literal\">True</span></span><br><span class=\"line\">            pre_char = i</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> contain_lower <span class=\"keyword\">and</span> i.islower():</span><br><span class=\"line\">                contain_lower = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> contain_upper <span class=\"keyword\">and</span> i.isupper():</span><br><span class=\"line\">                contain_upper = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> contain_number <span class=\"keyword\">and</span> i.isdigit():</span><br><span class=\"line\">                contain_number = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> contain_special <span class=\"keyword\">and</span> i <span class=\"keyword\">in</span> special:</span><br><span class=\"line\">                contain_special = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> if_length <span class=\"keyword\">and</span> contain_lower <span class=\"keyword\">and</span> contain_upper <span class=\"keyword\">and</span> contain_number <span class=\"keyword\">and</span> contain_special <span class=\"keyword\">and</span> <span class=\"keyword\">not</span> contain_twosame</span><br></pre></td></tr></table></figure>\n<h2 id=\"minimum-changes-to-make-alternating-binary-string\"><a class=\"markdownIt-Anchor\" href=\"#minimum-changes-to-make-alternating-binary-string\"></a> Minimum Changes to Make Alternating Binary String</h2>\n<p>You are given a string <code>s</code> consisting only of the characters <code>0</code> and <code>1</code>. In one\noperation, you can change any <code>0</code> to <code>1</code> or vice versa.</p>\n<p>The string is called alternating if no two adjacent characters are equal. Return\nthe minimum number of operations needed to make <code>s</code> alternating.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">minOperations</span>(<span class=\"params\">self, s: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(s)</span><br><span class=\"line\">        <span class=\"comment\"># The ans is the operation needed to turn s into `010101`</span></span><br><span class=\"line\">        ans = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> i % <span class=\"number\">2</span> <span class=\"keyword\">and</span> s[i] != <span class=\"string\">&quot;1&quot;</span>:</span><br><span class=\"line\">              ans += <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> i % <span class=\"number\">2</span> <span class=\"keyword\">and</span> s[i] != <span class=\"string\">&quot;0&quot;</span>:</span><br><span class=\"line\">                ans += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">min</span>(ans, n - ans)</span><br></pre></td></tr></table></figure>\n<h1 id=\"sort\"><a class=\"markdownIt-Anchor\" href=\"#sort\"></a> Sort</h1>\n<h2 id=\"sort-integers-by-the-number-of-1-bits-font-colormagenta2022-06-16font\"><a class=\"markdownIt-Anchor\" href=\"#sort-integers-by-the-number-of-1-bits-font-colormagenta2022-06-16font\"></a> Sort Integers by the Number of 1 Bits <font color=magenta>[2022-06-16]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/sort-integers-by-the-number-of-1-bits/\">here</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">sortByBits</span>(<span class=\"params\">self, arr: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]:</span></span><br><span class=\"line\">        res = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> arr:</span><br><span class=\"line\">            c = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> <span class=\"built_in\">bin</span>(i):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> s == <span class=\"string\">&#x27;1&#x27;</span>:</span><br><span class=\"line\">                    c += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">            res.append([c, i])</span><br><span class=\"line\">        res.sort()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [a[<span class=\"number\">1</span>] <span class=\"keyword\">for</span> a <span class=\"keyword\">in</span> res]</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> collections <span class=\"keyword\">import</span> defaultdict <span class=\"keyword\">as</span> d</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">sortByBits</span>(<span class=\"params\">self, arr: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]:</span></span><br><span class=\"line\">        dic = d(<span class=\"built_in\">list</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> arr:</span><br><span class=\"line\">            c = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> <span class=\"built_in\">str</span>(<span class=\"built_in\">bin</span>(i)):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> s == <span class=\"string\">&quot;1&quot;</span>:</span><br><span class=\"line\">                    c += <span class=\"number\">1</span></span><br><span class=\"line\">            dic[c].append(i)</span><br><span class=\"line\"></span><br><span class=\"line\">        output = []</span><br><span class=\"line\"><span class=\"comment\"># The range of integer is less than 0b111111111111111.</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">15</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> dic[j]:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> temp <span class=\"keyword\">in</span> <span class=\"built_in\">sorted</span>(dic[j]):</span><br><span class=\"line\">                    output.append(temp)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> output</span><br></pre></td></tr></table></figure>\n<h2 id=\"k-highest-ranked-items-within-a-price-range-font-colormagenta2022-06-13font\"><a class=\"markdownIt-Anchor\" href=\"#k-highest-ranked-items-within-a-price-range-font-colormagenta2022-06-13font\"></a> K Highest Ranked Items Within a Price Range <font color=magenta>[2022-06-13]</font></h2>\n<p>The topic is\n<a href=\"https://leetcode.cn/problems/k-highest-ranked-items-within-a-price-range/\">here</a>.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">highestRankedKItems</span>(<span class=\"params\">self, grid: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]], pricing: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], start: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], k: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]]:</span></span><br><span class=\"line\">        res = []</span><br><span class=\"line\"></span><br><span class=\"line\">        curs = [</span><br><span class=\"line\">            [<span class=\"number\">0</span>, grid[start[<span class=\"number\">0</span>]][start[<span class=\"number\">1</span>]], start[<span class=\"number\">0</span>], start[<span class=\"number\">1</span>]]</span><br><span class=\"line\">            ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># gird set to 0 is to avoid visiting a coordinate for multiple time.</span></span><br><span class=\"line\"><span class=\"comment\"># The position to set the grid to be 0 is important.</span></span><br><span class=\"line\"><span class=\"comment\"># in  this example, the price of a coordinate is set to 0 when it is visited by curs.</span></span><br><span class=\"line\"><span class=\"comment\"># also can set the price to be 0, when it is checked if within the price range.</span></span><br><span class=\"line\"><span class=\"comment\"># However, this is time expensive, for a position maybe append to curs many times before it is checked.</span></span><br><span class=\"line\"><span class=\"comment\"># It is the best to set the price to be 0, once it is visited by curs. The curs will not visits it again.</span></span><br><span class=\"line\">        grid[start[<span class=\"number\">0</span>]][start[<span class=\"number\">1</span>]] = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        r = <span class=\"built_in\">len</span>(grid)</span><br><span class=\"line\">        c = <span class=\"built_in\">len</span>(grid[<span class=\"number\">0</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">        dirctions = [[<span class=\"number\">0</span>, <span class=\"number\">1</span>], [<span class=\"number\">1</span>, <span class=\"number\">0</span>], [<span class=\"number\">0</span>, -<span class=\"number\">1</span>], [-<span class=\"number\">1</span>, <span class=\"number\">0</span>]]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> curs:</span><br><span class=\"line\">            cur = curs.pop(<span class=\"number\">0</span>)</span><br><span class=\"line\">            cur_step = cur[<span class=\"number\">0</span>]</span><br><span class=\"line\">            cur_price = cur[<span class=\"number\">1</span>]</span><br><span class=\"line\">            cur_row = cur[<span class=\"number\">2</span>]</span><br><span class=\"line\">            cur_cln = cur[<span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> pricing[<span class=\"number\">0</span>] &lt;= cur_price &lt;= pricing[<span class=\"number\">1</span>]:</span><br><span class=\"line\">               res.append(cur)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span> dirction <span class=\"keyword\">in</span> dirctions:</span><br><span class=\"line\">                next_step = cur_step + <span class=\"number\">1</span></span><br><span class=\"line\">                next_row = cur_row + dirction[<span class=\"number\">0</span>]</span><br><span class=\"line\">                next_cln = cur_cln + dirction[<span class=\"number\">1</span>]</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"number\">0</span> &lt;= next_row &lt; r <span class=\"keyword\">and</span> <span class=\"number\">0</span> &lt;= next_cln &lt; c:</span><br><span class=\"line\">                    next_price = grid[next_row][next_cln]</span><br><span class=\"line\">                    grid[next_row][next_cln] = <span class=\"number\">0</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> next_price &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">                        curs.append([next_step, next_price,next_row, next_cln])</span><br><span class=\"line\"></span><br><span class=\"line\">        res.sort()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [res[<span class=\"number\">2</span>:] <span class=\"keyword\">for</span> res <span class=\"keyword\">in</span> res[:k]]</span><br></pre></td></tr></table></figure>\n<h2 id=\"wiggle-sort-2\"><a class=\"markdownIt-Anchor\" href=\"#wiggle-sort-2\"></a> Wiggle Sort 2</h2>\n<p>Given an integer array <code>nums</code>, recorder it such that\n<code>nums[0] &lt; nums[1] &gt; nums[2] &lt; nums[3] &gt; ...</code>. You may assume the input array\nalways has a valid answer.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wiggleSort</span>(<span class=\"params\">self, nums: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"literal\">None</span>:</span></span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        Do not return anything, modify nums in-place instead.</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        res = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> nums:</span><br><span class=\"line\">            res.append(i)</span><br><span class=\"line\">        res.sort()</span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(nums)</span><br><span class=\"line\">        <span class=\"comment\"># Because the smaller number is always filled first,</span></span><br><span class=\"line\">        <span class=\"comment\"># let len(smaller numbers) - len(larger numbers) == 1</span></span><br><span class=\"line\">        <span class=\"comment\"># if the len(nums) is odd.</span></span><br><span class=\"line\">        <span class=\"comment\"># if n is even, the small half from 0 to n // 2 - 1</span></span><br><span class=\"line\">        <span class=\"comment\"># the large half from n // 2 to n - 1</span></span><br><span class=\"line\">        <span class=\"comment\"># if n is odd, small number from 0 to n // 2</span></span><br><span class=\"line\">        <span class=\"comment\"># large number from n // 2 + 1 to n - 1,</span></span><br><span class=\"line\">        <span class=\"comment\"># Thus, no matter n is odd or even, small number from 0 to</span></span><br><span class=\"line\">        <span class=\"comment\"># (n + 1) // 2 - 1, large number from (n + 1) // 2 to n - 1</span></span><br><span class=\"line\">        half = (n + <span class=\"number\">1</span>) // <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"comment\"># to avoid that the last small number is equal to the first large</span></span><br><span class=\"line\">        <span class=\"comment\"># number, fill the small number from *last* to first,</span></span><br><span class=\"line\">        <span class=\"comment\"># also, fill the large number from last to *first*</span></span><br><span class=\"line\">        <span class=\"comment\"># ** means that the number should try to be apart.</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># if n is even, half * 2 == n</span></span><br><span class=\"line\">        <span class=\"comment\"># if n is odd, half * 2 == n + 1</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(half):</span><br><span class=\"line\">            nums[<span class=\"number\">2</span> * i] = res[half - <span class=\"number\">1</span> -i]</span><br><span class=\"line\">            <span class=\"comment\"># len(large number) is smaller than len(small number),</span></span><br><span class=\"line\">            <span class=\"comment\"># thus, the when i = half -1, maybe no large number anymore</span></span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                nums[<span class=\"number\">2</span> * i + <span class=\"number\">1</span>] = res[n - <span class=\"number\">1</span> - i]</span><br><span class=\"line\">            <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"rank-teams-by-votes\"><a class=\"markdownIt-Anchor\" href=\"#rank-teams-by-votes\"></a> Rank Teams by Votes</h2>\n<p>In a special ranking system, each voter gives a rank from highest to lowest to\nall teams participated in the competition, e.g., one gives <code>ABC</code>, one gives\n<code>BCA</code>.</p>\n<p>The ordering of teams is decided by who received the most position-one votes. If\n<code>A</code> received the most 1-st place Then <code>A</code> is the first. If <code>B</code> received the same\nfirst place as <code>A</code> then compare the number of second place they received. If <code>A</code>\nand <code>B</code> received all the places the same number then ordered them by their\nletter, i.e., <code>A</code> is in front of <code>B</code>.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">rankTeams</span>(<span class=\"params\">self, votes: <span class=\"type\">List</span>[<span class=\"built_in\">str</span>]</span>) -&gt; <span class=\"built_in\">str</span>:</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(votes[<span class=\"number\">0</span>])</span><br><span class=\"line\">        <span class=\"comment\"># initialization of a hash map, the default value is list [0, 0, ..., 0]</span></span><br><span class=\"line\">        <span class=\"comment\"># <span class=\"doctag\">NOTE:</span> How to set defaultdict by lambda without input, it is indeed a function factory.</span></span><br><span class=\"line\">        ranking = collections.defaultdict(<span class=\"keyword\">lambda</span>: [<span class=\"number\">0</span>] * n)</span><br><span class=\"line\">         <span class=\"comment\"># count the vote situation for each team, vid is the name of teams.</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> vote <span class=\"keyword\">in</span> votes:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i, vid <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(vote):</span><br><span class=\"line\">                ranking[vid][i] += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># result is a list, e.g., [(&#x27;A&#x27;, [5, 0, 0]), (&#x27;B&#x27;, [0, 2, 3]), (&#x27;C&#x27;, [0, 3, 2])]</span></span><br><span class=\"line\">        result = <span class=\"built_in\">list</span>(ranking.items())</span><br><span class=\"line\">        <span class=\"comment\"># sort the order of letter -ord(x[0]) is regard as the last criterion</span></span><br><span class=\"line\">        result.sort(key=<span class=\"keyword\">lambda</span> x: (x[<span class=\"number\">1</span>], -<span class=\"built_in\">ord</span>(x[<span class=\"number\">0</span>])), reverse=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        <span class=\"comment\"># return the ordered vid</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>.join([vid <span class=\"keyword\">for</span> vid, rank <span class=\"keyword\">in</span> result])</span><br></pre></td></tr></table></figure>\n<h2 id=\"number-game\"><a class=\"markdownIt-Anchor\" href=\"#number-game\"></a> Number Game</h2>\n<p>Give a list of numbers. You can <code>+ 1</code> or <code>- 1</code> at position <code>i</code> which is regarded\nas one operator at position <code>i</code>. Please return the minimum operators for\nposition <code>i</code> to make the list of numbers satisfying\n<code>nums[a] + 1 == nums[a + 1], 0 &lt;= a &lt;= i</code>. The original topic is\n<a href=\"https://leetcode.cn/problems/5TxKeK/\">here</a>.</p>\n<h3 id=\"analysis\"><a class=\"markdownIt-Anchor\" href=\"#analysis\"></a> Analysis</h3>\n<p>To satisfying <code>nums[a] + 1 == nums[a + 1]</code>, we do not know which number it is\nfor position <code>i</code> which makes the operators minimum.</p>\n<p>Thus we can transform this problem, we make <code>nums[a] = nums[a] - a</code>. Then we\nonly need to make each position of the <code>nums</code> all equal to the same number. Then\nthe minimum way is to set the number as the median number of <code>nums</code>.</p>\n<p><font color=red>NOTE:</font> it is the median number, not the mean value. If the\nlength of the list is even then the median is the mean of the middle two\nnumbers.</p>\n<p>It is easy to prove that the mean value can not bring the minimum operators. For\nexamples, for list <code>[1, 3, 8]</code> the mean value is <code>4</code> and it needs\n<code>3 + 1 + 4 = 8</code> operators to make the list into <code>[4, 4, 4]</code>. The median is <code>3</code>\nand it needs only <code>2 + 0 + 5 = 7</code> operators to make the list into <code>[3, 3, 3]</code>.</p>\n<p><font color=blue>The reason for why it is the median.</font></p>\n<p>Let <code>s</code> be the value that each position will reach and <code>m</code> be the median. If <code>s</code>\nis large than <code>m</code>, then <code>#(nums[i] &gt; s) &lt; #(nums[i] &lt; s)</code>. If set <code>s = s - 1</code>,\n<code>nums[i]</code> will add <code>1</code> operator if <code>nums[i] &gt; s</code> and <code>nums[i]</code> will decrease <code>1</code>\noperator if <code>nums[i] &lt; s</code>. For <code>#(nums[i] &gt; s) &lt; #(nums[i] &lt; s)</code>, the total\nnumber of operators will decrease. It will always decrease until <code>s == m</code>, i.e.,\n<code>#(nums[i] &gt; s) = #(nums[i] &lt; s)</code>.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">List</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> heapq <span class=\"keyword\">import</span> heappush, heappushpop</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MedianFinder</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        self.small = []  <span class=\"comment\"># 大顶堆</span></span><br><span class=\"line\">        self.large = []  <span class=\"comment\"># 小顶堆</span></span><br><span class=\"line\">        self.leftSum = <span class=\"number\">0</span></span><br><span class=\"line\">        self.rightSum = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span>(<span class=\"params\">self, num: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"literal\">None</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># if #small == #large then put the num in large</span></span><br><span class=\"line\">        <span class=\"comment\"># How to push it in large.</span></span><br><span class=\"line\">        <span class=\"comment\"># <span class=\"doctag\">NOTE:</span> not put it in large directly, find the largest value then put it in to the large.</span></span><br><span class=\"line\">        <span class=\"comment\"># This ensure that large is always larger than small.</span></span><br><span class=\"line\">        <span class=\"comment\"># #small always smaller than #large and only larger than 1</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(self.small) == <span class=\"built_in\">len</span>(self.large):</span><br><span class=\"line\">            leftMax = -heappushpop(self.small, -num)</span><br><span class=\"line\">            heappush(self.large, leftMax)</span><br><span class=\"line\">            self.leftSum += num - leftMax</span><br><span class=\"line\">            self.rightSum += leftMax</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> <span class=\"built_in\">len</span>(self.small) &lt; <span class=\"built_in\">len</span>(self.large):</span><br><span class=\"line\">            rightMin = heappushpop(self.large, num)</span><br><span class=\"line\">            heappush(self.small, -rightMin)</span><br><span class=\"line\">            self.leftSum += rightMin</span><br><span class=\"line\">            self.rightSum += num - rightMin</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getMedian</span>(<span class=\"params\">self</span>) -&gt; <span class=\"built_in\">float</span>:</span></span><br><span class=\"line\">     <span class=\"comment\"># self.large[0] is the smallest value in large</span></span><br><span class=\"line\">     <span class=\"comment\"># -self.small[0] is the largest value in small</span></span><br><span class=\"line\">     <span class=\"comment\"># get the median if the length is odd, else the mean of the two middle numbers</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(self.small) == <span class=\"built_in\">len</span>(self.large):</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (self.large[<span class=\"number\">0</span>] - self.small[<span class=\"number\">0</span>]) / <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self.large[<span class=\"number\">0</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getDiffSum</span>(<span class=\"params\">self</span>) -&gt; <span class=\"built_in\">float</span>:</span></span><br><span class=\"line\">        median = self.getMedian()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.rightSum - <span class=\"built_in\">len</span>(self.large) * median + <span class=\"built_in\">len</span>(self.small) * median - self.leftSum</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">numsGame</span>(<span class=\"params\">self, nums: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]:</span></span><br><span class=\"line\">        MOD = <span class=\"built_in\">int</span>(<span class=\"number\">1e9</span> + <span class=\"number\">7</span>)</span><br><span class=\"line\">        res = []</span><br><span class=\"line\">        medianFinder = MedianFinder()</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(nums)):</span><br><span class=\"line\">            normalized = nums[i] - i</span><br><span class=\"line\">            medianFinder.add(normalized)</span><br><span class=\"line\">            res.append(<span class=\"built_in\">int</span>(medianFinder.getDiffSum() % MOD))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res</span><br></pre></td></tr></table></figure>\n<h1 id=\"dichotomy\"><a class=\"markdownIt-Anchor\" href=\"#dichotomy\"></a> Dichotomy</h1>\n<h2 id=\"minimum-garden-perimeter-to-collect-enough-apples-font-colormagenta2022-06-22font\"><a class=\"markdownIt-Anchor\" href=\"#minimum-garden-perimeter-to-collect-enough-apples-font-colormagenta2022-06-22font\"></a> Minimum Garden Perimeter to Collect Enough Apples <font color=magenta>[2022-06-22]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/minimum-garden-perimeter-to-collect-enough-apples/\">Medium</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">minimumPerimeter</span>(<span class=\"params\">self, neededApples: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        left, right, ans = <span class=\"number\">1</span>, <span class=\"number\">100000</span>, <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) // <span class=\"number\">2</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"number\">2</span> * mid * (mid + <span class=\"number\">1</span>) * (mid * <span class=\"number\">2</span> + <span class=\"number\">1</span>) &gt;= neededApples:</span><br><span class=\"line\">                ans = mid</span><br><span class=\"line\">                right = mid - <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                left = mid + <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans * <span class=\"number\">8</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"greedy\"><a class=\"markdownIt-Anchor\" href=\"#greedy\"></a> Greedy</h1>\n<h2 id=\"longest-chunked-palindrome-decomposition-font-colormagenta2022-06-19font\"><a class=\"markdownIt-Anchor\" href=\"#longest-chunked-palindrome-decomposition-font-colormagenta2022-06-19font\"></a> Longest Chunked Palindrome Decomposition <font color=magenta>[2022-06-19]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/longest-chunked-palindrome-decomposition/\">hard</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">longestDecomposition</span>(<span class=\"params\">self, text: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_sub_str</span>(<span class=\"params\">s</span>):</span></span><br><span class=\"line\">            n = <span class=\"built_in\">len</span>(s)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span> , n // <span class=\"number\">2</span> + <span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> s[ : i] == s[n - i : ]:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> i</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        ans = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> text:</span><br><span class=\"line\">            cur_sub_length = get_sub_str(text)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> cur_sub_length:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> ans + <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">            text_length = <span class=\"built_in\">len</span>(text)</span><br><span class=\"line\">            text = text[cur_sub_length : text_length  - cur_sub_length]</span><br><span class=\"line\">            ans += <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></table></figure>\n<h2 id=\"orderly-queue-font-colormagenta2022-06-17font\"><a class=\"markdownIt-Anchor\" href=\"#orderly-queue-font-colormagenta2022-06-17font\"></a> Orderly Queue <font color=magenta>[2022-06-17]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/orderly-queue/\">Hard</a></p>\n<p>When K &gt;= 2 the minimum queue can be obtained, thus only need to sort it and do\nnot need to know how the minimum queue is obtained.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">orderlyQueue</span>(<span class=\"params\">self, S, K</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> K == <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">min</span>(S[i:] + S[:i] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(S)))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>.join(<span class=\"built_in\">sorted</span>(S))</span><br></pre></td></tr></table></figure>\n<h1 id=\"brute-force-search\"><a class=\"markdownIt-Anchor\" href=\"#brute-force-search\"></a> Brute Force Search</h1>\n<h2 id=\"number-of-string-that-appear-as-substrings-in-word-font-colormagenta2022-06-17font\"><a class=\"markdownIt-Anchor\" href=\"#number-of-string-that-appear-as-substrings-in-word-font-colormagenta2022-06-17font\"></a> Number of String That Appear as Substrings in Word <font color=magenta>[2022-06-17]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/number-of-strings-that-appear-as-substrings-in-word/\">Simple</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">numOfStrings</span>(<span class=\"params\">self, patterns: <span class=\"type\">List</span>[<span class=\"built_in\">str</span>], word: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        ans = <span class=\"number\">0</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(word)</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">check</span>(<span class=\"params\">pa</span>):</span></span><br><span class=\"line\">            m = <span class=\"built_in\">len</span>(pa)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n - m + <span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> word[i : i + m] == pa:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> pa <span class=\"keyword\">in</span> patterns:</span><br><span class=\"line\">            ans += check(pa)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></table></figure>\n<h2 id=\"coordinate-with-maximum-network-quality-font-colormagenta2022-05-10font\"><a class=\"markdownIt-Anchor\" href=\"#coordinate-with-maximum-network-quality-font-colormagenta2022-05-10font\"></a> Coordinate with Maximum Network Quality <font color=magenta>[2022-05-10]</font></h2>\n<p>An array of network towers <code>towers</code> is given, where\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>y</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>q</mi><mi>i</mi></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">towers[i] = [x_i, y_i, q_i]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\" style=\"margin-right:0.02691em;\">w</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\">s</span><span class=\"mopen\">[</span><span class=\"mord mathdefault\">i</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>. <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> are the integral coordinates of\nthe network tower location and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>q</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">q_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> is the network quality factor. The network\nquality of <code>towers[i]</code> at <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(x, y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span> is <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>q</mi><mi>i</mi></msub><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo>+</mo><mi>d</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">q_i / (1 + d)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">d</span><span class=\"mclose\">)</span></span></span></span> where\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>d</mi><mo>=</mo><msqrt><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><mi>y</mi><mo>−</mo><msub><mi>y</mi><mi>i</mi></msub><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">d = \\sqrt{(x - x_i)^2 + (y - y_i)^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">d</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.24em;vertical-align:-0.30499999999999994em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.935em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.740108em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.740108em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.8950000000000005em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,\n158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067\nc4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,\n175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71\nc-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,\n-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26\ns76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30499999999999994em;\"><span></span></span></span></span></span></span></span></span>.</p>\n<p>You are also given an integer <code>radius</code>. All the tower is not reachable if and\nonly if <code>d &gt; radius</code>.</p>\n<p>The network quality of a location is the sum of network qualities from all\ntowers. Return the location with the maximum network quality.</p>\n<p>If there are multiple coordinates with the same network quality, return the\nlexicographically minimum non-negative coordinate.</p>\n<p>Constraints:</p>\n<ol>\n<li>1 &lt;= towers.length &lt;= 50</li>\n<li>towers[i].length == 3</li>\n<li>0 &lt;= <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>q</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">q_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> &lt;=50</li>\n<li>1 &lt;= radius &lt;= 50</li>\n</ol>\n<h3 id=\"analysis-2\"><a class=\"markdownIt-Anchor\" href=\"#analysis-2\"></a> Analysis</h3>\n<p>For 0 &lt;= <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>q</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">q_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> &lt;=50, if x or y is large than 51, it can not be the\nanswer. All the network quality will be stronger when x or y is smaller. Thus,\nwe do only need to search within [0, 51].</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> math</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">bestCoordinate</span>(<span class=\"params\">self, towers: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]], radius: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]:</span></span><br><span class=\"line\">        max_signal, x, y = <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"comment\"># search from small coordinate to large then we will get the small coordinate first</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">51</span>):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">51</span>):</span><br><span class=\"line\">                signal_ij = <span class=\"number\">0</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> tower <span class=\"keyword\">in</span> towers:</span><br><span class=\"line\">                    delta_x, delta_y = tower[<span class=\"number\">0</span>] - i, tower[<span class=\"number\">1</span>] - j</span><br><span class=\"line\">                    d = math.sqrt(delta_x * delta_x + delta_y * delta_y)</span><br><span class=\"line\">                    <span class=\"comment\"># if &gt; radius no quality</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> d &gt; radius:</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span></span><br><span class=\"line\">                      <span class=\"comment\"># use floor</span></span><br><span class=\"line\">                    signal_ij += math.floor(tower[<span class=\"number\">2</span>] / (<span class=\"number\">1</span> + d))</span><br><span class=\"line\">                <span class=\"keyword\">if</span> signal_ij &gt; max_signal:</span><br><span class=\"line\">                    max_signal, x, y = signal_ij, i, j</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [x, y]</span><br></pre></td></tr></table></figure>\n<h1 id=\"flip-the-char\"><a class=\"markdownIt-Anchor\" href=\"#flip-the-char\"></a> Flip the Char</h1>\n<h2 id=\"flip-the-char-font-colormagenta2022-06-16font\"><a class=\"markdownIt-Anchor\" href=\"#flip-the-char-font-colormagenta2022-06-16font\"></a> Flip the Char <font color=magenta>[2022-06-16]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/cyJERH/\">here</a></p>\n<p>The position ‘max_idx’ that the number of <code>0</code> on the left hand - the number of\n<code>1</code> on the left hand get the maximum is the dividing line of <code>0</code> and <code>1</code>.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">minFlipsMonoIncr</span>(<span class=\"params\">self, s: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        num_0 = <span class=\"number\">0</span></span><br><span class=\"line\">        num_1 = <span class=\"number\">0</span></span><br><span class=\"line\">        max_off_set = <span class=\"number\">0</span></span><br><span class=\"line\">        max_num_0 = <span class=\"number\">0</span></span><br><span class=\"line\">        max_num_1 = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> idx, num <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(s):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> num == <span class=\"string\">&quot;0&quot;</span>:</span><br><span class=\"line\">                num_0 += <span class=\"number\">1</span></span><br><span class=\"line\">                off_set = num_0 - num_1</span><br><span class=\"line\">                <span class=\"keyword\">if</span> off_set &gt; max_off_set:</span><br><span class=\"line\">                    max_off_set = off_set</span><br><span class=\"line\">                    max_idx = idx</span><br><span class=\"line\">                    max_num_0 = num_0</span><br><span class=\"line\">                    max_num_1 = num_1</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                num_1 += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> num_0 - max_num_0 + max_num_1</span><br></pre></td></tr></table></figure>\n<h1 id=\"stack\"><a class=\"markdownIt-Anchor\" href=\"#stack\"></a> Stack</h1>\n<h2 id=\"valid-parentheses-font-colormagenta2022-06-17font\"><a class=\"markdownIt-Anchor\" href=\"#valid-parentheses-font-colormagenta2022-06-17font\"></a> Valid Parentheses <font color=magenta>[2022-06-17]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/valid-parentheses/\">here</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">isValid</span>(<span class=\"params\">self, s: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">bool</span>:</span></span><br><span class=\"line\">        dic = &#123;<span class=\"string\">&#x27;)&#x27;</span> : <span class=\"string\">&#x27;(&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;&#125;&#x27;</span> : <span class=\"string\">&#x27;&#123;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;]&#x27;</span> : <span class=\"string\">&#x27;[&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        res = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> s:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> i <span class=\"keyword\">in</span> dic:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> res:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">                cur = res.pop()</span><br><span class=\"line\">                <span class=\"keyword\">if</span> cur != dic[i]:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                res.append(i)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> res:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"other\"><a class=\"markdownIt-Anchor\" href=\"#other\"></a> Other</h1>\n<h2 id=\"random-pick-with-weight-font-colormagenta2022-06-26font\"><a class=\"markdownIt-Anchor\" href=\"#random-pick-with-weight-font-colormagenta2022-06-26font\"></a> Random Pick with Weight <font color=magenta>[2022-06-26]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/random-pick-with-weight/\">Medium</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, w: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>):</span></span><br><span class=\"line\">        self.array = []</span><br><span class=\"line\">        res = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> w:</span><br><span class=\"line\">            res += i</span><br><span class=\"line\">            self.array.append(res)</span><br><span class=\"line\">        self.<span class=\"built_in\">sum</span> = res</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">pickIndex</span>(<span class=\"params\">self</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\">        <span class=\"keyword\">import</span> bisect</span><br><span class=\"line\">        num = np.random.uniform(<span class=\"number\">0</span>, self.<span class=\"built_in\">sum</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> bisect.bisect_left/right(self.array, num)</span><br></pre></td></tr></table></figure>\n<h2 id=\"intersections-of-two-arrays-ii-font-colormagenta2022-06-25font\"><a class=\"markdownIt-Anchor\" href=\"#intersections-of-two-arrays-ii-font-colormagenta2022-06-25font\"></a> Intersections of Two Arrays II <font color=magenta>[2022-06-25]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/intersection-of-two-arrays-ii/\">Simple</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">intersect</span>(<span class=\"params\">self, nums1: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], nums2: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]:</span></span><br><span class=\"line\">        ans = []</span><br><span class=\"line\">        res1 = defaultdict(<span class=\"keyword\">lambda</span> : <span class=\"number\">0</span>)</span><br><span class=\"line\">        res2 = defaultdict(<span class=\"keyword\">lambda</span> : <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> nums1:</span><br><span class=\"line\">            res1[i] += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> nums2:</span><br><span class=\"line\">            res2[i] += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> res1:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> key <span class=\"keyword\">in</span> res2:</span><br><span class=\"line\">                num = <span class=\"built_in\">min</span>(res1[key], res2[key])</span><br><span class=\"line\">                ans += [key] * num</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></table></figure>\n<h2 id=\"check-if-there-is-a-valid-path-in-a-grid-font-colormagenta2022-06-21font\"><a class=\"markdownIt-Anchor\" href=\"#check-if-there-is-a-valid-path-in-a-grid-font-colormagenta2022-06-21font\"></a> Check if There is a Valid Path in a Grid <font color=magenta>[2022-06-21]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/check-if-there-is-a-valid-path-in-a-grid/\">medium</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hasValidPath</span>(<span class=\"params\">self, grid: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]]</span>) -&gt; <span class=\"built_in\">bool</span>:</span></span><br><span class=\"line\">        res = &#123;</span><br><span class=\"line\">        <span class=\"number\">1</span> :[[<span class=\"number\">0</span>, -<span class=\"number\">1</span>], [<span class=\"number\">0</span>, <span class=\"number\">1</span>]],</span><br><span class=\"line\">        <span class=\"number\">2</span>: [[-<span class=\"number\">1</span>, <span class=\"number\">0</span>], [<span class=\"number\">1</span>, <span class=\"number\">0</span>]],</span><br><span class=\"line\">        <span class=\"number\">3</span>: [[<span class=\"number\">0</span>, -<span class=\"number\">1</span>], [<span class=\"number\">1</span>, <span class=\"number\">0</span>]],</span><br><span class=\"line\">        <span class=\"number\">4</span>: [[<span class=\"number\">0</span>, <span class=\"number\">1</span>], [<span class=\"number\">1</span>, <span class=\"number\">0</span>]],</span><br><span class=\"line\">        <span class=\"number\">5</span>: [[<span class=\"number\">0</span>, -<span class=\"number\">1</span>], [-<span class=\"number\">1</span>, <span class=\"number\">0</span>]],</span><br><span class=\"line\">        <span class=\"number\">6</span>: [[<span class=\"number\">0</span>, <span class=\"number\">1</span>], [-<span class=\"number\">1</span>, <span class=\"number\">0</span>]],</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(grid)</span><br><span class=\"line\">        m = <span class=\"built_in\">len</span>(grid[<span class=\"number\">0</span>])</span><br><span class=\"line\">        <span class=\"keyword\">if</span> n == m == <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">to_position</span>(<span class=\"params\">position, direction</span>):</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> [position[<span class=\"number\">0</span>] + direction[<span class=\"number\">0</span>], position[<span class=\"number\">1</span>] + direction[<span class=\"number\">1</span>]]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reach</span>(<span class=\"params\">cur</span>):</span></span><br><span class=\"line\">            pre = [<span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">            <span class=\"keyword\">while</span> cur != [<span class=\"number\">0</span>, <span class=\"number\">0</span>] <span class=\"keyword\">and</span> <span class=\"number\">0</span> &lt;= cur[<span class=\"number\">0</span>] &lt; n <span class=\"keyword\">and</span> <span class=\"number\">0</span> &lt;= cur[<span class=\"number\">1</span>] &lt; m:</span><br><span class=\"line\">                nex1 = to_position(cur, res[grid[cur[<span class=\"number\">0</span>]][cur[<span class=\"number\">1</span>]]][<span class=\"number\">0</span>])</span><br><span class=\"line\">                nex2 = to_position(cur, res[grid[cur[<span class=\"number\">0</span>]][cur[<span class=\"number\">1</span>]]][<span class=\"number\">1</span>])</span><br><span class=\"line\">                <span class=\"keyword\">if</span> nex1 != pre <span class=\"keyword\">and</span> nex2 != pre:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">                <span class=\"comment\"># be careful about the position of checking if reach the destination</span></span><br><span class=\"line\">                <span class=\"comment\"># can not be after `cur = nex`, because it can be reachable only</span></span><br><span class=\"line\">                 <span class=\"comment\"># checked nex1 or nex2 == pre</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> cur == [n - <span class=\"number\">1</span>, m - <span class=\"number\">1</span>]:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">                nex = nex1 <span class=\"keyword\">if</span> nex1 != pre <span class=\"keyword\">else</span> nex2</span><br><span class=\"line\">                pre = cur</span><br><span class=\"line\">                cur = nex</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">        start = [<span class=\"number\">0</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">        cur1 = to_position(start, res[grid[<span class=\"number\">0</span>][<span class=\"number\">0</span>]][<span class=\"number\">0</span>])</span><br><span class=\"line\">        cur2 = to_position(start, res[grid[<span class=\"number\">0</span>][<span class=\"number\">0</span>]][<span class=\"number\">1</span>])</span><br><span class=\"line\">        <span class=\"keyword\">return</span> reach(cur1) <span class=\"keyword\">or</span> reach(cur2)</span><br></pre></td></tr></table></figure>\n<h2 id=\"maximum-number-of-visible-points-font-colormagenta2022-06-19font\"><a class=\"markdownIt-Anchor\" href=\"#maximum-number-of-visible-points-font-colormagenta2022-06-19font\"></a> Maximum Number of Visible Points <font color=magenta>[2022-06-19]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/maximum-number-of-visible-points/\">hard</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">visiblePoints</span>(<span class=\"params\">self, points: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]], angle: <span class=\"built_in\">int</span>, location: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        sameCnt = <span class=\"number\">0</span></span><br><span class=\"line\">        polarDegrees = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> p <span class=\"keyword\">in</span> points:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> p == location:</span><br><span class=\"line\">                sameCnt += <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"comment\"># obain all the angles the range is (-pi, pi]</span></span><br><span class=\"line\">                polarDegrees.append(atan2(p[<span class=\"number\">1</span>] - location[<span class=\"number\">1</span>], p[<span class=\"number\">0</span>] - location[<span class=\"number\">0</span>]))</span><br><span class=\"line\"></span><br><span class=\"line\">        polarDegrees.sort()</span><br><span class=\"line\"></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(polarDegrees)</span><br><span class=\"line\">        <span class=\"comment\"># and 2 pi, the -pi will changed to pi, and thus -pi and pi</span></span><br><span class=\"line\">        <span class=\"comment\"># will be adjoined to each other</span></span><br><span class=\"line\">        <span class=\"comment\"># deg and deg + 2pi are both counted only if the angle is 2pi</span></span><br><span class=\"line\">        polarDegrees += [deg + <span class=\"number\">2</span> * pi <span class=\"keyword\">for</span> deg <span class=\"keyword\">in</span> polarDegrees]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># change the degree into pi</span></span><br><span class=\"line\">        degree = angle * pi / <span class=\"number\">180</span></span><br><span class=\"line\">        <span class=\"comment\"># bisect_right/bisect_left require from bisect import xxxx</span></span><br><span class=\"line\">        <span class=\"comment\"># both bisect_right or bisect_left return the index that the val</span></span><br><span class=\"line\">        <span class=\"comment\"># placed in to the array and keeps the array ranked.</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># when there are numbers equal to val bisect_right places the val to the right</span></span><br><span class=\"line\">        <span class=\"comment\"># side of the equaled numbers, thus the returned value is the number of digits</span></span><br><span class=\"line\">        <span class=\"comment\"># smaller and equil to val in the array</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># bisect_left places the val to the left side of the equaled numbers. Thus the</span></span><br><span class=\"line\">        <span class=\"comment\"># returned value is the number of digits smaller to the val in the array</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># here bisect_right should be used</span></span><br><span class=\"line\">        maxCnt = <span class=\"built_in\">max</span>((bisect_right(polarDegrees, polarDegrees[i] + degree) - i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n)), default=<span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> maxCnt + sameCnt</span><br></pre></td></tr></table></figure>\n<h2 id=\"number-of-different-integers-in-a-string-font-colormagenta2022-06-17font\"><a class=\"markdownIt-Anchor\" href=\"#number-of-different-integers-in-a-string-font-colormagenta2022-06-17font\"></a> Number of Different Integers in a String <font color=magenta>[2022-06-17]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/number-of-different-integers-in-a-string/\">here</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">numDifferentIntegers</span>(<span class=\"params\">self, word: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        res = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        cur = <span class=\"number\">0</span></span><br><span class=\"line\">        word += <span class=\"string\">&#x27;a&#x27;</span></span><br><span class=\"line\">        flag = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> word:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> i.isdigit():</span><br><span class=\"line\">                flag = <span class=\"literal\">True</span></span><br><span class=\"line\">                cur = cur * <span class=\"number\">10</span> + <span class=\"built_in\">int</span>(i)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> flag:</span><br><span class=\"line\">                    res.add(cur)</span><br><span class=\"line\">                    cur = <span class=\"number\">0</span></span><br><span class=\"line\">                    flag = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">len</span>(res)</span><br></pre></td></tr></table></figure>\n<h2 id=\"max-length-of-pair-chain-font-colormagenta2022-06-16font\"><a class=\"markdownIt-Anchor\" href=\"#max-length-of-pair-chain-font-colormagenta2022-06-16font\"></a> Max Length of Pair Chain <font color=magenta>[2022-06-16]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/maximum-length-of-pair-chain/\">here</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">findLongestChain</span>(<span class=\"params\">self, pairs: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        res  = <span class=\"built_in\">sorted</span>(pairs, key = <span class=\"keyword\">lambda</span> a: a[<span class=\"number\">1</span>])</span><br><span class=\"line\">        ans = [res[<span class=\"number\">0</span>]]</span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(res)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, n):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ans[-<span class=\"number\">1</span>][-<span class=\"number\">1</span>] &lt; res[i][<span class=\"number\">0</span>]:</span><br><span class=\"line\">                ans.append(res[i])</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">len</span>(ans)</span><br></pre></td></tr></table></figure>\n<h2 id=\"two-city-scheduling-font-colormagenta2022-06-16font\"><a class=\"markdownIt-Anchor\" href=\"#two-city-scheduling-font-colormagenta2022-06-16font\"></a> Two City Scheduling <font color=magenta>[2022-06-16]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/two-city-scheduling/\">here</a></p>\n<p>Think about how to divide these people.</p>\n<ul>\n<li>The gain of changing the people from one city to another is only related to\nthe difference between the costs of a and b.</li>\n<li>Thus, we can set the cost of a always 0, and set the cost of b to cost(b) -\ncost(a).</li>\n<li>The cost of a is always 0 and we only need to pick n people to b which reach\nthe minimum cost.</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">twoCitySchedCost</span>(<span class=\"params\">self, costs: <span class=\"type\">List</span>[<span class=\"type\">List</span>[<span class=\"built_in\">int</span>]]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        res = [a[<span class=\"number\">1</span>] - a[<span class=\"number\">0</span>] <span class=\"keyword\">for</span> a <span class=\"keyword\">in</span> costs]</span><br><span class=\"line\">        nn = <span class=\"built_in\">len</span>(res)</span><br><span class=\"line\">        sort_idx = <span class=\"built_in\">sorted</span>(<span class=\"built_in\">range</span>(nn), key = <span class=\"keyword\">lambda</span> k: res[k], reverse = <span class=\"literal\">False</span>)</span><br><span class=\"line\">        cost = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(nn // <span class=\"number\">2</span>):</span><br><span class=\"line\">            cost += costs[sort_idx[i]][<span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(nn // <span class=\"number\">2</span>, nn):</span><br><span class=\"line\">            cost += costs[sort_idx[i]][<span class=\"number\">0</span>]</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cost</span><br></pre></td></tr></table></figure>\n<h2 id=\"exchange-lcci-font-colormagenta2022-06-16font\"><a class=\"markdownIt-Anchor\" href=\"#exchange-lcci-font-colormagenta2022-06-16font\"></a> Exchange LCCI <font color=magenta>[2022-06-16]</font></h2>\n<p><a href=\"https://leetcode.cn/problems/exchange-lcci/\">here</a></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">exchangeBits</span>(<span class=\"params\">self, num: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        num_bin = <span class=\"built_in\">bin</span>(num)</span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(num_bin)</span><br><span class=\"line\">        res = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        start = <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> n % <span class=\"number\">2</span>:</span><br><span class=\"line\">            res += <span class=\"string\">&#x27;10&#x27;</span></span><br><span class=\"line\">            start = <span class=\"number\">3</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(start, n, <span class=\"number\">2</span>):</span><br><span class=\"line\">            res += num_bin[i + <span class=\"number\">1</span>]</span><br><span class=\"line\">            res += num_bin[i]</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">int</span>(res, <span class=\"number\">2</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"the-first-char-which-only-appears-once-font-colormagenta2022-06-16font\"><a class=\"markdownIt-Anchor\" href=\"#the-first-char-which-only-appears-once-font-colormagenta2022-06-16font\"></a> The First Char which Only Appears once <font color=magenta>[2022-06-16]</font></h2>\n<p>The topic is\n<a href=\"https://leetcode.cn/problems/di-yi-ge-zhi-chu-xian-yi-ci-de-zi-fu-lcof/\">here</a>.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">firstUniqChar</span>(<span class=\"params\">self, s: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">str</span>:</span></span><br><span class=\"line\">        res = collections.defaultdict(<span class=\"keyword\">lambda</span>: [<span class=\"number\">0</span>, <span class=\"number\">1</span>])</span><br><span class=\"line\">        <span class=\"keyword\">for</span> idx, c <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(s):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> c <span class=\"keyword\">in</span> res:</span><br><span class=\"line\">                res[c][<span class=\"number\">0</span>] = idx</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                res[c][<span class=\"number\">1</span>] += <span class=\"number\">1</span></span><br><span class=\"line\">        ans = <span class=\"string\">&quot; &quot;</span></span><br><span class=\"line\">        min_idx = <span class=\"built_in\">len</span>(s)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> res:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> res[i][<span class=\"number\">1</span>] == <span class=\"number\">1</span> <span class=\"keyword\">and</span> res[i][<span class=\"number\">0</span>] &lt; min_idx:</span><br><span class=\"line\">                min_idx = res[i][<span class=\"number\">0</span>]</span><br><span class=\"line\">                ans = i</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></table></figure>\n<h2 id=\"the-gas-station\"><a class=\"markdownIt-Anchor\" href=\"#the-gas-station\"></a> The Gas Station</h2>\n<p>There are <code>n</code> stations along a circular route, where the amount of gas at the\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">i^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.849108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mord mathdefault mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span> station is gas[i].</p>\n<p>A car costs cost[i] of gas to travel from the <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">i^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.849108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mord mathdefault mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span> station to its next\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><msup><mo stretchy=\"false\">)</mo><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">(i + 1)^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.099108em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mord mathdefault mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span> station.</p>\n<p>Can the car run a circle. If can, return the start station. If not, return -1.\nIf there exists a solution, it is guaranteed to be the unique.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">canCompleteCircuit</span>(<span class=\"params\">self, gas: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], cost: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"built_in\">int</span></span></span><br><span class=\"line\"><span class=\"function\">        n = <span class=\"built_in\">len</span>(gas)</span></span><br><span class=\"line\"><span class=\"function\">        res = [0] * n</span></span><br><span class=\"line\"><span class=\"function\">        # a car <span class=\"keyword\">pass</span> station i, it can get gas[i] <span class=\"keyword\">and</span> cost</span></span><br><span class=\"line\"><span class=\"function\">        # cost[i]. Thus gets gas[i] - cost[i].</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">        # <span class=\"keyword\">if</span> <span class=\"keyword\">in</span> station i, gas[i] - cost[i] &gt;= 0, it can</span></span><br><span class=\"line\"><span class=\"function\">        # arrive the <span class=\"built_in\">next</span> station.</span></span><br><span class=\"line\"><span class=\"function\">        # after arrive the <span class=\"built_in\">next</span> station, <span class=\"keyword\">and</span> gets the station</span></span><br><span class=\"line\"><span class=\"function\">        # <span class=\"keyword\">if</span> the remain &gt;= 0 it can gets the <span class=\"built_in\">next</span> <span class=\"built_in\">next</span> station.</span></span><br><span class=\"line\"><span class=\"function\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span></span><br><span class=\"line\">            res[i] = gas[i] - cost[i]</span><br><span class=\"line\">        first = <span class=\"number\">0</span></span><br><span class=\"line\">        second = <span class=\"number\">0</span></span><br><span class=\"line\">        sum_ = res[<span class=\"number\">0</span>]</span><br><span class=\"line\">        key = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"comment\"># second represents the station the car already getting.</span></span><br><span class=\"line\">        <span class=\"comment\"># first represents the starting station.</span></span><br><span class=\"line\">        <span class=\"comment\"># sum_ represents if the car can get the next staion.</span></span><br><span class=\"line\">        <span class=\"comment\"># if sum_ &gt;= 0, it can, else, it can not.</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> sum_ &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                second += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> second == n:</span><br><span class=\"line\">                    second = <span class=\"number\">0</span></span><br><span class=\"line\">                    key = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> key <span class=\"keyword\">and</span> second == first:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> first</span><br><span class=\"line\">                sum_ += res[second]</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                sum_ -= res[first]</span><br><span class=\"line\">                first += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"comment\"># from 0 to n, first do not find an answer, return -1.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> first == n:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> -<span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> first &gt; second:</span><br><span class=\"line\">                        second += <span class=\"number\">1</span></span><br><span class=\"line\">                        sum_ += res[second</span><br></pre></td></tr></table></figure>\n<p>Consider this, if y is the first station that the car can not arrive from x.\nThat is to say <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mi>y</mi></mrow><mi>x</mi></msubsup><mi>r</mi><mi>e</mi><mi>s</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">\\sum_{i = y}^x res[i] &lt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.24011em;vertical-align:-0.43581800000000004em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.804292em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.43581800000000004em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">s</span><span class=\"mopen\">[</span><span class=\"mord mathdefault\">i</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>. For a station z between x and y. It\ncan arrive z from x, which means the sum <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">&gt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>. Then from z to y, the sum is\ndefinitely <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">&lt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>. It can not arrive y from z.</p>\n<p>Thus, if a car can not arrive y from x, it can not arrive y from any station\nbetween x and y. It is no need to search such stations.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">canCompleteCircuit</span>(<span class=\"params\">self, gas: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], cost: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>]</span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        n = <span class=\"built_in\">len</span>(gas)</span><br><span class=\"line\">        res = [<span class=\"number\">0</span>] * n</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n):</span><br><span class=\"line\">            res[i] = gas[i] - cost[i]</span><br><span class=\"line\">        first = <span class=\"number\">0</span></span><br><span class=\"line\">        second = <span class=\"number\">0</span></span><br><span class=\"line\">        sum_ = res[<span class=\"number\">0</span>]</span><br><span class=\"line\">        key = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> sum_ &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                second += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> second == n:</span><br><span class=\"line\">                    second = <span class=\"number\">0</span></span><br><span class=\"line\">                    key = <span class=\"literal\">True</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> key <span class=\"keyword\">and</span> second == first:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> first</span><br><span class=\"line\">                sum_ += res[second]</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># if can not arrive second + 1, then</span></span><br><span class=\"line\">            <span class=\"comment\"># starting from second + 1</span></span><br><span class=\"line\">                second += <span class=\"number\">1</span></span><br><span class=\"line\">                first = second</span><br><span class=\"line\">                <span class=\"comment\"># if the new starting point equal or bigger than</span></span><br><span class=\"line\">                <span class=\"comment\"># n, first move from 0 to n fails to find.</span></span><br><span class=\"line\">                <span class=\"comment\"># if key is True, second + 1 is actually larger than</span></span><br><span class=\"line\">                <span class=\"comment\"># n, first move from 0 to n fails to find.</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> first == n <span class=\"keyword\">or</span> key:</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> -<span class=\"number\">1</span></span><br><span class=\"line\">                sum_ = res[first]</span><br></pre></td></tr></table></figure>\n<h2 id=\"maximum-number-of-tasks-you-can-assign-font-colormagenta2022-05-11font\"><a class=\"markdownIt-Anchor\" href=\"#maximum-number-of-tasks-you-can-assign-font-colormagenta2022-05-11font\"></a> Maximum Number of Tasks You Can Assign <font color=magenta>[2022-05-11]</font></h2>\n<p>The topic is\n<a href=\"https://leetcode.cn/problems/maximum-number-of-tasks-you-can-assign/\">here</a>.</p>\n<h3 id=\"analysis-3\"><a class=\"markdownIt-Anchor\" href=\"#analysis-3\"></a> Analysis</h3>\n<ol>\n<li>The task need small strength is preferred.</li>\n<li>The worker with large strength is preferred</li>\n</ol>\n<p>A wrong code</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">maxTaskAssign</span>(<span class=\"params\">self, tasks: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], workers: <span class=\"type\">List</span>[<span class=\"built_in\">int</span>], pills: <span class=\"built_in\">int</span>, strength: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">int</span>:</span></span><br><span class=\"line\">        tasks.sort()</span><br><span class=\"line\">        workers.sort()</span><br><span class=\"line\">        n =  <span class=\"built_in\">len</span>(tasks)</span><br><span class=\"line\">        m =  <span class=\"built_in\">len</span>(workers)</span><br><span class=\"line\">        ans = <span class=\"number\">0</span></span><br><span class=\"line\">        j = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(m):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> j &lt; n:</span><br><span class=\"line\">                <span class=\"comment\"># A new worker waiting for task</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> workers[i] &gt;= tasks[j]:</span><br><span class=\"line\">                    ans += <span class=\"number\">1</span></span><br><span class=\"line\">                    <span class=\"comment\"># the task has been assigned, consider the next task</span></span><br><span class=\"line\">                    j += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"comment\"># if there is pills avaliable</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> pills <span class=\"keyword\">and</span> workers[i] + strength &gt;= tasks[j]:</span><br><span class=\"line\">                        <span class=\"comment\"># use this pill</span></span><br><span class=\"line\">                        pills -= <span class=\"number\">1</span></span><br><span class=\"line\">                        ans += <span class=\"number\">1</span></span><br><span class=\"line\">                        j += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></table></figure>\n<p>This code prefers to use small strength workers, which is wrong. When the\nworkers can do <code>k</code> tasks, it must be the top <code>k</code> strength workers taking the\nbottom <code>k</code> tasks.</p>\n<p>The final answer.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> sortedcontainers <span class=\"keyword\">import</span> SortedList</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">maxTaskAssign</span>(<span class=\"params\">self, tasks, workers, pills, strength</span>):</span></span><br><span class=\"line\">        n, m = <span class=\"built_in\">len</span>(tasks), <span class=\"built_in\">len</span>(workers)</span><br><span class=\"line\">        tasks.sort()</span><br><span class=\"line\">        workers.sort()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">check</span>(<span class=\"params\">mid: <span class=\"built_in\">int</span></span>) -&gt; <span class=\"built_in\">bool</span>:</span></span><br><span class=\"line\">            p = pills</span><br><span class=\"line\">            <span class=\"comment\">#  the workers needed to be check</span></span><br><span class=\"line\">            ws = SortedList(workers[m - mid:])</span><br><span class=\"line\">            <span class=\"comment\"># tasks from large to small</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(mid - <span class=\"number\">1</span>, -<span class=\"number\">1</span>, -<span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ws[-<span class=\"number\">1</span>] &gt;= tasks[i]:</span><br><span class=\"line\">                    <span class=\"comment\"># tasks[i] is assigned to ws[-1]</span></span><br><span class=\"line\">                    ws.pop()</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> p == <span class=\"number\">0</span>:</span><br><span class=\"line\">                        <span class=\"comment\"># if does not have pills anymore</span></span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">                    <span class=\"comment\"># has pills</span></span><br><span class=\"line\">                    <span class=\"comment\"># Note: find the smallest worker can take the task by pill</span></span><br><span class=\"line\">                    rep = ws.bisect_left(tasks[i] - strength)</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> rep == <span class=\"built_in\">len</span>(ws):</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">                    p -= <span class=\"number\">1</span></span><br><span class=\"line\">                    ws.pop(rep)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># The scope of k needed to be checked if 1 checked false, answer is 0</span></span><br><span class=\"line\">        <span class=\"comment\"># if right = min(m, n) checked true, answer is right</span></span><br><span class=\"line\">        left, right, ans = <span class=\"number\">1</span>, <span class=\"built_in\">min</span>(m, n), <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> left &lt;= right:</span><br><span class=\"line\">            mid = (left + right) // <span class=\"number\">2</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> check(mid):</span><br><span class=\"line\">                <span class=\"comment\"># if mid is true, then ans is larger than mid</span></span><br><span class=\"line\">                <span class=\"comment\"># find it in [mid + 1, right]</span></span><br><span class=\"line\">                ans = mid</span><br><span class=\"line\">                left = mid + <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"comment\"># if mid is false, then ans is smaller than mid</span></span><br><span class=\"line\">                <span class=\"comment\"># find it in [left, mid - 1]</span></span><br><span class=\"line\">                right = mid - <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br></pre></td></tr></table></figure>\n"},{"title":"An Introduction to Git","description":"介绍git里面的一些基本概念，了解git运行的基本原理。","abbrlink":"d13cd4ec","date":"2021-12-10T13:55:33.000Z","summary":null,"_content":"\n![The Structure of Git](git.jpg)\n\ngit checkout 用于切换分支或恢复工作数文件，它是一个危险的命令，因为这条命令会重\n写工作区。\n\ngit ls-files 查看缓存区中文件信息，它的参数有，括号里面是简写\n\n--cached (-c) 查看缓存区中所有文件\n\n--midified (-m)查看修改过的文件\n\n--delete (-d)查看删除过的文件\n\n--other (-o)查看没有被 git 跟踪的文件\n\n<!-- # errors -->\n\n<!-- ## Failed to connect to github.com port 443: Time out -->\n\n<!-- The following commands fixed this issue. -->\n\n<!-- ```fish -->\n<!-- git config --global http.proxy http://127.0.0.1:1080 -->\n<!-- git config --global https.proxy https://127.0.0.1:1080 -->\n<!-- git config --global --unset http.proxy -->\n<!-- git config --global --unset https.proxy -->\n<!-- ``` -->\n\n# Get back to an old version\n\n`git log` can show the history of your commit.\n\n`git reset xxx` will git back to an old version. However, the workspace will not\nchange, i.e., the workspace is also the current workspace.\n`git reset --hard xxx` will get back to an old version, and the workspace will\nbe also the old version.\n\nTo get back to the newest version `git reflog` can show the reference logs\ninformation. It records when the tips of branches and other references were\nupdated in the local repository. The code of the newest version will be\nobserved.\n\n# Clone too slow\n\nThe network speed of `git clone` is often very slow in China mainland. To\nimprove the speed, I often `clone` by ssh, i.e., use the ssh link instead of\nhttps link. However, it need to change the link. Use\n`git config --global url.\"https://mirror.ghproxy.com/https://github.com\".insteadOf https://github.com`\ncan download repos fast without changing the links. It will write some thing in\nthe `~/.gitconfig` file.\n\nWhen the `.gitconfig` file is\n\n```\n[user]\n\tname = xyegithub\n\temail = xye@bupt.edu.cn\n[url \"https://mirror.ghproxy.com/https://github.com\"]\n\tinsteadOf = https://github.com\n```\n\nIf you clone a repo by `git clone https://github.com/xxx/xxx.git`, it will\nactually clone from `https://mirror.ghproxy.com/https://github.com/xxx/xxx.git`.\nThus the mirror is used.\n\nHowever, it may cause some trouble when `git push` is used for your own repos.\nUse ssh will work fine for it only replace `https://github.com` and ssh uses\n`git@github`. The `url` in `.gitconfig` file have no effect on ssh push/clone or\npull.\n","source":"_posts/An-Introduction-to-Git.md","raw":"---\ntitle: An Introduction to Git\ndescription: 介绍git里面的一些基本概念，了解git运行的基本原理。\ncategories:\n  - Programming\n  - Tools\n  - Git\ntags:\n  - Git\nabbrlink: d13cd4ec\ndate: 2021-12-10 21:55:33\nsummary:\n---\n\n![The Structure of Git](git.jpg)\n\ngit checkout 用于切换分支或恢复工作数文件，它是一个危险的命令，因为这条命令会重\n写工作区。\n\ngit ls-files 查看缓存区中文件信息，它的参数有，括号里面是简写\n\n--cached (-c) 查看缓存区中所有文件\n\n--midified (-m)查看修改过的文件\n\n--delete (-d)查看删除过的文件\n\n--other (-o)查看没有被 git 跟踪的文件\n\n<!-- # errors -->\n\n<!-- ## Failed to connect to github.com port 443: Time out -->\n\n<!-- The following commands fixed this issue. -->\n\n<!-- ```fish -->\n<!-- git config --global http.proxy http://127.0.0.1:1080 -->\n<!-- git config --global https.proxy https://127.0.0.1:1080 -->\n<!-- git config --global --unset http.proxy -->\n<!-- git config --global --unset https.proxy -->\n<!-- ``` -->\n\n# Get back to an old version\n\n`git log` can show the history of your commit.\n\n`git reset xxx` will git back to an old version. However, the workspace will not\nchange, i.e., the workspace is also the current workspace.\n`git reset --hard xxx` will get back to an old version, and the workspace will\nbe also the old version.\n\nTo get back to the newest version `git reflog` can show the reference logs\ninformation. It records when the tips of branches and other references were\nupdated in the local repository. The code of the newest version will be\nobserved.\n\n# Clone too slow\n\nThe network speed of `git clone` is often very slow in China mainland. To\nimprove the speed, I often `clone` by ssh, i.e., use the ssh link instead of\nhttps link. However, it need to change the link. Use\n`git config --global url.\"https://mirror.ghproxy.com/https://github.com\".insteadOf https://github.com`\ncan download repos fast without changing the links. It will write some thing in\nthe `~/.gitconfig` file.\n\nWhen the `.gitconfig` file is\n\n```\n[user]\n\tname = xyegithub\n\temail = xye@bupt.edu.cn\n[url \"https://mirror.ghproxy.com/https://github.com\"]\n\tinsteadOf = https://github.com\n```\n\nIf you clone a repo by `git clone https://github.com/xxx/xxx.git`, it will\nactually clone from `https://mirror.ghproxy.com/https://github.com/xxx/xxx.git`.\nThus the mirror is used.\n\nHowever, it may cause some trouble when `git push` is used for your own repos.\nUse ssh will work fine for it only replace `https://github.com` and ssh uses\n`git@github`. The `url` in `.gitconfig` file have no effect on ssh push/clone or\npull.\n","slug":"An-Introduction-to-Git","published":1,"updated":"2022-06-13T07:38:40.678Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpg40003y7mldedibwd7","content":"<html><head></head><body><p><img src=\"git.jpg\" alt=\"The Structure of Git\"></p>\n<p>git checkout 用于切换分支或恢复工作数文件，它是一个危险的命令，因为这条命令会重\n写工作区。</p>\n<p>git ls-files 查看缓存区中文件信息，它的参数有，括号里面是简写</p>\n<p>–cached (-c) 查看缓存区中所有文件</p>\n<p>–midified (-m)查看修改过的文件</p>\n<p>–delete (-d)查看删除过的文件</p>\n<p>–other (-o)查看没有被 git 跟踪的文件</p>\n<!-- # errors -->\n<!-- ## Failed to connect to github.com port 443: Time out -->\n<!-- The following commands fixed this issue. -->\n<!-- ```fish -->\n<!-- git config --global http.proxy http://127.0.0.1:1080 -->\n<!-- git config --global https.proxy https://127.0.0.1:1080 -->\n<!-- git config --global --unset http.proxy -->\n<!-- git config --global --unset https.proxy -->\n<!-- ``` -->\n<h1 id=\"get-back-to-an-old-version\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#get-back-to-an-old-version\"></a> Get back to an old version</h1>\n<p><code>git log</code> can show the history of your commit.</p>\n<p><code>git reset xxx</code> will git back to an old version. However, the workspace will not\nchange, i.e., the workspace is also the current workspace.\n<code>git reset --hard xxx</code> will get back to an old version, and the workspace will\nbe also the old version.</p>\n<p>To get back to the newest version <code>git reflog</code> can show the reference logs\ninformation. It records when the tips of branches and other references were\nupdated in the local repository. The code of the newest version will be\nobserved.</p>\n<h1 id=\"clone-too-slow\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#clone-too-slow\"></a> Clone too slow</h1>\n<p>The network speed of <code>git clone</code> is often very slow in China mainland. To\nimprove the speed, I often <code>clone</code> by ssh, i.e., use the ssh link instead of\nhttps link. However, it need to change the link. Use\n<code>git config --global url.\"https://mirror.ghproxy.com/https://github.com\".insteadOf https://github.com</code>\ncan download repos fast without changing the links. It will write some thing in\nthe <code>~/.gitconfig</code> file.</p>\n<p>When the <code>.gitconfig</code> file is</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[user]</span><br><span class=\"line\">\tname = xyegithub</span><br><span class=\"line\">\temail = xye@bupt.edu.cn</span><br><span class=\"line\">[url \"https://mirror.ghproxy.com/https://github.com\"]</span><br><span class=\"line\">\tinsteadOf = https://github.com</span><br></pre></td></tr></tbody></table></figure>\n<p>If you clone a repo by <code>git clone https://github.com/xxx/xxx.git</code>, it will\nactually clone from <code>https://mirror.ghproxy.com/https://github.com/xxx/xxx.git</code>.\nThus the mirror is used.</p>\n<p>However, it may cause some trouble when <code>git push</code> is used for your own repos.\nUse ssh will work fine for it only replace <code>https://github.com</code> and ssh uses\n<code>git@github</code>. The <code>url</code> in <code>.gitconfig</code> file have no effect on ssh push/clone or\npull.</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<p><img src=\"git.jpg\" alt=\"The Structure of Git\" /></p>\n<p>git checkout 用于切换分支或恢复工作数文件，它是一个危险的命令，因为这条命令会重\n写工作区。</p>\n<p>git ls-files 查看缓存区中文件信息，它的参数有，括号里面是简写</p>\n<p>–cached (-c) 查看缓存区中所有文件</p>\n<p>–midified (-m)查看修改过的文件</p>\n<p>–delete (-d)查看删除过的文件</p>\n<p>–other (-o)查看没有被 git 跟踪的文件</p>\n<!-- # errors -->\n<!-- ## Failed to connect to github.com port 443: Time out -->\n<!-- The following commands fixed this issue. -->\n<!-- ```fish -->\n<!-- git config --global http.proxy http://127.0.0.1:1080 -->\n<!-- git config --global https.proxy https://127.0.0.1:1080 -->\n<!-- git config --global --unset http.proxy -->\n<!-- git config --global --unset https.proxy -->\n<!-- ``` -->\n<h1 id=\"get-back-to-an-old-version\"><a class=\"markdownIt-Anchor\" href=\"#get-back-to-an-old-version\"></a> Get back to an old version</h1>\n<p><code>git log</code> can show the history of your commit.</p>\n<p><code>git reset xxx</code> will git back to an old version. However, the workspace will not\nchange, i.e., the workspace is also the current workspace.\n<code>git reset --hard xxx</code> will get back to an old version, and the workspace will\nbe also the old version.</p>\n<p>To get back to the newest version <code>git reflog</code> can show the reference logs\ninformation. It records when the tips of branches and other references were\nupdated in the local repository. The code of the newest version will be\nobserved.</p>\n<h1 id=\"clone-too-slow\"><a class=\"markdownIt-Anchor\" href=\"#clone-too-slow\"></a> Clone too slow</h1>\n<p>The network speed of <code>git clone</code> is often very slow in China mainland. To\nimprove the speed, I often <code>clone</code> by ssh, i.e., use the ssh link instead of\nhttps link. However, it need to change the link. Use\n<code>git config --global url.&quot;https://mirror.ghproxy.com/https://github.com&quot;.insteadOf https://github.com</code>\ncan download repos fast without changing the links. It will write some thing in\nthe <code>~/.gitconfig</code> file.</p>\n<p>When the <code>.gitconfig</code> file is</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[user]</span><br><span class=\"line\">\tname = xyegithub</span><br><span class=\"line\">\temail = xye@bupt.edu.cn</span><br><span class=\"line\">[url &quot;https://mirror.ghproxy.com/https://github.com&quot;]</span><br><span class=\"line\">\tinsteadOf = https://github.com</span><br></pre></td></tr></table></figure>\n<p>If you clone a repo by <code>git clone https://github.com/xxx/xxx.git</code>, it will\nactually clone from <code>https://mirror.ghproxy.com/https://github.com/xxx/xxx.git</code>.\nThus the mirror is used.</p>\n<p>However, it may cause some trouble when <code>git push</code> is used for your own repos.\nUse ssh will work fine for it only replace <code>https://github.com</code> and ssh uses\n<code>git@github</code>. The <code>url</code> in <code>.gitconfig</code> file have no effect on ssh push/clone or\npull.</p>\n"},{"title":"Arch Linux","top":false,"cover":false,"toc":true,"description":"Arch Linux installation, Configuration","abbrlink":"38c4d001","date":"2022-05-15T12:40:03.000Z","password":null,"summary":null,"_content":"\n[A good Tutorial for Installing it!](https://archlinuxstudio.github.io/ArchLinuxTutorial/#/)\n\n# What is Verify Signature\n\nSignature is used for protecting data from undetected changes by including a\nproof of identify value called a digital signature.\n\n# What is Kernel Module\n\nKernel module are pieces of code that can be loaded and unloaded into the kernel\nupon demand. They extend the functionality of the kernel without the need of\nreboot the system.\n\nModules are stored in `/usr/lib/modules/kernel_release` or `/lib/modules`. You\ncan use the command `uname -r` to get your current kernel release version.\n\n[How to block a kernel module](https://wiki.archlinux.org/title/Kernel_modules#Blacklisting).\n\n## Nouveau\n\nNouveau is an open-source Nouveau driver for NVIDIA graphics cards.\n\n# initramfs\n\nThe root file system at `/` starts out as an empty rootfs, which is a special\ninstance of ramfs or tmpfs. The purpose of the initramfs is to bootstrap the\nsystem to the point where it can access the root file system. It does not need\nto contain every module one would ever want to use; it should only have modules\nrequired for the root device like IDE, SCCI, SATA or USB/FW. The majority of\nmodules will be loaded later on by `udev`, during the init process.\n\n# What is fstab\n\n`fstab` is the Linux system's file system table. It is a configuration table\ndesigned to ease the burden of mounting and unmounting file systems to a\nmachine. It is a set of rules used to control how different file systems are\ntreated each time they are introduced to a system.\n\n# What is grub\n\n`grub` is a boot loader. It is the software that loads the Linux kernel (It has\nother uses as well). It is the first software that starts at a system boot.\n\nThe BIOS checks the Master Boot Record (MBR) which is a 512 byte section located\nfirst on the Hard Drive. It looks for a bootloader (like GRUB).\n\nThen you will be prompted by the GRUB menu which can contain a list of the\noperating systems installed (in the case of dual boot), or perhaps different\nkernels installed in a Linux distro.\n\nWhen you choose which distro or kernel you want to use, GRUB loads the selected\nkernel. The kernel starts `init` or `systemd`, which is the first process to\nstart in Linux. `init` then starts other processes like network services and\nother that you might have configured at boot time.\n\n# Firmware Types\n\nThe firmware is the very first program that is executed once the system is\nswitched on. The words BIOS or (U)EFI are often used instead of firmware.\n\n# What is UEFI\n\n## BIOS\n\n1. BIOS (basic input/output system) is a program.\n2. It is in the ROM (read only) disk. It is hard encoded on the computer\n   motherboard.\n3. It is used by a computer's microprocessor to start the computer system after\n   it is powered on. It performs hardware initialization during the booting\n   process (power-on startup).\n4. It also manages data flow between the computer's operating system (OS) and\n   attached devices, such as the hard disk, video adapter, keyboard, mouse and\n   printer.\n\n## UEFI\n\nBIOS's popularity has waned in favor of a newer technology: UEFI (Unified\nExtensible Firmware Interface). Intel announced a plan in 2017 to retire support\nfor legacy BIOS systems by 2020, replacing them with UEFI.\n\nUEFI does not launch any boot code from the Master Boot Record (MBR) whether it\nexists or not, instead booting relies on boot entries in NVRAM.\n\n### The Usage of UEFI\n\nUEFI launches EFI (Extensible Firmware Interface) applications, e.g., boot\nloaders, boot managers, UEFI shell, etc. These applications are usually stored\nas files in the EFI system partition. Each vendor can stores its files in the\nEFI system partition under the `/EFI/vendor_name` directory. The applications\ncan be launched by adding a boot entry to the NVRAM (non-volatile random access\nmemory, an RAM can keep the data with power off) or from the UEFI shell.\n\n# System Initialization\n\n## Under BIOS\n\n![The Initialization process](init.png)\n\n1. System switched on, the POST (power-on self-test) is executed.\n2. After POST, BIOS initializes the hardware required for booting (disk,\n   keyboard controller etc.).\n3. BIOS launches the first 440 bytes (the Master Boot Record bootstrap code\n   area) of the first disk in the BIOS disk order.\n4. The boot loader's first stage in the MBR (Master Boot Record) boot code then\n   launches its second stage code (if any) from either:\n   - next disk sectors after the MBR, i.e., the so called post-MBR gap (only on\n     a MBR partition table).\n   - A partition's or a partitionless disk's volume boot record (VBR)\n   - The BIOS boot partition (GRUB on BIOS/GPT only).\n5. The actual boot loader is launched.\n6. The boot loader then loads an operating system by either chain-loading or\n   directly loading the operating system kernel\n\n> POST: A power-on self-test is a set of routines performed by firmware or\n> software immediately after a computer is powered on, to determine if the\n> hardware is working as expected. The process would proceed further only if the\n> required hardware is working correctly, else the BIOS would issue an error\n> message. POST sequence is executed irrespective of the Operating System and is\n> handled by the system BIOS. Once the tests are passed the POST would generally\n> notify the OS with beeps while the number of beeps can vary from system to\n> system. When POST is successfully finalized bootstrapping is enable.\n> Bootstrapping starts the initialization of the OS.\n\n## Under UEFI\n\n1. System switched on, the power-on self-test (POST) is executed.\n2. After POST, UEFI initializes the hardware required for booting (disk,\n   keyboard controllers etc.).\n3. Firmware reads the boot entries in the NVRAM to determine which EFI\n   application to launch and from where (e.g. from which disk and partition).\n   - A boot entry could simply be a disk. In this case the firmware looks fro an\n     EFI system partition on that disk and tries to find an EFI application in\n     the fallback boot path `\\EFI\\BOOT\\BOOTx64.EFI` (`bootia32.EFI` on systems\n     with a IA32 (32-bit) UEFI). This is how UEFI bootable removable media work.\n4. Firmware launches the EFI application.\n   - This could be a boot loader or the Arch kernel itself using EFISTUB.\n   - It could be some other EFI application such as UEFI shell or a boot manages\n     like systemd-boot or rEFInd.\n\nIf Secure Boot is enabled, the boot process will verify authenticity of the EFI\nbinary by signature.\n\n# Dual Boot with Windows\n\n## Windows Before Linux\n\nThe main difference between installing individual Linux and dual system is the\nboot loader, which load the operating system.\n\n### BIOS Systems\n\n#### Using a Linux Boot Loader\n\nYou may use any multi-boot supporting BIOS boot loader, such as 'grub'.\n\n#### Using Windows Boot Loader\n\n1. Install a Linux bootloader on a partition instead of the MBR, e.g., the\n   `/boot` partition\n2. Copy this bootloader to a partition readable by the windows bootloader\n3. Use Windows bootloader to start said copy of the Linux bootloader\n\n# Configuration\n\n## Default applications\n\nTo set the default applications, one needs to modify the file\n`~/.config/mimeapps.list`. In the right side of `=` can be the file name in\n`/usr/share/applications/`.\n\n## Thunderbird\n\nThunderbird is used as the email app. However, it can not be stored on the tray.\n`birdtray` can help. Install it with `yay -S birdtray` and run `birdtray` then\nConfigure it with thunderbird.\n\n## Remote Desktop\n\nTo use the local camera, this command is needed.\n\n```bash\nsudo xfreerdp /f /u:Account Name /p:Password /v:IP:Port /video /usb:id,dev:1bcf:28b\n0  /sound /microphone:sys:alsa\n```\n\nThe usb id is obtained by command `lsusb`.\n\nSomething also need to be set on the Windows side.\n\n1. Type `WinKey + R` and run `gpedit.msc` on the target VM (the target windows\n   10 Virtual Machine) to start the `Group Policy Editor`.\n2. Locate the item\n   ` Computer Configuration \\ Administrative Templates \\ Windows Components \\ Remote Desktop Services \\ Remote Desktop Session Host \\ Device and Resource Redirection\\ Do not allow supported Plug and Play device redirection`\n   and set this item to Disabled.\n3. Also you can set\n\n```bash\nRemote Desktop Connection Client \\ RemoteFX USB Device Redirection \\ Allow RDP redirection of other supported RemoteFX USB devices from this computer (Enabled)\n\nRemote Desktop Session Host \\ Remote Session Environment \\ RemoteFX for Windows Server 2008 R2 \\ Configure RemoteFX (Enabled)\n\nRemote Desktop Session Host \\ Connections \\ Allow users to connect remotely by using Remote Desktop Services (Enabled)\n\nRemote Desktop Session Host \\ Device and Resource Redirection\\ Do not allow supported Plug and Play device redirection (Disabled)\n\ngpupdate /force in elevated CMD Prompt and reboot\n```\n\n4. Run `gpupdate /force` from an elevated command prompt.\n5. At least disconnect RDP session and connect again, if this does not work\n   reboot target VM.\n\n[For More Information](https://stackoverflow.com/questions/33719489/how-to-enable-usb-redirection-in-windows-10/46628854)\n\n## Touch Pad\n\nWhen `dwm` is started, tapping the touchpad does not work. To let it work create\n`/etc/X11/xorg.conf.d/30-touchpad.conf`, which contains\n\n```\nSection \"InputClass\"\nIdentifier \"touchpad catchall\"\nDriver \"libinput\"\nOption \"Tapping\" \"on\"\nEndSection\n```\n\nNotice that there is no indents in the file, otherwise it will not work.\n\n## Network\n\nConnect a network with `NetworkManager`. For example,\n`nmcli connection add type wifi con-name BUPT-mobile ifname wlan0 ssid BUPT-mobile -- wifi-sec.key-mgmt wpa-eap 802-1x.eap ttls 802-1x.phase2-auth mschapv2 802-1x.identity USERNAME`\nThen `BUPT-mobile` can be connected with `nmcli --ask connection up BUPT-mobile`\nor `nmtui`. The `nmtui` does not support add network of `WPA2 802.1X` otherwise\none can add and connect the network by only `nmtui`.\n\nUse `space` to enable or disable `automatically connect` in `nmtui`. `X` denotes\nenable.\n\n## startx\n\n### NVIDIA\n\n`startx` provides a command line startup of Linux. However, it will cause a\nblack screen problem with NVIDIA. To avoid it, add\n\n```bash\nxrandr --setprovideroutputsource modesetting NVIDIA-0\nxrandr --auto\n```\n\nto the `.xinitrc`.\n\n### Auto Start\n\nAdd the following snippets to `~/.bash_profile`.\n\n```bash\nif [ -z \"${DISPLAY}\" ] && [ \"${XDG_VTNR}\" -eq 1 ]; then\n  exec startx\nfi\n```\n\n## Screen Translator\n\n### youdao\n\n`youdao` can be installed by `yay -S youdao-dict`. However, it is very slow to\nshow the result when words are picked. This is because of the vpn. I use\n`51game`. However, when I set the `system client` into `mainland white list`, it\ntranslate fast for picking words.\n\n## Goldendict\n\nGoldendict is a more power translator. Install `translate-shell`. `edit` >\n`dictionaries` > `programs` > `add`, `type`: `Plain text`; `Command Line`:\n`trans -e google -s en -t zh -show-original y -show-original-phonetics n -show-translation y -no-ansi -show-translation-phonetics n -show-prompt-message n -show-languages n -show-original-dictionary n -show-dictionary n -show-alternatives n \"%GDWORD%\"`\n\nSet `popup` only press `alt`. Use `ctrl` will cause a problem that translate\nwhen copy. Especially when copy a web link.\n\nTo enable run `goldendict` in background, pick `Enable system try icon` and\n`Start to system try`. Otherwise, the gui of `goldendict` will open even if it\nis executed by `goldendict &`.\n\n## Tmux\n\nWhen install `tmux`, some error maybe occur.\n`/usr/share/fish/functions/fish_prompt.fish (line 6): hostname|cut -d . -f 1`\ncan be solved by `pacman -S inetutils`.\n\n`shell command \\`tmux\\`throws\\`can't use /dev/tty\\` error`can be solved by`exec\n</dev/tty; exec <&1; TMUX= tmux`.\n\n## Clipboard of nvim\n\nTo enable the clipboard of nvim share by the system, run `sudo pacman -S xsel`\n\n## Try to run `exe` files\n\n### Wine\n\nI successfully installed wechat with wine. However, it can not use the camera.\n\n### Bottles\n\n#### PyGObject\n\nBottles depends on `PyGObject`, it is a python package. However, it is difficult\nto install it by `pip`. It can be easily installed by conda.\n\n##### A way to install PyGObject\n\n`pip install PyGObject` default to install its dependences like `pycairo`.\nHowever, the latest version of `pycairo` can not be successfully ran on my\nsystem. Thus I can install `pycairo` manually by `pip` or `conda` and run\n`pip install --no-build-isolation pygobject` to install `pygobject` and in this\nway `pygobject` will not install its dependences automatically and will find the\ndependences locally.\n\n##### Install successfully\n\n`bottles` is installed successfully by using ` flatpak`, by\n`sudo pacman -S flatpak`. However, it also can not use the camera.\n\n# Locale\n\nFor detail to see the Arch Linux wiki. Notice that the KDE can set the language\ntoo. Only set to en_US.\n","source":"_posts/Arch-Linux.md","raw":"---\ntitle: Arch Linux\ntop: false\ncover: false\ntoc: true\ndescription: \"Arch Linux installation, Configuration\"\ncategories:\n  - Programming\n  - Tools\n  - Linux\ntags:\n  - Arch Linux\nabbrlink: 38c4d001\ndate: 2022-05-15 20:40:03\npassword:\nsummary:\n---\n\n[A good Tutorial for Installing it!](https://archlinuxstudio.github.io/ArchLinuxTutorial/#/)\n\n# What is Verify Signature\n\nSignature is used for protecting data from undetected changes by including a\nproof of identify value called a digital signature.\n\n# What is Kernel Module\n\nKernel module are pieces of code that can be loaded and unloaded into the kernel\nupon demand. They extend the functionality of the kernel without the need of\nreboot the system.\n\nModules are stored in `/usr/lib/modules/kernel_release` or `/lib/modules`. You\ncan use the command `uname -r` to get your current kernel release version.\n\n[How to block a kernel module](https://wiki.archlinux.org/title/Kernel_modules#Blacklisting).\n\n## Nouveau\n\nNouveau is an open-source Nouveau driver for NVIDIA graphics cards.\n\n# initramfs\n\nThe root file system at `/` starts out as an empty rootfs, which is a special\ninstance of ramfs or tmpfs. The purpose of the initramfs is to bootstrap the\nsystem to the point where it can access the root file system. It does not need\nto contain every module one would ever want to use; it should only have modules\nrequired for the root device like IDE, SCCI, SATA or USB/FW. The majority of\nmodules will be loaded later on by `udev`, during the init process.\n\n# What is fstab\n\n`fstab` is the Linux system's file system table. It is a configuration table\ndesigned to ease the burden of mounting and unmounting file systems to a\nmachine. It is a set of rules used to control how different file systems are\ntreated each time they are introduced to a system.\n\n# What is grub\n\n`grub` is a boot loader. It is the software that loads the Linux kernel (It has\nother uses as well). It is the first software that starts at a system boot.\n\nThe BIOS checks the Master Boot Record (MBR) which is a 512 byte section located\nfirst on the Hard Drive. It looks for a bootloader (like GRUB).\n\nThen you will be prompted by the GRUB menu which can contain a list of the\noperating systems installed (in the case of dual boot), or perhaps different\nkernels installed in a Linux distro.\n\nWhen you choose which distro or kernel you want to use, GRUB loads the selected\nkernel. The kernel starts `init` or `systemd`, which is the first process to\nstart in Linux. `init` then starts other processes like network services and\nother that you might have configured at boot time.\n\n# Firmware Types\n\nThe firmware is the very first program that is executed once the system is\nswitched on. The words BIOS or (U)EFI are often used instead of firmware.\n\n# What is UEFI\n\n## BIOS\n\n1. BIOS (basic input/output system) is a program.\n2. It is in the ROM (read only) disk. It is hard encoded on the computer\n   motherboard.\n3. It is used by a computer's microprocessor to start the computer system after\n   it is powered on. It performs hardware initialization during the booting\n   process (power-on startup).\n4. It also manages data flow between the computer's operating system (OS) and\n   attached devices, such as the hard disk, video adapter, keyboard, mouse and\n   printer.\n\n## UEFI\n\nBIOS's popularity has waned in favor of a newer technology: UEFI (Unified\nExtensible Firmware Interface). Intel announced a plan in 2017 to retire support\nfor legacy BIOS systems by 2020, replacing them with UEFI.\n\nUEFI does not launch any boot code from the Master Boot Record (MBR) whether it\nexists or not, instead booting relies on boot entries in NVRAM.\n\n### The Usage of UEFI\n\nUEFI launches EFI (Extensible Firmware Interface) applications, e.g., boot\nloaders, boot managers, UEFI shell, etc. These applications are usually stored\nas files in the EFI system partition. Each vendor can stores its files in the\nEFI system partition under the `/EFI/vendor_name` directory. The applications\ncan be launched by adding a boot entry to the NVRAM (non-volatile random access\nmemory, an RAM can keep the data with power off) or from the UEFI shell.\n\n# System Initialization\n\n## Under BIOS\n\n![The Initialization process](init.png)\n\n1. System switched on, the POST (power-on self-test) is executed.\n2. After POST, BIOS initializes the hardware required for booting (disk,\n   keyboard controller etc.).\n3. BIOS launches the first 440 bytes (the Master Boot Record bootstrap code\n   area) of the first disk in the BIOS disk order.\n4. The boot loader's first stage in the MBR (Master Boot Record) boot code then\n   launches its second stage code (if any) from either:\n   - next disk sectors after the MBR, i.e., the so called post-MBR gap (only on\n     a MBR partition table).\n   - A partition's or a partitionless disk's volume boot record (VBR)\n   - The BIOS boot partition (GRUB on BIOS/GPT only).\n5. The actual boot loader is launched.\n6. The boot loader then loads an operating system by either chain-loading or\n   directly loading the operating system kernel\n\n> POST: A power-on self-test is a set of routines performed by firmware or\n> software immediately after a computer is powered on, to determine if the\n> hardware is working as expected. The process would proceed further only if the\n> required hardware is working correctly, else the BIOS would issue an error\n> message. POST sequence is executed irrespective of the Operating System and is\n> handled by the system BIOS. Once the tests are passed the POST would generally\n> notify the OS with beeps while the number of beeps can vary from system to\n> system. When POST is successfully finalized bootstrapping is enable.\n> Bootstrapping starts the initialization of the OS.\n\n## Under UEFI\n\n1. System switched on, the power-on self-test (POST) is executed.\n2. After POST, UEFI initializes the hardware required for booting (disk,\n   keyboard controllers etc.).\n3. Firmware reads the boot entries in the NVRAM to determine which EFI\n   application to launch and from where (e.g. from which disk and partition).\n   - A boot entry could simply be a disk. In this case the firmware looks fro an\n     EFI system partition on that disk and tries to find an EFI application in\n     the fallback boot path `\\EFI\\BOOT\\BOOTx64.EFI` (`bootia32.EFI` on systems\n     with a IA32 (32-bit) UEFI). This is how UEFI bootable removable media work.\n4. Firmware launches the EFI application.\n   - This could be a boot loader or the Arch kernel itself using EFISTUB.\n   - It could be some other EFI application such as UEFI shell or a boot manages\n     like systemd-boot or rEFInd.\n\nIf Secure Boot is enabled, the boot process will verify authenticity of the EFI\nbinary by signature.\n\n# Dual Boot with Windows\n\n## Windows Before Linux\n\nThe main difference between installing individual Linux and dual system is the\nboot loader, which load the operating system.\n\n### BIOS Systems\n\n#### Using a Linux Boot Loader\n\nYou may use any multi-boot supporting BIOS boot loader, such as 'grub'.\n\n#### Using Windows Boot Loader\n\n1. Install a Linux bootloader on a partition instead of the MBR, e.g., the\n   `/boot` partition\n2. Copy this bootloader to a partition readable by the windows bootloader\n3. Use Windows bootloader to start said copy of the Linux bootloader\n\n# Configuration\n\n## Default applications\n\nTo set the default applications, one needs to modify the file\n`~/.config/mimeapps.list`. In the right side of `=` can be the file name in\n`/usr/share/applications/`.\n\n## Thunderbird\n\nThunderbird is used as the email app. However, it can not be stored on the tray.\n`birdtray` can help. Install it with `yay -S birdtray` and run `birdtray` then\nConfigure it with thunderbird.\n\n## Remote Desktop\n\nTo use the local camera, this command is needed.\n\n```bash\nsudo xfreerdp /f /u:Account Name /p:Password /v:IP:Port /video /usb:id,dev:1bcf:28b\n0  /sound /microphone:sys:alsa\n```\n\nThe usb id is obtained by command `lsusb`.\n\nSomething also need to be set on the Windows side.\n\n1. Type `WinKey + R` and run `gpedit.msc` on the target VM (the target windows\n   10 Virtual Machine) to start the `Group Policy Editor`.\n2. Locate the item\n   ` Computer Configuration \\ Administrative Templates \\ Windows Components \\ Remote Desktop Services \\ Remote Desktop Session Host \\ Device and Resource Redirection\\ Do not allow supported Plug and Play device redirection`\n   and set this item to Disabled.\n3. Also you can set\n\n```bash\nRemote Desktop Connection Client \\ RemoteFX USB Device Redirection \\ Allow RDP redirection of other supported RemoteFX USB devices from this computer (Enabled)\n\nRemote Desktop Session Host \\ Remote Session Environment \\ RemoteFX for Windows Server 2008 R2 \\ Configure RemoteFX (Enabled)\n\nRemote Desktop Session Host \\ Connections \\ Allow users to connect remotely by using Remote Desktop Services (Enabled)\n\nRemote Desktop Session Host \\ Device and Resource Redirection\\ Do not allow supported Plug and Play device redirection (Disabled)\n\ngpupdate /force in elevated CMD Prompt and reboot\n```\n\n4. Run `gpupdate /force` from an elevated command prompt.\n5. At least disconnect RDP session and connect again, if this does not work\n   reboot target VM.\n\n[For More Information](https://stackoverflow.com/questions/33719489/how-to-enable-usb-redirection-in-windows-10/46628854)\n\n## Touch Pad\n\nWhen `dwm` is started, tapping the touchpad does not work. To let it work create\n`/etc/X11/xorg.conf.d/30-touchpad.conf`, which contains\n\n```\nSection \"InputClass\"\nIdentifier \"touchpad catchall\"\nDriver \"libinput\"\nOption \"Tapping\" \"on\"\nEndSection\n```\n\nNotice that there is no indents in the file, otherwise it will not work.\n\n## Network\n\nConnect a network with `NetworkManager`. For example,\n`nmcli connection add type wifi con-name BUPT-mobile ifname wlan0 ssid BUPT-mobile -- wifi-sec.key-mgmt wpa-eap 802-1x.eap ttls 802-1x.phase2-auth mschapv2 802-1x.identity USERNAME`\nThen `BUPT-mobile` can be connected with `nmcli --ask connection up BUPT-mobile`\nor `nmtui`. The `nmtui` does not support add network of `WPA2 802.1X` otherwise\none can add and connect the network by only `nmtui`.\n\nUse `space` to enable or disable `automatically connect` in `nmtui`. `X` denotes\nenable.\n\n## startx\n\n### NVIDIA\n\n`startx` provides a command line startup of Linux. However, it will cause a\nblack screen problem with NVIDIA. To avoid it, add\n\n```bash\nxrandr --setprovideroutputsource modesetting NVIDIA-0\nxrandr --auto\n```\n\nto the `.xinitrc`.\n\n### Auto Start\n\nAdd the following snippets to `~/.bash_profile`.\n\n```bash\nif [ -z \"${DISPLAY}\" ] && [ \"${XDG_VTNR}\" -eq 1 ]; then\n  exec startx\nfi\n```\n\n## Screen Translator\n\n### youdao\n\n`youdao` can be installed by `yay -S youdao-dict`. However, it is very slow to\nshow the result when words are picked. This is because of the vpn. I use\n`51game`. However, when I set the `system client` into `mainland white list`, it\ntranslate fast for picking words.\n\n## Goldendict\n\nGoldendict is a more power translator. Install `translate-shell`. `edit` >\n`dictionaries` > `programs` > `add`, `type`: `Plain text`; `Command Line`:\n`trans -e google -s en -t zh -show-original y -show-original-phonetics n -show-translation y -no-ansi -show-translation-phonetics n -show-prompt-message n -show-languages n -show-original-dictionary n -show-dictionary n -show-alternatives n \"%GDWORD%\"`\n\nSet `popup` only press `alt`. Use `ctrl` will cause a problem that translate\nwhen copy. Especially when copy a web link.\n\nTo enable run `goldendict` in background, pick `Enable system try icon` and\n`Start to system try`. Otherwise, the gui of `goldendict` will open even if it\nis executed by `goldendict &`.\n\n## Tmux\n\nWhen install `tmux`, some error maybe occur.\n`/usr/share/fish/functions/fish_prompt.fish (line 6): hostname|cut -d . -f 1`\ncan be solved by `pacman -S inetutils`.\n\n`shell command \\`tmux\\`throws\\`can't use /dev/tty\\` error`can be solved by`exec\n</dev/tty; exec <&1; TMUX= tmux`.\n\n## Clipboard of nvim\n\nTo enable the clipboard of nvim share by the system, run `sudo pacman -S xsel`\n\n## Try to run `exe` files\n\n### Wine\n\nI successfully installed wechat with wine. However, it can not use the camera.\n\n### Bottles\n\n#### PyGObject\n\nBottles depends on `PyGObject`, it is a python package. However, it is difficult\nto install it by `pip`. It can be easily installed by conda.\n\n##### A way to install PyGObject\n\n`pip install PyGObject` default to install its dependences like `pycairo`.\nHowever, the latest version of `pycairo` can not be successfully ran on my\nsystem. Thus I can install `pycairo` manually by `pip` or `conda` and run\n`pip install --no-build-isolation pygobject` to install `pygobject` and in this\nway `pygobject` will not install its dependences automatically and will find the\ndependences locally.\n\n##### Install successfully\n\n`bottles` is installed successfully by using ` flatpak`, by\n`sudo pacman -S flatpak`. However, it also can not use the camera.\n\n# Locale\n\nFor detail to see the Arch Linux wiki. Notice that the KDE can set the language\ntoo. Only set to en_US.\n","slug":"Arch-Linux","published":1,"updated":"2022-06-14T11:06:15.885Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpg80007y7ml0twaa2mq","content":"<html><head></head><body><p><a href=\"https://archlinuxstudio.github.io/ArchLinuxTutorial/#/\">A good Tutorial for Installing it!</a></p>\n<h1 id=\"what-is-verify-signature\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#what-is-verify-signature\"></a> What is Verify Signature</h1>\n<p>Signature is used for protecting data from undetected changes by including a\nproof of identify value called a digital signature.</p>\n<h1 id=\"what-is-kernel-module\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#what-is-kernel-module\"></a> What is Kernel Module</h1>\n<p>Kernel module are pieces of code that can be loaded and unloaded into the kernel\nupon demand. They extend the functionality of the kernel without the need of\nreboot the system.</p>\n<p>Modules are stored in <code>/usr/lib/modules/kernel_release</code> or <code>/lib/modules</code>. You\ncan use the command <code>uname -r</code> to get your current kernel release version.</p>\n<p><a href=\"https://wiki.archlinux.org/title/Kernel_modules#Blacklisting\">How to block a kernel module</a>.</p>\n<h2 id=\"nouveau\"><span class=\"post-title-index\">2.1. </span><a class=\"markdownIt-Anchor\" href=\"#nouveau\"></a> Nouveau</h2>\n<p>Nouveau is an open-source Nouveau driver for NVIDIA graphics cards.</p>\n<h1 id=\"initramfs\"><span class=\"post-title-index\">3. </span><a class=\"markdownIt-Anchor\" href=\"#initramfs\"></a> initramfs</h1>\n<p>The root file system at <code>/</code> starts out as an empty rootfs, which is a special\ninstance of ramfs or tmpfs. The purpose of the initramfs is to bootstrap the\nsystem to the point where it can access the root file system. It does not need\nto contain every module one would ever want to use; it should only have modules\nrequired for the root device like IDE, SCCI, SATA or USB/FW. The majority of\nmodules will be loaded later on by <code>udev</code>, during the init process.</p>\n<h1 id=\"what-is-fstab\"><span class=\"post-title-index\">4. </span><a class=\"markdownIt-Anchor\" href=\"#what-is-fstab\"></a> What is fstab</h1>\n<p><code>fstab</code> is the Linux system’s file system table. It is a configuration table\ndesigned to ease the burden of mounting and unmounting file systems to a\nmachine. It is a set of rules used to control how different file systems are\ntreated each time they are introduced to a system.</p>\n<h1 id=\"what-is-grub\"><span class=\"post-title-index\">5. </span><a class=\"markdownIt-Anchor\" href=\"#what-is-grub\"></a> What is grub</h1>\n<p><code>grub</code> is a boot loader. It is the software that loads the Linux kernel (It has\nother uses as well). It is the first software that starts at a system boot.</p>\n<p>The BIOS checks the Master Boot Record (MBR) which is a 512 byte section located\nfirst on the Hard Drive. It looks for a bootloader (like GRUB).</p>\n<p>Then you will be prompted by the GRUB menu which can contain a list of the\noperating systems installed (in the case of dual boot), or perhaps different\nkernels installed in a Linux distro.</p>\n<p>When you choose which distro or kernel you want to use, GRUB loads the selected\nkernel. The kernel starts <code>init</code> or <code>systemd</code>, which is the first process to\nstart in Linux. <code>init</code> then starts other processes like network services and\nother that you might have configured at boot time.</p>\n<h1 id=\"firmware-types\"><span class=\"post-title-index\">6. </span><a class=\"markdownIt-Anchor\" href=\"#firmware-types\"></a> Firmware Types</h1>\n<p>The firmware is the very first program that is executed once the system is\nswitched on. The words BIOS or (U)EFI are often used instead of firmware.</p>\n<h1 id=\"what-is-uefi\"><span class=\"post-title-index\">7. </span><a class=\"markdownIt-Anchor\" href=\"#what-is-uefi\"></a> What is UEFI</h1>\n<h2 id=\"bios\"><span class=\"post-title-index\">7.1. </span><a class=\"markdownIt-Anchor\" href=\"#bios\"></a> BIOS</h2>\n<ol>\n<li>BIOS (basic input/output system) is a program.</li>\n<li>It is in the ROM (read only) disk. It is hard encoded on the computer\nmotherboard.</li>\n<li>It is used by a computer’s microprocessor to start the computer system after\nit is powered on. It performs hardware initialization during the booting\nprocess (power-on startup).</li>\n<li>It also manages data flow between the computer’s operating system (OS) and\nattached devices, such as the hard disk, video adapter, keyboard, mouse and\nprinter.</li>\n</ol>\n<h2 id=\"uefi\"><span class=\"post-title-index\">7.2. </span><a class=\"markdownIt-Anchor\" href=\"#uefi\"></a> UEFI</h2>\n<p>BIOS’s popularity has waned in favor of a newer technology: UEFI (Unified\nExtensible Firmware Interface). Intel announced a plan in 2017 to retire support\nfor legacy BIOS systems by 2020, replacing them with UEFI.</p>\n<p>UEFI does not launch any boot code from the Master Boot Record (MBR) whether it\nexists or not, instead booting relies on boot entries in NVRAM.</p>\n<h3 id=\"the-usage-of-uefi\"><span class=\"post-title-index\">7.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#the-usage-of-uefi\"></a> The Usage of UEFI</h3>\n<p>UEFI launches EFI (Extensible Firmware Interface) applications, e.g., boot\nloaders, boot managers, UEFI shell, etc. These applications are usually stored\nas files in the EFI system partition. Each vendor can stores its files in the\nEFI system partition under the <code>/EFI/vendor_name</code> directory. The applications\ncan be launched by adding a boot entry to the NVRAM (non-volatile random access\nmemory, an RAM can keep the data with power off) or from the UEFI shell.</p>\n<h1 id=\"system-initialization\"><span class=\"post-title-index\">8. </span><a class=\"markdownIt-Anchor\" href=\"#system-initialization\"></a> System Initialization</h1>\n<h2 id=\"under-bios\"><span class=\"post-title-index\">8.1. </span><a class=\"markdownIt-Anchor\" href=\"#under-bios\"></a> Under BIOS</h2>\n<p><img src=\"init.png\" alt=\"The Initialization process\"></p>\n<ol>\n<li>System switched on, the POST (power-on self-test) is executed.</li>\n<li>After POST, BIOS initializes the hardware required for booting (disk,\nkeyboard controller etc.).</li>\n<li>BIOS launches the first 440 bytes (the Master Boot Record bootstrap code\narea) of the first disk in the BIOS disk order.</li>\n<li>The boot loader’s first stage in the MBR (Master Boot Record) boot code then\nlaunches its second stage code (if any) from either:\n<ul>\n<li>next disk sectors after the MBR, i.e., the so called post-MBR gap (only on\na MBR partition table).</li>\n<li>A partition’s or a partitionless disk’s volume boot record (VBR)</li>\n<li>The BIOS boot partition (GRUB on BIOS/GPT only).</li>\n</ul>\n</li>\n<li>The actual boot loader is launched.</li>\n<li>The boot loader then loads an operating system by either chain-loading or\ndirectly loading the operating system kernel</li>\n</ol>\n<blockquote>\n<p>POST: A power-on self-test is a set of routines performed by firmware or\nsoftware immediately after a computer is powered on, to determine if the\nhardware is working as expected. The process would proceed further only if the\nrequired hardware is working correctly, else the BIOS would issue an error\nmessage. POST sequence is executed irrespective of the Operating System and is\nhandled by the system BIOS. Once the tests are passed the POST would generally\nnotify the OS with beeps while the number of beeps can vary from system to\nsystem. When POST is successfully finalized bootstrapping is enable.\nBootstrapping starts the initialization of the OS.</p>\n</blockquote>\n<h2 id=\"under-uefi\"><span class=\"post-title-index\">8.2. </span><a class=\"markdownIt-Anchor\" href=\"#under-uefi\"></a> Under UEFI</h2>\n<ol>\n<li>System switched on, the power-on self-test (POST) is executed.</li>\n<li>After POST, UEFI initializes the hardware required for booting (disk,\nkeyboard controllers etc.).</li>\n<li>Firmware reads the boot entries in the NVRAM to determine which EFI\napplication to launch and from where (e.g. from which disk and partition).\n<ul>\n<li>A boot entry could simply be a disk. In this case the firmware looks fro an\nEFI system partition on that disk and tries to find an EFI application in\nthe fallback boot path <code>\\EFI\\BOOT\\BOOTx64.EFI</code> (<code>bootia32.EFI</code> on systems\nwith a IA32 (32-bit) UEFI). This is how UEFI bootable removable media work.</li>\n</ul>\n</li>\n<li>Firmware launches the EFI application.\n<ul>\n<li>This could be a boot loader or the Arch kernel itself using EFISTUB.</li>\n<li>It could be some other EFI application such as UEFI shell or a boot manages\nlike systemd-boot or rEFInd.</li>\n</ul>\n</li>\n</ol>\n<p>If Secure Boot is enabled, the boot process will verify authenticity of the EFI\nbinary by signature.</p>\n<h1 id=\"dual-boot-with-windows\"><span class=\"post-title-index\">9. </span><a class=\"markdownIt-Anchor\" href=\"#dual-boot-with-windows\"></a> Dual Boot with Windows</h1>\n<h2 id=\"windows-before-linux\"><span class=\"post-title-index\">9.1. </span><a class=\"markdownIt-Anchor\" href=\"#windows-before-linux\"></a> Windows Before Linux</h2>\n<p>The main difference between installing individual Linux and dual system is the\nboot loader, which load the operating system.</p>\n<h3 id=\"bios-systems\"><span class=\"post-title-index\">9.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#bios-systems\"></a> BIOS Systems</h3>\n<h4 id=\"using-a-linux-boot-loader\"><span class=\"post-title-index\">9.1.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#using-a-linux-boot-loader\"></a> Using a Linux Boot Loader</h4>\n<p>You may use any multi-boot supporting BIOS boot loader, such as ‘grub’.</p>\n<h4 id=\"using-windows-boot-loader\"><span class=\"post-title-index\">9.1.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#using-windows-boot-loader\"></a> Using Windows Boot Loader</h4>\n<ol>\n<li>Install a Linux bootloader on a partition instead of the MBR, e.g., the\n<code>/boot</code> partition</li>\n<li>Copy this bootloader to a partition readable by the windows bootloader</li>\n<li>Use Windows bootloader to start said copy of the Linux bootloader</li>\n</ol>\n<h1 id=\"configuration\"><span class=\"post-title-index\">10. </span><a class=\"markdownIt-Anchor\" href=\"#configuration\"></a> Configuration</h1>\n<h2 id=\"default-applications\"><span class=\"post-title-index\">10.1. </span><a class=\"markdownIt-Anchor\" href=\"#default-applications\"></a> Default applications</h2>\n<p>To set the default applications, one needs to modify the file\n<code>~/.config/mimeapps.list</code>. In the right side of <code>=</code> can be the file name in\n<code>/usr/share/applications/</code>.</p>\n<h2 id=\"thunderbird\"><span class=\"post-title-index\">10.2. </span><a class=\"markdownIt-Anchor\" href=\"#thunderbird\"></a> Thunderbird</h2>\n<p>Thunderbird is used as the email app. However, it can not be stored on the tray.\n<code>birdtray</code> can help. Install it with <code>yay -S birdtray</code> and run <code>birdtray</code> then\nConfigure it with thunderbird.</p>\n<h2 id=\"remote-desktop\"><span class=\"post-title-index\">10.3. </span><a class=\"markdownIt-Anchor\" href=\"#remote-desktop\"></a> Remote Desktop</h2>\n<p>To use the local camera, this command is needed.</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo xfreerdp /f /u:Account Name /p:Password /v:IP:Port /video /usb:id,dev:1bcf:28b</span><br><span class=\"line\">0  /sound /microphone:sys:alsa</span><br></pre></td></tr></tbody></table></figure>\n<p>The usb id is obtained by command <code>lsusb</code>.</p>\n<p>Something also need to be set on the Windows side.</p>\n<ol>\n<li>Type <code>WinKey + R</code> and run <code>gpedit.msc</code> on the target VM (the target windows\n10 Virtual Machine) to start the <code>Group Policy Editor</code>.</li>\n<li>Locate the item\n<code>Computer Configuration \\ Administrative Templates \\ Windows Components \\ Remote Desktop Services \\ Remote Desktop Session Host \\ Device and Resource Redirection\\ Do not allow supported Plug and Play device redirection</code>\nand set this item to Disabled.</li>\n<li>Also you can set</li>\n</ol>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Remote Desktop Connection Client \\ RemoteFX USB Device Redirection \\ Allow RDP redirection of other supported RemoteFX USB devices from this computer (Enabled)</span><br><span class=\"line\"></span><br><span class=\"line\">Remote Desktop Session Host \\ Remote Session Environment \\ RemoteFX <span class=\"keyword\">for</span> Windows Server 2008 R2 \\ Configure RemoteFX (Enabled)</span><br><span class=\"line\"></span><br><span class=\"line\">Remote Desktop Session Host \\ Connections \\ Allow users to connect remotely by using Remote Desktop Services (Enabled)</span><br><span class=\"line\"></span><br><span class=\"line\">Remote Desktop Session Host \\ Device and Resource Redirection\\ Do not allow supported Plug and Play device redirection (Disabled)</span><br><span class=\"line\"></span><br><span class=\"line\">gpupdate /force <span class=\"keyword\">in</span> elevated CMD Prompt and reboot</span><br></pre></td></tr></tbody></table></figure>\n<ol start=\"4\">\n<li>Run <code>gpupdate /force</code> from an elevated command prompt.</li>\n<li>At least disconnect RDP session and connect again, if this does not work\nreboot target VM.</li>\n</ol>\n<p><a href=\"https://stackoverflow.com/questions/33719489/how-to-enable-usb-redirection-in-windows-10/46628854\">For More Information</a></p>\n<h2 id=\"touch-pad\"><span class=\"post-title-index\">10.4. </span><a class=\"markdownIt-Anchor\" href=\"#touch-pad\"></a> Touch Pad</h2>\n<p>When <code>dwm</code> is started, tapping the touchpad does not work. To let it work create\n<code>/etc/X11/xorg.conf.d/30-touchpad.conf</code>, which contains</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Section \"InputClass\"</span><br><span class=\"line\">Identifier \"touchpad catchall\"</span><br><span class=\"line\">Driver \"libinput\"</span><br><span class=\"line\">Option \"Tapping\" \"on\"</span><br><span class=\"line\">EndSection</span><br></pre></td></tr></tbody></table></figure>\n<p>Notice that there is no indents in the file, otherwise it will not work.</p>\n<h2 id=\"network\"><span class=\"post-title-index\">10.5. </span><a class=\"markdownIt-Anchor\" href=\"#network\"></a> Network</h2>\n<p>Connect a network with <code>NetworkManager</code>. For example,\n<code>nmcli connection add type wifi con-name BUPT-mobile ifname wlan0 ssid BUPT-mobile -- wifi-sec.key-mgmt wpa-eap 802-1x.eap ttls 802-1x.phase2-auth mschapv2 802-1x.identity USERNAME</code>\nThen <code>BUPT-mobile</code> can be connected with <code>nmcli --ask connection up BUPT-mobile</code>\nor <code>nmtui</code>. The <code>nmtui</code> does not support add network of <code>WPA2 802.1X</code> otherwise\none can add and connect the network by only <code>nmtui</code>.</p>\n<p>Use <code>space</code> to enable or disable <code>automatically connect</code> in <code>nmtui</code>. <code>X</code> denotes\nenable.</p>\n<h2 id=\"startx\"><span class=\"post-title-index\">10.6. </span><a class=\"markdownIt-Anchor\" href=\"#startx\"></a> startx</h2>\n<h3 id=\"nvidia\"><span class=\"post-title-index\">10.6.1. </span><a class=\"markdownIt-Anchor\" href=\"#nvidia\"></a> NVIDIA</h3>\n<p><code>startx</code> provides a command line startup of Linux. However, it will cause a\nblack screen problem with NVIDIA. To avoid it, add</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xrandr --setprovideroutputsource modesetting NVIDIA-0</span><br><span class=\"line\">xrandr --auto</span><br></pre></td></tr></tbody></table></figure>\n<p>to the <code>.xinitrc</code>.</p>\n<h3 id=\"auto-start\"><span class=\"post-title-index\">10.6.2. </span><a class=\"markdownIt-Anchor\" href=\"#auto-start\"></a> Auto Start</h3>\n<p>Add the following snippets to <code>~/.bash_profile</code>.</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">\"<span class=\"variable\">${DISPLAY}</span>\"</span> ] &amp;&amp; [ <span class=\"string\">\"<span class=\"variable\">${XDG_VTNR}</span>\"</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">exec</span> startx</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"screen-translator\"><span class=\"post-title-index\">10.7. </span><a class=\"markdownIt-Anchor\" href=\"#screen-translator\"></a> Screen Translator</h2>\n<h3 id=\"youdao\"><span class=\"post-title-index\">10.7.1. </span><a class=\"markdownIt-Anchor\" href=\"#youdao\"></a> youdao</h3>\n<p><code>youdao</code> can be installed by <code>yay -S youdao-dict</code>. However, it is very slow to\nshow the result when words are picked. This is because of the vpn. I use\n<code>51game</code>. However, when I set the <code>system client</code> into <code>mainland white list</code>, it\ntranslate fast for picking words.</p>\n<h2 id=\"goldendict\"><span class=\"post-title-index\">10.8. </span><a class=\"markdownIt-Anchor\" href=\"#goldendict\"></a> Goldendict</h2>\n<p>Goldendict is a more power translator. Install <code>translate-shell</code>. <code>edit</code> &gt;\n<code>dictionaries</code> &gt; <code>programs</code> &gt; <code>add</code>, <code>type</code>: <code>Plain text</code>; <code>Command Line</code>:\n<code>trans -e google -s en -t zh -show-original y -show-original-phonetics n -show-translation y -no-ansi -show-translation-phonetics n -show-prompt-message n -show-languages n -show-original-dictionary n -show-dictionary n -show-alternatives n \"%GDWORD%\"</code></p>\n<p>Set <code>popup</code> only press <code>alt</code>. Use <code>ctrl</code> will cause a problem that translate\nwhen copy. Especially when copy a web link.</p>\n<p>To enable run <code>goldendict</code> in background, pick <code>Enable system try icon</code> and\n<code>Start to system try</code>. Otherwise, the gui of <code>goldendict</code> will open even if it\nis executed by <code>goldendict &amp;</code>.</p>\n<h2 id=\"tmux\"><span class=\"post-title-index\">10.9. </span><a class=\"markdownIt-Anchor\" href=\"#tmux\"></a> Tmux</h2>\n<p>When install <code>tmux</code>, some error maybe occur.\n<code>/usr/share/fish/functions/fish_prompt.fish (line 6): hostname|cut -d . -f 1</code>\ncan be solved by <code>pacman -S inetutils</code>.</p>\n<p><code>shell command \\</code>tmux`throws`can’t use /dev/tty` error<code>can be solved by</code>exec\n&lt;/dev/tty; exec &lt;&amp;1; TMUX= tmux`.</p>\n<h2 id=\"clipboard-of-nvim\"><span class=\"post-title-index\">10.10. </span><a class=\"markdownIt-Anchor\" href=\"#clipboard-of-nvim\"></a> Clipboard of nvim</h2>\n<p>To enable the clipboard of nvim share by the system, run <code>sudo pacman -S xsel</code></p>\n<h2 id=\"try-to-run-exe-files\"><span class=\"post-title-index\">10.11. </span><a class=\"markdownIt-Anchor\" href=\"#try-to-run-exe-files\"></a> Try to run <code>exe</code> files</h2>\n<h3 id=\"wine\"><span class=\"post-title-index\">10.11.1. </span><a class=\"markdownIt-Anchor\" href=\"#wine\"></a> Wine</h3>\n<p>I successfully installed wechat with wine. However, it can not use the camera.</p>\n<h3 id=\"bottles\"><span class=\"post-title-index\">10.11.2. </span><a class=\"markdownIt-Anchor\" href=\"#bottles\"></a> Bottles</h3>\n<h4 id=\"pygobject\"><span class=\"post-title-index\">10.11.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#pygobject\"></a> PyGObject</h4>\n<p>Bottles depends on <code>PyGObject</code>, it is a python package. However, it is difficult\nto install it by <code>pip</code>. It can be easily installed by conda.</p>\n<h5 id=\"a-way-to-install-pygobject\"><span class=\"post-title-index\">10.11.2.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#a-way-to-install-pygobject\"></a> A way to install PyGObject</h5>\n<p><code>pip install PyGObject</code> default to install its dependences like <code>pycairo</code>.\nHowever, the latest version of <code>pycairo</code> can not be successfully ran on my\nsystem. Thus I can install <code>pycairo</code> manually by <code>pip</code> or <code>conda</code> and run\n<code>pip install --no-build-isolation pygobject</code> to install <code>pygobject</code> and in this\nway <code>pygobject</code> will not install its dependences automatically and will find the\ndependences locally.</p>\n<h5 id=\"install-successfully\"><span class=\"post-title-index\">10.11.2.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#install-successfully\"></a> Install successfully</h5>\n<p><code>bottles</code> is installed successfully by using <code>flatpak</code>, by\n<code>sudo pacman -S flatpak</code>. However, it also can not use the camera.</p>\n<h1 id=\"locale\"><span class=\"post-title-index\">11. </span><a class=\"markdownIt-Anchor\" href=\"#locale\"></a> Locale</h1>\n<p>For detail to see the Arch Linux wiki. Notice that the KDE can set the language\ntoo. Only set to en_US.</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<p><a href=\"https://archlinuxstudio.github.io/ArchLinuxTutorial/#/\">A good Tutorial for Installing it!</a></p>\n<h1 id=\"what-is-verify-signature\"><a class=\"markdownIt-Anchor\" href=\"#what-is-verify-signature\"></a> What is Verify Signature</h1>\n<p>Signature is used for protecting data from undetected changes by including a\nproof of identify value called a digital signature.</p>\n<h1 id=\"what-is-kernel-module\"><a class=\"markdownIt-Anchor\" href=\"#what-is-kernel-module\"></a> What is Kernel Module</h1>\n<p>Kernel module are pieces of code that can be loaded and unloaded into the kernel\nupon demand. They extend the functionality of the kernel without the need of\nreboot the system.</p>\n<p>Modules are stored in <code>/usr/lib/modules/kernel_release</code> or <code>/lib/modules</code>. You\ncan use the command <code>uname -r</code> to get your current kernel release version.</p>\n<p><a href=\"https://wiki.archlinux.org/title/Kernel_modules#Blacklisting\">How to block a kernel module</a>.</p>\n<h2 id=\"nouveau\"><a class=\"markdownIt-Anchor\" href=\"#nouveau\"></a> Nouveau</h2>\n<p>Nouveau is an open-source Nouveau driver for NVIDIA graphics cards.</p>\n<h1 id=\"initramfs\"><a class=\"markdownIt-Anchor\" href=\"#initramfs\"></a> initramfs</h1>\n<p>The root file system at <code>/</code> starts out as an empty rootfs, which is a special\ninstance of ramfs or tmpfs. The purpose of the initramfs is to bootstrap the\nsystem to the point where it can access the root file system. It does not need\nto contain every module one would ever want to use; it should only have modules\nrequired for the root device like IDE, SCCI, SATA or USB/FW. The majority of\nmodules will be loaded later on by <code>udev</code>, during the init process.</p>\n<h1 id=\"what-is-fstab\"><a class=\"markdownIt-Anchor\" href=\"#what-is-fstab\"></a> What is fstab</h1>\n<p><code>fstab</code> is the Linux system’s file system table. It is a configuration table\ndesigned to ease the burden of mounting and unmounting file systems to a\nmachine. It is a set of rules used to control how different file systems are\ntreated each time they are introduced to a system.</p>\n<h1 id=\"what-is-grub\"><a class=\"markdownIt-Anchor\" href=\"#what-is-grub\"></a> What is grub</h1>\n<p><code>grub</code> is a boot loader. It is the software that loads the Linux kernel (It has\nother uses as well). It is the first software that starts at a system boot.</p>\n<p>The BIOS checks the Master Boot Record (MBR) which is a 512 byte section located\nfirst on the Hard Drive. It looks for a bootloader (like GRUB).</p>\n<p>Then you will be prompted by the GRUB menu which can contain a list of the\noperating systems installed (in the case of dual boot), or perhaps different\nkernels installed in a Linux distro.</p>\n<p>When you choose which distro or kernel you want to use, GRUB loads the selected\nkernel. The kernel starts <code>init</code> or <code>systemd</code>, which is the first process to\nstart in Linux. <code>init</code> then starts other processes like network services and\nother that you might have configured at boot time.</p>\n<h1 id=\"firmware-types\"><a class=\"markdownIt-Anchor\" href=\"#firmware-types\"></a> Firmware Types</h1>\n<p>The firmware is the very first program that is executed once the system is\nswitched on. The words BIOS or (U)EFI are often used instead of firmware.</p>\n<h1 id=\"what-is-uefi\"><a class=\"markdownIt-Anchor\" href=\"#what-is-uefi\"></a> What is UEFI</h1>\n<h2 id=\"bios\"><a class=\"markdownIt-Anchor\" href=\"#bios\"></a> BIOS</h2>\n<ol>\n<li>BIOS (basic input/output system) is a program.</li>\n<li>It is in the ROM (read only) disk. It is hard encoded on the computer\nmotherboard.</li>\n<li>It is used by a computer’s microprocessor to start the computer system after\nit is powered on. It performs hardware initialization during the booting\nprocess (power-on startup).</li>\n<li>It also manages data flow between the computer’s operating system (OS) and\nattached devices, such as the hard disk, video adapter, keyboard, mouse and\nprinter.</li>\n</ol>\n<h2 id=\"uefi\"><a class=\"markdownIt-Anchor\" href=\"#uefi\"></a> UEFI</h2>\n<p>BIOS’s popularity has waned in favor of a newer technology: UEFI (Unified\nExtensible Firmware Interface). Intel announced a plan in 2017 to retire support\nfor legacy BIOS systems by 2020, replacing them with UEFI.</p>\n<p>UEFI does not launch any boot code from the Master Boot Record (MBR) whether it\nexists or not, instead booting relies on boot entries in NVRAM.</p>\n<h3 id=\"the-usage-of-uefi\"><a class=\"markdownIt-Anchor\" href=\"#the-usage-of-uefi\"></a> The Usage of UEFI</h3>\n<p>UEFI launches EFI (Extensible Firmware Interface) applications, e.g., boot\nloaders, boot managers, UEFI shell, etc. These applications are usually stored\nas files in the EFI system partition. Each vendor can stores its files in the\nEFI system partition under the <code>/EFI/vendor_name</code> directory. The applications\ncan be launched by adding a boot entry to the NVRAM (non-volatile random access\nmemory, an RAM can keep the data with power off) or from the UEFI shell.</p>\n<h1 id=\"system-initialization\"><a class=\"markdownIt-Anchor\" href=\"#system-initialization\"></a> System Initialization</h1>\n<h2 id=\"under-bios\"><a class=\"markdownIt-Anchor\" href=\"#under-bios\"></a> Under BIOS</h2>\n<p><img src=\"init.png\" alt=\"The Initialization process\" /></p>\n<ol>\n<li>System switched on, the POST (power-on self-test) is executed.</li>\n<li>After POST, BIOS initializes the hardware required for booting (disk,\nkeyboard controller etc.).</li>\n<li>BIOS launches the first 440 bytes (the Master Boot Record bootstrap code\narea) of the first disk in the BIOS disk order.</li>\n<li>The boot loader’s first stage in the MBR (Master Boot Record) boot code then\nlaunches its second stage code (if any) from either:\n<ul>\n<li>next disk sectors after the MBR, i.e., the so called post-MBR gap (only on\na MBR partition table).</li>\n<li>A partition’s or a partitionless disk’s volume boot record (VBR)</li>\n<li>The BIOS boot partition (GRUB on BIOS/GPT only).</li>\n</ul>\n</li>\n<li>The actual boot loader is launched.</li>\n<li>The boot loader then loads an operating system by either chain-loading or\ndirectly loading the operating system kernel</li>\n</ol>\n<blockquote>\n<p>POST: A power-on self-test is a set of routines performed by firmware or\nsoftware immediately after a computer is powered on, to determine if the\nhardware is working as expected. The process would proceed further only if the\nrequired hardware is working correctly, else the BIOS would issue an error\nmessage. POST sequence is executed irrespective of the Operating System and is\nhandled by the system BIOS. Once the tests are passed the POST would generally\nnotify the OS with beeps while the number of beeps can vary from system to\nsystem. When POST is successfully finalized bootstrapping is enable.\nBootstrapping starts the initialization of the OS.</p>\n</blockquote>\n<h2 id=\"under-uefi\"><a class=\"markdownIt-Anchor\" href=\"#under-uefi\"></a> Under UEFI</h2>\n<ol>\n<li>System switched on, the power-on self-test (POST) is executed.</li>\n<li>After POST, UEFI initializes the hardware required for booting (disk,\nkeyboard controllers etc.).</li>\n<li>Firmware reads the boot entries in the NVRAM to determine which EFI\napplication to launch and from where (e.g. from which disk and partition).\n<ul>\n<li>A boot entry could simply be a disk. In this case the firmware looks fro an\nEFI system partition on that disk and tries to find an EFI application in\nthe fallback boot path <code>\\EFI\\BOOT\\BOOTx64.EFI</code> (<code>bootia32.EFI</code> on systems\nwith a IA32 (32-bit) UEFI). This is how UEFI bootable removable media work.</li>\n</ul>\n</li>\n<li>Firmware launches the EFI application.\n<ul>\n<li>This could be a boot loader or the Arch kernel itself using EFISTUB.</li>\n<li>It could be some other EFI application such as UEFI shell or a boot manages\nlike systemd-boot or rEFInd.</li>\n</ul>\n</li>\n</ol>\n<p>If Secure Boot is enabled, the boot process will verify authenticity of the EFI\nbinary by signature.</p>\n<h1 id=\"dual-boot-with-windows\"><a class=\"markdownIt-Anchor\" href=\"#dual-boot-with-windows\"></a> Dual Boot with Windows</h1>\n<h2 id=\"windows-before-linux\"><a class=\"markdownIt-Anchor\" href=\"#windows-before-linux\"></a> Windows Before Linux</h2>\n<p>The main difference between installing individual Linux and dual system is the\nboot loader, which load the operating system.</p>\n<h3 id=\"bios-systems\"><a class=\"markdownIt-Anchor\" href=\"#bios-systems\"></a> BIOS Systems</h3>\n<h4 id=\"using-a-linux-boot-loader\"><a class=\"markdownIt-Anchor\" href=\"#using-a-linux-boot-loader\"></a> Using a Linux Boot Loader</h4>\n<p>You may use any multi-boot supporting BIOS boot loader, such as ‘grub’.</p>\n<h4 id=\"using-windows-boot-loader\"><a class=\"markdownIt-Anchor\" href=\"#using-windows-boot-loader\"></a> Using Windows Boot Loader</h4>\n<ol>\n<li>Install a Linux bootloader on a partition instead of the MBR, e.g., the\n<code>/boot</code> partition</li>\n<li>Copy this bootloader to a partition readable by the windows bootloader</li>\n<li>Use Windows bootloader to start said copy of the Linux bootloader</li>\n</ol>\n<h1 id=\"configuration\"><a class=\"markdownIt-Anchor\" href=\"#configuration\"></a> Configuration</h1>\n<h2 id=\"default-applications\"><a class=\"markdownIt-Anchor\" href=\"#default-applications\"></a> Default applications</h2>\n<p>To set the default applications, one needs to modify the file\n<code>~/.config/mimeapps.list</code>. In the right side of <code>=</code> can be the file name in\n<code>/usr/share/applications/</code>.</p>\n<h2 id=\"thunderbird\"><a class=\"markdownIt-Anchor\" href=\"#thunderbird\"></a> Thunderbird</h2>\n<p>Thunderbird is used as the email app. However, it can not be stored on the tray.\n<code>birdtray</code> can help. Install it with <code>yay -S birdtray</code> and run <code>birdtray</code> then\nConfigure it with thunderbird.</p>\n<h2 id=\"remote-desktop\"><a class=\"markdownIt-Anchor\" href=\"#remote-desktop\"></a> Remote Desktop</h2>\n<p>To use the local camera, this command is needed.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo xfreerdp /f /u:Account Name /p:Password /v:IP:Port /video /usb:id,dev:1bcf:28b</span><br><span class=\"line\">0  /sound /microphone:sys:alsa</span><br></pre></td></tr></table></figure>\n<p>The usb id is obtained by command <code>lsusb</code>.</p>\n<p>Something also need to be set on the Windows side.</p>\n<ol>\n<li>Type <code>WinKey + R</code> and run <code>gpedit.msc</code> on the target VM (the target windows\n10 Virtual Machine) to start the <code>Group Policy Editor</code>.</li>\n<li>Locate the item\n<code>Computer Configuration \\ Administrative Templates \\ Windows Components \\ Remote Desktop Services \\ Remote Desktop Session Host \\ Device and Resource Redirection\\ Do not allow supported Plug and Play device redirection</code>\nand set this item to Disabled.</li>\n<li>Also you can set</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Remote Desktop Connection Client \\ RemoteFX USB Device Redirection \\ Allow RDP redirection of other supported RemoteFX USB devices from this computer (Enabled)</span><br><span class=\"line\"></span><br><span class=\"line\">Remote Desktop Session Host \\ Remote Session Environment \\ RemoteFX <span class=\"keyword\">for</span> Windows Server 2008 R2 \\ Configure RemoteFX (Enabled)</span><br><span class=\"line\"></span><br><span class=\"line\">Remote Desktop Session Host \\ Connections \\ Allow users to connect remotely by using Remote Desktop Services (Enabled)</span><br><span class=\"line\"></span><br><span class=\"line\">Remote Desktop Session Host \\ Device and Resource Redirection\\ Do not allow supported Plug and Play device redirection (Disabled)</span><br><span class=\"line\"></span><br><span class=\"line\">gpupdate /force <span class=\"keyword\">in</span> elevated CMD Prompt and reboot</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>Run <code>gpupdate /force</code> from an elevated command prompt.</li>\n<li>At least disconnect RDP session and connect again, if this does not work\nreboot target VM.</li>\n</ol>\n<p><a href=\"https://stackoverflow.com/questions/33719489/how-to-enable-usb-redirection-in-windows-10/46628854\">For More Information</a></p>\n<h2 id=\"touch-pad\"><a class=\"markdownIt-Anchor\" href=\"#touch-pad\"></a> Touch Pad</h2>\n<p>When <code>dwm</code> is started, tapping the touchpad does not work. To let it work create\n<code>/etc/X11/xorg.conf.d/30-touchpad.conf</code>, which contains</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Section &quot;InputClass&quot;</span><br><span class=\"line\">Identifier &quot;touchpad catchall&quot;</span><br><span class=\"line\">Driver &quot;libinput&quot;</span><br><span class=\"line\">Option &quot;Tapping&quot; &quot;on&quot;</span><br><span class=\"line\">EndSection</span><br></pre></td></tr></table></figure>\n<p>Notice that there is no indents in the file, otherwise it will not work.</p>\n<h2 id=\"network\"><a class=\"markdownIt-Anchor\" href=\"#network\"></a> Network</h2>\n<p>Connect a network with <code>NetworkManager</code>. For example,\n<code>nmcli connection add type wifi con-name BUPT-mobile ifname wlan0 ssid BUPT-mobile -- wifi-sec.key-mgmt wpa-eap 802-1x.eap ttls 802-1x.phase2-auth mschapv2 802-1x.identity USERNAME</code>\nThen <code>BUPT-mobile</code> can be connected with <code>nmcli --ask connection up BUPT-mobile</code>\nor <code>nmtui</code>. The <code>nmtui</code> does not support add network of <code>WPA2 802.1X</code> otherwise\none can add and connect the network by only <code>nmtui</code>.</p>\n<p>Use <code>space</code> to enable or disable <code>automatically connect</code> in <code>nmtui</code>. <code>X</code> denotes\nenable.</p>\n<h2 id=\"startx\"><a class=\"markdownIt-Anchor\" href=\"#startx\"></a> startx</h2>\n<h3 id=\"nvidia\"><a class=\"markdownIt-Anchor\" href=\"#nvidia\"></a> NVIDIA</h3>\n<p><code>startx</code> provides a command line startup of Linux. However, it will cause a\nblack screen problem with NVIDIA. To avoid it, add</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xrandr --setprovideroutputsource modesetting NVIDIA-0</span><br><span class=\"line\">xrandr --auto</span><br></pre></td></tr></table></figure>\n<p>to the <code>.xinitrc</code>.</p>\n<h3 id=\"auto-start\"><a class=\"markdownIt-Anchor\" href=\"#auto-start\"></a> Auto Start</h3>\n<p>Add the following snippets to <code>~/.bash_profile</code>.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$&#123;DISPLAY&#125;</span>&quot;</span> ] &amp;&amp; [ <span class=\"string\">&quot;<span class=\"variable\">$&#123;XDG_VTNR&#125;</span>&quot;</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">exec</span> startx</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"screen-translator\"><a class=\"markdownIt-Anchor\" href=\"#screen-translator\"></a> Screen Translator</h2>\n<h3 id=\"youdao\"><a class=\"markdownIt-Anchor\" href=\"#youdao\"></a> youdao</h3>\n<p><code>youdao</code> can be installed by <code>yay -S youdao-dict</code>. However, it is very slow to\nshow the result when words are picked. This is because of the vpn. I use\n<code>51game</code>. However, when I set the <code>system client</code> into <code>mainland white list</code>, it\ntranslate fast for picking words.</p>\n<h2 id=\"goldendict\"><a class=\"markdownIt-Anchor\" href=\"#goldendict\"></a> Goldendict</h2>\n<p>Goldendict is a more power translator. Install <code>translate-shell</code>. <code>edit</code> &gt;\n<code>dictionaries</code> &gt; <code>programs</code> &gt; <code>add</code>, <code>type</code>: <code>Plain text</code>; <code>Command Line</code>:\n<code>trans -e google -s en -t zh -show-original y -show-original-phonetics n -show-translation y -no-ansi -show-translation-phonetics n -show-prompt-message n -show-languages n -show-original-dictionary n -show-dictionary n -show-alternatives n &quot;%GDWORD%&quot;</code></p>\n<p>Set <code>popup</code> only press <code>alt</code>. Use <code>ctrl</code> will cause a problem that translate\nwhen copy. Especially when copy a web link.</p>\n<p>To enable run <code>goldendict</code> in background, pick <code>Enable system try icon</code> and\n<code>Start to system try</code>. Otherwise, the gui of <code>goldendict</code> will open even if it\nis executed by <code>goldendict &amp;</code>.</p>\n<h2 id=\"tmux\"><a class=\"markdownIt-Anchor\" href=\"#tmux\"></a> Tmux</h2>\n<p>When install <code>tmux</code>, some error maybe occur.\n<code>/usr/share/fish/functions/fish_prompt.fish (line 6): hostname|cut -d . -f 1</code>\ncan be solved by <code>pacman -S inetutils</code>.</p>\n<p><code>shell command \\</code>tmux`throws`can’t use /dev/tty` error<code>can be solved by</code>exec\n&lt;/dev/tty; exec &lt;&amp;1; TMUX= tmux`.</p>\n<h2 id=\"clipboard-of-nvim\"><a class=\"markdownIt-Anchor\" href=\"#clipboard-of-nvim\"></a> Clipboard of nvim</h2>\n<p>To enable the clipboard of nvim share by the system, run <code>sudo pacman -S xsel</code></p>\n<h2 id=\"try-to-run-exe-files\"><a class=\"markdownIt-Anchor\" href=\"#try-to-run-exe-files\"></a> Try to run <code>exe</code> files</h2>\n<h3 id=\"wine\"><a class=\"markdownIt-Anchor\" href=\"#wine\"></a> Wine</h3>\n<p>I successfully installed wechat with wine. However, it can not use the camera.</p>\n<h3 id=\"bottles\"><a class=\"markdownIt-Anchor\" href=\"#bottles\"></a> Bottles</h3>\n<h4 id=\"pygobject\"><a class=\"markdownIt-Anchor\" href=\"#pygobject\"></a> PyGObject</h4>\n<p>Bottles depends on <code>PyGObject</code>, it is a python package. However, it is difficult\nto install it by <code>pip</code>. It can be easily installed by conda.</p>\n<h5 id=\"a-way-to-install-pygobject\"><a class=\"markdownIt-Anchor\" href=\"#a-way-to-install-pygobject\"></a> A way to install PyGObject</h5>\n<p><code>pip install PyGObject</code> default to install its dependences like <code>pycairo</code>.\nHowever, the latest version of <code>pycairo</code> can not be successfully ran on my\nsystem. Thus I can install <code>pycairo</code> manually by <code>pip</code> or <code>conda</code> and run\n<code>pip install --no-build-isolation pygobject</code> to install <code>pygobject</code> and in this\nway <code>pygobject</code> will not install its dependences automatically and will find the\ndependences locally.</p>\n<h5 id=\"install-successfully\"><a class=\"markdownIt-Anchor\" href=\"#install-successfully\"></a> Install successfully</h5>\n<p><code>bottles</code> is installed successfully by using <code>flatpak</code>, by\n<code>sudo pacman -S flatpak</code>. However, it also can not use the camera.</p>\n<h1 id=\"locale\"><a class=\"markdownIt-Anchor\" href=\"#locale\"></a> Locale</h1>\n<p>For detail to see the Arch Linux wiki. Notice that the KDE can set the language\ntoo. Only set to en_US.</p>\n"},{"title":"Bash","top":false,"cover":false,"toc":true,"description":"Bash Shell","abbrlink":"1e372de2","date":"2022-05-12T03:28:51.000Z","password":null,"summary":null,"_content":"\n# Arguments\n\n# Some Scripts\n\n## Modify the brightness of Arch Linux\n\nPut a number into `/sys/class/backlight/intel_backlight/brightness` represent\nthe brightness. The max number of brightness is denoted in file\n`/sys/class/backlight/intel_backlight/max_brightness`.\n\n```bash\n#!/bin/bash\nflag=true\nmax_light=$(cat /sys/class/backlight/intel_backlight/max_brightness)\n\nread -p \"please input a number in range (0, $max_light):\" num\n\nwhile $flag\ndo\n  # >name, means 1>name -- redirect stdout to the file name\n  # &>name, is like 1>name 2>name -- redirect stdout and stderr to the file name (however, name is only opened once; if you actually wrote 1>name 2>name, it'd try to open name twice and perhaps malfunction.)\n  # expr performs the arithmetic operations\n  # if the input num is not a number then an error will produce\n  # $? can capture the error, if expr is executed correctly, $? == 0, else it is the number represent the error type.\n\n         expr $num + 0 &>/dev/null\n         # $ false || echo \"Oops, fail\"\n         # Oops, fail\n\n          # $ true || echo \"Will not be printed\"\n          # $\n\n          # $ true && echo \"Things went well\"\n          # Things went well\n\n          # $ false && echo \"Will not be printed\"\n          # $\n          # for && the right command will be executed, only the left command is true\n          # for || the left command will be executed, only the left command is false\n          # thus when [xxx] is true flag=true will be executed and the last command will\n          # not be executed.\n          # when [xxx] is false, flag=false will never be executed and the last command\n          # will be executed.\n         [[ $? -eq 0 && $num -ge 0 && $num -le $max_light ]] && flag=false || read -p \"please input a number in range (0, $max_light):\" num\ndone\necho $num > /sys/class/backlight/intel_backlight/brightness\n```\n\n## run tmux only open a terminal\n\nAdd this to the `.bashrc`.\n\n```bash\n#  Note: the spaces after the [ and before the ] are necessary.\n# tmux will be executed only if it is opened by st\nif [ \"$TERM\" = \"st-256color\" ]; then\n\ttmux\nfi\n```\n","source":"_posts/Bash.md","raw":"---\ntitle: Bash\ntop: false\ncover: false\ntoc: true\ndescription: Bash Shell\ncategories:\n  - Programming\n  - Tools\n  - Shell\ntags:\n  - Bash\nabbrlink: 1e372de2\ndate: 2022-05-12 11:28:51\npassword:\nsummary:\n---\n\n# Arguments\n\n# Some Scripts\n\n## Modify the brightness of Arch Linux\n\nPut a number into `/sys/class/backlight/intel_backlight/brightness` represent\nthe brightness. The max number of brightness is denoted in file\n`/sys/class/backlight/intel_backlight/max_brightness`.\n\n```bash\n#!/bin/bash\nflag=true\nmax_light=$(cat /sys/class/backlight/intel_backlight/max_brightness)\n\nread -p \"please input a number in range (0, $max_light):\" num\n\nwhile $flag\ndo\n  # >name, means 1>name -- redirect stdout to the file name\n  # &>name, is like 1>name 2>name -- redirect stdout and stderr to the file name (however, name is only opened once; if you actually wrote 1>name 2>name, it'd try to open name twice and perhaps malfunction.)\n  # expr performs the arithmetic operations\n  # if the input num is not a number then an error will produce\n  # $? can capture the error, if expr is executed correctly, $? == 0, else it is the number represent the error type.\n\n         expr $num + 0 &>/dev/null\n         # $ false || echo \"Oops, fail\"\n         # Oops, fail\n\n          # $ true || echo \"Will not be printed\"\n          # $\n\n          # $ true && echo \"Things went well\"\n          # Things went well\n\n          # $ false && echo \"Will not be printed\"\n          # $\n          # for && the right command will be executed, only the left command is true\n          # for || the left command will be executed, only the left command is false\n          # thus when [xxx] is true flag=true will be executed and the last command will\n          # not be executed.\n          # when [xxx] is false, flag=false will never be executed and the last command\n          # will be executed.\n         [[ $? -eq 0 && $num -ge 0 && $num -le $max_light ]] && flag=false || read -p \"please input a number in range (0, $max_light):\" num\ndone\necho $num > /sys/class/backlight/intel_backlight/brightness\n```\n\n## run tmux only open a terminal\n\nAdd this to the `.bashrc`.\n\n```bash\n#  Note: the spaces after the [ and before the ] are necessary.\n# tmux will be executed only if it is opened by st\nif [ \"$TERM\" = \"st-256color\" ]; then\n\ttmux\nfi\n```\n","slug":"Bash","published":1,"updated":"2022-06-13T07:38:40.678Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpg90008y7mlhy2ibswm","content":"<html><head></head><body><h1 id=\"arguments\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#arguments\"></a> Arguments</h1>\n<h1 id=\"some-scripts\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#some-scripts\"></a> Some Scripts</h1>\n<h2 id=\"modify-the-brightness-of-arch-linux\"><span class=\"post-title-index\">2.1. </span><a class=\"markdownIt-Anchor\" href=\"#modify-the-brightness-of-arch-linux\"></a> Modify the brightness of Arch Linux</h2>\n<p>Put a number into <code>/sys/class/backlight/intel_backlight/brightness</code> represent\nthe brightness. The max number of brightness is denoted in file\n<code>/sys/class/backlight/intel_backlight/max_brightness</code>.</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">flag=<span class=\"literal\">true</span></span><br><span class=\"line\">max_light=$(cat /sys/class/backlight/intel_backlight/max_brightness)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">\"please input a number in range (0, <span class=\"variable\">$max_light</span>):\"</span> num</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"variable\">$flag</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"comment\"># &gt;name, means 1&gt;name -- redirect stdout to the file name</span></span><br><span class=\"line\">  <span class=\"comment\"># &amp;&gt;name, is like 1&gt;name 2&gt;name -- redirect stdout and stderr to the file name (however, name is only opened once; if you actually wrote 1&gt;name 2&gt;name, it'd try to open name twice and perhaps malfunction.)</span></span><br><span class=\"line\">  <span class=\"comment\"># expr performs the arithmetic operations</span></span><br><span class=\"line\">  <span class=\"comment\"># if the input num is not a number then an error will produce</span></span><br><span class=\"line\">  <span class=\"comment\"># $? can capture the error, if expr is executed correctly, $? == 0, else it is the number represent the error type.</span></span><br><span class=\"line\"></span><br><span class=\"line\">         expr <span class=\"variable\">$num</span> + 0 &amp;&gt;/dev/null</span><br><span class=\"line\">         <span class=\"comment\"># $ false || echo \"Oops, fail\"</span></span><br><span class=\"line\">         <span class=\"comment\"># Oops, fail</span></span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\"># $ true || echo \"Will not be printed\"</span></span><br><span class=\"line\">          <span class=\"comment\"># $</span></span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\"># $ true &amp;&amp; echo \"Things went well\"</span></span><br><span class=\"line\">          <span class=\"comment\"># Things went well</span></span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\"># $ false &amp;&amp; echo \"Will not be printed\"</span></span><br><span class=\"line\">          <span class=\"comment\"># $</span></span><br><span class=\"line\">          <span class=\"comment\"># for &amp;&amp; the right command will be executed, only the left command is true</span></span><br><span class=\"line\">          <span class=\"comment\"># for || the left command will be executed, only the left command is false</span></span><br><span class=\"line\">          <span class=\"comment\"># thus when [xxx] is true flag=true will be executed and the last command will</span></span><br><span class=\"line\">          <span class=\"comment\"># not be executed.</span></span><br><span class=\"line\">          <span class=\"comment\"># when [xxx] is false, flag=false will never be executed and the last command</span></span><br><span class=\"line\">          <span class=\"comment\"># will be executed.</span></span><br><span class=\"line\">         [[ $? -eq 0 &amp;&amp; <span class=\"variable\">$num</span> -ge 0 &amp;&amp; <span class=\"variable\">$num</span> -le <span class=\"variable\">$max_light</span> ]] &amp;&amp; flag=<span class=\"literal\">false</span> || <span class=\"built_in\">read</span> -p <span class=\"string\">\"please input a number in range (0, <span class=\"variable\">$max_light</span>):\"</span> num</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$num</span> &gt; /sys/class/backlight/intel_backlight/brightness</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"run-tmux-only-open-a-terminal\"><span class=\"post-title-index\">2.2. </span><a class=\"markdownIt-Anchor\" href=\"#run-tmux-only-open-a-terminal\"></a> run tmux only open a terminal</h2>\n<p>Add this to the <code>.bashrc</code>.</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  Note: the spaces after the [ and before the ] are necessary.</span></span><br><span class=\"line\"><span class=\"comment\"># tmux will be executed only if it is opened by st</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$TERM</span>\"</span> = <span class=\"string\">\"st-256color\"</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">\ttmux</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></tbody></table></figure>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"arguments\"><a class=\"markdownIt-Anchor\" href=\"#arguments\"></a> Arguments</h1>\n<h1 id=\"some-scripts\"><a class=\"markdownIt-Anchor\" href=\"#some-scripts\"></a> Some Scripts</h1>\n<h2 id=\"modify-the-brightness-of-arch-linux\"><a class=\"markdownIt-Anchor\" href=\"#modify-the-brightness-of-arch-linux\"></a> Modify the brightness of Arch Linux</h2>\n<p>Put a number into <code>/sys/class/backlight/intel_backlight/brightness</code> represent\nthe brightness. The max number of brightness is denoted in file\n<code>/sys/class/backlight/intel_backlight/max_brightness</code>.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">flag=<span class=\"literal\">true</span></span><br><span class=\"line\">max_light=$(cat /sys/class/backlight/intel_backlight/max_brightness)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">&quot;please input a number in range (0, <span class=\"variable\">$max_light</span>):&quot;</span> num</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"variable\">$flag</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"comment\"># &gt;name, means 1&gt;name -- redirect stdout to the file name</span></span><br><span class=\"line\">  <span class=\"comment\"># &amp;&gt;name, is like 1&gt;name 2&gt;name -- redirect stdout and stderr to the file name (however, name is only opened once; if you actually wrote 1&gt;name 2&gt;name, it&#x27;d try to open name twice and perhaps malfunction.)</span></span><br><span class=\"line\">  <span class=\"comment\"># expr performs the arithmetic operations</span></span><br><span class=\"line\">  <span class=\"comment\"># if the input num is not a number then an error will produce</span></span><br><span class=\"line\">  <span class=\"comment\"># $? can capture the error, if expr is executed correctly, $? == 0, else it is the number represent the error type.</span></span><br><span class=\"line\"></span><br><span class=\"line\">         expr <span class=\"variable\">$num</span> + 0 &amp;&gt;/dev/null</span><br><span class=\"line\">         <span class=\"comment\"># $ false || echo &quot;Oops, fail&quot;</span></span><br><span class=\"line\">         <span class=\"comment\"># Oops, fail</span></span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\"># $ true || echo &quot;Will not be printed&quot;</span></span><br><span class=\"line\">          <span class=\"comment\"># $</span></span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\"># $ true &amp;&amp; echo &quot;Things went well&quot;</span></span><br><span class=\"line\">          <span class=\"comment\"># Things went well</span></span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\"># $ false &amp;&amp; echo &quot;Will not be printed&quot;</span></span><br><span class=\"line\">          <span class=\"comment\"># $</span></span><br><span class=\"line\">          <span class=\"comment\"># for &amp;&amp; the right command will be executed, only the left command is true</span></span><br><span class=\"line\">          <span class=\"comment\"># for || the left command will be executed, only the left command is false</span></span><br><span class=\"line\">          <span class=\"comment\"># thus when [xxx] is true flag=true will be executed and the last command will</span></span><br><span class=\"line\">          <span class=\"comment\"># not be executed.</span></span><br><span class=\"line\">          <span class=\"comment\"># when [xxx] is false, flag=false will never be executed and the last command</span></span><br><span class=\"line\">          <span class=\"comment\"># will be executed.</span></span><br><span class=\"line\">         [[ $? -eq 0 &amp;&amp; <span class=\"variable\">$num</span> -ge 0 &amp;&amp; <span class=\"variable\">$num</span> -le <span class=\"variable\">$max_light</span> ]] &amp;&amp; flag=<span class=\"literal\">false</span> || <span class=\"built_in\">read</span> -p <span class=\"string\">&quot;please input a number in range (0, <span class=\"variable\">$max_light</span>):&quot;</span> num</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$num</span> &gt; /sys/class/backlight/intel_backlight/brightness</span><br></pre></td></tr></table></figure>\n<h2 id=\"run-tmux-only-open-a-terminal\"><a class=\"markdownIt-Anchor\" href=\"#run-tmux-only-open-a-terminal\"></a> run tmux only open a terminal</h2>\n<p>Add this to the <code>.bashrc</code>.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  Note: the spaces after the [ and before the ] are necessary.</span></span><br><span class=\"line\"><span class=\"comment\"># tmux will be executed only if it is opened by st</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$TERM</span>&quot;</span> = <span class=\"string\">&quot;st-256color&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">\ttmux</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n"},{"title":"C Project","top":false,"cover":false,"toc":true,"description":"C Projects","abbrlink":"85027f36","date":"2022-06-10T09:38:28.000Z","password":null,"summary":null,"_content":"\n# DWM\n","source":"_posts/C-Project.md","raw":"---\ntitle: C Project\ntop: false\ncover: false\ntoc: true\ndescription: C Projects\ncategories:\n  - Programming\n  - Open Source Project\n  - C\ntags:\n  - C\nabbrlink: 85027f36\ndate: 2022-06-10 17:38:28\npassword:\nsummary:\n---\n\n# DWM\n","slug":"C-Project","published":1,"updated":"2022-06-13T07:38:40.681Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpga0009y7ml36q1eiid","content":"<html><head></head><body><h1 id=\"dwm\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#dwm\"></a> DWM</h1>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"dwm\"><a class=\"markdownIt-Anchor\" href=\"#dwm\"></a> DWM</h1>\n"},{"title":"Config Vim","top":false,"cover":false,"toc":true,"mathjax":true,"description":"Vim Configuration","abbrlink":"730c940e","date":"2022-01-20T02:24:34.000Z","password":null,"summary":null,"_content":"\n# 安装 anaconda\n\n本来安装 anaconda 应该问题不大，但是却发现了一个问题。\n`./Anaconda3-2021.11-Linux-x86_64.sh: 489: [[: Exec format error` 这个错，是因为\n直用./Anaconda.sh 启动安装默认用的是 sh 改成了 bash Anaconda.sh 就不会报错了.\n\n# 一些碎的 Linux 知识\n\n## 查找包的安装位置\n\n一些软件用 apt install 了，但是不知道安装位置在哪里 `dpkg -L xxx`显示包的安装位\n置．\n\n## 编译错误定位\n\n编译的时候,打印一些 log 但是并不详细一般会有更加详细的编译 log 文件，在里面可以\n更精确的定位错误发生的原因．\n\n## linux 的环境变量可能是两个\n\n`LIBRARY_PATH`编译的时候用到的库的搜索路径 `LD_LIBRARY_PATH`程序加载时库的搜索路\n径\n\n## 遇到一个问题明明再搜索路径下有动态库，却报错所无法找到\n\nokular: error while loading shared libraries: libQt5Core.so.5: cannot open\nshared object file: No such file or directory 用 strip 处理完之后解决 sudo strip\n--remove-section=.note.ABI-tag /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n\n# 编译 vim\n\napt 安装的 vim 不能随意的控制 vim 的特性，比如在 latex 反向搜索的时候需要的\n+clietservice。 apt-cache search libc-dev ln -s libXtst.so.6 libXtst.so 综合两篇\n博客。 https://www.jianshu.com/p/aa5ea81bbc72\nhttps://toutiao.io/posts/runvgs/preview 尽量多的保留特性，最终得到的 config 命令\n是\n\n```python\n./configure --with-features=huge \\\n    --enable-multibyte \\\n    --enable-rubyinterp=yes \\\n    --enable-python3interp=yes \\\n    --enable-perlinterp=yes \\\n    --enable-cscope \\\n    --enable-fontset \\\n    --enable-largefile \\\n    --enable-fail-if-missing \\\n    --prefix=/path-to-install\n```\n\n`--enable-fail-if-missing` 用于显示错误信息。\n\n## 很久没有成功，最后 apt 安装解决了\n\n编译的时候 feature 用了 hug，但是还是没有增加+clientserver。我估计是缺少库。查\nsrc/auto/cofig.log 也没有发现很相关的信息。最后`sudo apt-get install vim-gtk`成\n功安装了+clientserver 的 vim。\n\n# tmux\n\nTo enable vi key mode in tmux. I mapped `hjkl` for select the pane.\n\n```\nbind -r 'h' select-pane -L  # move left\nbind -r 'j' select-pane -D  # move down\nbind -r 'k' select-pane -U  # move up\nbind -r 'l' select-pane -R  # move right\n```\n\n`r` means I can change the pane continually by click `<prefix>` and twice `k`.\n\n# A practice of vim\n\n## Search and Replace\n\n`:.,$s/old/new/gc`, where `g` means match all for each line and `c` means ask me\nbefore replace at each position. Without `g` only the first match of each line\nwill be considered.\n\n# Why lua instead of vimL(vim script)\n\n## Introduction\n\nNeovim has an embedded lua 5.1 runtime which is used to create faster and more\npowerful extentions of you favorite efitor.\n\n1. VimL is a slow interpreted language with almost no optimizations. Much of the\n   time spent in vim startup and in actions from plugins that can block the main\n   loop in the editor is in parsing and executing vim script.\n\n## How to use lua in command line or vimL file\n\nsee `:h lua`.\n\n- From the vim command line, you can run `lua <you code>`. This is useful for\n  keybindings, commands, and other one-off execution cases.\n- Inside of a vimL file, you can demarcate lua code with the follow code\n  fencing:\n\n```vim\nlua << EOF\n-- your lua code\nEOF\n```\n\n- Inside of a vimL file you can use the `lua` keyword to execute commands\n  similar to the first example,i.e., `lua <your code>`.\n\nOne important note here is that Neovim will look for lua code in the\n`runtimepath` you've set in your settings. Additionally, it will append your\nruntimepath with `/lua/?.lua` and `lua/?/init.lua` so it is common practice to\nsee a `/lua` sub-directory inside `nvim`. For more detailed information about\nwhere Neovim looks for lua code, check out `:h lua-require`.\n\n[More Information](https://github.com/nanotee/nvim-lua-guide)\n\n# Debug vim\n\n1. `:message/:mes` will display the messages that your configuration files\n   print.\n2. `:nmap` or `:imap` can check all the shortcuts of normal or insert mode.\n   `:map` lists the shortcuts of all modes. However, I find that some shortcuts\n   defined can not be find by `:map`.\n\n# A Practice for `Neovim-from-scratch`\n\n## Install\n\n1. Plugins are defined in `~/.config/nvim/lua/user/plugins.lua`. The plugins\n   will fail to be installed due to the internet of China Mainland. Thus, git is\n   asked to be configured with ssh. Then the path of plugins can be changed by\n   add `git@github.com:` before the original path.\n2. `treesitter` is a plugin for syntax-hight. It will install a series of\n   language parsers. They are defined in\n   `~/.config/nvim/lua/user/treesitter.lua`. By setting\n   `ensure_installed = {'astro', 'xxx'}`, we can define the parsers to be\n   download. Also, download errors may be occurred due to the internet. The path\n   of these language parsers are defined in\n   `~/.local/share/nvim/site/pack/packer/start/nvim-treesitter/lua/nvim-treesitter/parsers.lua`,\n   which may be changed by download with ssh.\n\n## Analysis\n\n1. There are 21 files required in `init.lua`. They are exactly the 21 files in\n   `lua/user` folder. About 34 plugins are defined in `plugins.lua`. The lua\n   files are all the configuration file of the plugins defined in `plugins.lua`,\n   except for `keymaps.lua`, `option.lua`, `autocommand.lua`. `plugins.lua`\n   itself is the configuration file of `packer.nvim`, a plugin manager.\n2. Here gives a brief look at the plugins.\n\n   1. `packer.nvim` is a plugin manager.\n   2. `Alpha-vim` is a plugin used by Neovim-from-scratch. It allow one to\n      custom the greeter for neovim\n   3. `popup.nvim`, An implementation of the Popup API from vim in neovim.\n   4. `plenary.nvim`, implement some useful window management items for neovim.\n   5. `nvim-autopais` A super powerful auto pair plugin for neovim that supports\n      multiple characters.\n   6. `Comment.nvim` Smart and Powerful commenting plugin for neovim.\n   7. `nvim-web-devicons` A lua fork of `vim-devicons`. This plugin provides the\n      same icons as well as colors for each icon\n   8. `nvim-tree-lua` A file explorer for neovim written in lua.\n   9. `bufferline.nvim` A snazzy buffer line (with tabpage integration) for\n      neovim built using lua.\n   10. `vim-bbye` Bbye allows you to do delete buffers (close files) without\n       colosing you windows or messing up your layout.\n   11. `lualine.nvim` A blazing fast and easy to configure neovim status line\n       written in lua.\n   12. `toggleterm.nvim` A neovim plugin to persist and toggle multiple\n       terminals during an editing session.\n   13. `project.nvim` an all in one neovim plugin written in lua that provides\n       superior project management.\n   14. `impatient.nvim` speed up loading lua modules in neovim to improve start\n       up time.\n   15. `indent-blankline.nvim` adds indentation guides to all lines (including\n       empty lines.)\n   16. `FixCursorHold.nvim` This is needed to fix lsp doc highlight.\n   17. `which-key.nvim` a lua plugin that displays a popup with possible key\n       bindings of the command you started typing.\n   18. `darkplus.nvim` color themes\n   19. `nvim-cmp` The completion plugin\n   20. `cmp-buffer` buffer completions\n   21. `cmp-path` path completions\n   22. `cmp-cmdline` cmdline completions\n   23. `cmp_luasnip` snippet completions.\n   24. `cmp-nvim-lsp` nvim-cmp source for neovim's built-in language server\n       client.\n   25. `LuaSnip` snippet engin\n   26. `friendly-snippets` a bunch of snippets to use\n   27. `nvim-lspconfig` A collection of common configurations for neovim's\n       built-in language server clinet. Features: go-to-definition,\n       find-references, hover, completion, rename, format, refactor.\n   28. `nvim-lsp-installer` allows you to seamlessly install LSP server\n       locally(inside `:echo stdpaht(\"data\")`)\n   29. `nlsp-settings.nvim` A plugin to configure LSP using json/yaml files like\n       `coc-setting.json`\n   30. `null-ls.nvim` for formatters and linters, use neovim as a language\n       server to inject LSP diagnostic, code actions, and more via lua\n   31. `telescope.nvim` a highly extendable fuzzy finder over lists.\n   32. `nvim-treesitter` both provide a simple and easy way to use the interface\n       for `tree-sitter` in neovim and to provide some basic functionality such\n       as highlighting based on it.\n   33. `nvim-ts-context-commentstring\"` setting `comment string` option based on\n       the cursor location in the file. The location is checked via treesitter\n       queries.\n   34. `gitsigns.nvim` Git\n\n3. The plugins are installed in `~/.local/share/nvim/site/pack/packer/start`,\n   which is defined in the `install_path` in `plugins.lua`.\n\n# Analyze `LunarVim`\n\n## The Install Script `install.sh`\n\n25 functions are defined in `install.sh`.\n\n```tex\n    __attempt_to_install_with_cargo\n    __install_nodejs_deps_npm\n    __install_nodejs_deps_pnpm\n    __install_nodejs_deps_yarn\n    __validate_node_installation\n    backup_old_config\n    check_neovim_min_version\n    check_system_deps\n    clone_lvim\n    detect_platform\n    install_nodejs_deps\n    install_python_deps\n    install_rust_deps\n    link_local_lvim\n    main\n    msg\n    parse_arguments\n    print_logo\n    print_missing_dep_msg\n    remove_old_cache_files\n    setup_lvim\n    setup_shim\n    usage\n    validate_lunarvim_files\n    verify_lvim_dirs\n```\n\nThe last line `main \"$@\"` shows that it well execute the `main` function first.\n`$@` means that all the args will be passed to the function.\n\n### Function `main`\n\n```bash\nfunction main() {\n# function parse_arguments is defined to parse the arguments passed by\n# \"$@$\"\n  parse_arguments \"$@\"\n\n  # print the logo of lunarvim\n  print_logo\n\n  msg \"Detecting platform for managing any additional neovim dependencies\"\n  detect_platform\n  # check if the git and neovim is installed\n  check_system_deps\n\n  if [ \"$ARGS_INSTALL_DEPENDENCIES\" -eq 1 ]; then\n    if [ \"$INTERACTIVE_MODE\" -eq 1 ]; then\n      msg \"Would you like to install LunarVim's NodeJS dependencies?\"\n      read -p \"[y]es or [n]o (default: no) : \" -r answer\n      [ \"$answer\" != \"${answer#[Yy]}\" ] && install_nodejs_deps\n\n      msg \"Would you like to install LunarVim's Python dependencies?\"\n      read -p \"[y]es or [n]o (default: no) : \" -r answer\n      [ \"$answer\" != \"${answer#[Yy]}\" ] && install_python_deps\n\n      msg \"Would you like to install LunarVim's Rust dependencies?\"\n      read -p \"[y]es or [n]o (default: no) : \" -r answer\n      [ \"$answer\" != \"${answer#[Yy]}\" ] && install_rust_deps\n    else\n      install_nodejs_deps\n      install_python_deps\n      install_rust_deps\n    fi\n  fi\n\n  # backup old config of lunarvim if it is installed before\n  backup_old_config\n  # if the paths are not already, mkdir them\n  verify_lvim_dirs\n\n  if [ \"$ARGS_LOCAL\" -eq 1 ]; then\n    link_local_lvim\n  elif [ -d \"$LUNARVIM_BASE_DIR\" ]; then\n    validate_lunarvim_files\n  else\n    clone_lvim\n  fi\n\n  setup_lvim\n\n  msg \"Thank you for installing LunarVim!!\"\n  echo \"You can start it by running: $INSTALL_PREFIX/bin/lvim\"\n  echo \"Do not forget to use a font with glyphs (icons) support [https://github.com/ryanoasis/nerd-fonts]\"\n}\n```\n\n### Function `clone_lvim`\n\n```bash\nfunction clone_lvim() {\n  msg \"Cloning LunarVim configuration\"\n  if ! git clone --branch \"$LV_BRANCH\" \\\n    # to download by ssh, change this line to\n    # `--depth 1 \"git@github.com:LunarVim/LunarVim.git\" \"$LUNARVIM_BASE_DIR\"; then`\n    --depth 1 \"https://github.com/${LV_REMOTE}\" \"$LUNARVIM_BASE_DIR\"; then\n    echo \"Failed to clone repository. Installation failed.\"\n    exit 1\n  fi\n}\n```\n\n### Function `setup_lvim`\n\n```bash\nfunction setup_lvim() {\n\n  remove_old_cache_files\n\n  msg \"Installing LunarVim shim\"\n\n  # output the executable file of `lvim` which lies in `~/.local/bin/lvim`\n  setup_shim\n\n  cp \"$LUNARVIM_BASE_DIR/utils/installer/config.example.lua\" \"$LUNARVIM_CONFIG_DIR/config.lua\"\n\n  echo \"Preparing Packer setup\"\n\n  # Prepare Packer, this is done by `nvim -u init.lua --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'`\n  # `--headless` means Don't start a user interface.\n  # `-c <cmd>` means Execute <cmd> after config and first file\n\n  # packer is often failed to be setup due to the network of the China Mainland\n\n  # Packer's operation are asynchronous. Previously, to install plugins in a non\n  # -interactive way, `nvim + PackerSync + 30sleep + quitall`.\n  # It is not ideal since we do not really know that after 30 seconds, the plugin\n  # install process should finish.\n  # A more ideal way is to use autocmd PackerComplete\n  # https://github.com/wbthomason/packer.nvim/blob/master/doc/packer.txt#L479\n  # provided by Packer\n  # `nvim -c 'autocmd User PackerComplete quitall' -c 'PackerSync'`\n  # PackerComplete xxx: Fires xxx after install, update, clean, and sync\n  # asynchronous operations finish\n  # PackerSync: Perform 'PackerUpdate' and then 'PackerCompile'\n  # PackerUpdate: Clean, then update and install plugins\n  # PackerCompile: You must run this or 'PackerSync' whenever you make\n  # changes to your plugin configuration. Regenerate compiled loader file.\n\n  \"$INSTALL_PREFIX/bin/lvim\" --headless \\\n    -c 'autocmd User PackerComplete quitall' \\\n    -c 'PackerSync'\n\n  echo \"Packer setup complete\"\n}\n```\n\n### Function `setup_shim`\n\n```bash\nfunction setup_shim() {\n #  make -C ~/.local/share/lunarvim/lvim install-bin\n # `-C` specifies the directory of `Makefile`\n # `install-bin` is a target defined in `Makefile`\n # install-bin:\n #\t@echo starting LunarVim bin-installer\n #\tbash ./utils/installer/install_bin.sh\n # This command outputs `~/.local/bin/lvim`, the executable file of `lvim`,\n\n  make -C \"$LUNARVIM_BASE_DIR\" install-bin\n}\n```\n\nThe `~/.local/bin/lvim` is\n\n```bash\n#!/bin/sh\n\nexport LUNARVIM_RUNTIME_DIR=\"${LUNARVIM_RUNTIME_DIR:-\"~/.local/share/lunarvim\"}\"\nexport LUNARVIM_CONFIG_DIR=\"${LUNARVIM_CONFIG_DIR:-\"~/.config/lvim\"}\"\nexport LUNARVIM_CACHE_DIR=\"${LUNARVIM_CACHE_DIR:-\"~/.cache/nvim\"}\"\n\n # `exec` is a builtin command of the Bash shell. It allows you to execute a\n # command that completely replaces the current process. The current shell process\n # is destroyed, and entirely replaced by the command you specify.\n # `-u` means use this config file, which is `~/.config/share/lunarvim/lvim/init.lua`\nexec nvim -u \"$LUNARVIM_RUNTIME_DIR/lvim/init.lua\" \"$@\"\n\n```\n\n### Function `msg`\n\nMessage or log is an effective tool to debug and make the users know the detail\nof the programming. Instead of simply using `print/echo` function, most\nprogrammers define their message functions to enable effective message giving.\nHave a look at this message function.\n\n```bash\nfunction msg() {\n# local variable receives the message needed to be print.\n  local text=\"$1\"\n  local div_width=\"80\"\n  # before print the message a line comprised of `-` will be printed.\n  # it will makes the message easily been noticed.\n  # div_width gives the width of the line.\n  printf \"%${div_width}s\\n\" ' ' | tr ' ' -\n  printf \"%s\\n\" \"$text\"\n}\n```\n\n## ABout the init process\n\n### The `init.lua`\n\n```lua\n-- init_path = '~/.local/share/lunarvim/lvim/init.lua'\n-- base_dir = '~/.local/share/lunarvim/lvim/'\nlocal init_path = debug.getinfo(1, \"S\").source:sub(2)\nlocal base_dir = init_path:match(\"(.*[/\\\\])\"):sub(1, -2)\n\n-- vim.opt return a option object\n-- rtp mean runtimepath\nif not vim.tbl_contains(vim.opt.rtp:get(), base_dir) then\n  vim.opt.rtp:append(base_dir)\nend\n-- bootstrap file is in lua/lvim/, which is the guide file of lvim\n-- NOTICE THAT, the end of the bootstrap file, return a local module M,\n-- which is defined at the beginning of the file.\n-- Thus, the term :init(base_dir) runs the init function of module M.\nrequire(\"lvim.bootstrap\"):init(base_dir)\n\nrequire(\"lvim.config\"):load()\n\n-- the plugins are defined in lua/lvim/plugins.lua\nlocal plugins = require \"lvim.plugins\"\n\n-- the same as init funtion in bootstrap, `load` is a function of the module in\n-- plugins-loader\n\nrequire(\"lvim.plugin-loader\").load { plugins, lvim.plugins }\n\nlocal Log = require \"lvim.core.log\"\nLog:debug \"Starting LunarVim\"\n\nlocal commands = require \"lvim.core.commands\"\ncommands.load(commands.defaults)\n\nrequire(\"lvim.lsp\").setup()\n```\n\n### The `Bootstrap:init`\n\n```lua\n---Initialize the `&runtimepath` variables and prepare for startup\n---@return table\nfunction M:init(base_dir)\n  self.runtime_dir = get_runtime_dir()\n  self.config_dir = get_config_dir()\n  self.cache_dir = get_cache_dir()\n  self.pack_dir = join_paths(self.runtime_dir, \"site\", \"pack\")\n  self.packer_install_dir = join_paths(self.runtime_dir, \"site\", \"pack\", \"packer\", \"start\", \"packer.nvim\")\n  self.packer_cache_path = join_paths(self.config_dir, \"plugin\", \"packer_compiled.lua\")\n\n  ---Get the full path to LunarVim's base directory\n  ---@return string\n  function _G.get_lvim_base_dir()\n    return base_dir\n  end\n\n  if os.getenv \"LUNARVIM_RUNTIME_DIR\" then\n    -- vim.opt.rtp:append(os.getenv \"LUNARVIM_RUNTIME_DIR\" .. path_sep .. \"lvim\")\n    vim.opt.rtp:remove(join_paths(vim.fn.stdpath \"data\", \"site\"))\n    vim.opt.rtp:remove(join_paths(vim.fn.stdpath \"data\", \"site\", \"after\"))\n    vim.opt.rtp:prepend(join_paths(self.runtime_dir, \"site\"))\n    vim.opt.rtp:append(join_paths(self.runtime_dir, \"site\", \"after\"))\n\n    vim.opt.rtp:remove(vim.fn.stdpath \"config\")\n    vim.opt.rtp:remove(join_paths(vim.fn.stdpath \"config\", \"after\"))\n    vim.opt.rtp:prepend(self.config_dir)\n    vim.opt.rtp:append(join_paths(self.config_dir, \"after\"))\n    -- TODO: we need something like this: vim.opt.packpath = vim.opt.rtp\n\n    vim.cmd [[let &packpath = &runtimepath]]\n  end\n\n  -- FIXME: currently unreliable in unit-tests\n  if not in_headless then\n    _G.PLENARY_DEBUG = false\n    require(\"lvim.impatient\").setup {\n      path = join_paths(self.cache_dir, \"lvim_cache\"),\n      enable_profiling = true,\n    }\n  end\n\n  require(\"lvim.config\"):init()\n\n  require(\"lvim.plugin-loader\").init {\n    package_root = self.pack_dir,\n    install_path = self.packer_install_dir,\n  }\n\n  return self\nend\n```\n\n### The `config` function in `builtin` folder\n\nFor some plugins, such as `whichkey` and `telescope`, there are `M.config`\nfunctions in their configuration files. However, the `setup` function only uses\nsome variable defined in them and do not execute them first. The are executed by\nthe `init.lua` in the `builtin` folder.\n\n```lua\nfunction M.config(config)\n  for _, builtin_path in ipairs(builtins) do\n    local builtin = require(builtin_path)\n    builtin.config(config)\n  end\nend\n```\n\nDuring the lunch process, the `config` functions will be called in front of the\nfunctions defined in the configuration file `config.lua`.\n\n## The nerd-fonts\n\nThe font is only related to your local devices. It is not related to the remote\ndevice.\n\nTo install the nerd fonts, you need to download the nerd version of your fonts,\nfor example I use `hack`, though\n[this](https://www.nerdfonts.com/font-downloads) or\n[this](https://github.com/ryanoasis/nerd-fonts). Then put it in your font\ndirectory. For windows, it is `C:\\Windows\\Fonts`. Finally, restart your terminal\nand set your terminal such as mobaxterm to use that font.\n\n## Debug system\n\n### lvim.log\n\n1. The file is in `~/.cache/` which is defined by\n   `~/.local/share/lunarvim/lvim/lua/lvim/core/log.lua`. Using `Log:warn/debug`\n   will write logs in the file.\n2. `lvim.log.level` controls the level that will be print into the `lvim.log`\n   (see `local log_level = Log.levels[(lvim.log.level):upper() or \"WARN\"]` in\n   the `log.lua`. `function Log:get_path()` sets the path and name of the log\n   file.\n3. `log.lua` used `structlog` which is a plugin of nvim defined in the\n   `plugins.lua`. In the readme of `structlog`:\n   > `structlog` makes logging in lua less painful and more powerful by adding\n   > structure to your log entries.\n\n## Plugins\n\n### yank\n\nIn the visual mode of `lunarvim`, `y` will yank the select chars into the system\nclipboard automatically. Do not use `\"+Y`, which will yank the whole line.\n`\"[~+]y` is also available.\n\n### `project.nvim`\n\nIf open vim in a subdirectory of a git package, and then open a new tmux pane or\nwindow, its initial path will be the main directory of that git package. The\n`manual mode` in `~/.local/share/lunarvim/lvim/lua/lvim/core/project.lua`\ndetermines vim change the directory or not.\n\n#### With lsp\n\nIn the readme of `project`.\n\n> Automagically cd to project directory using nvim lsp. If not then uses pattern\n> matching to cd to root directory\n\nThis means that lsp has the function to find the project directories.\n\n### Telescope\n\nThe `telescope` is depended on `fd`. To install `fd` do not use\n`apt install fdclone` which causes a collapse of nvim when run `telescope`.\n\n#### Telescope in which key\n\n`~/.local/share/lunarvim/lvim/lua/lvim/core/which-key.lua` defines many which\nkey mapping related to telescope. <leader>f can find the files in git repos\nwhich is the feature provided by `telescope.builtin` (see the document of\ntelescope). `<leader>sf` can find the files in current directory.\n\n### `Comment`\n\nAn error occur with `Comment` when open `lvim`, which is solved by adding\n`tag = 'v0.6',` to the `plugins.lua` file the Comment part.\n\n### Treesitter\n\n#### Parsers install\n\n11 parsers are defined to be installed in `~/.config/lvim/config.lua`\n\nParsers often failed to be downloaded. See\n`https://github.com/nvim-treesitter/nvim-treesitter#adding-parsers`. One can\ndownload it manually. And change the url of the parsers.\n\n[parsers](https://github.com/nvim-treesitter/nvim-treesitter#language-parsers)\n\n> parser for every language need to be generated via `tree-sitter-cli` from\n> `grammer.js` file, then complied to a `.so` library that needd to be placed in\n> neovim's `runtimepath` (typically under `parser/{language}.so`). To simplify\n> this, `nvim-treesitter` provides commands to automate this process. If the\n> language is already supported by `nvim-treesitter` you can install it with\n> `TSInstall <language>`\n\nThe `{language}.so` files are in\n`~/.local/share/lunarvim/site/pack/packer/start/nvim-treesitter.git/parser`.\n\n<!-- #### Notice -->\n\n<!-- treestter may not always perform a good highlight, e.g., for markdown or tex -->\n<!-- files. -->\n\n### About `packer`\n\n1. the some plugins are installed in `opt` directory. Some are installed in\n   `start` directory. This is controlled by the settings in `plugins.lua`. 7\n   plugins are installed in `opt` directory, 6 of which are setted `event` and\n   only the 6 plugins are setted it. `lua-dev` is setted `module`.\n\n   > module = string or list -- Specifies lua module name for require. When\n   > requiring a string which starts with one of these module names, the plugin\n   > will be loaded.\n\n   > event = string or list, -- Specifies auto command events which load this\n   > plugin\n\n   In the Readme of `Packer`\n\n   > `use` takes either a string or a table. If a string is provided, it is\n   > treated as a plugin location (link) for a non-optional plugin with no\n   > additional configuration.\n\n   [Opt](https://github.com/wbthomason/packer.nvim/issues/237#issuecomment-787457600)\n\n   > `start` packages are always available and loaded every time you start nvim,\n   > while `opt` packages are loaded on-demand with the `packadd` command. This\n   > is what `packer` uses to conditionally load plugins. `packer` itself\n   > doesn't run any code until you call `require('packer')`, so it should be\n   > fine to keep it as a start package.\n\n   [Opt](https://github.com/wbthomason/packer.nvim/discussions/823#discussioncomment-2184455)\n\n### LSP\n\n#### The setup process\n\n1. the setup function of a lsp server is defined by the files in\n   ` ~/.local/share/lunarvim/site/after/ftplugin`. `ftplugin` directory means\n   file type plugin. Vim will auto load this directory when it is in the runtime\n   path. However, only the `filetype.lua/vim` will be loaded when open a file of\n   particular filetype. ` ~/.local/share/lunarvim/site/after/ftplugin` is\n   created by `~/.local/share/lunarvim/lvim/lua/lvim/lsp/templates.lua` (see\n   line 67). The server list is given in line 58. The content in the files in\n   ftplugins is given in line 40. The `ft.lua` will call `lvim.lsp.manager`\n   which is a function defined in\n   `~/.local/share/lunarvim/lvim/lua/lvim/lsp/manager.lua`. It setup the lsp\n   servers since when `ft.lua` is removed, the lsp server will not start.\n2. The configuration files of `nvim-lspconfig` are listed in\n   `~/.local/share/lunarvim/site/pack/packer/start/nvim-lspconfig.git/lua/lspconfig/server_configurations`.\n   Which can be modified.\n3. The servers installed by `lsp-installer` are installed in\n   `~/.local/share/nvim/lsp_servers`\n4. see `setup` function in `manager.lua`\n\n```lua\nfunction M.setup(server_name, user_config)\n  vim.validate { name = { server_name, \"string\" } }\n\n\n  if lvim_lsp_utils.is_client_active(server_name) or client_is_configured(server_name) then\n    return\n  end\n\n\n  local config = resolve_config(server_name, user_config)\n\n  local servers = require \"nvim-lsp-installer.servers\"\n  local server_available, requested_server = servers.get_server(server_name)\n\n  -- if not server available in nvim-lsp-installer, call lspconfig[server_name].setup(config)\n  -- if the server is  available it will be set up by nvim-lsp-installer.\n  -- that is to say all the servers will preferentially be set upped by nvim-lsp-installer.\n\n  -- NOTE THAT\n\n  -- Most servers will be set uppped by nvim-lsp-installer by this way.\n  if not server_available then\n    -- The pcall function calls its first argument in protected mode, so that it\n    -- catches any errors while the function is running. If there are no errors, pcall\n    -- returns true, plus any values returned by the call. Otherwise, it returns false,\n    -- plus the error message.\n    pcall(function()\n      require(\"lspconfig\")[server_name].setup(config)\n      buf_try_add(server_name)\n    end)\n    return\n  end\n\n  local install_notification = false\n\n  if not requested_server:is_installed() then\n    if lvim.lsp.automatic_servers_installation then\n      Log:debug \"Automatic server installation detected\"\n      requested_server:install()\n      install_notification = true\n    else\n      Log:debug(requested_server.name .. \" is not managed by the automatic installer\")\n    end\n  end\n\n  requested_server:on_ready(function()\n    if install_notification then\n      -- `vim.notify` is defined in `log.lua` in lvim folder.\n      -- > `vim.notify` A fancy, configurable, notification manager for NeoVim.\n      -- `vim.log.levels.INFO` is defined in the `lua-dev` plunin defined in `plugins.lua`.\n      -- > `lua-dev` setup for init.lua and plugin development with full signature help,\n      -- > docs and completion for the nvim lua API.\n      -- i do not find where the vim.log.levels is required by `manager.lua`.\n      -- I think vim.log.levels must be in the search path of nvim thus it can find it\n      -- though the search path.\n      vim.notify(string.format(\"Installation complete for [%s] server\", requested_server.name), vim.log.levels.INFO)\n    end\n    install_notification = false\n    requested_server:setup(config)\n    -- Log:warn(config)\n  end)\nend\n```\n\nFrom the code we know that most of the servers will be setup by\n`nvim-lsp-installer` (see `requested_server:setup(config)`). However, thought\nthis the configuration for manually setup server is not works. From the document\nof `nvim-lsp-installer`,\n[server.setup](https://github.com/williamboman/nvim-lsp-installer/blob/40442b67a151fc2a58a790fd7e74a7487f1f9157/doc/nvim-lsp-installer.txt#L349)\nis deprecated. Thus I change the `setup` function in `manager.lua`.\n\n```lua\nfunction M.setup(server_name, user_config)\n  vim.validate { name = { server_name, \"string\" } }\n\n\n  if lvim_lsp_utils.is_client_active(server_name) or client_is_configured(server_name) then\n    return\n  end\n\n\n  local config = resolve_config(server_name, user_config)\n\n  local servers = require \"nvim-lsp-installer.servers\"\n  local server_available, requested_server = servers.get_server(server_name)\n\n  -- if the server is installed then setup by lspconfig\n  if requested_server:is_installed() then\n    pcall(function()\n      require(\"lspconfig\")[server_name].setup(config)\n      buf_try_add(server_name)\n    end)\n    return\n  end\n\n  local install_notification = false\n\n  -- if the server is not installed, install it\n  if not requested_server:is_installed() then\n    if lvim.lsp.automatic_servers_installation then\n      Log:debug \"Automatic server installation detected\"\n      requested_server:install()\n      install_notification = true\n    else\n      Log:debug(requested_server.name .. \" is not managed by the automatic installer\")\n    end\n  end\n\n  requested_server:on_ready(function()\n    if install_notification then\n      vim.notify(string.format(\"Installation complete for [%s] server\", requested_server.name), vim.log.levels.INFO)\n    end\n    install_notification = false\n    -- requested_server:setup(config)\n  end)\nend\n```\n\n#### the relationship between `lspconfig` and `null-ls`\n\n1. Both of them can use `latexindent` to format the tex file\n2. `lspconfig` can not use `prettier`.\n\nThus `null-ls` provide an extension tools for `lspconfig`. When `lspconfig` can\nmatch our requirement, we do not need to use `null-ls`, e.g., tools for tex\nfile.\n\n#### the relationship between `lspconfig` and `lsp-installer`\n\n1. `lsp-installer` depends on `lspconfig` as in the readme of `lsp-installer`.\n2. lvim strives to have support for all major languages. This is made possible\n   by plugins such as `nvim-lspconfig`, for LSP support, and `null-ls` to\n   provide support for handing external formatters, such as `prettier` and\n   `eslint`.\n\n`lua print(vim.inspect(vim.lsp.buf_get_clients()[2].resolved_capabilities))` see\nthe detail of server clients.\n\n#### Code Action\n\nCode action = quick fixes and refactoring\n\n### The lualine\n\nThe status line is defined in\n`~/.local/share/lunarvim/lvim/lua/lvim/core/lualine/init.lua` line 5 which can\nbe chose as `default`, `lvim`, or `none`. The are defined in the\n`~/.local/share/lunarvim/lvim/lua/lvim/core/lualine/styles.lua` file. The\ncomponent are defined in\n`~/.local/share/lunarvim/lvim/lua/lvim/core/lualine/components.lua`.\n\n### The whichkey\n\nWhich key can define key mappings for vim. They are defined in\n`~/.local/share/lunarvim/lvim/lua/lvim/core/which-key.lua`. The use of\n`telescope` can be learned by reading `which-key.lua`, since the key mapping of\n`telescope` is defined in it.\n\nThe lsp also used which key, which is defined in\n`~/.local/share/lunarvim/lvim/lua/lvim/lsp/config.lua` and used/registered in\n`~/.local/share/lunarvim/lvim/lua/lvim/lsp/init.lua`. Which key makes the key\nmappings more organized.\n\n#### Modify which key map\n\nTo modify which key maps, for example, `<leader>sp` is defined in\n`whichkey.lua`. I want to change it in `config.lua`.\n`lvim.builtin.which_key.mappings[\"sp\"] = { \"<CMD>Telescope projects<CR>\", \"Project\" }`\ndoes not work.\n\n`lvim.builtin.which_key.mappings.s[\"p\"] = { \"<CMD>Telescope projects<CR>\", \"Project\" }`\nworks. `lvim.builtin.which_key.mappings.s` is a table, and the `config` function\nin `which-key.lua` is executed in front of the `config.lua`. So that the value\nof key `p` can be modified.\n\n### The alpha\n\nThe start cover is defined in\n`~/.local/share/lunarvim/lvim/lua/lvim/core/alpha/startify.lua`.\n\n### nvim-notify\n\nThe notation manager and message manager for nvim.\n","source":"_posts/Config-Vim.md","raw":"---\ntitle: Config Vim\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndescription: Vim Configuration\ncategories:\n  - Programming\n  - Tools\n  - Vim\ntags:\n  - Vim\nabbrlink: 730c940e\ndate: 2022-01-20 10:24:34\npassword:\nsummary:\n---\n\n# 安装 anaconda\n\n本来安装 anaconda 应该问题不大，但是却发现了一个问题。\n`./Anaconda3-2021.11-Linux-x86_64.sh: 489: [[: Exec format error` 这个错，是因为\n直用./Anaconda.sh 启动安装默认用的是 sh 改成了 bash Anaconda.sh 就不会报错了.\n\n# 一些碎的 Linux 知识\n\n## 查找包的安装位置\n\n一些软件用 apt install 了，但是不知道安装位置在哪里 `dpkg -L xxx`显示包的安装位\n置．\n\n## 编译错误定位\n\n编译的时候,打印一些 log 但是并不详细一般会有更加详细的编译 log 文件，在里面可以\n更精确的定位错误发生的原因．\n\n## linux 的环境变量可能是两个\n\n`LIBRARY_PATH`编译的时候用到的库的搜索路径 `LD_LIBRARY_PATH`程序加载时库的搜索路\n径\n\n## 遇到一个问题明明再搜索路径下有动态库，却报错所无法找到\n\nokular: error while loading shared libraries: libQt5Core.so.5: cannot open\nshared object file: No such file or directory 用 strip 处理完之后解决 sudo strip\n--remove-section=.note.ABI-tag /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n\n# 编译 vim\n\napt 安装的 vim 不能随意的控制 vim 的特性，比如在 latex 反向搜索的时候需要的\n+clietservice。 apt-cache search libc-dev ln -s libXtst.so.6 libXtst.so 综合两篇\n博客。 https://www.jianshu.com/p/aa5ea81bbc72\nhttps://toutiao.io/posts/runvgs/preview 尽量多的保留特性，最终得到的 config 命令\n是\n\n```python\n./configure --with-features=huge \\\n    --enable-multibyte \\\n    --enable-rubyinterp=yes \\\n    --enable-python3interp=yes \\\n    --enable-perlinterp=yes \\\n    --enable-cscope \\\n    --enable-fontset \\\n    --enable-largefile \\\n    --enable-fail-if-missing \\\n    --prefix=/path-to-install\n```\n\n`--enable-fail-if-missing` 用于显示错误信息。\n\n## 很久没有成功，最后 apt 安装解决了\n\n编译的时候 feature 用了 hug，但是还是没有增加+clientserver。我估计是缺少库。查\nsrc/auto/cofig.log 也没有发现很相关的信息。最后`sudo apt-get install vim-gtk`成\n功安装了+clientserver 的 vim。\n\n# tmux\n\nTo enable vi key mode in tmux. I mapped `hjkl` for select the pane.\n\n```\nbind -r 'h' select-pane -L  # move left\nbind -r 'j' select-pane -D  # move down\nbind -r 'k' select-pane -U  # move up\nbind -r 'l' select-pane -R  # move right\n```\n\n`r` means I can change the pane continually by click `<prefix>` and twice `k`.\n\n# A practice of vim\n\n## Search and Replace\n\n`:.,$s/old/new/gc`, where `g` means match all for each line and `c` means ask me\nbefore replace at each position. Without `g` only the first match of each line\nwill be considered.\n\n# Why lua instead of vimL(vim script)\n\n## Introduction\n\nNeovim has an embedded lua 5.1 runtime which is used to create faster and more\npowerful extentions of you favorite efitor.\n\n1. VimL is a slow interpreted language with almost no optimizations. Much of the\n   time spent in vim startup and in actions from plugins that can block the main\n   loop in the editor is in parsing and executing vim script.\n\n## How to use lua in command line or vimL file\n\nsee `:h lua`.\n\n- From the vim command line, you can run `lua <you code>`. This is useful for\n  keybindings, commands, and other one-off execution cases.\n- Inside of a vimL file, you can demarcate lua code with the follow code\n  fencing:\n\n```vim\nlua << EOF\n-- your lua code\nEOF\n```\n\n- Inside of a vimL file you can use the `lua` keyword to execute commands\n  similar to the first example,i.e., `lua <your code>`.\n\nOne important note here is that Neovim will look for lua code in the\n`runtimepath` you've set in your settings. Additionally, it will append your\nruntimepath with `/lua/?.lua` and `lua/?/init.lua` so it is common practice to\nsee a `/lua` sub-directory inside `nvim`. For more detailed information about\nwhere Neovim looks for lua code, check out `:h lua-require`.\n\n[More Information](https://github.com/nanotee/nvim-lua-guide)\n\n# Debug vim\n\n1. `:message/:mes` will display the messages that your configuration files\n   print.\n2. `:nmap` or `:imap` can check all the shortcuts of normal or insert mode.\n   `:map` lists the shortcuts of all modes. However, I find that some shortcuts\n   defined can not be find by `:map`.\n\n# A Practice for `Neovim-from-scratch`\n\n## Install\n\n1. Plugins are defined in `~/.config/nvim/lua/user/plugins.lua`. The plugins\n   will fail to be installed due to the internet of China Mainland. Thus, git is\n   asked to be configured with ssh. Then the path of plugins can be changed by\n   add `git@github.com:` before the original path.\n2. `treesitter` is a plugin for syntax-hight. It will install a series of\n   language parsers. They are defined in\n   `~/.config/nvim/lua/user/treesitter.lua`. By setting\n   `ensure_installed = {'astro', 'xxx'}`, we can define the parsers to be\n   download. Also, download errors may be occurred due to the internet. The path\n   of these language parsers are defined in\n   `~/.local/share/nvim/site/pack/packer/start/nvim-treesitter/lua/nvim-treesitter/parsers.lua`,\n   which may be changed by download with ssh.\n\n## Analysis\n\n1. There are 21 files required in `init.lua`. They are exactly the 21 files in\n   `lua/user` folder. About 34 plugins are defined in `plugins.lua`. The lua\n   files are all the configuration file of the plugins defined in `plugins.lua`,\n   except for `keymaps.lua`, `option.lua`, `autocommand.lua`. `plugins.lua`\n   itself is the configuration file of `packer.nvim`, a plugin manager.\n2. Here gives a brief look at the plugins.\n\n   1. `packer.nvim` is a plugin manager.\n   2. `Alpha-vim` is a plugin used by Neovim-from-scratch. It allow one to\n      custom the greeter for neovim\n   3. `popup.nvim`, An implementation of the Popup API from vim in neovim.\n   4. `plenary.nvim`, implement some useful window management items for neovim.\n   5. `nvim-autopais` A super powerful auto pair plugin for neovim that supports\n      multiple characters.\n   6. `Comment.nvim` Smart and Powerful commenting plugin for neovim.\n   7. `nvim-web-devicons` A lua fork of `vim-devicons`. This plugin provides the\n      same icons as well as colors for each icon\n   8. `nvim-tree-lua` A file explorer for neovim written in lua.\n   9. `bufferline.nvim` A snazzy buffer line (with tabpage integration) for\n      neovim built using lua.\n   10. `vim-bbye` Bbye allows you to do delete buffers (close files) without\n       colosing you windows or messing up your layout.\n   11. `lualine.nvim` A blazing fast and easy to configure neovim status line\n       written in lua.\n   12. `toggleterm.nvim` A neovim plugin to persist and toggle multiple\n       terminals during an editing session.\n   13. `project.nvim` an all in one neovim plugin written in lua that provides\n       superior project management.\n   14. `impatient.nvim` speed up loading lua modules in neovim to improve start\n       up time.\n   15. `indent-blankline.nvim` adds indentation guides to all lines (including\n       empty lines.)\n   16. `FixCursorHold.nvim` This is needed to fix lsp doc highlight.\n   17. `which-key.nvim` a lua plugin that displays a popup with possible key\n       bindings of the command you started typing.\n   18. `darkplus.nvim` color themes\n   19. `nvim-cmp` The completion plugin\n   20. `cmp-buffer` buffer completions\n   21. `cmp-path` path completions\n   22. `cmp-cmdline` cmdline completions\n   23. `cmp_luasnip` snippet completions.\n   24. `cmp-nvim-lsp` nvim-cmp source for neovim's built-in language server\n       client.\n   25. `LuaSnip` snippet engin\n   26. `friendly-snippets` a bunch of snippets to use\n   27. `nvim-lspconfig` A collection of common configurations for neovim's\n       built-in language server clinet. Features: go-to-definition,\n       find-references, hover, completion, rename, format, refactor.\n   28. `nvim-lsp-installer` allows you to seamlessly install LSP server\n       locally(inside `:echo stdpaht(\"data\")`)\n   29. `nlsp-settings.nvim` A plugin to configure LSP using json/yaml files like\n       `coc-setting.json`\n   30. `null-ls.nvim` for formatters and linters, use neovim as a language\n       server to inject LSP diagnostic, code actions, and more via lua\n   31. `telescope.nvim` a highly extendable fuzzy finder over lists.\n   32. `nvim-treesitter` both provide a simple and easy way to use the interface\n       for `tree-sitter` in neovim and to provide some basic functionality such\n       as highlighting based on it.\n   33. `nvim-ts-context-commentstring\"` setting `comment string` option based on\n       the cursor location in the file. The location is checked via treesitter\n       queries.\n   34. `gitsigns.nvim` Git\n\n3. The plugins are installed in `~/.local/share/nvim/site/pack/packer/start`,\n   which is defined in the `install_path` in `plugins.lua`.\n\n# Analyze `LunarVim`\n\n## The Install Script `install.sh`\n\n25 functions are defined in `install.sh`.\n\n```tex\n    __attempt_to_install_with_cargo\n    __install_nodejs_deps_npm\n    __install_nodejs_deps_pnpm\n    __install_nodejs_deps_yarn\n    __validate_node_installation\n    backup_old_config\n    check_neovim_min_version\n    check_system_deps\n    clone_lvim\n    detect_platform\n    install_nodejs_deps\n    install_python_deps\n    install_rust_deps\n    link_local_lvim\n    main\n    msg\n    parse_arguments\n    print_logo\n    print_missing_dep_msg\n    remove_old_cache_files\n    setup_lvim\n    setup_shim\n    usage\n    validate_lunarvim_files\n    verify_lvim_dirs\n```\n\nThe last line `main \"$@\"` shows that it well execute the `main` function first.\n`$@` means that all the args will be passed to the function.\n\n### Function `main`\n\n```bash\nfunction main() {\n# function parse_arguments is defined to parse the arguments passed by\n# \"$@$\"\n  parse_arguments \"$@\"\n\n  # print the logo of lunarvim\n  print_logo\n\n  msg \"Detecting platform for managing any additional neovim dependencies\"\n  detect_platform\n  # check if the git and neovim is installed\n  check_system_deps\n\n  if [ \"$ARGS_INSTALL_DEPENDENCIES\" -eq 1 ]; then\n    if [ \"$INTERACTIVE_MODE\" -eq 1 ]; then\n      msg \"Would you like to install LunarVim's NodeJS dependencies?\"\n      read -p \"[y]es or [n]o (default: no) : \" -r answer\n      [ \"$answer\" != \"${answer#[Yy]}\" ] && install_nodejs_deps\n\n      msg \"Would you like to install LunarVim's Python dependencies?\"\n      read -p \"[y]es or [n]o (default: no) : \" -r answer\n      [ \"$answer\" != \"${answer#[Yy]}\" ] && install_python_deps\n\n      msg \"Would you like to install LunarVim's Rust dependencies?\"\n      read -p \"[y]es or [n]o (default: no) : \" -r answer\n      [ \"$answer\" != \"${answer#[Yy]}\" ] && install_rust_deps\n    else\n      install_nodejs_deps\n      install_python_deps\n      install_rust_deps\n    fi\n  fi\n\n  # backup old config of lunarvim if it is installed before\n  backup_old_config\n  # if the paths are not already, mkdir them\n  verify_lvim_dirs\n\n  if [ \"$ARGS_LOCAL\" -eq 1 ]; then\n    link_local_lvim\n  elif [ -d \"$LUNARVIM_BASE_DIR\" ]; then\n    validate_lunarvim_files\n  else\n    clone_lvim\n  fi\n\n  setup_lvim\n\n  msg \"Thank you for installing LunarVim!!\"\n  echo \"You can start it by running: $INSTALL_PREFIX/bin/lvim\"\n  echo \"Do not forget to use a font with glyphs (icons) support [https://github.com/ryanoasis/nerd-fonts]\"\n}\n```\n\n### Function `clone_lvim`\n\n```bash\nfunction clone_lvim() {\n  msg \"Cloning LunarVim configuration\"\n  if ! git clone --branch \"$LV_BRANCH\" \\\n    # to download by ssh, change this line to\n    # `--depth 1 \"git@github.com:LunarVim/LunarVim.git\" \"$LUNARVIM_BASE_DIR\"; then`\n    --depth 1 \"https://github.com/${LV_REMOTE}\" \"$LUNARVIM_BASE_DIR\"; then\n    echo \"Failed to clone repository. Installation failed.\"\n    exit 1\n  fi\n}\n```\n\n### Function `setup_lvim`\n\n```bash\nfunction setup_lvim() {\n\n  remove_old_cache_files\n\n  msg \"Installing LunarVim shim\"\n\n  # output the executable file of `lvim` which lies in `~/.local/bin/lvim`\n  setup_shim\n\n  cp \"$LUNARVIM_BASE_DIR/utils/installer/config.example.lua\" \"$LUNARVIM_CONFIG_DIR/config.lua\"\n\n  echo \"Preparing Packer setup\"\n\n  # Prepare Packer, this is done by `nvim -u init.lua --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'`\n  # `--headless` means Don't start a user interface.\n  # `-c <cmd>` means Execute <cmd> after config and first file\n\n  # packer is often failed to be setup due to the network of the China Mainland\n\n  # Packer's operation are asynchronous. Previously, to install plugins in a non\n  # -interactive way, `nvim + PackerSync + 30sleep + quitall`.\n  # It is not ideal since we do not really know that after 30 seconds, the plugin\n  # install process should finish.\n  # A more ideal way is to use autocmd PackerComplete\n  # https://github.com/wbthomason/packer.nvim/blob/master/doc/packer.txt#L479\n  # provided by Packer\n  # `nvim -c 'autocmd User PackerComplete quitall' -c 'PackerSync'`\n  # PackerComplete xxx: Fires xxx after install, update, clean, and sync\n  # asynchronous operations finish\n  # PackerSync: Perform 'PackerUpdate' and then 'PackerCompile'\n  # PackerUpdate: Clean, then update and install plugins\n  # PackerCompile: You must run this or 'PackerSync' whenever you make\n  # changes to your plugin configuration. Regenerate compiled loader file.\n\n  \"$INSTALL_PREFIX/bin/lvim\" --headless \\\n    -c 'autocmd User PackerComplete quitall' \\\n    -c 'PackerSync'\n\n  echo \"Packer setup complete\"\n}\n```\n\n### Function `setup_shim`\n\n```bash\nfunction setup_shim() {\n #  make -C ~/.local/share/lunarvim/lvim install-bin\n # `-C` specifies the directory of `Makefile`\n # `install-bin` is a target defined in `Makefile`\n # install-bin:\n #\t@echo starting LunarVim bin-installer\n #\tbash ./utils/installer/install_bin.sh\n # This command outputs `~/.local/bin/lvim`, the executable file of `lvim`,\n\n  make -C \"$LUNARVIM_BASE_DIR\" install-bin\n}\n```\n\nThe `~/.local/bin/lvim` is\n\n```bash\n#!/bin/sh\n\nexport LUNARVIM_RUNTIME_DIR=\"${LUNARVIM_RUNTIME_DIR:-\"~/.local/share/lunarvim\"}\"\nexport LUNARVIM_CONFIG_DIR=\"${LUNARVIM_CONFIG_DIR:-\"~/.config/lvim\"}\"\nexport LUNARVIM_CACHE_DIR=\"${LUNARVIM_CACHE_DIR:-\"~/.cache/nvim\"}\"\n\n # `exec` is a builtin command of the Bash shell. It allows you to execute a\n # command that completely replaces the current process. The current shell process\n # is destroyed, and entirely replaced by the command you specify.\n # `-u` means use this config file, which is `~/.config/share/lunarvim/lvim/init.lua`\nexec nvim -u \"$LUNARVIM_RUNTIME_DIR/lvim/init.lua\" \"$@\"\n\n```\n\n### Function `msg`\n\nMessage or log is an effective tool to debug and make the users know the detail\nof the programming. Instead of simply using `print/echo` function, most\nprogrammers define their message functions to enable effective message giving.\nHave a look at this message function.\n\n```bash\nfunction msg() {\n# local variable receives the message needed to be print.\n  local text=\"$1\"\n  local div_width=\"80\"\n  # before print the message a line comprised of `-` will be printed.\n  # it will makes the message easily been noticed.\n  # div_width gives the width of the line.\n  printf \"%${div_width}s\\n\" ' ' | tr ' ' -\n  printf \"%s\\n\" \"$text\"\n}\n```\n\n## ABout the init process\n\n### The `init.lua`\n\n```lua\n-- init_path = '~/.local/share/lunarvim/lvim/init.lua'\n-- base_dir = '~/.local/share/lunarvim/lvim/'\nlocal init_path = debug.getinfo(1, \"S\").source:sub(2)\nlocal base_dir = init_path:match(\"(.*[/\\\\])\"):sub(1, -2)\n\n-- vim.opt return a option object\n-- rtp mean runtimepath\nif not vim.tbl_contains(vim.opt.rtp:get(), base_dir) then\n  vim.opt.rtp:append(base_dir)\nend\n-- bootstrap file is in lua/lvim/, which is the guide file of lvim\n-- NOTICE THAT, the end of the bootstrap file, return a local module M,\n-- which is defined at the beginning of the file.\n-- Thus, the term :init(base_dir) runs the init function of module M.\nrequire(\"lvim.bootstrap\"):init(base_dir)\n\nrequire(\"lvim.config\"):load()\n\n-- the plugins are defined in lua/lvim/plugins.lua\nlocal plugins = require \"lvim.plugins\"\n\n-- the same as init funtion in bootstrap, `load` is a function of the module in\n-- plugins-loader\n\nrequire(\"lvim.plugin-loader\").load { plugins, lvim.plugins }\n\nlocal Log = require \"lvim.core.log\"\nLog:debug \"Starting LunarVim\"\n\nlocal commands = require \"lvim.core.commands\"\ncommands.load(commands.defaults)\n\nrequire(\"lvim.lsp\").setup()\n```\n\n### The `Bootstrap:init`\n\n```lua\n---Initialize the `&runtimepath` variables and prepare for startup\n---@return table\nfunction M:init(base_dir)\n  self.runtime_dir = get_runtime_dir()\n  self.config_dir = get_config_dir()\n  self.cache_dir = get_cache_dir()\n  self.pack_dir = join_paths(self.runtime_dir, \"site\", \"pack\")\n  self.packer_install_dir = join_paths(self.runtime_dir, \"site\", \"pack\", \"packer\", \"start\", \"packer.nvim\")\n  self.packer_cache_path = join_paths(self.config_dir, \"plugin\", \"packer_compiled.lua\")\n\n  ---Get the full path to LunarVim's base directory\n  ---@return string\n  function _G.get_lvim_base_dir()\n    return base_dir\n  end\n\n  if os.getenv \"LUNARVIM_RUNTIME_DIR\" then\n    -- vim.opt.rtp:append(os.getenv \"LUNARVIM_RUNTIME_DIR\" .. path_sep .. \"lvim\")\n    vim.opt.rtp:remove(join_paths(vim.fn.stdpath \"data\", \"site\"))\n    vim.opt.rtp:remove(join_paths(vim.fn.stdpath \"data\", \"site\", \"after\"))\n    vim.opt.rtp:prepend(join_paths(self.runtime_dir, \"site\"))\n    vim.opt.rtp:append(join_paths(self.runtime_dir, \"site\", \"after\"))\n\n    vim.opt.rtp:remove(vim.fn.stdpath \"config\")\n    vim.opt.rtp:remove(join_paths(vim.fn.stdpath \"config\", \"after\"))\n    vim.opt.rtp:prepend(self.config_dir)\n    vim.opt.rtp:append(join_paths(self.config_dir, \"after\"))\n    -- TODO: we need something like this: vim.opt.packpath = vim.opt.rtp\n\n    vim.cmd [[let &packpath = &runtimepath]]\n  end\n\n  -- FIXME: currently unreliable in unit-tests\n  if not in_headless then\n    _G.PLENARY_DEBUG = false\n    require(\"lvim.impatient\").setup {\n      path = join_paths(self.cache_dir, \"lvim_cache\"),\n      enable_profiling = true,\n    }\n  end\n\n  require(\"lvim.config\"):init()\n\n  require(\"lvim.plugin-loader\").init {\n    package_root = self.pack_dir,\n    install_path = self.packer_install_dir,\n  }\n\n  return self\nend\n```\n\n### The `config` function in `builtin` folder\n\nFor some plugins, such as `whichkey` and `telescope`, there are `M.config`\nfunctions in their configuration files. However, the `setup` function only uses\nsome variable defined in them and do not execute them first. The are executed by\nthe `init.lua` in the `builtin` folder.\n\n```lua\nfunction M.config(config)\n  for _, builtin_path in ipairs(builtins) do\n    local builtin = require(builtin_path)\n    builtin.config(config)\n  end\nend\n```\n\nDuring the lunch process, the `config` functions will be called in front of the\nfunctions defined in the configuration file `config.lua`.\n\n## The nerd-fonts\n\nThe font is only related to your local devices. It is not related to the remote\ndevice.\n\nTo install the nerd fonts, you need to download the nerd version of your fonts,\nfor example I use `hack`, though\n[this](https://www.nerdfonts.com/font-downloads) or\n[this](https://github.com/ryanoasis/nerd-fonts). Then put it in your font\ndirectory. For windows, it is `C:\\Windows\\Fonts`. Finally, restart your terminal\nand set your terminal such as mobaxterm to use that font.\n\n## Debug system\n\n### lvim.log\n\n1. The file is in `~/.cache/` which is defined by\n   `~/.local/share/lunarvim/lvim/lua/lvim/core/log.lua`. Using `Log:warn/debug`\n   will write logs in the file.\n2. `lvim.log.level` controls the level that will be print into the `lvim.log`\n   (see `local log_level = Log.levels[(lvim.log.level):upper() or \"WARN\"]` in\n   the `log.lua`. `function Log:get_path()` sets the path and name of the log\n   file.\n3. `log.lua` used `structlog` which is a plugin of nvim defined in the\n   `plugins.lua`. In the readme of `structlog`:\n   > `structlog` makes logging in lua less painful and more powerful by adding\n   > structure to your log entries.\n\n## Plugins\n\n### yank\n\nIn the visual mode of `lunarvim`, `y` will yank the select chars into the system\nclipboard automatically. Do not use `\"+Y`, which will yank the whole line.\n`\"[~+]y` is also available.\n\n### `project.nvim`\n\nIf open vim in a subdirectory of a git package, and then open a new tmux pane or\nwindow, its initial path will be the main directory of that git package. The\n`manual mode` in `~/.local/share/lunarvim/lvim/lua/lvim/core/project.lua`\ndetermines vim change the directory or not.\n\n#### With lsp\n\nIn the readme of `project`.\n\n> Automagically cd to project directory using nvim lsp. If not then uses pattern\n> matching to cd to root directory\n\nThis means that lsp has the function to find the project directories.\n\n### Telescope\n\nThe `telescope` is depended on `fd`. To install `fd` do not use\n`apt install fdclone` which causes a collapse of nvim when run `telescope`.\n\n#### Telescope in which key\n\n`~/.local/share/lunarvim/lvim/lua/lvim/core/which-key.lua` defines many which\nkey mapping related to telescope. <leader>f can find the files in git repos\nwhich is the feature provided by `telescope.builtin` (see the document of\ntelescope). `<leader>sf` can find the files in current directory.\n\n### `Comment`\n\nAn error occur with `Comment` when open `lvim`, which is solved by adding\n`tag = 'v0.6',` to the `plugins.lua` file the Comment part.\n\n### Treesitter\n\n#### Parsers install\n\n11 parsers are defined to be installed in `~/.config/lvim/config.lua`\n\nParsers often failed to be downloaded. See\n`https://github.com/nvim-treesitter/nvim-treesitter#adding-parsers`. One can\ndownload it manually. And change the url of the parsers.\n\n[parsers](https://github.com/nvim-treesitter/nvim-treesitter#language-parsers)\n\n> parser for every language need to be generated via `tree-sitter-cli` from\n> `grammer.js` file, then complied to a `.so` library that needd to be placed in\n> neovim's `runtimepath` (typically under `parser/{language}.so`). To simplify\n> this, `nvim-treesitter` provides commands to automate this process. If the\n> language is already supported by `nvim-treesitter` you can install it with\n> `TSInstall <language>`\n\nThe `{language}.so` files are in\n`~/.local/share/lunarvim/site/pack/packer/start/nvim-treesitter.git/parser`.\n\n<!-- #### Notice -->\n\n<!-- treestter may not always perform a good highlight, e.g., for markdown or tex -->\n<!-- files. -->\n\n### About `packer`\n\n1. the some plugins are installed in `opt` directory. Some are installed in\n   `start` directory. This is controlled by the settings in `plugins.lua`. 7\n   plugins are installed in `opt` directory, 6 of which are setted `event` and\n   only the 6 plugins are setted it. `lua-dev` is setted `module`.\n\n   > module = string or list -- Specifies lua module name for require. When\n   > requiring a string which starts with one of these module names, the plugin\n   > will be loaded.\n\n   > event = string or list, -- Specifies auto command events which load this\n   > plugin\n\n   In the Readme of `Packer`\n\n   > `use` takes either a string or a table. If a string is provided, it is\n   > treated as a plugin location (link) for a non-optional plugin with no\n   > additional configuration.\n\n   [Opt](https://github.com/wbthomason/packer.nvim/issues/237#issuecomment-787457600)\n\n   > `start` packages are always available and loaded every time you start nvim,\n   > while `opt` packages are loaded on-demand with the `packadd` command. This\n   > is what `packer` uses to conditionally load plugins. `packer` itself\n   > doesn't run any code until you call `require('packer')`, so it should be\n   > fine to keep it as a start package.\n\n   [Opt](https://github.com/wbthomason/packer.nvim/discussions/823#discussioncomment-2184455)\n\n### LSP\n\n#### The setup process\n\n1. the setup function of a lsp server is defined by the files in\n   ` ~/.local/share/lunarvim/site/after/ftplugin`. `ftplugin` directory means\n   file type plugin. Vim will auto load this directory when it is in the runtime\n   path. However, only the `filetype.lua/vim` will be loaded when open a file of\n   particular filetype. ` ~/.local/share/lunarvim/site/after/ftplugin` is\n   created by `~/.local/share/lunarvim/lvim/lua/lvim/lsp/templates.lua` (see\n   line 67). The server list is given in line 58. The content in the files in\n   ftplugins is given in line 40. The `ft.lua` will call `lvim.lsp.manager`\n   which is a function defined in\n   `~/.local/share/lunarvim/lvim/lua/lvim/lsp/manager.lua`. It setup the lsp\n   servers since when `ft.lua` is removed, the lsp server will not start.\n2. The configuration files of `nvim-lspconfig` are listed in\n   `~/.local/share/lunarvim/site/pack/packer/start/nvim-lspconfig.git/lua/lspconfig/server_configurations`.\n   Which can be modified.\n3. The servers installed by `lsp-installer` are installed in\n   `~/.local/share/nvim/lsp_servers`\n4. see `setup` function in `manager.lua`\n\n```lua\nfunction M.setup(server_name, user_config)\n  vim.validate { name = { server_name, \"string\" } }\n\n\n  if lvim_lsp_utils.is_client_active(server_name) or client_is_configured(server_name) then\n    return\n  end\n\n\n  local config = resolve_config(server_name, user_config)\n\n  local servers = require \"nvim-lsp-installer.servers\"\n  local server_available, requested_server = servers.get_server(server_name)\n\n  -- if not server available in nvim-lsp-installer, call lspconfig[server_name].setup(config)\n  -- if the server is  available it will be set up by nvim-lsp-installer.\n  -- that is to say all the servers will preferentially be set upped by nvim-lsp-installer.\n\n  -- NOTE THAT\n\n  -- Most servers will be set uppped by nvim-lsp-installer by this way.\n  if not server_available then\n    -- The pcall function calls its first argument in protected mode, so that it\n    -- catches any errors while the function is running. If there are no errors, pcall\n    -- returns true, plus any values returned by the call. Otherwise, it returns false,\n    -- plus the error message.\n    pcall(function()\n      require(\"lspconfig\")[server_name].setup(config)\n      buf_try_add(server_name)\n    end)\n    return\n  end\n\n  local install_notification = false\n\n  if not requested_server:is_installed() then\n    if lvim.lsp.automatic_servers_installation then\n      Log:debug \"Automatic server installation detected\"\n      requested_server:install()\n      install_notification = true\n    else\n      Log:debug(requested_server.name .. \" is not managed by the automatic installer\")\n    end\n  end\n\n  requested_server:on_ready(function()\n    if install_notification then\n      -- `vim.notify` is defined in `log.lua` in lvim folder.\n      -- > `vim.notify` A fancy, configurable, notification manager for NeoVim.\n      -- `vim.log.levels.INFO` is defined in the `lua-dev` plunin defined in `plugins.lua`.\n      -- > `lua-dev` setup for init.lua and plugin development with full signature help,\n      -- > docs and completion for the nvim lua API.\n      -- i do not find where the vim.log.levels is required by `manager.lua`.\n      -- I think vim.log.levels must be in the search path of nvim thus it can find it\n      -- though the search path.\n      vim.notify(string.format(\"Installation complete for [%s] server\", requested_server.name), vim.log.levels.INFO)\n    end\n    install_notification = false\n    requested_server:setup(config)\n    -- Log:warn(config)\n  end)\nend\n```\n\nFrom the code we know that most of the servers will be setup by\n`nvim-lsp-installer` (see `requested_server:setup(config)`). However, thought\nthis the configuration for manually setup server is not works. From the document\nof `nvim-lsp-installer`,\n[server.setup](https://github.com/williamboman/nvim-lsp-installer/blob/40442b67a151fc2a58a790fd7e74a7487f1f9157/doc/nvim-lsp-installer.txt#L349)\nis deprecated. Thus I change the `setup` function in `manager.lua`.\n\n```lua\nfunction M.setup(server_name, user_config)\n  vim.validate { name = { server_name, \"string\" } }\n\n\n  if lvim_lsp_utils.is_client_active(server_name) or client_is_configured(server_name) then\n    return\n  end\n\n\n  local config = resolve_config(server_name, user_config)\n\n  local servers = require \"nvim-lsp-installer.servers\"\n  local server_available, requested_server = servers.get_server(server_name)\n\n  -- if the server is installed then setup by lspconfig\n  if requested_server:is_installed() then\n    pcall(function()\n      require(\"lspconfig\")[server_name].setup(config)\n      buf_try_add(server_name)\n    end)\n    return\n  end\n\n  local install_notification = false\n\n  -- if the server is not installed, install it\n  if not requested_server:is_installed() then\n    if lvim.lsp.automatic_servers_installation then\n      Log:debug \"Automatic server installation detected\"\n      requested_server:install()\n      install_notification = true\n    else\n      Log:debug(requested_server.name .. \" is not managed by the automatic installer\")\n    end\n  end\n\n  requested_server:on_ready(function()\n    if install_notification then\n      vim.notify(string.format(\"Installation complete for [%s] server\", requested_server.name), vim.log.levels.INFO)\n    end\n    install_notification = false\n    -- requested_server:setup(config)\n  end)\nend\n```\n\n#### the relationship between `lspconfig` and `null-ls`\n\n1. Both of them can use `latexindent` to format the tex file\n2. `lspconfig` can not use `prettier`.\n\nThus `null-ls` provide an extension tools for `lspconfig`. When `lspconfig` can\nmatch our requirement, we do not need to use `null-ls`, e.g., tools for tex\nfile.\n\n#### the relationship between `lspconfig` and `lsp-installer`\n\n1. `lsp-installer` depends on `lspconfig` as in the readme of `lsp-installer`.\n2. lvim strives to have support for all major languages. This is made possible\n   by plugins such as `nvim-lspconfig`, for LSP support, and `null-ls` to\n   provide support for handing external formatters, such as `prettier` and\n   `eslint`.\n\n`lua print(vim.inspect(vim.lsp.buf_get_clients()[2].resolved_capabilities))` see\nthe detail of server clients.\n\n#### Code Action\n\nCode action = quick fixes and refactoring\n\n### The lualine\n\nThe status line is defined in\n`~/.local/share/lunarvim/lvim/lua/lvim/core/lualine/init.lua` line 5 which can\nbe chose as `default`, `lvim`, or `none`. The are defined in the\n`~/.local/share/lunarvim/lvim/lua/lvim/core/lualine/styles.lua` file. The\ncomponent are defined in\n`~/.local/share/lunarvim/lvim/lua/lvim/core/lualine/components.lua`.\n\n### The whichkey\n\nWhich key can define key mappings for vim. They are defined in\n`~/.local/share/lunarvim/lvim/lua/lvim/core/which-key.lua`. The use of\n`telescope` can be learned by reading `which-key.lua`, since the key mapping of\n`telescope` is defined in it.\n\nThe lsp also used which key, which is defined in\n`~/.local/share/lunarvim/lvim/lua/lvim/lsp/config.lua` and used/registered in\n`~/.local/share/lunarvim/lvim/lua/lvim/lsp/init.lua`. Which key makes the key\nmappings more organized.\n\n#### Modify which key map\n\nTo modify which key maps, for example, `<leader>sp` is defined in\n`whichkey.lua`. I want to change it in `config.lua`.\n`lvim.builtin.which_key.mappings[\"sp\"] = { \"<CMD>Telescope projects<CR>\", \"Project\" }`\ndoes not work.\n\n`lvim.builtin.which_key.mappings.s[\"p\"] = { \"<CMD>Telescope projects<CR>\", \"Project\" }`\nworks. `lvim.builtin.which_key.mappings.s` is a table, and the `config` function\nin `which-key.lua` is executed in front of the `config.lua`. So that the value\nof key `p` can be modified.\n\n### The alpha\n\nThe start cover is defined in\n`~/.local/share/lunarvim/lvim/lua/lvim/core/alpha/startify.lua`.\n\n### nvim-notify\n\nThe notation manager and message manager for nvim.\n","slug":"Config-Vim","published":1,"updated":"2022-06-13T07:38:40.681Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgd000cy7ml4glt1rwg","content":"<html><head></head><body><h1 id=\"安装-anaconda\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#安装-anaconda\"></a> 安装 anaconda</h1>\n<p>本来安装 anaconda 应该问题不大，但是却发现了一个问题。\n<code>./Anaconda3-2021.11-Linux-x86_64.sh: 489: [[: Exec format error</code> 这个错，是因为\n直用./Anaconda.sh 启动安装默认用的是 sh 改成了 bash <a href=\"http://Anaconda.sh\">Anaconda.sh</a> 就不会报错了.</p>\n<h1 id=\"一些碎的-linux-知识\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#一些碎的-linux-知识\"></a> 一些碎的 Linux 知识</h1>\n<h2 id=\"查找包的安装位置\"><span class=\"post-title-index\">2.1. </span><a class=\"markdownIt-Anchor\" href=\"#查找包的安装位置\"></a> 查找包的安装位置</h2>\n<p>一些软件用 apt install 了，但是不知道安装位置在哪里 <code>dpkg -L xxx</code>显示包的安装位\n置．</p>\n<h2 id=\"编译错误定位\"><span class=\"post-title-index\">2.2. </span><a class=\"markdownIt-Anchor\" href=\"#编译错误定位\"></a> 编译错误定位</h2>\n<p>编译的时候,打印一些 log 但是并不详细一般会有更加详细的编译 log 文件，在里面可以\n更精确的定位错误发生的原因．</p>\n<h2 id=\"linux-的环境变量可能是两个\"><span class=\"post-title-index\">2.3. </span><a class=\"markdownIt-Anchor\" href=\"#linux-的环境变量可能是两个\"></a> linux 的环境变量可能是两个</h2>\n<p><code>LIBRARY_PATH</code>编译的时候用到的库的搜索路径 <code>LD_LIBRARY_PATH</code>程序加载时库的搜索路\n径</p>\n<h2 id=\"遇到一个问题明明再搜索路径下有动态库却报错所无法找到\"><span class=\"post-title-index\">2.4. </span><a class=\"markdownIt-Anchor\" href=\"#遇到一个问题明明再搜索路径下有动态库却报错所无法找到\"></a> 遇到一个问题明明再搜索路径下有动态库，却报错所无法找到</h2>\n<p>okular: error while loading shared libraries: libQt5Core.so.5: cannot open\nshared object file: No such file or directory 用 strip 处理完之后解决 sudo strip\n–remove-section=.note.ABI-tag /usr/lib/x86_64-linux-gnu/libQt5Core.so.5</p>\n<h1 id=\"编译-vim\"><span class=\"post-title-index\">3. </span><a class=\"markdownIt-Anchor\" href=\"#编译-vim\"></a> 编译 vim</h1>\n<p>apt 安装的 vim 不能随意的控制 vim 的特性，比如在 latex 反向搜索的时候需要的\n+clietservice。 apt-cache search libc-dev ln -s libXtst.so.6 <a href=\"http://libXtst.so\">libXtst.so</a> 综合两篇\n博客。 <a href=\"https://www.jianshu.com/p/aa5ea81bbc72\">https://www.jianshu.com/p/aa5ea81bbc72</a>\n<a href=\"https://toutiao.io/posts/runvgs/preview\">https://toutiao.io/posts/runvgs/preview</a> 尽量多的保留特性，最终得到的 config 命令\n是</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --<span class=\"keyword\">with</span>-features=huge \\</span><br><span class=\"line\">    --enable-multibyte \\</span><br><span class=\"line\">    --enable-rubyinterp=yes \\</span><br><span class=\"line\">    --enable-python3interp=yes \\</span><br><span class=\"line\">    --enable-perlinterp=yes \\</span><br><span class=\"line\">    --enable-cscope \\</span><br><span class=\"line\">    --enable-fontset \\</span><br><span class=\"line\">    --enable-largefile \\</span><br><span class=\"line\">    --enable-fail-<span class=\"keyword\">if</span>-missing \\</span><br><span class=\"line\">    --prefix=/path-to-install</span><br></pre></td></tr></tbody></table></figure>\n<p><code>--enable-fail-if-missing</code> 用于显示错误信息。</p>\n<h2 id=\"很久没有成功最后-apt-安装解决了\"><span class=\"post-title-index\">3.1. </span><a class=\"markdownIt-Anchor\" href=\"#很久没有成功最后-apt-安装解决了\"></a> 很久没有成功，最后 apt 安装解决了</h2>\n<p>编译的时候 feature 用了 hug，但是还是没有增加+clientserver。我估计是缺少库。查\nsrc/auto/cofig.log 也没有发现很相关的信息。最后<code>sudo apt-get install vim-gtk</code>成\n功安装了+clientserver 的 vim。</p>\n<h1 id=\"tmux\"><span class=\"post-title-index\">4. </span><a class=\"markdownIt-Anchor\" href=\"#tmux\"></a> tmux</h1>\n<p>To enable vi key mode in tmux. I mapped <code>hjkl</code> for select the pane.</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bind -r 'h' select-pane -L  # move left</span><br><span class=\"line\">bind -r 'j' select-pane -D  # move down</span><br><span class=\"line\">bind -r 'k' select-pane -U  # move up</span><br><span class=\"line\">bind -r 'l' select-pane -R  # move right</span><br></pre></td></tr></tbody></table></figure>\n<p><code>r</code> means I can change the pane continually by click <code>&lt;prefix&gt;</code> and twice <code>k</code>.</p>\n<h1 id=\"a-practice-of-vim\"><span class=\"post-title-index\">5. </span><a class=\"markdownIt-Anchor\" href=\"#a-practice-of-vim\"></a> A practice of vim</h1>\n<h2 id=\"search-and-replace\"><span class=\"post-title-index\">5.1. </span><a class=\"markdownIt-Anchor\" href=\"#search-and-replace\"></a> Search and Replace</h2>\n<p><code>:.,$s/old/new/gc</code>, where <code>g</code> means match all for each line and <code>c</code> means ask me\nbefore replace at each position. Without <code>g</code> only the first match of each line\nwill be considered.</p>\n<h1 id=\"why-lua-instead-of-vimlvim-script\"><span class=\"post-title-index\">6. </span><a class=\"markdownIt-Anchor\" href=\"#why-lua-instead-of-vimlvim-script\"></a> Why lua instead of vimL(vim script)</h1>\n<h2 id=\"introduction\"><span class=\"post-title-index\">6.1. </span><a class=\"markdownIt-Anchor\" href=\"#introduction\"></a> Introduction</h2>\n<p>Neovim has an embedded lua 5.1 runtime which is used to create faster and more\npowerful extentions of you favorite efitor.</p>\n<ol>\n<li>VimL is a slow interpreted language with almost no optimizations. Much of the\ntime spent in vim startup and in actions from plugins that can block the main\nloop in the editor is in parsing and executing vim script.</li>\n</ol>\n<h2 id=\"how-to-use-lua-in-command-line-or-viml-file\"><span class=\"post-title-index\">6.2. </span><a class=\"markdownIt-Anchor\" href=\"#how-to-use-lua-in-command-line-or-viml-file\"></a> How to use lua in command line or vimL file</h2>\n<p>see <code>:h lua</code>.</p>\n<ul>\n<li>From the vim command line, you can run <code>lua &lt;you code&gt;</code>. This is useful for\nkeybindings, commands, and other one-off execution cases.</li>\n<li>Inside of a vimL file, you can demarcate lua code with the follow code\nfencing:</li>\n</ul>\n<figure class=\"highlight vim\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">lua</span> &lt;&lt; EOF</span><br><span class=\"line\">-- your <span class=\"keyword\">lua</span> code</span><br><span class=\"line\">EOF</span><br></pre></td></tr></tbody></table></figure>\n<ul>\n<li>Inside of a vimL file you can use the <code>lua</code> keyword to execute commands\nsimilar to the first example,i.e., <code>lua &lt;your code&gt;</code>.</li>\n</ul>\n<p>One important note here is that Neovim will look for lua code in the\n<code>runtimepath</code> you’ve set in your settings. Additionally, it will append your\nruntimepath with <code>/lua/?.lua</code> and <code>lua/?/init.lua</code> so it is common practice to\nsee a <code>/lua</code> sub-directory inside <code>nvim</code>. For more detailed information about\nwhere Neovim looks for lua code, check out <code>:h lua-require</code>.</p>\n<p><a href=\"https://github.com/nanotee/nvim-lua-guide\">More Information</a></p>\n<h1 id=\"debug-vim\"><span class=\"post-title-index\">7. </span><a class=\"markdownIt-Anchor\" href=\"#debug-vim\"></a> Debug vim</h1>\n<ol>\n<li><code>:message/:mes</code> will display the messages that your configuration files\nprint.</li>\n<li><code>:nmap</code> or <code>:imap</code> can check all the shortcuts of normal or insert mode.\n<code>:map</code> lists the shortcuts of all modes. However, I find that some shortcuts\ndefined can not be find by <code>:map</code>.</li>\n</ol>\n<h1 id=\"a-practice-for-neovim-from-scratch\"><span class=\"post-title-index\">8. </span><a class=\"markdownIt-Anchor\" href=\"#a-practice-for-neovim-from-scratch\"></a> A Practice for <code>Neovim-from-scratch</code></h1>\n<h2 id=\"install\"><span class=\"post-title-index\">8.1. </span><a class=\"markdownIt-Anchor\" href=\"#install\"></a> Install</h2>\n<ol>\n<li>Plugins are defined in <code>~/.config/nvim/lua/user/plugins.lua</code>. The plugins\nwill fail to be installed due to the internet of China Mainland. Thus, git is\nasked to be configured with ssh. Then the path of plugins can be changed by\nadd <code>git@github.com:</code> before the original path.</li>\n<li><code>treesitter</code> is a plugin for syntax-hight. It will install a series of\nlanguage parsers. They are defined in\n<code>~/.config/nvim/lua/user/treesitter.lua</code>. By setting\n<code>ensure_installed = {'astro', 'xxx'}</code>, we can define the parsers to be\ndownload. Also, download errors may be occurred due to the internet. The path\nof these language parsers are defined in\n<code>~/.local/share/nvim/site/pack/packer/start/nvim-treesitter/lua/nvim-treesitter/parsers.lua</code>,\nwhich may be changed by download with ssh.</li>\n</ol>\n<h2 id=\"analysis\"><span class=\"post-title-index\">8.2. </span><a class=\"markdownIt-Anchor\" href=\"#analysis\"></a> Analysis</h2>\n<ol>\n<li>\n<p>There are 21 files required in <code>init.lua</code>. They are exactly the 21 files in\n<code>lua/user</code> folder. About 34 plugins are defined in <code>plugins.lua</code>. The lua\nfiles are all the configuration file of the plugins defined in <code>plugins.lua</code>,\nexcept for <code>keymaps.lua</code>, <code>option.lua</code>, <code>autocommand.lua</code>. <code>plugins.lua</code>\nitself is the configuration file of <code>packer.nvim</code>, a plugin manager.</p>\n</li>\n<li>\n<p>Here gives a brief look at the plugins.</p>\n<ol>\n<li><code>packer.nvim</code> is a plugin manager.</li>\n<li><code>Alpha-vim</code> is a plugin used by Neovim-from-scratch. It allow one to\ncustom the greeter for neovim</li>\n<li><code>popup.nvim</code>, An implementation of the Popup API from vim in neovim.</li>\n<li><code>plenary.nvim</code>, implement some useful window management items for neovim.</li>\n<li><code>nvim-autopais</code> A super powerful auto pair plugin for neovim that supports\nmultiple characters.</li>\n<li><code>Comment.nvim</code> Smart and Powerful commenting plugin for neovim.</li>\n<li><code>nvim-web-devicons</code> A lua fork of <code>vim-devicons</code>. This plugin provides the\nsame icons as well as colors for each icon</li>\n<li><code>nvim-tree-lua</code> A file explorer for neovim written in lua.</li>\n<li><code>bufferline.nvim</code> A snazzy buffer line (with tabpage integration) for\nneovim built using lua.</li>\n<li><code>vim-bbye</code> Bbye allows you to do delete buffers (close files) without\ncolosing you windows or messing up your layout.</li>\n<li><code>lualine.nvim</code> A blazing fast and easy to configure neovim status line\nwritten in lua.</li>\n<li><code>toggleterm.nvim</code> A neovim plugin to persist and toggle multiple\nterminals during an editing session.</li>\n<li><code>project.nvim</code> an all in one neovim plugin written in lua that provides\nsuperior project management.</li>\n<li><code>impatient.nvim</code> speed up loading lua modules in neovim to improve start\nup time.</li>\n<li><code>indent-blankline.nvim</code> adds indentation guides to all lines (including\nempty lines.)</li>\n<li><code>FixCursorHold.nvim</code> This is needed to fix lsp doc highlight.</li>\n<li><code>which-key.nvim</code> a lua plugin that displays a popup with possible key\nbindings of the command you started typing.</li>\n<li><code>darkplus.nvim</code> color themes</li>\n<li><code>nvim-cmp</code> The completion plugin</li>\n<li><code>cmp-buffer</code> buffer completions</li>\n<li><code>cmp-path</code> path completions</li>\n<li><code>cmp-cmdline</code> cmdline completions</li>\n<li><code>cmp_luasnip</code> snippet completions.</li>\n<li><code>cmp-nvim-lsp</code> nvim-cmp source for neovim’s built-in language server\nclient.</li>\n<li><code>LuaSnip</code> snippet engin</li>\n<li><code>friendly-snippets</code> a bunch of snippets to use</li>\n<li><code>nvim-lspconfig</code> A collection of common configurations for neovim’s\nbuilt-in language server clinet. Features: go-to-definition,\nfind-references, hover, completion, rename, format, refactor.</li>\n<li><code>nvim-lsp-installer</code> allows you to seamlessly install LSP server\nlocally(inside <code>:echo stdpaht(\"data\")</code>)</li>\n<li><code>nlsp-settings.nvim</code> A plugin to configure LSP using json/yaml files like\n<code>coc-setting.json</code></li>\n<li><code>null-ls.nvim</code> for formatters and linters, use neovim as a language\nserver to inject LSP diagnostic, code actions, and more via lua</li>\n<li><code>telescope.nvim</code> a highly extendable fuzzy finder over lists.</li>\n<li><code>nvim-treesitter</code> both provide a simple and easy way to use the interface\nfor <code>tree-sitter</code> in neovim and to provide some basic functionality such\nas highlighting based on it.</li>\n<li><code>nvim-ts-context-commentstring\"</code> setting <code>comment string</code> option based on\nthe cursor location in the file. The location is checked via treesitter\nqueries.</li>\n<li><code>gitsigns.nvim</code> Git</li>\n</ol>\n</li>\n<li>\n<p>The plugins are installed in <code>~/.local/share/nvim/site/pack/packer/start</code>,\nwhich is defined in the <code>install_path</code> in <code>plugins.lua</code>.</p>\n</li>\n</ol>\n<h1 id=\"analyze-lunarvim\"><span class=\"post-title-index\">9. </span><a class=\"markdownIt-Anchor\" href=\"#analyze-lunarvim\"></a> Analyze <code>LunarVim</code></h1>\n<h2 id=\"the-install-script-installsh\"><span class=\"post-title-index\">9.1. </span><a class=\"markdownIt-Anchor\" href=\"#the-install-script-installsh\"></a> The Install Script <code>install.sh</code></h2>\n<p>25 functions are defined in <code>install.sh</code>.</p>\n<figure class=\"highlight tex\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">_</span><span class=\"built_in\">_</span>attempt<span class=\"built_in\">_</span>to<span class=\"built_in\">_</span>install<span class=\"built_in\">_</span>with<span class=\"built_in\">_</span>cargo</span><br><span class=\"line\"><span class=\"built_in\">_</span><span class=\"built_in\">_</span>install<span class=\"built_in\">_</span>nodejs<span class=\"built_in\">_</span>deps<span class=\"built_in\">_</span>npm</span><br><span class=\"line\"><span class=\"built_in\">_</span><span class=\"built_in\">_</span>install<span class=\"built_in\">_</span>nodejs<span class=\"built_in\">_</span>deps<span class=\"built_in\">_</span>pnpm</span><br><span class=\"line\"><span class=\"built_in\">_</span><span class=\"built_in\">_</span>install<span class=\"built_in\">_</span>nodejs<span class=\"built_in\">_</span>deps<span class=\"built_in\">_</span>yarn</span><br><span class=\"line\"><span class=\"built_in\">_</span><span class=\"built_in\">_</span>validate<span class=\"built_in\">_</span>node<span class=\"built_in\">_</span>installation</span><br><span class=\"line\">backup<span class=\"built_in\">_</span>old<span class=\"built_in\">_</span>config</span><br><span class=\"line\">check<span class=\"built_in\">_</span>neovim<span class=\"built_in\">_</span>min<span class=\"built_in\">_</span>version</span><br><span class=\"line\">check<span class=\"built_in\">_</span>system<span class=\"built_in\">_</span>deps</span><br><span class=\"line\">clone<span class=\"built_in\">_</span>lvim</span><br><span class=\"line\">detect<span class=\"built_in\">_</span>platform</span><br><span class=\"line\">install<span class=\"built_in\">_</span>nodejs<span class=\"built_in\">_</span>deps</span><br><span class=\"line\">install<span class=\"built_in\">_</span>python<span class=\"built_in\">_</span>deps</span><br><span class=\"line\">install<span class=\"built_in\">_</span>rust<span class=\"built_in\">_</span>deps</span><br><span class=\"line\">link<span class=\"built_in\">_</span>local<span class=\"built_in\">_</span>lvim</span><br><span class=\"line\">main</span><br><span class=\"line\">msg</span><br><span class=\"line\">parse<span class=\"built_in\">_</span>arguments</span><br><span class=\"line\">print<span class=\"built_in\">_</span>logo</span><br><span class=\"line\">print<span class=\"built_in\">_</span>missing<span class=\"built_in\">_</span>dep<span class=\"built_in\">_</span>msg</span><br><span class=\"line\">remove<span class=\"built_in\">_</span>old<span class=\"built_in\">_</span>cache<span class=\"built_in\">_</span>files</span><br><span class=\"line\">setup<span class=\"built_in\">_</span>lvim</span><br><span class=\"line\">setup<span class=\"built_in\">_</span>shim</span><br><span class=\"line\">usage</span><br><span class=\"line\">validate<span class=\"built_in\">_</span>lunarvim<span class=\"built_in\">_</span>files</span><br><span class=\"line\">verify<span class=\"built_in\">_</span>lvim<span class=\"built_in\">_</span>dirs</span><br></pre></td></tr></tbody></table></figure>\n<p>The last line <code>main \"$@\"</code> shows that it well execute the <code>main</code> function first.\n<code>$@</code> means that all the args will be passed to the function.</p>\n<h3 id=\"function-main\"><span class=\"post-title-index\">9.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#function-main\"></a> Function <code>main</code></h3>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">main</span></span>() {</span><br><span class=\"line\"><span class=\"comment\"># function parse_arguments is defined to parse the arguments passed by</span></span><br><span class=\"line\"><span class=\"comment\"># \"$@$\"</span></span><br><span class=\"line\">  parse_arguments <span class=\"string\">\"<span class=\"variable\">$@</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># print the logo of lunarvim</span></span><br><span class=\"line\">  print_logo</span><br><span class=\"line\"></span><br><span class=\"line\">  msg <span class=\"string\">\"Detecting platform for managing any additional neovim dependencies\"</span></span><br><span class=\"line\">  detect_platform</span><br><span class=\"line\">  <span class=\"comment\"># check if the git and neovim is installed</span></span><br><span class=\"line\">  check_system_deps</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$ARGS_INSTALL_DEPENDENCIES</span>\"</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$INTERACTIVE_MODE</span>\"</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">      msg <span class=\"string\">\"Would you like to install LunarVim's NodeJS dependencies?\"</span></span><br><span class=\"line\">      <span class=\"built_in\">read</span> -p <span class=\"string\">\"[y]es or [n]o (default: no) : \"</span> -r answer</span><br><span class=\"line\">      [ <span class=\"string\">\"<span class=\"variable\">$answer</span>\"</span> != <span class=\"string\">\"<span class=\"variable\">${answer#[Yy]}</span>\"</span> ] &amp;&amp; install_nodejs_deps</span><br><span class=\"line\"></span><br><span class=\"line\">      msg <span class=\"string\">\"Would you like to install LunarVim's Python dependencies?\"</span></span><br><span class=\"line\">      <span class=\"built_in\">read</span> -p <span class=\"string\">\"[y]es or [n]o (default: no) : \"</span> -r answer</span><br><span class=\"line\">      [ <span class=\"string\">\"<span class=\"variable\">$answer</span>\"</span> != <span class=\"string\">\"<span class=\"variable\">${answer#[Yy]}</span>\"</span> ] &amp;&amp; install_python_deps</span><br><span class=\"line\"></span><br><span class=\"line\">      msg <span class=\"string\">\"Would you like to install LunarVim's Rust dependencies?\"</span></span><br><span class=\"line\">      <span class=\"built_in\">read</span> -p <span class=\"string\">\"[y]es or [n]o (default: no) : \"</span> -r answer</span><br><span class=\"line\">      [ <span class=\"string\">\"<span class=\"variable\">$answer</span>\"</span> != <span class=\"string\">\"<span class=\"variable\">${answer#[Yy]}</span>\"</span> ] &amp;&amp; install_rust_deps</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      install_nodejs_deps</span><br><span class=\"line\">      install_python_deps</span><br><span class=\"line\">      install_rust_deps</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># backup old config of lunarvim if it is installed before</span></span><br><span class=\"line\">  backup_old_config</span><br><span class=\"line\">  <span class=\"comment\"># if the paths are not already, mkdir them</span></span><br><span class=\"line\">  verify_lvim_dirs</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$ARGS_LOCAL</span>\"</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    link_local_lvim</span><br><span class=\"line\">  <span class=\"keyword\">elif</span> [ -d <span class=\"string\">\"<span class=\"variable\">$LUNARVIM_BASE_DIR</span>\"</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    validate_lunarvim_files</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    clone_lvim</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">  setup_lvim</span><br><span class=\"line\"></span><br><span class=\"line\">  msg <span class=\"string\">\"Thank you for installing LunarVim!!\"</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"You can start it by running: <span class=\"variable\">$INSTALL_PREFIX</span>/bin/lvim\"</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"Do not forget to use a font with glyphs (icons) support [https://github.com/ryanoasis/nerd-fonts]\"</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n<h3 id=\"function-clone_lvim\"><span class=\"post-title-index\">9.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#function-clone_lvim\"></a> Function <code>clone_lvim</code></h3>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">clone_lvim</span></span>() {</span><br><span class=\"line\">  msg <span class=\"string\">\"Cloning LunarVim configuration\"</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ! git <span class=\"built_in\">clone</span> --branch <span class=\"string\">\"<span class=\"variable\">$LV_BRANCH</span>\"</span> \\</span><br><span class=\"line\">    <span class=\"comment\"># to download by ssh, change this line to</span></span><br><span class=\"line\">    <span class=\"comment\"># `--depth 1 \"git@github.com:LunarVim/LunarVim.git\" \"$LUNARVIM_BASE_DIR\"; then`</span></span><br><span class=\"line\">    --depth 1 <span class=\"string\">\"https://github.com/<span class=\"variable\">${LV_REMOTE}</span>\"</span> <span class=\"string\">\"<span class=\"variable\">$LUNARVIM_BASE_DIR</span>\"</span>; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"Failed to clone repository. Installation failed.\"</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n<h3 id=\"function-setup_lvim\"><span class=\"post-title-index\">9.1.3. </span><a class=\"markdownIt-Anchor\" href=\"#function-setup_lvim\"></a> Function <code>setup_lvim</code></h3>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">setup_lvim</span></span>() {</span><br><span class=\"line\"></span><br><span class=\"line\">  remove_old_cache_files</span><br><span class=\"line\"></span><br><span class=\"line\">  msg <span class=\"string\">\"Installing LunarVim shim\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># output the executable file of `lvim` which lies in `~/.local/bin/lvim`</span></span><br><span class=\"line\">  setup_shim</span><br><span class=\"line\"></span><br><span class=\"line\">  cp <span class=\"string\">\"<span class=\"variable\">$LUNARVIM_BASE_DIR</span>/utils/installer/config.example.lua\"</span> <span class=\"string\">\"<span class=\"variable\">$LUNARVIM_CONFIG_DIR</span>/config.lua\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"Preparing Packer setup\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Prepare Packer, this is done by `nvim -u init.lua --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'`</span></span><br><span class=\"line\">  <span class=\"comment\"># `--headless` means Don't start a user interface.</span></span><br><span class=\"line\">  <span class=\"comment\"># `-c &lt;cmd&gt;` means Execute &lt;cmd&gt; after config and first file</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># packer is often failed to be setup due to the network of the China Mainland</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Packer's operation are asynchronous. Previously, to install plugins in a non</span></span><br><span class=\"line\">  <span class=\"comment\"># -interactive way, `nvim + PackerSync + 30sleep + quitall`.</span></span><br><span class=\"line\">  <span class=\"comment\"># It is not ideal since we do not really know that after 30 seconds, the plugin</span></span><br><span class=\"line\">  <span class=\"comment\"># install process should finish.</span></span><br><span class=\"line\">  <span class=\"comment\"># A more ideal way is to use autocmd PackerComplete</span></span><br><span class=\"line\">  <span class=\"comment\"># https://github.com/wbthomason/packer.nvim/blob/master/doc/packer.txt#L479</span></span><br><span class=\"line\">  <span class=\"comment\"># provided by Packer</span></span><br><span class=\"line\">  <span class=\"comment\"># `nvim -c 'autocmd User PackerComplete quitall' -c 'PackerSync'`</span></span><br><span class=\"line\">  <span class=\"comment\"># PackerComplete xxx: Fires xxx after install, update, clean, and sync</span></span><br><span class=\"line\">  <span class=\"comment\"># asynchronous operations finish</span></span><br><span class=\"line\">  <span class=\"comment\"># PackerSync: Perform 'PackerUpdate' and then 'PackerCompile'</span></span><br><span class=\"line\">  <span class=\"comment\"># PackerUpdate: Clean, then update and install plugins</span></span><br><span class=\"line\">  <span class=\"comment\"># PackerCompile: You must run this or 'PackerSync' whenever you make</span></span><br><span class=\"line\">  <span class=\"comment\"># changes to your plugin configuration. Regenerate compiled loader file.</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"string\">\"<span class=\"variable\">$INSTALL_PREFIX</span>/bin/lvim\"</span> --headless \\</span><br><span class=\"line\">    -c <span class=\"string\">'autocmd User PackerComplete quitall'</span> \\</span><br><span class=\"line\">    -c <span class=\"string\">'PackerSync'</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"Packer setup complete\"</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n<h3 id=\"function-setup_shim\"><span class=\"post-title-index\">9.1.4. </span><a class=\"markdownIt-Anchor\" href=\"#function-setup_shim\"></a> Function <code>setup_shim</code></h3>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">setup_shim</span></span>() {</span><br><span class=\"line\"> <span class=\"comment\">#  make -C ~/.local/share/lunarvim/lvim install-bin</span></span><br><span class=\"line\"> <span class=\"comment\"># `-C` specifies the directory of `Makefile`</span></span><br><span class=\"line\"> <span class=\"comment\"># `install-bin` is a target defined in `Makefile`</span></span><br><span class=\"line\"> <span class=\"comment\"># install-bin:</span></span><br><span class=\"line\"> <span class=\"comment\">#\t@echo starting LunarVim bin-installer</span></span><br><span class=\"line\"> <span class=\"comment\">#\tbash ./utils/installer/install_bin.sh</span></span><br><span class=\"line\"> <span class=\"comment\"># This command outputs `~/.local/bin/lvim`, the executable file of `lvim`,</span></span><br><span class=\"line\"></span><br><span class=\"line\">  make -C <span class=\"string\">\"<span class=\"variable\">$LUNARVIM_BASE_DIR</span>\"</span> install-bin</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n<p>The <code>~/.local/bin/lvim</code> is</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> LUNARVIM_RUNTIME_DIR=<span class=\"string\">\"<span class=\"variable\">${LUNARVIM_RUNTIME_DIR:-\"~/.local/share/lunarvim\"}</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> LUNARVIM_CONFIG_DIR=<span class=\"string\">\"<span class=\"variable\">${LUNARVIM_CONFIG_DIR:-\"~/.config/lvim\"}</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> LUNARVIM_CACHE_DIR=<span class=\"string\">\"<span class=\"variable\">${LUNARVIM_CACHE_DIR:-\"~/.cache/nvim\"}</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># `exec` is a builtin command of the Bash shell. It allows you to execute a</span></span><br><span class=\"line\"> <span class=\"comment\"># command that completely replaces the current process. The current shell process</span></span><br><span class=\"line\"> <span class=\"comment\"># is destroyed, and entirely replaced by the command you specify.</span></span><br><span class=\"line\"> <span class=\"comment\"># `-u` means use this config file, which is `~/.config/share/lunarvim/lvim/init.lua`</span></span><br><span class=\"line\"><span class=\"built_in\">exec</span> nvim -u <span class=\"string\">\"<span class=\"variable\">$LUNARVIM_RUNTIME_DIR</span>/lvim/init.lua\"</span> <span class=\"string\">\"<span class=\"variable\">$@</span>\"</span></span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure>\n<h3 id=\"function-msg\"><span class=\"post-title-index\">9.1.5. </span><a class=\"markdownIt-Anchor\" href=\"#function-msg\"></a> Function <code>msg</code></h3>\n<p>Message or log is an effective tool to debug and make the users know the detail\nof the programming. Instead of simply using <code>print/echo</code> function, most\nprogrammers define their message functions to enable effective message giving.\nHave a look at this message function.</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">msg</span></span>() {</span><br><span class=\"line\"><span class=\"comment\"># local variable receives the message needed to be print.</span></span><br><span class=\"line\">  <span class=\"built_in\">local</span> text=<span class=\"string\">\"<span class=\"variable\">$1</span>\"</span></span><br><span class=\"line\">  <span class=\"built_in\">local</span> div_width=<span class=\"string\">\"80\"</span></span><br><span class=\"line\">  <span class=\"comment\"># before print the message a line comprised of `-` will be printed.</span></span><br><span class=\"line\">  <span class=\"comment\"># it will makes the message easily been noticed.</span></span><br><span class=\"line\">  <span class=\"comment\"># div_width gives the width of the line.</span></span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">\"%<span class=\"variable\">${div_width}</span>s\\n\"</span> <span class=\"string\">' '</span> | tr <span class=\"string\">' '</span> -</span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">\"%s\\n\"</span> <span class=\"string\">\"<span class=\"variable\">$text</span>\"</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"about-the-init-process\"><span class=\"post-title-index\">9.2. </span><a class=\"markdownIt-Anchor\" href=\"#about-the-init-process\"></a> ABout the init process</h2>\n<h3 id=\"the-initlua\"><span class=\"post-title-index\">9.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#the-initlua\"></a> The <code>init.lua</code></h3>\n<figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- init_path = '~/.local/share/lunarvim/lvim/init.lua'</span></span><br><span class=\"line\"><span class=\"comment\">-- base_dir = '~/.local/share/lunarvim/lvim/'</span></span><br><span class=\"line\"><span class=\"keyword\">local</span> init_path = <span class=\"built_in\">debug</span>.<span class=\"built_in\">getinfo</span>(<span class=\"number\">1</span>, <span class=\"string\">\"S\"</span>).source:<span class=\"built_in\">sub</span>(<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"keyword\">local</span> base_dir = init_path:<span class=\"built_in\">match</span>(<span class=\"string\">\"(.*[/\\\\])\"</span>):<span class=\"built_in\">sub</span>(<span class=\"number\">1</span>, <span class=\"number\">-2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- vim.opt return a option object</span></span><br><span class=\"line\"><span class=\"comment\">-- rtp mean runtimepath</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">not</span> vim.tbl_contains(vim.opt.rtp:get(), base_dir) <span class=\"keyword\">then</span></span><br><span class=\"line\">  vim.opt.rtp:append(base_dir)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"comment\">-- bootstrap file is in lua/lvim/, which is the guide file of lvim</span></span><br><span class=\"line\"><span class=\"comment\">-- NOTICE THAT, the end of the bootstrap file, return a local module M,</span></span><br><span class=\"line\"><span class=\"comment\">-- which is defined at the beginning of the file.</span></span><br><span class=\"line\"><span class=\"comment\">-- Thus, the term :init(base_dir) runs the init function of module M.</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">\"lvim.bootstrap\"</span>):init(base_dir)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">\"lvim.config\"</span>):<span class=\"built_in\">load</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- the plugins are defined in lua/lvim/plugins.lua</span></span><br><span class=\"line\"><span class=\"keyword\">local</span> plugins = <span class=\"built_in\">require</span> <span class=\"string\">\"lvim.plugins\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- the same as init funtion in bootstrap, `load` is a function of the module in</span></span><br><span class=\"line\"><span class=\"comment\">-- plugins-loader</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">\"lvim.plugin-loader\"</span>).<span class=\"built_in\">load</span> { plugins, lvim.plugins }</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">local</span> Log = <span class=\"built_in\">require</span> <span class=\"string\">\"lvim.core.log\"</span></span><br><span class=\"line\">Log:<span class=\"built_in\">debug</span> <span class=\"string\">\"Starting LunarVim\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">local</span> commands = <span class=\"built_in\">require</span> <span class=\"string\">\"lvim.core.commands\"</span></span><br><span class=\"line\">commands.<span class=\"built_in\">load</span>(commands.defaults)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">\"lvim.lsp\"</span>).setup()</span><br></pre></td></tr></tbody></table></figure>\n<h3 id=\"the-bootstrapinit\"><span class=\"post-title-index\">9.2.2. </span><a class=\"markdownIt-Anchor\" href=\"#the-bootstrapinit\"></a> The <code>Bootstrap:init</code></h3>\n<figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">---Initialize the `&amp;runtimepath` variables and prepare for startup</span></span><br><span class=\"line\"><span class=\"comment\">---@return table</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">M:init</span><span class=\"params\">(base_dir)</span></span></span><br><span class=\"line\">  <span class=\"built_in\">self</span>.runtime_dir = get_runtime_dir()</span><br><span class=\"line\">  <span class=\"built_in\">self</span>.config_dir = get_config_dir()</span><br><span class=\"line\">  <span class=\"built_in\">self</span>.cache_dir = get_cache_dir()</span><br><span class=\"line\">  <span class=\"built_in\">self</span>.pack_dir = join_paths(<span class=\"built_in\">self</span>.runtime_dir, <span class=\"string\">\"site\"</span>, <span class=\"string\">\"pack\"</span>)</span><br><span class=\"line\">  <span class=\"built_in\">self</span>.packer_install_dir = join_paths(<span class=\"built_in\">self</span>.runtime_dir, <span class=\"string\">\"site\"</span>, <span class=\"string\">\"pack\"</span>, <span class=\"string\">\"packer\"</span>, <span class=\"string\">\"start\"</span>, <span class=\"string\">\"packer.nvim\"</span>)</span><br><span class=\"line\">  <span class=\"built_in\">self</span>.packer_cache_path = join_paths(<span class=\"built_in\">self</span>.config_dir, <span class=\"string\">\"plugin\"</span>, <span class=\"string\">\"packer_compiled.lua\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">---Get the full path to LunarVim's base directory</span></span><br><span class=\"line\">  <span class=\"comment\">---@return string</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_G.get_lvim_base_dir</span><span class=\"params\">()</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> base_dir</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> <span class=\"built_in\">os</span>.<span class=\"built_in\">getenv</span> <span class=\"string\">\"LUNARVIM_RUNTIME_DIR\"</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\">-- vim.opt.rtp:append(os.getenv \"LUNARVIM_RUNTIME_DIR\" .. path_sep .. \"lvim\")</span></span><br><span class=\"line\">    vim.opt.rtp:<span class=\"built_in\">remove</span>(join_paths(vim.fn.stdpath <span class=\"string\">\"data\"</span>, <span class=\"string\">\"site\"</span>))</span><br><span class=\"line\">    vim.opt.rtp:<span class=\"built_in\">remove</span>(join_paths(vim.fn.stdpath <span class=\"string\">\"data\"</span>, <span class=\"string\">\"site\"</span>, <span class=\"string\">\"after\"</span>))</span><br><span class=\"line\">    vim.opt.rtp:prepend(join_paths(<span class=\"built_in\">self</span>.runtime_dir, <span class=\"string\">\"site\"</span>))</span><br><span class=\"line\">    vim.opt.rtp:append(join_paths(<span class=\"built_in\">self</span>.runtime_dir, <span class=\"string\">\"site\"</span>, <span class=\"string\">\"after\"</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    vim.opt.rtp:<span class=\"built_in\">remove</span>(vim.fn.stdpath <span class=\"string\">\"config\"</span>)</span><br><span class=\"line\">    vim.opt.rtp:<span class=\"built_in\">remove</span>(join_paths(vim.fn.stdpath <span class=\"string\">\"config\"</span>, <span class=\"string\">\"after\"</span>))</span><br><span class=\"line\">    vim.opt.rtp:prepend(<span class=\"built_in\">self</span>.config_dir)</span><br><span class=\"line\">    vim.opt.rtp:append(join_paths(<span class=\"built_in\">self</span>.config_dir, <span class=\"string\">\"after\"</span>))</span><br><span class=\"line\">    <span class=\"comment\">-- <span class=\"doctag\">TODO:</span> we need something like this: vim.opt.packpath = vim.opt.rtp</span></span><br><span class=\"line\"></span><br><span class=\"line\">    vim.cmd <span class=\"string\">[[let &amp;packpath = &amp;runtimepath]]</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">-- <span class=\"doctag\">FIXME:</span> currently unreliable in unit-tests</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> in_headless <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">_G</span>.PLENARY_DEBUG = <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"built_in\">require</span>(<span class=\"string\">\"lvim.impatient\"</span>).setup {</span><br><span class=\"line\">      <span class=\"built_in\">path</span> = join_paths(<span class=\"built_in\">self</span>.cache_dir, <span class=\"string\">\"lvim_cache\"</span>),</span><br><span class=\"line\">      enable_profiling = <span class=\"literal\">true</span>,</span><br><span class=\"line\">    }</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">require</span>(<span class=\"string\">\"lvim.config\"</span>):init()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">require</span>(<span class=\"string\">\"lvim.plugin-loader\"</span>).init {</span><br><span class=\"line\">    package_root = <span class=\"built_in\">self</span>.pack_dir,</span><br><span class=\"line\">    install_path = <span class=\"built_in\">self</span>.packer_install_dir,</span><br><span class=\"line\">  }</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">self</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></tbody></table></figure>\n<h3 id=\"the-config-function-in-builtin-folder\"><span class=\"post-title-index\">9.2.3. </span><a class=\"markdownIt-Anchor\" href=\"#the-config-function-in-builtin-folder\"></a> The <code>config</code> function in <code>builtin</code> folder</h3>\n<p>For some plugins, such as <code>whichkey</code> and <code>telescope</code>, there are <code>M.config</code>\nfunctions in their configuration files. However, the <code>setup</code> function only uses\nsome variable defined in them and do not execute them first. The are executed by\nthe <code>init.lua</code> in the <code>builtin</code> folder.</p>\n<figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">M.config</span><span class=\"params\">(config)</span></span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> _, builtin_path <span class=\"keyword\">in</span> <span class=\"built_in\">ipairs</span>(builtins) <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"keyword\">local</span> builtin = <span class=\"built_in\">require</span>(builtin_path)</span><br><span class=\"line\">    builtin.<span class=\"built_in\">config</span>(<span class=\"built_in\">config</span>)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></tbody></table></figure>\n<p>During the lunch process, the <code>config</code> functions will be called in front of the\nfunctions defined in the configuration file <code>config.lua</code>.</p>\n<h2 id=\"the-nerd-fonts\"><span class=\"post-title-index\">9.3. </span><a class=\"markdownIt-Anchor\" href=\"#the-nerd-fonts\"></a> The nerd-fonts</h2>\n<p>The font is only related to your local devices. It is not related to the remote\ndevice.</p>\n<p>To install the nerd fonts, you need to download the nerd version of your fonts,\nfor example I use <code>hack</code>, though\n<a href=\"https://www.nerdfonts.com/font-downloads\">this</a> or\n<a href=\"https://github.com/ryanoasis/nerd-fonts\">this</a>. Then put it in your font\ndirectory. For windows, it is <code>C:\\Windows\\Fonts</code>. Finally, restart your terminal\nand set your terminal such as mobaxterm to use that font.</p>\n<h2 id=\"debug-system\"><span class=\"post-title-index\">9.4. </span><a class=\"markdownIt-Anchor\" href=\"#debug-system\"></a> Debug system</h2>\n<h3 id=\"lvimlog\"><span class=\"post-title-index\">9.4.1. </span><a class=\"markdownIt-Anchor\" href=\"#lvimlog\"></a> lvim.log</h3>\n<ol>\n<li>The file is in <code>~/.cache/</code> which is defined by\n<code>~/.local/share/lunarvim/lvim/lua/lvim/core/log.lua</code>. Using <code>Log:warn/debug</code>\nwill write logs in the file.</li>\n<li><code>lvim.log.level</code> controls the level that will be print into the <code>lvim.log</code>\n(see <code>local log_level = Log.levels[(lvim.log.level):upper() or \"WARN\"]</code> in\nthe <code>log.lua</code>. <code>function Log:get_path()</code> sets the path and name of the log\nfile.</li>\n<li><code>log.lua</code> used <code>structlog</code> which is a plugin of nvim defined in the\n<code>plugins.lua</code>. In the readme of <code>structlog</code>:\n<blockquote>\n<p><code>structlog</code> makes logging in lua less painful and more powerful by adding\nstructure to your log entries.</p>\n</blockquote>\n</li>\n</ol>\n<h2 id=\"plugins\"><span class=\"post-title-index\">9.5. </span><a class=\"markdownIt-Anchor\" href=\"#plugins\"></a> Plugins</h2>\n<h3 id=\"yank\"><span class=\"post-title-index\">9.5.1. </span><a class=\"markdownIt-Anchor\" href=\"#yank\"></a> yank</h3>\n<p>In the visual mode of <code>lunarvim</code>, <code>y</code> will yank the select chars into the system\nclipboard automatically. Do not use <code>\"+Y</code>, which will yank the whole line.\n<code>\"[~+]y</code> is also available.</p>\n<h3 id=\"projectnvim\"><span class=\"post-title-index\">9.5.2. </span><a class=\"markdownIt-Anchor\" href=\"#projectnvim\"></a> <code>project.nvim</code></h3>\n<p>If open vim in a subdirectory of a git package, and then open a new tmux pane or\nwindow, its initial path will be the main directory of that git package. The\n<code>manual mode</code> in <code>~/.local/share/lunarvim/lvim/lua/lvim/core/project.lua</code>\ndetermines vim change the directory or not.</p>\n<h4 id=\"with-lsp\"><span class=\"post-title-index\">9.5.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#with-lsp\"></a> With lsp</h4>\n<p>In the readme of <code>project</code>.</p>\n<blockquote>\n<p>Automagically cd to project directory using nvim lsp. If not then uses pattern\nmatching to cd to root directory</p>\n</blockquote>\n<p>This means that lsp has the function to find the project directories.</p>\n<h3 id=\"telescope\"><span class=\"post-title-index\">9.5.3. </span><a class=\"markdownIt-Anchor\" href=\"#telescope\"></a> Telescope</h3>\n<p>The <code>telescope</code> is depended on <code>fd</code>. To install <code>fd</code> do not use\n<code>apt install fdclone</code> which causes a collapse of nvim when run <code>telescope</code>.</p>\n<h4 id=\"telescope-in-which-key\"><span class=\"post-title-index\">9.5.3.1. </span><a class=\"markdownIt-Anchor\" href=\"#telescope-in-which-key\"></a> Telescope in which key</h4>\n<p><code>~/.local/share/lunarvim/lvim/lua/lvim/core/which-key.lua</code> defines many which\nkey mapping related to telescope. <leader>f can find the files in git repos\nwhich is the feature provided by <code>telescope.builtin</code> (see the document of\ntelescope). <code>&lt;leader&gt;sf</code> can find the files in current directory.</leader></p>\n<h3 id=\"comment\"><span class=\"post-title-index\">9.5.4. </span><a class=\"markdownIt-Anchor\" href=\"#comment\"></a> <code>Comment</code></h3>\n<p>An error occur with <code>Comment</code> when open <code>lvim</code>, which is solved by adding\n<code>tag = 'v0.6',</code> to the <code>plugins.lua</code> file the Comment part.</p>\n<h3 id=\"treesitter\"><span class=\"post-title-index\">9.5.5. </span><a class=\"markdownIt-Anchor\" href=\"#treesitter\"></a> Treesitter</h3>\n<h4 id=\"parsers-install\"><span class=\"post-title-index\">9.5.5.1. </span><a class=\"markdownIt-Anchor\" href=\"#parsers-install\"></a> Parsers install</h4>\n<p>11 parsers are defined to be installed in <code>~/.config/lvim/config.lua</code></p>\n<p>Parsers often failed to be downloaded. See\n<code>https://github.com/nvim-treesitter/nvim-treesitter#adding-parsers</code>. One can\ndownload it manually. And change the url of the parsers.</p>\n<p><a href=\"https://github.com/nvim-treesitter/nvim-treesitter#language-parsers\">parsers</a></p>\n<blockquote>\n<p>parser for every language need to be generated via <code>tree-sitter-cli</code> from\n<code>grammer.js</code> file, then complied to a <code>.so</code> library that needd to be placed in\nneovim’s <code>runtimepath</code> (typically under <code>parser/{language}.so</code>). To simplify\nthis, <code>nvim-treesitter</code> provides commands to automate this process. If the\nlanguage is already supported by <code>nvim-treesitter</code> you can install it with\n<code>TSInstall &lt;language&gt;</code></p>\n</blockquote>\n<p>The <code>{language}.so</code> files are in\n<code>~/.local/share/lunarvim/site/pack/packer/start/nvim-treesitter.git/parser</code>.</p>\n<!-- #### Notice -->\n<!-- treestter may not always perform a good highlight, e.g., for markdown or tex -->\n<!-- files. -->\n<h3 id=\"about-packer\"><span class=\"post-title-index\">9.5.6. </span><a class=\"markdownIt-Anchor\" href=\"#about-packer\"></a> About <code>packer</code></h3>\n<ol>\n<li>\n<p>the some plugins are installed in <code>opt</code> directory. Some are installed in\n<code>start</code> directory. This is controlled by the settings in <code>plugins.lua</code>. 7\nplugins are installed in <code>opt</code> directory, 6 of which are setted <code>event</code> and\nonly the 6 plugins are setted it. <code>lua-dev</code> is setted <code>module</code>.</p>\n<blockquote>\n<p>module = string or list – Specifies lua module name for require. When\nrequiring a string which starts with one of these module names, the plugin\nwill be loaded.</p>\n</blockquote>\n<blockquote>\n<p>event = string or list, – Specifies auto command events which load this\nplugin</p>\n</blockquote>\n<p>In the Readme of <code>Packer</code></p>\n<blockquote>\n<p><code>use</code> takes either a string or a table. If a string is provided, it is\ntreated as a plugin location (link) for a non-optional plugin with no\nadditional configuration.</p>\n</blockquote>\n<p><a href=\"https://github.com/wbthomason/packer.nvim/issues/237#issuecomment-787457600\">Opt</a></p>\n<blockquote>\n<p><code>start</code> packages are always available and loaded every time you start nvim,\nwhile <code>opt</code> packages are loaded on-demand with the <code>packadd</code> command. This\nis what <code>packer</code> uses to conditionally load plugins. <code>packer</code> itself\ndoesn’t run any code until you call <code>require('packer')</code>, so it should be\nfine to keep it as a start package.</p>\n</blockquote>\n<p><a href=\"https://github.com/wbthomason/packer.nvim/discussions/823#discussioncomment-2184455\">Opt</a></p>\n</li>\n</ol>\n<h3 id=\"lsp\"><span class=\"post-title-index\">9.5.7. </span><a class=\"markdownIt-Anchor\" href=\"#lsp\"></a> LSP</h3>\n<h4 id=\"the-setup-process\"><span class=\"post-title-index\">9.5.7.1. </span><a class=\"markdownIt-Anchor\" href=\"#the-setup-process\"></a> The setup process</h4>\n<ol>\n<li>the setup function of a lsp server is defined by the files in\n<code>~/.local/share/lunarvim/site/after/ftplugin</code>. <code>ftplugin</code> directory means\nfile type plugin. Vim will auto load this directory when it is in the runtime\npath. However, only the <code>filetype.lua/vim</code> will be loaded when open a file of\nparticular filetype. <code>~/.local/share/lunarvim/site/after/ftplugin</code> is\ncreated by <code>~/.local/share/lunarvim/lvim/lua/lvim/lsp/templates.lua</code> (see\nline 67). The server list is given in line 58. The content in the files in\nftplugins is given in line 40. The <code>ft.lua</code> will call <code>lvim.lsp.manager</code>\nwhich is a function defined in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/lsp/manager.lua</code>. It setup the lsp\nservers since when <code>ft.lua</code> is removed, the lsp server will not start.</li>\n<li>The configuration files of <code>nvim-lspconfig</code> are listed in\n<code>~/.local/share/lunarvim/site/pack/packer/start/nvim-lspconfig.git/lua/lspconfig/server_configurations</code>.\nWhich can be modified.</li>\n<li>The servers installed by <code>lsp-installer</code> are installed in\n<code>~/.local/share/nvim/lsp_servers</code></li>\n<li>see <code>setup</code> function in <code>manager.lua</code></li>\n</ol>\n<figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">M.setup</span><span class=\"params\">(server_name, user_config)</span></span></span><br><span class=\"line\">  vim.validate { name = { server_name, <span class=\"string\">\"string\"</span> } }</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> lvim_lsp_utils.is_client_active(server_name) <span class=\"keyword\">or</span> client_is_configured(server_name) <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">local</span> <span class=\"built_in\">config</span> = resolve_config(server_name, user_config)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">local</span> servers = <span class=\"built_in\">require</span> <span class=\"string\">\"nvim-lsp-installer.servers\"</span></span><br><span class=\"line\">  <span class=\"keyword\">local</span> server_available, requested_server = servers.get_server(server_name)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">-- if not server available in nvim-lsp-installer, call lspconfig[server_name].setup(config)</span></span><br><span class=\"line\">  <span class=\"comment\">-- if the server is  available it will be set up by nvim-lsp-installer.</span></span><br><span class=\"line\">  <span class=\"comment\">-- that is to say all the servers will preferentially be set upped by nvim-lsp-installer.</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">-- NOTE THAT</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">-- Most servers will be set uppped by nvim-lsp-installer by this way.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> server_available <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\">-- The pcall function calls its first argument in protected mode, so that it</span></span><br><span class=\"line\">    <span class=\"comment\">-- catches any errors while the function is running. If there are no errors, pcall</span></span><br><span class=\"line\">    <span class=\"comment\">-- returns true, plus any values returned by the call. Otherwise, it returns false,</span></span><br><span class=\"line\">    <span class=\"comment\">-- plus the error message.</span></span><br><span class=\"line\">    <span class=\"built_in\">pcall</span>(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span></span><br><span class=\"line\">      <span class=\"built_in\">require</span>(<span class=\"string\">\"lspconfig\"</span>)[server_name].setup(<span class=\"built_in\">config</span>)</span><br><span class=\"line\">      buf_try_add(server_name)</span><br><span class=\"line\">    <span class=\"keyword\">end</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">local</span> install_notification = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> requested_server:is_installed() <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> lvim.lsp.automatic_servers_installation <span class=\"keyword\">then</span></span><br><span class=\"line\">      Log:<span class=\"built_in\">debug</span> <span class=\"string\">\"Automatic server installation detected\"</span></span><br><span class=\"line\">      requested_server:install()</span><br><span class=\"line\">      install_notification = <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      Log:<span class=\"built_in\">debug</span>(requested_server.name .. <span class=\"string\">\" is not managed by the automatic installer\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  requested_server:on_ready(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> install_notification <span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"comment\">-- `vim.notify` is defined in `log.lua` in lvim folder.</span></span><br><span class=\"line\">      <span class=\"comment\">-- &gt; `vim.notify` A fancy, configurable, notification manager for NeoVim.</span></span><br><span class=\"line\">      <span class=\"comment\">-- `vim.log.levels.INFO` is defined in the `lua-dev` plunin defined in `plugins.lua`.</span></span><br><span class=\"line\">      <span class=\"comment\">-- &gt; `lua-dev` setup for init.lua and plugin development with full signature help,</span></span><br><span class=\"line\">      <span class=\"comment\">-- &gt; docs and completion for the nvim lua API.</span></span><br><span class=\"line\">      <span class=\"comment\">-- i do not find where the vim.log.levels is required by `manager.lua`.</span></span><br><span class=\"line\">      <span class=\"comment\">-- I think vim.log.levels must be in the search path of nvim thus it can find it</span></span><br><span class=\"line\">      <span class=\"comment\">-- though the search path.</span></span><br><span class=\"line\">      vim.notify(<span class=\"built_in\">string</span>.<span class=\"built_in\">format</span>(<span class=\"string\">\"Installation complete for [%s] server\"</span>, requested_server.name), vim.<span class=\"built_in\">log</span>.levels.INFO)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">    install_notification = <span class=\"literal\">false</span></span><br><span class=\"line\">    requested_server:setup(<span class=\"built_in\">config</span>)</span><br><span class=\"line\">    <span class=\"comment\">-- Log:warn(config)</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span>)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></tbody></table></figure>\n<p>From the code we know that most of the servers will be setup by\n<code>nvim-lsp-installer</code> (see <code>requested_server:setup(config)</code>). However, thought\nthis the configuration for manually setup server is not works. From the document\nof <code>nvim-lsp-installer</code>,\n<a href=\"https://github.com/williamboman/nvim-lsp-installer/blob/40442b67a151fc2a58a790fd7e74a7487f1f9157/doc/nvim-lsp-installer.txt#L349\">server.setup</a>\nis deprecated. Thus I change the <code>setup</code> function in <code>manager.lua</code>.</p>\n<figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">M.setup</span><span class=\"params\">(server_name, user_config)</span></span></span><br><span class=\"line\">  vim.validate { name = { server_name, <span class=\"string\">\"string\"</span> } }</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> lvim_lsp_utils.is_client_active(server_name) <span class=\"keyword\">or</span> client_is_configured(server_name) <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">local</span> <span class=\"built_in\">config</span> = resolve_config(server_name, user_config)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">local</span> servers = <span class=\"built_in\">require</span> <span class=\"string\">\"nvim-lsp-installer.servers\"</span></span><br><span class=\"line\">  <span class=\"keyword\">local</span> server_available, requested_server = servers.get_server(server_name)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">-- if the server is installed then setup by lspconfig</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> requested_server:is_installed() <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">pcall</span>(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span></span><br><span class=\"line\">      <span class=\"built_in\">require</span>(<span class=\"string\">\"lspconfig\"</span>)[server_name].setup(<span class=\"built_in\">config</span>)</span><br><span class=\"line\">      buf_try_add(server_name)</span><br><span class=\"line\">    <span class=\"keyword\">end</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">local</span> install_notification = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">-- if the server is not installed, install it</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> requested_server:is_installed() <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> lvim.lsp.automatic_servers_installation <span class=\"keyword\">then</span></span><br><span class=\"line\">      Log:<span class=\"built_in\">debug</span> <span class=\"string\">\"Automatic server installation detected\"</span></span><br><span class=\"line\">      requested_server:install()</span><br><span class=\"line\">      install_notification = <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      Log:<span class=\"built_in\">debug</span>(requested_server.name .. <span class=\"string\">\" is not managed by the automatic installer\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  requested_server:on_ready(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> install_notification <span class=\"keyword\">then</span></span><br><span class=\"line\">      vim.notify(<span class=\"built_in\">string</span>.<span class=\"built_in\">format</span>(<span class=\"string\">\"Installation complete for [%s] server\"</span>, requested_server.name), vim.<span class=\"built_in\">log</span>.levels.INFO)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">    install_notification = <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"comment\">-- requested_server:setup(config)</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span>)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></tbody></table></figure>\n<h4 id=\"the-relationship-between-lspconfig-and-null-ls\"><span class=\"post-title-index\">9.5.7.2. </span><a class=\"markdownIt-Anchor\" href=\"#the-relationship-between-lspconfig-and-null-ls\"></a> the relationship between <code>lspconfig</code> and <code>null-ls</code></h4>\n<ol>\n<li>Both of them can use <code>latexindent</code> to format the tex file</li>\n<li><code>lspconfig</code> can not use <code>prettier</code>.</li>\n</ol>\n<p>Thus <code>null-ls</code> provide an extension tools for <code>lspconfig</code>. When <code>lspconfig</code> can\nmatch our requirement, we do not need to use <code>null-ls</code>, e.g., tools for tex\nfile.</p>\n<h4 id=\"the-relationship-between-lspconfig-and-lsp-installer\"><span class=\"post-title-index\">9.5.7.3. </span><a class=\"markdownIt-Anchor\" href=\"#the-relationship-between-lspconfig-and-lsp-installer\"></a> the relationship between <code>lspconfig</code> and <code>lsp-installer</code></h4>\n<ol>\n<li><code>lsp-installer</code> depends on <code>lspconfig</code> as in the readme of <code>lsp-installer</code>.</li>\n<li>lvim strives to have support for all major languages. This is made possible\nby plugins such as <code>nvim-lspconfig</code>, for LSP support, and <code>null-ls</code> to\nprovide support for handing external formatters, such as <code>prettier</code> and\n<code>eslint</code>.</li>\n</ol>\n<p><code>lua print(vim.inspect(vim.lsp.buf_get_clients()[2].resolved_capabilities))</code> see\nthe detail of server clients.</p>\n<h4 id=\"code-action\"><span class=\"post-title-index\">9.5.7.4. </span><a class=\"markdownIt-Anchor\" href=\"#code-action\"></a> Code Action</h4>\n<p>Code action = quick fixes and refactoring</p>\n<h3 id=\"the-lualine\"><span class=\"post-title-index\">9.5.8. </span><a class=\"markdownIt-Anchor\" href=\"#the-lualine\"></a> The lualine</h3>\n<p>The status line is defined in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/core/lualine/init.lua</code> line 5 which can\nbe chose as <code>default</code>, <code>lvim</code>, or <code>none</code>. The are defined in the\n<code>~/.local/share/lunarvim/lvim/lua/lvim/core/lualine/styles.lua</code> file. The\ncomponent are defined in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/core/lualine/components.lua</code>.</p>\n<h3 id=\"the-whichkey\"><span class=\"post-title-index\">9.5.9. </span><a class=\"markdownIt-Anchor\" href=\"#the-whichkey\"></a> The whichkey</h3>\n<p>Which key can define key mappings for vim. They are defined in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/core/which-key.lua</code>. The use of\n<code>telescope</code> can be learned by reading <code>which-key.lua</code>, since the key mapping of\n<code>telescope</code> is defined in it.</p>\n<p>The lsp also used which key, which is defined in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/lsp/config.lua</code> and used/registered in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/lsp/init.lua</code>. Which key makes the key\nmappings more organized.</p>\n<h4 id=\"modify-which-key-map\"><span class=\"post-title-index\">9.5.9.1. </span><a class=\"markdownIt-Anchor\" href=\"#modify-which-key-map\"></a> Modify which key map</h4>\n<p>To modify which key maps, for example, <code>&lt;leader&gt;sp</code> is defined in\n<code>whichkey.lua</code>. I want to change it in <code>config.lua</code>.\n<code>lvim.builtin.which_key.mappings[\"sp\"] = { \"&lt;CMD&gt;Telescope projects&lt;CR&gt;\", \"Project\" }</code>\ndoes not work.</p>\n<p><code>lvim.builtin.which_key.mappings.s[\"p\"] = { \"&lt;CMD&gt;Telescope projects&lt;CR&gt;\", \"Project\" }</code>\nworks. <code>lvim.builtin.which_key.mappings.s</code> is a table, and the <code>config</code> function\nin <code>which-key.lua</code> is executed in front of the <code>config.lua</code>. So that the value\nof key <code>p</code> can be modified.</p>\n<h3 id=\"the-alpha\"><span class=\"post-title-index\">9.5.10. </span><a class=\"markdownIt-Anchor\" href=\"#the-alpha\"></a> The alpha</h3>\n<p>The start cover is defined in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/core/alpha/startify.lua</code>.</p>\n<h3 id=\"nvim-notify\"><span class=\"post-title-index\">9.5.11. </span><a class=\"markdownIt-Anchor\" href=\"#nvim-notify\"></a> nvim-notify</h3>\n<p>The notation manager and message manager for nvim.</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"安装-anaconda\"><a class=\"markdownIt-Anchor\" href=\"#安装-anaconda\"></a> 安装 anaconda</h1>\n<p>本来安装 anaconda 应该问题不大，但是却发现了一个问题。\n<code>./Anaconda3-2021.11-Linux-x86_64.sh: 489: [[: Exec format error</code> 这个错，是因为\n直用./Anaconda.sh 启动安装默认用的是 sh 改成了 bash <a href=\"http://Anaconda.sh\">Anaconda.sh</a> 就不会报错了.</p>\n<h1 id=\"一些碎的-linux-知识\"><a class=\"markdownIt-Anchor\" href=\"#一些碎的-linux-知识\"></a> 一些碎的 Linux 知识</h1>\n<h2 id=\"查找包的安装位置\"><a class=\"markdownIt-Anchor\" href=\"#查找包的安装位置\"></a> 查找包的安装位置</h2>\n<p>一些软件用 apt install 了，但是不知道安装位置在哪里 <code>dpkg -L xxx</code>显示包的安装位\n置．</p>\n<h2 id=\"编译错误定位\"><a class=\"markdownIt-Anchor\" href=\"#编译错误定位\"></a> 编译错误定位</h2>\n<p>编译的时候,打印一些 log 但是并不详细一般会有更加详细的编译 log 文件，在里面可以\n更精确的定位错误发生的原因．</p>\n<h2 id=\"linux-的环境变量可能是两个\"><a class=\"markdownIt-Anchor\" href=\"#linux-的环境变量可能是两个\"></a> linux 的环境变量可能是两个</h2>\n<p><code>LIBRARY_PATH</code>编译的时候用到的库的搜索路径 <code>LD_LIBRARY_PATH</code>程序加载时库的搜索路\n径</p>\n<h2 id=\"遇到一个问题明明再搜索路径下有动态库却报错所无法找到\"><a class=\"markdownIt-Anchor\" href=\"#遇到一个问题明明再搜索路径下有动态库却报错所无法找到\"></a> 遇到一个问题明明再搜索路径下有动态库，却报错所无法找到</h2>\n<p>okular: error while loading shared libraries: libQt5Core.so.5: cannot open\nshared object file: No such file or directory 用 strip 处理完之后解决 sudo strip\n–remove-section=.note.ABI-tag /usr/lib/x86_64-linux-gnu/libQt5Core.so.5</p>\n<h1 id=\"编译-vim\"><a class=\"markdownIt-Anchor\" href=\"#编译-vim\"></a> 编译 vim</h1>\n<p>apt 安装的 vim 不能随意的控制 vim 的特性，比如在 latex 反向搜索的时候需要的\n+clietservice。 apt-cache search libc-dev ln -s libXtst.so.6 <a href=\"http://libXtst.so\">libXtst.so</a> 综合两篇\n博客。 <a href=\"https://www.jianshu.com/p/aa5ea81bbc72\">https://www.jianshu.com/p/aa5ea81bbc72</a>\n<a href=\"https://toutiao.io/posts/runvgs/preview\">https://toutiao.io/posts/runvgs/preview</a> 尽量多的保留特性，最终得到的 config 命令\n是</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --<span class=\"keyword\">with</span>-features=huge \\</span><br><span class=\"line\">    --enable-multibyte \\</span><br><span class=\"line\">    --enable-rubyinterp=yes \\</span><br><span class=\"line\">    --enable-python3interp=yes \\</span><br><span class=\"line\">    --enable-perlinterp=yes \\</span><br><span class=\"line\">    --enable-cscope \\</span><br><span class=\"line\">    --enable-fontset \\</span><br><span class=\"line\">    --enable-largefile \\</span><br><span class=\"line\">    --enable-fail-<span class=\"keyword\">if</span>-missing \\</span><br><span class=\"line\">    --prefix=/path-to-install</span><br></pre></td></tr></table></figure>\n<p><code>--enable-fail-if-missing</code> 用于显示错误信息。</p>\n<h2 id=\"很久没有成功最后-apt-安装解决了\"><a class=\"markdownIt-Anchor\" href=\"#很久没有成功最后-apt-安装解决了\"></a> 很久没有成功，最后 apt 安装解决了</h2>\n<p>编译的时候 feature 用了 hug，但是还是没有增加+clientserver。我估计是缺少库。查\nsrc/auto/cofig.log 也没有发现很相关的信息。最后<code>sudo apt-get install vim-gtk</code>成\n功安装了+clientserver 的 vim。</p>\n<h1 id=\"tmux\"><a class=\"markdownIt-Anchor\" href=\"#tmux\"></a> tmux</h1>\n<p>To enable vi key mode in tmux. I mapped <code>hjkl</code> for select the pane.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bind -r &#x27;h&#x27; select-pane -L  # move left</span><br><span class=\"line\">bind -r &#x27;j&#x27; select-pane -D  # move down</span><br><span class=\"line\">bind -r &#x27;k&#x27; select-pane -U  # move up</span><br><span class=\"line\">bind -r &#x27;l&#x27; select-pane -R  # move right</span><br></pre></td></tr></table></figure>\n<p><code>r</code> means I can change the pane continually by click <code>&lt;prefix&gt;</code> and twice <code>k</code>.</p>\n<h1 id=\"a-practice-of-vim\"><a class=\"markdownIt-Anchor\" href=\"#a-practice-of-vim\"></a> A practice of vim</h1>\n<h2 id=\"search-and-replace\"><a class=\"markdownIt-Anchor\" href=\"#search-and-replace\"></a> Search and Replace</h2>\n<p><code>:.,$s/old/new/gc</code>, where <code>g</code> means match all for each line and <code>c</code> means ask me\nbefore replace at each position. Without <code>g</code> only the first match of each line\nwill be considered.</p>\n<h1 id=\"why-lua-instead-of-vimlvim-script\"><a class=\"markdownIt-Anchor\" href=\"#why-lua-instead-of-vimlvim-script\"></a> Why lua instead of vimL(vim script)</h1>\n<h2 id=\"introduction\"><a class=\"markdownIt-Anchor\" href=\"#introduction\"></a> Introduction</h2>\n<p>Neovim has an embedded lua 5.1 runtime which is used to create faster and more\npowerful extentions of you favorite efitor.</p>\n<ol>\n<li>VimL is a slow interpreted language with almost no optimizations. Much of the\ntime spent in vim startup and in actions from plugins that can block the main\nloop in the editor is in parsing and executing vim script.</li>\n</ol>\n<h2 id=\"how-to-use-lua-in-command-line-or-viml-file\"><a class=\"markdownIt-Anchor\" href=\"#how-to-use-lua-in-command-line-or-viml-file\"></a> How to use lua in command line or vimL file</h2>\n<p>see <code>:h lua</code>.</p>\n<ul>\n<li>From the vim command line, you can run <code>lua &lt;you code&gt;</code>. This is useful for\nkeybindings, commands, and other one-off execution cases.</li>\n<li>Inside of a vimL file, you can demarcate lua code with the follow code\nfencing:</li>\n</ul>\n<figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">lua</span> &lt;&lt; EOF</span><br><span class=\"line\">-- your <span class=\"keyword\">lua</span> code</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Inside of a vimL file you can use the <code>lua</code> keyword to execute commands\nsimilar to the first example,i.e., <code>lua &lt;your code&gt;</code>.</li>\n</ul>\n<p>One important note here is that Neovim will look for lua code in the\n<code>runtimepath</code> you’ve set in your settings. Additionally, it will append your\nruntimepath with <code>/lua/?.lua</code> and <code>lua/?/init.lua</code> so it is common practice to\nsee a <code>/lua</code> sub-directory inside <code>nvim</code>. For more detailed information about\nwhere Neovim looks for lua code, check out <code>:h lua-require</code>.</p>\n<p><a href=\"https://github.com/nanotee/nvim-lua-guide\">More Information</a></p>\n<h1 id=\"debug-vim\"><a class=\"markdownIt-Anchor\" href=\"#debug-vim\"></a> Debug vim</h1>\n<ol>\n<li><code>:message/:mes</code> will display the messages that your configuration files\nprint.</li>\n<li><code>:nmap</code> or <code>:imap</code> can check all the shortcuts of normal or insert mode.\n<code>:map</code> lists the shortcuts of all modes. However, I find that some shortcuts\ndefined can not be find by <code>:map</code>.</li>\n</ol>\n<h1 id=\"a-practice-for-neovim-from-scratch\"><a class=\"markdownIt-Anchor\" href=\"#a-practice-for-neovim-from-scratch\"></a> A Practice for <code>Neovim-from-scratch</code></h1>\n<h2 id=\"install\"><a class=\"markdownIt-Anchor\" href=\"#install\"></a> Install</h2>\n<ol>\n<li>Plugins are defined in <code>~/.config/nvim/lua/user/plugins.lua</code>. The plugins\nwill fail to be installed due to the internet of China Mainland. Thus, git is\nasked to be configured with ssh. Then the path of plugins can be changed by\nadd <code>git@github.com:</code> before the original path.</li>\n<li><code>treesitter</code> is a plugin for syntax-hight. It will install a series of\nlanguage parsers. They are defined in\n<code>~/.config/nvim/lua/user/treesitter.lua</code>. By setting\n<code>ensure_installed = &#123;'astro', 'xxx'&#125;</code>, we can define the parsers to be\ndownload. Also, download errors may be occurred due to the internet. The path\nof these language parsers are defined in\n<code>~/.local/share/nvim/site/pack/packer/start/nvim-treesitter/lua/nvim-treesitter/parsers.lua</code>,\nwhich may be changed by download with ssh.</li>\n</ol>\n<h2 id=\"analysis\"><a class=\"markdownIt-Anchor\" href=\"#analysis\"></a> Analysis</h2>\n<ol>\n<li>\n<p>There are 21 files required in <code>init.lua</code>. They are exactly the 21 files in\n<code>lua/user</code> folder. About 34 plugins are defined in <code>plugins.lua</code>. The lua\nfiles are all the configuration file of the plugins defined in <code>plugins.lua</code>,\nexcept for <code>keymaps.lua</code>, <code>option.lua</code>, <code>autocommand.lua</code>. <code>plugins.lua</code>\nitself is the configuration file of <code>packer.nvim</code>, a plugin manager.</p>\n</li>\n<li>\n<p>Here gives a brief look at the plugins.</p>\n<ol>\n<li><code>packer.nvim</code> is a plugin manager.</li>\n<li><code>Alpha-vim</code> is a plugin used by Neovim-from-scratch. It allow one to\ncustom the greeter for neovim</li>\n<li><code>popup.nvim</code>, An implementation of the Popup API from vim in neovim.</li>\n<li><code>plenary.nvim</code>, implement some useful window management items for neovim.</li>\n<li><code>nvim-autopais</code> A super powerful auto pair plugin for neovim that supports\nmultiple characters.</li>\n<li><code>Comment.nvim</code> Smart and Powerful commenting plugin for neovim.</li>\n<li><code>nvim-web-devicons</code> A lua fork of <code>vim-devicons</code>. This plugin provides the\nsame icons as well as colors for each icon</li>\n<li><code>nvim-tree-lua</code> A file explorer for neovim written in lua.</li>\n<li><code>bufferline.nvim</code> A snazzy buffer line (with tabpage integration) for\nneovim built using lua.</li>\n<li><code>vim-bbye</code> Bbye allows you to do delete buffers (close files) without\ncolosing you windows or messing up your layout.</li>\n<li><code>lualine.nvim</code> A blazing fast and easy to configure neovim status line\nwritten in lua.</li>\n<li><code>toggleterm.nvim</code> A neovim plugin to persist and toggle multiple\nterminals during an editing session.</li>\n<li><code>project.nvim</code> an all in one neovim plugin written in lua that provides\nsuperior project management.</li>\n<li><code>impatient.nvim</code> speed up loading lua modules in neovim to improve start\nup time.</li>\n<li><code>indent-blankline.nvim</code> adds indentation guides to all lines (including\nempty lines.)</li>\n<li><code>FixCursorHold.nvim</code> This is needed to fix lsp doc highlight.</li>\n<li><code>which-key.nvim</code> a lua plugin that displays a popup with possible key\nbindings of the command you started typing.</li>\n<li><code>darkplus.nvim</code> color themes</li>\n<li><code>nvim-cmp</code> The completion plugin</li>\n<li><code>cmp-buffer</code> buffer completions</li>\n<li><code>cmp-path</code> path completions</li>\n<li><code>cmp-cmdline</code> cmdline completions</li>\n<li><code>cmp_luasnip</code> snippet completions.</li>\n<li><code>cmp-nvim-lsp</code> nvim-cmp source for neovim’s built-in language server\nclient.</li>\n<li><code>LuaSnip</code> snippet engin</li>\n<li><code>friendly-snippets</code> a bunch of snippets to use</li>\n<li><code>nvim-lspconfig</code> A collection of common configurations for neovim’s\nbuilt-in language server clinet. Features: go-to-definition,\nfind-references, hover, completion, rename, format, refactor.</li>\n<li><code>nvim-lsp-installer</code> allows you to seamlessly install LSP server\nlocally(inside <code>:echo stdpaht(&quot;data&quot;)</code>)</li>\n<li><code>nlsp-settings.nvim</code> A plugin to configure LSP using json/yaml files like\n<code>coc-setting.json</code></li>\n<li><code>null-ls.nvim</code> for formatters and linters, use neovim as a language\nserver to inject LSP diagnostic, code actions, and more via lua</li>\n<li><code>telescope.nvim</code> a highly extendable fuzzy finder over lists.</li>\n<li><code>nvim-treesitter</code> both provide a simple and easy way to use the interface\nfor <code>tree-sitter</code> in neovim and to provide some basic functionality such\nas highlighting based on it.</li>\n<li><code>nvim-ts-context-commentstring&quot;</code> setting <code>comment string</code> option based on\nthe cursor location in the file. The location is checked via treesitter\nqueries.</li>\n<li><code>gitsigns.nvim</code> Git</li>\n</ol>\n</li>\n<li>\n<p>The plugins are installed in <code>~/.local/share/nvim/site/pack/packer/start</code>,\nwhich is defined in the <code>install_path</code> in <code>plugins.lua</code>.</p>\n</li>\n</ol>\n<h1 id=\"analyze-lunarvim\"><a class=\"markdownIt-Anchor\" href=\"#analyze-lunarvim\"></a> Analyze <code>LunarVim</code></h1>\n<h2 id=\"the-install-script-installsh\"><a class=\"markdownIt-Anchor\" href=\"#the-install-script-installsh\"></a> The Install Script <code>install.sh</code></h2>\n<p>25 functions are defined in <code>install.sh</code>.</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">_</span><span class=\"built_in\">_</span>attempt<span class=\"built_in\">_</span>to<span class=\"built_in\">_</span>install<span class=\"built_in\">_</span>with<span class=\"built_in\">_</span>cargo</span><br><span class=\"line\"><span class=\"built_in\">_</span><span class=\"built_in\">_</span>install<span class=\"built_in\">_</span>nodejs<span class=\"built_in\">_</span>deps<span class=\"built_in\">_</span>npm</span><br><span class=\"line\"><span class=\"built_in\">_</span><span class=\"built_in\">_</span>install<span class=\"built_in\">_</span>nodejs<span class=\"built_in\">_</span>deps<span class=\"built_in\">_</span>pnpm</span><br><span class=\"line\"><span class=\"built_in\">_</span><span class=\"built_in\">_</span>install<span class=\"built_in\">_</span>nodejs<span class=\"built_in\">_</span>deps<span class=\"built_in\">_</span>yarn</span><br><span class=\"line\"><span class=\"built_in\">_</span><span class=\"built_in\">_</span>validate<span class=\"built_in\">_</span>node<span class=\"built_in\">_</span>installation</span><br><span class=\"line\">backup<span class=\"built_in\">_</span>old<span class=\"built_in\">_</span>config</span><br><span class=\"line\">check<span class=\"built_in\">_</span>neovim<span class=\"built_in\">_</span>min<span class=\"built_in\">_</span>version</span><br><span class=\"line\">check<span class=\"built_in\">_</span>system<span class=\"built_in\">_</span>deps</span><br><span class=\"line\">clone<span class=\"built_in\">_</span>lvim</span><br><span class=\"line\">detect<span class=\"built_in\">_</span>platform</span><br><span class=\"line\">install<span class=\"built_in\">_</span>nodejs<span class=\"built_in\">_</span>deps</span><br><span class=\"line\">install<span class=\"built_in\">_</span>python<span class=\"built_in\">_</span>deps</span><br><span class=\"line\">install<span class=\"built_in\">_</span>rust<span class=\"built_in\">_</span>deps</span><br><span class=\"line\">link<span class=\"built_in\">_</span>local<span class=\"built_in\">_</span>lvim</span><br><span class=\"line\">main</span><br><span class=\"line\">msg</span><br><span class=\"line\">parse<span class=\"built_in\">_</span>arguments</span><br><span class=\"line\">print<span class=\"built_in\">_</span>logo</span><br><span class=\"line\">print<span class=\"built_in\">_</span>missing<span class=\"built_in\">_</span>dep<span class=\"built_in\">_</span>msg</span><br><span class=\"line\">remove<span class=\"built_in\">_</span>old<span class=\"built_in\">_</span>cache<span class=\"built_in\">_</span>files</span><br><span class=\"line\">setup<span class=\"built_in\">_</span>lvim</span><br><span class=\"line\">setup<span class=\"built_in\">_</span>shim</span><br><span class=\"line\">usage</span><br><span class=\"line\">validate<span class=\"built_in\">_</span>lunarvim<span class=\"built_in\">_</span>files</span><br><span class=\"line\">verify<span class=\"built_in\">_</span>lvim<span class=\"built_in\">_</span>dirs</span><br></pre></td></tr></table></figure>\n<p>The last line <code>main &quot;$@&quot;</code> shows that it well execute the <code>main</code> function first.\n<code>$@</code> means that all the args will be passed to the function.</p>\n<h3 id=\"function-main\"><a class=\"markdownIt-Anchor\" href=\"#function-main\"></a> Function <code>main</code></h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\"><span class=\"comment\"># function parse_arguments is defined to parse the arguments passed by</span></span><br><span class=\"line\"><span class=\"comment\"># &quot;$@$&quot;</span></span><br><span class=\"line\">  parse_arguments <span class=\"string\">&quot;<span class=\"variable\">$@</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># print the logo of lunarvim</span></span><br><span class=\"line\">  print_logo</span><br><span class=\"line\"></span><br><span class=\"line\">  msg <span class=\"string\">&quot;Detecting platform for managing any additional neovim dependencies&quot;</span></span><br><span class=\"line\">  detect_platform</span><br><span class=\"line\">  <span class=\"comment\"># check if the git and neovim is installed</span></span><br><span class=\"line\">  check_system_deps</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$ARGS_INSTALL_DEPENDENCIES</span>&quot;</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$INTERACTIVE_MODE</span>&quot;</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">      msg <span class=\"string\">&quot;Would you like to install LunarVim&#x27;s NodeJS dependencies?&quot;</span></span><br><span class=\"line\">      <span class=\"built_in\">read</span> -p <span class=\"string\">&quot;[y]es or [n]o (default: no) : &quot;</span> -r answer</span><br><span class=\"line\">      [ <span class=\"string\">&quot;<span class=\"variable\">$answer</span>&quot;</span> != <span class=\"string\">&quot;<span class=\"variable\">$&#123;answer#[Yy]&#125;</span>&quot;</span> ] &amp;&amp; install_nodejs_deps</span><br><span class=\"line\"></span><br><span class=\"line\">      msg <span class=\"string\">&quot;Would you like to install LunarVim&#x27;s Python dependencies?&quot;</span></span><br><span class=\"line\">      <span class=\"built_in\">read</span> -p <span class=\"string\">&quot;[y]es or [n]o (default: no) : &quot;</span> -r answer</span><br><span class=\"line\">      [ <span class=\"string\">&quot;<span class=\"variable\">$answer</span>&quot;</span> != <span class=\"string\">&quot;<span class=\"variable\">$&#123;answer#[Yy]&#125;</span>&quot;</span> ] &amp;&amp; install_python_deps</span><br><span class=\"line\"></span><br><span class=\"line\">      msg <span class=\"string\">&quot;Would you like to install LunarVim&#x27;s Rust dependencies?&quot;</span></span><br><span class=\"line\">      <span class=\"built_in\">read</span> -p <span class=\"string\">&quot;[y]es or [n]o (default: no) : &quot;</span> -r answer</span><br><span class=\"line\">      [ <span class=\"string\">&quot;<span class=\"variable\">$answer</span>&quot;</span> != <span class=\"string\">&quot;<span class=\"variable\">$&#123;answer#[Yy]&#125;</span>&quot;</span> ] &amp;&amp; install_rust_deps</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      install_nodejs_deps</span><br><span class=\"line\">      install_python_deps</span><br><span class=\"line\">      install_rust_deps</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># backup old config of lunarvim if it is installed before</span></span><br><span class=\"line\">  backup_old_config</span><br><span class=\"line\">  <span class=\"comment\"># if the paths are not already, mkdir them</span></span><br><span class=\"line\">  verify_lvim_dirs</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$ARGS_LOCAL</span>&quot;</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    link_local_lvim</span><br><span class=\"line\">  <span class=\"keyword\">elif</span> [ -d <span class=\"string\">&quot;<span class=\"variable\">$LUNARVIM_BASE_DIR</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    validate_lunarvim_files</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    clone_lvim</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">  setup_lvim</span><br><span class=\"line\"></span><br><span class=\"line\">  msg <span class=\"string\">&quot;Thank you for installing LunarVim!!&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;You can start it by running: <span class=\"variable\">$INSTALL_PREFIX</span>/bin/lvim&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Do not forget to use a font with glyphs (icons) support [https://github.com/ryanoasis/nerd-fonts]&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"function-clone_lvim\"><a class=\"markdownIt-Anchor\" href=\"#function-clone_lvim\"></a> Function <code>clone_lvim</code></h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">clone_lvim</span></span>() &#123;</span><br><span class=\"line\">  msg <span class=\"string\">&quot;Cloning LunarVim configuration&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ! git <span class=\"built_in\">clone</span> --branch <span class=\"string\">&quot;<span class=\"variable\">$LV_BRANCH</span>&quot;</span> \\</span><br><span class=\"line\">    <span class=\"comment\"># to download by ssh, change this line to</span></span><br><span class=\"line\">    <span class=\"comment\"># `--depth 1 &quot;git@github.com:LunarVim/LunarVim.git&quot; &quot;$LUNARVIM_BASE_DIR&quot;; then`</span></span><br><span class=\"line\">    --depth 1 <span class=\"string\">&quot;https://github.com/<span class=\"variable\">$&#123;LV_REMOTE&#125;</span>&quot;</span> <span class=\"string\">&quot;<span class=\"variable\">$LUNARVIM_BASE_DIR</span>&quot;</span>; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Failed to clone repository. Installation failed.&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"function-setup_lvim\"><a class=\"markdownIt-Anchor\" href=\"#function-setup_lvim\"></a> Function <code>setup_lvim</code></h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">setup_lvim</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  remove_old_cache_files</span><br><span class=\"line\"></span><br><span class=\"line\">  msg <span class=\"string\">&quot;Installing LunarVim shim&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># output the executable file of `lvim` which lies in `~/.local/bin/lvim`</span></span><br><span class=\"line\">  setup_shim</span><br><span class=\"line\"></span><br><span class=\"line\">  cp <span class=\"string\">&quot;<span class=\"variable\">$LUNARVIM_BASE_DIR</span>/utils/installer/config.example.lua&quot;</span> <span class=\"string\">&quot;<span class=\"variable\">$LUNARVIM_CONFIG_DIR</span>/config.lua&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Preparing Packer setup&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Prepare Packer, this is done by `nvim -u init.lua --headless -c &#x27;autocmd User PackerComplete quitall&#x27; -c &#x27;PackerSync&#x27;`</span></span><br><span class=\"line\">  <span class=\"comment\"># `--headless` means Don&#x27;t start a user interface.</span></span><br><span class=\"line\">  <span class=\"comment\"># `-c &lt;cmd&gt;` means Execute &lt;cmd&gt; after config and first file</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># packer is often failed to be setup due to the network of the China Mainland</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Packer&#x27;s operation are asynchronous. Previously, to install plugins in a non</span></span><br><span class=\"line\">  <span class=\"comment\"># -interactive way, `nvim + PackerSync + 30sleep + quitall`.</span></span><br><span class=\"line\">  <span class=\"comment\"># It is not ideal since we do not really know that after 30 seconds, the plugin</span></span><br><span class=\"line\">  <span class=\"comment\"># install process should finish.</span></span><br><span class=\"line\">  <span class=\"comment\"># A more ideal way is to use autocmd PackerComplete</span></span><br><span class=\"line\">  <span class=\"comment\"># https://github.com/wbthomason/packer.nvim/blob/master/doc/packer.txt#L479</span></span><br><span class=\"line\">  <span class=\"comment\"># provided by Packer</span></span><br><span class=\"line\">  <span class=\"comment\"># `nvim -c &#x27;autocmd User PackerComplete quitall&#x27; -c &#x27;PackerSync&#x27;`</span></span><br><span class=\"line\">  <span class=\"comment\"># PackerComplete xxx: Fires xxx after install, update, clean, and sync</span></span><br><span class=\"line\">  <span class=\"comment\"># asynchronous operations finish</span></span><br><span class=\"line\">  <span class=\"comment\"># PackerSync: Perform &#x27;PackerUpdate&#x27; and then &#x27;PackerCompile&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\"># PackerUpdate: Clean, then update and install plugins</span></span><br><span class=\"line\">  <span class=\"comment\"># PackerCompile: You must run this or &#x27;PackerSync&#x27; whenever you make</span></span><br><span class=\"line\">  <span class=\"comment\"># changes to your plugin configuration. Regenerate compiled loader file.</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"string\">&quot;<span class=\"variable\">$INSTALL_PREFIX</span>/bin/lvim&quot;</span> --headless \\</span><br><span class=\"line\">    -c <span class=\"string\">&#x27;autocmd User PackerComplete quitall&#x27;</span> \\</span><br><span class=\"line\">    -c <span class=\"string\">&#x27;PackerSync&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Packer setup complete&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"function-setup_shim\"><a class=\"markdownIt-Anchor\" href=\"#function-setup_shim\"></a> Function <code>setup_shim</code></h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">setup_shim</span></span>() &#123;</span><br><span class=\"line\"> <span class=\"comment\">#  make -C ~/.local/share/lunarvim/lvim install-bin</span></span><br><span class=\"line\"> <span class=\"comment\"># `-C` specifies the directory of `Makefile`</span></span><br><span class=\"line\"> <span class=\"comment\"># `install-bin` is a target defined in `Makefile`</span></span><br><span class=\"line\"> <span class=\"comment\"># install-bin:</span></span><br><span class=\"line\"> <span class=\"comment\">#\t@echo starting LunarVim bin-installer</span></span><br><span class=\"line\"> <span class=\"comment\">#\tbash ./utils/installer/install_bin.sh</span></span><br><span class=\"line\"> <span class=\"comment\"># This command outputs `~/.local/bin/lvim`, the executable file of `lvim`,</span></span><br><span class=\"line\"></span><br><span class=\"line\">  make -C <span class=\"string\">&quot;<span class=\"variable\">$LUNARVIM_BASE_DIR</span>&quot;</span> install-bin</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>The <code>~/.local/bin/lvim</code> is</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> LUNARVIM_RUNTIME_DIR=<span class=\"string\">&quot;<span class=\"variable\">$&#123;LUNARVIM_RUNTIME_DIR:-&quot;~/.local/share/lunarvim&quot;&#125;</span>&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> LUNARVIM_CONFIG_DIR=<span class=\"string\">&quot;<span class=\"variable\">$&#123;LUNARVIM_CONFIG_DIR:-&quot;~/.config/lvim&quot;&#125;</span>&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> LUNARVIM_CACHE_DIR=<span class=\"string\">&quot;<span class=\"variable\">$&#123;LUNARVIM_CACHE_DIR:-&quot;~/.cache/nvim&quot;&#125;</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># `exec` is a builtin command of the Bash shell. It allows you to execute a</span></span><br><span class=\"line\"> <span class=\"comment\"># command that completely replaces the current process. The current shell process</span></span><br><span class=\"line\"> <span class=\"comment\"># is destroyed, and entirely replaced by the command you specify.</span></span><br><span class=\"line\"> <span class=\"comment\"># `-u` means use this config file, which is `~/.config/share/lunarvim/lvim/init.lua`</span></span><br><span class=\"line\"><span class=\"built_in\">exec</span> nvim -u <span class=\"string\">&quot;<span class=\"variable\">$LUNARVIM_RUNTIME_DIR</span>/lvim/init.lua&quot;</span> <span class=\"string\">&quot;<span class=\"variable\">$@</span>&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"function-msg\"><a class=\"markdownIt-Anchor\" href=\"#function-msg\"></a> Function <code>msg</code></h3>\n<p>Message or log is an effective tool to debug and make the users know the detail\nof the programming. Instead of simply using <code>print/echo</code> function, most\nprogrammers define their message functions to enable effective message giving.\nHave a look at this message function.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">msg</span></span>() &#123;</span><br><span class=\"line\"><span class=\"comment\"># local variable receives the message needed to be print.</span></span><br><span class=\"line\">  <span class=\"built_in\">local</span> text=<span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span></span><br><span class=\"line\">  <span class=\"built_in\">local</span> div_width=<span class=\"string\">&quot;80&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># before print the message a line comprised of `-` will be printed.</span></span><br><span class=\"line\">  <span class=\"comment\"># it will makes the message easily been noticed.</span></span><br><span class=\"line\">  <span class=\"comment\"># div_width gives the width of the line.</span></span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">&quot;%<span class=\"variable\">$&#123;div_width&#125;</span>s\\n&quot;</span> <span class=\"string\">&#x27; &#x27;</span> | tr <span class=\"string\">&#x27; &#x27;</span> -</span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">&quot;%s\\n&quot;</span> <span class=\"string\">&quot;<span class=\"variable\">$text</span>&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"about-the-init-process\"><a class=\"markdownIt-Anchor\" href=\"#about-the-init-process\"></a> ABout the init process</h2>\n<h3 id=\"the-initlua\"><a class=\"markdownIt-Anchor\" href=\"#the-initlua\"></a> The <code>init.lua</code></h3>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- init_path = &#x27;~/.local/share/lunarvim/lvim/init.lua&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">-- base_dir = &#x27;~/.local/share/lunarvim/lvim/&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">local</span> init_path = <span class=\"built_in\">debug</span>.<span class=\"built_in\">getinfo</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;S&quot;</span>).source:<span class=\"built_in\">sub</span>(<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"keyword\">local</span> base_dir = init_path:<span class=\"built_in\">match</span>(<span class=\"string\">&quot;(.*[/\\\\])&quot;</span>):<span class=\"built_in\">sub</span>(<span class=\"number\">1</span>, <span class=\"number\">-2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- vim.opt return a option object</span></span><br><span class=\"line\"><span class=\"comment\">-- rtp mean runtimepath</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">not</span> vim.tbl_contains(vim.opt.rtp:get(), base_dir) <span class=\"keyword\">then</span></span><br><span class=\"line\">  vim.opt.rtp:append(base_dir)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"comment\">-- bootstrap file is in lua/lvim/, which is the guide file of lvim</span></span><br><span class=\"line\"><span class=\"comment\">-- NOTICE THAT, the end of the bootstrap file, return a local module M,</span></span><br><span class=\"line\"><span class=\"comment\">-- which is defined at the beginning of the file.</span></span><br><span class=\"line\"><span class=\"comment\">-- Thus, the term :init(base_dir) runs the init function of module M.</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&quot;lvim.bootstrap&quot;</span>):init(base_dir)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&quot;lvim.config&quot;</span>):<span class=\"built_in\">load</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- the plugins are defined in lua/lvim/plugins.lua</span></span><br><span class=\"line\"><span class=\"keyword\">local</span> plugins = <span class=\"built_in\">require</span> <span class=\"string\">&quot;lvim.plugins&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- the same as init funtion in bootstrap, `load` is a function of the module in</span></span><br><span class=\"line\"><span class=\"comment\">-- plugins-loader</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&quot;lvim.plugin-loader&quot;</span>).<span class=\"built_in\">load</span> &#123; plugins, lvim.plugins &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">local</span> Log = <span class=\"built_in\">require</span> <span class=\"string\">&quot;lvim.core.log&quot;</span></span><br><span class=\"line\">Log:<span class=\"built_in\">debug</span> <span class=\"string\">&quot;Starting LunarVim&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">local</span> commands = <span class=\"built_in\">require</span> <span class=\"string\">&quot;lvim.core.commands&quot;</span></span><br><span class=\"line\">commands.<span class=\"built_in\">load</span>(commands.defaults)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&quot;lvim.lsp&quot;</span>).setup()</span><br></pre></td></tr></table></figure>\n<h3 id=\"the-bootstrapinit\"><a class=\"markdownIt-Anchor\" href=\"#the-bootstrapinit\"></a> The <code>Bootstrap:init</code></h3>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">---Initialize the `&amp;runtimepath` variables and prepare for startup</span></span><br><span class=\"line\"><span class=\"comment\">---@return table</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">M:init</span><span class=\"params\">(base_dir)</span></span></span><br><span class=\"line\">  <span class=\"built_in\">self</span>.runtime_dir = get_runtime_dir()</span><br><span class=\"line\">  <span class=\"built_in\">self</span>.config_dir = get_config_dir()</span><br><span class=\"line\">  <span class=\"built_in\">self</span>.cache_dir = get_cache_dir()</span><br><span class=\"line\">  <span class=\"built_in\">self</span>.pack_dir = join_paths(<span class=\"built_in\">self</span>.runtime_dir, <span class=\"string\">&quot;site&quot;</span>, <span class=\"string\">&quot;pack&quot;</span>)</span><br><span class=\"line\">  <span class=\"built_in\">self</span>.packer_install_dir = join_paths(<span class=\"built_in\">self</span>.runtime_dir, <span class=\"string\">&quot;site&quot;</span>, <span class=\"string\">&quot;pack&quot;</span>, <span class=\"string\">&quot;packer&quot;</span>, <span class=\"string\">&quot;start&quot;</span>, <span class=\"string\">&quot;packer.nvim&quot;</span>)</span><br><span class=\"line\">  <span class=\"built_in\">self</span>.packer_cache_path = join_paths(<span class=\"built_in\">self</span>.config_dir, <span class=\"string\">&quot;plugin&quot;</span>, <span class=\"string\">&quot;packer_compiled.lua&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">---Get the full path to LunarVim&#x27;s base directory</span></span><br><span class=\"line\">  <span class=\"comment\">---@return string</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_G.get_lvim_base_dir</span><span class=\"params\">()</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> base_dir</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> <span class=\"built_in\">os</span>.<span class=\"built_in\">getenv</span> <span class=\"string\">&quot;LUNARVIM_RUNTIME_DIR&quot;</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\">-- vim.opt.rtp:append(os.getenv &quot;LUNARVIM_RUNTIME_DIR&quot; .. path_sep .. &quot;lvim&quot;)</span></span><br><span class=\"line\">    vim.opt.rtp:<span class=\"built_in\">remove</span>(join_paths(vim.fn.stdpath <span class=\"string\">&quot;data&quot;</span>, <span class=\"string\">&quot;site&quot;</span>))</span><br><span class=\"line\">    vim.opt.rtp:<span class=\"built_in\">remove</span>(join_paths(vim.fn.stdpath <span class=\"string\">&quot;data&quot;</span>, <span class=\"string\">&quot;site&quot;</span>, <span class=\"string\">&quot;after&quot;</span>))</span><br><span class=\"line\">    vim.opt.rtp:prepend(join_paths(<span class=\"built_in\">self</span>.runtime_dir, <span class=\"string\">&quot;site&quot;</span>))</span><br><span class=\"line\">    vim.opt.rtp:append(join_paths(<span class=\"built_in\">self</span>.runtime_dir, <span class=\"string\">&quot;site&quot;</span>, <span class=\"string\">&quot;after&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    vim.opt.rtp:<span class=\"built_in\">remove</span>(vim.fn.stdpath <span class=\"string\">&quot;config&quot;</span>)</span><br><span class=\"line\">    vim.opt.rtp:<span class=\"built_in\">remove</span>(join_paths(vim.fn.stdpath <span class=\"string\">&quot;config&quot;</span>, <span class=\"string\">&quot;after&quot;</span>))</span><br><span class=\"line\">    vim.opt.rtp:prepend(<span class=\"built_in\">self</span>.config_dir)</span><br><span class=\"line\">    vim.opt.rtp:append(join_paths(<span class=\"built_in\">self</span>.config_dir, <span class=\"string\">&quot;after&quot;</span>))</span><br><span class=\"line\">    <span class=\"comment\">-- <span class=\"doctag\">TODO:</span> we need something like this: vim.opt.packpath = vim.opt.rtp</span></span><br><span class=\"line\"></span><br><span class=\"line\">    vim.cmd <span class=\"string\">[[let &amp;packpath = &amp;runtimepath]]</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">-- <span class=\"doctag\">FIXME:</span> currently unreliable in unit-tests</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> in_headless <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">_G</span>.PLENARY_DEBUG = <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"built_in\">require</span>(<span class=\"string\">&quot;lvim.impatient&quot;</span>).setup &#123;</span><br><span class=\"line\">      <span class=\"built_in\">path</span> = join_paths(<span class=\"built_in\">self</span>.cache_dir, <span class=\"string\">&quot;lvim_cache&quot;</span>),</span><br><span class=\"line\">      enable_profiling = <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">require</span>(<span class=\"string\">&quot;lvim.config&quot;</span>):init()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">require</span>(<span class=\"string\">&quot;lvim.plugin-loader&quot;</span>).init &#123;</span><br><span class=\"line\">    package_root = <span class=\"built_in\">self</span>.pack_dir,</span><br><span class=\"line\">    install_path = <span class=\"built_in\">self</span>.packer_install_dir,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">self</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"the-config-function-in-builtin-folder\"><a class=\"markdownIt-Anchor\" href=\"#the-config-function-in-builtin-folder\"></a> The <code>config</code> function in <code>builtin</code> folder</h3>\n<p>For some plugins, such as <code>whichkey</code> and <code>telescope</code>, there are <code>M.config</code>\nfunctions in their configuration files. However, the <code>setup</code> function only uses\nsome variable defined in them and do not execute them first. The are executed by\nthe <code>init.lua</code> in the <code>builtin</code> folder.</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">M.config</span><span class=\"params\">(config)</span></span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> _, builtin_path <span class=\"keyword\">in</span> <span class=\"built_in\">ipairs</span>(builtins) <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"keyword\">local</span> builtin = <span class=\"built_in\">require</span>(builtin_path)</span><br><span class=\"line\">    builtin.<span class=\"built_in\">config</span>(<span class=\"built_in\">config</span>)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<p>During the lunch process, the <code>config</code> functions will be called in front of the\nfunctions defined in the configuration file <code>config.lua</code>.</p>\n<h2 id=\"the-nerd-fonts\"><a class=\"markdownIt-Anchor\" href=\"#the-nerd-fonts\"></a> The nerd-fonts</h2>\n<p>The font is only related to your local devices. It is not related to the remote\ndevice.</p>\n<p>To install the nerd fonts, you need to download the nerd version of your fonts,\nfor example I use <code>hack</code>, though\n<a href=\"https://www.nerdfonts.com/font-downloads\">this</a> or\n<a href=\"https://github.com/ryanoasis/nerd-fonts\">this</a>. Then put it in your font\ndirectory. For windows, it is <code>C:\\Windows\\Fonts</code>. Finally, restart your terminal\nand set your terminal such as mobaxterm to use that font.</p>\n<h2 id=\"debug-system\"><a class=\"markdownIt-Anchor\" href=\"#debug-system\"></a> Debug system</h2>\n<h3 id=\"lvimlog\"><a class=\"markdownIt-Anchor\" href=\"#lvimlog\"></a> lvim.log</h3>\n<ol>\n<li>The file is in <code>~/.cache/</code> which is defined by\n<code>~/.local/share/lunarvim/lvim/lua/lvim/core/log.lua</code>. Using <code>Log:warn/debug</code>\nwill write logs in the file.</li>\n<li><code>lvim.log.level</code> controls the level that will be print into the <code>lvim.log</code>\n(see <code>local log_level = Log.levels[(lvim.log.level):upper() or &quot;WARN&quot;]</code> in\nthe <code>log.lua</code>. <code>function Log:get_path()</code> sets the path and name of the log\nfile.</li>\n<li><code>log.lua</code> used <code>structlog</code> which is a plugin of nvim defined in the\n<code>plugins.lua</code>. In the readme of <code>structlog</code>:\n<blockquote>\n<p><code>structlog</code> makes logging in lua less painful and more powerful by adding\nstructure to your log entries.</p>\n</blockquote>\n</li>\n</ol>\n<h2 id=\"plugins\"><a class=\"markdownIt-Anchor\" href=\"#plugins\"></a> Plugins</h2>\n<h3 id=\"yank\"><a class=\"markdownIt-Anchor\" href=\"#yank\"></a> yank</h3>\n<p>In the visual mode of <code>lunarvim</code>, <code>y</code> will yank the select chars into the system\nclipboard automatically. Do not use <code>&quot;+Y</code>, which will yank the whole line.\n<code>&quot;[~+]y</code> is also available.</p>\n<h3 id=\"projectnvim\"><a class=\"markdownIt-Anchor\" href=\"#projectnvim\"></a> <code>project.nvim</code></h3>\n<p>If open vim in a subdirectory of a git package, and then open a new tmux pane or\nwindow, its initial path will be the main directory of that git package. The\n<code>manual mode</code> in <code>~/.local/share/lunarvim/lvim/lua/lvim/core/project.lua</code>\ndetermines vim change the directory or not.</p>\n<h4 id=\"with-lsp\"><a class=\"markdownIt-Anchor\" href=\"#with-lsp\"></a> With lsp</h4>\n<p>In the readme of <code>project</code>.</p>\n<blockquote>\n<p>Automagically cd to project directory using nvim lsp. If not then uses pattern\nmatching to cd to root directory</p>\n</blockquote>\n<p>This means that lsp has the function to find the project directories.</p>\n<h3 id=\"telescope\"><a class=\"markdownIt-Anchor\" href=\"#telescope\"></a> Telescope</h3>\n<p>The <code>telescope</code> is depended on <code>fd</code>. To install <code>fd</code> do not use\n<code>apt install fdclone</code> which causes a collapse of nvim when run <code>telescope</code>.</p>\n<h4 id=\"telescope-in-which-key\"><a class=\"markdownIt-Anchor\" href=\"#telescope-in-which-key\"></a> Telescope in which key</h4>\n<p><code>~/.local/share/lunarvim/lvim/lua/lvim/core/which-key.lua</code> defines many which\nkey mapping related to telescope. <leader>f can find the files in git repos\nwhich is the feature provided by <code>telescope.builtin</code> (see the document of\ntelescope). <code>&lt;leader&gt;sf</code> can find the files in current directory.</p>\n<h3 id=\"comment\"><a class=\"markdownIt-Anchor\" href=\"#comment\"></a> <code>Comment</code></h3>\n<p>An error occur with <code>Comment</code> when open <code>lvim</code>, which is solved by adding\n<code>tag = 'v0.6',</code> to the <code>plugins.lua</code> file the Comment part.</p>\n<h3 id=\"treesitter\"><a class=\"markdownIt-Anchor\" href=\"#treesitter\"></a> Treesitter</h3>\n<h4 id=\"parsers-install\"><a class=\"markdownIt-Anchor\" href=\"#parsers-install\"></a> Parsers install</h4>\n<p>11 parsers are defined to be installed in <code>~/.config/lvim/config.lua</code></p>\n<p>Parsers often failed to be downloaded. See\n<code>https://github.com/nvim-treesitter/nvim-treesitter#adding-parsers</code>. One can\ndownload it manually. And change the url of the parsers.</p>\n<p><a href=\"https://github.com/nvim-treesitter/nvim-treesitter#language-parsers\">parsers</a></p>\n<blockquote>\n<p>parser for every language need to be generated via <code>tree-sitter-cli</code> from\n<code>grammer.js</code> file, then complied to a <code>.so</code> library that needd to be placed in\nneovim’s <code>runtimepath</code> (typically under <code>parser/&#123;language&#125;.so</code>). To simplify\nthis, <code>nvim-treesitter</code> provides commands to automate this process. If the\nlanguage is already supported by <code>nvim-treesitter</code> you can install it with\n<code>TSInstall &lt;language&gt;</code></p>\n</blockquote>\n<p>The <code>&#123;language&#125;.so</code> files are in\n<code>~/.local/share/lunarvim/site/pack/packer/start/nvim-treesitter.git/parser</code>.</p>\n<!-- #### Notice -->\n<!-- treestter may not always perform a good highlight, e.g., for markdown or tex -->\n<!-- files. -->\n<h3 id=\"about-packer\"><a class=\"markdownIt-Anchor\" href=\"#about-packer\"></a> About <code>packer</code></h3>\n<ol>\n<li>\n<p>the some plugins are installed in <code>opt</code> directory. Some are installed in\n<code>start</code> directory. This is controlled by the settings in <code>plugins.lua</code>. 7\nplugins are installed in <code>opt</code> directory, 6 of which are setted <code>event</code> and\nonly the 6 plugins are setted it. <code>lua-dev</code> is setted <code>module</code>.</p>\n<blockquote>\n<p>module = string or list – Specifies lua module name for require. When\nrequiring a string which starts with one of these module names, the plugin\nwill be loaded.</p>\n</blockquote>\n<blockquote>\n<p>event = string or list, – Specifies auto command events which load this\nplugin</p>\n</blockquote>\n<p>In the Readme of <code>Packer</code></p>\n<blockquote>\n<p><code>use</code> takes either a string or a table. If a string is provided, it is\ntreated as a plugin location (link) for a non-optional plugin with no\nadditional configuration.</p>\n</blockquote>\n<p><a href=\"https://github.com/wbthomason/packer.nvim/issues/237#issuecomment-787457600\">Opt</a></p>\n<blockquote>\n<p><code>start</code> packages are always available and loaded every time you start nvim,\nwhile <code>opt</code> packages are loaded on-demand with the <code>packadd</code> command. This\nis what <code>packer</code> uses to conditionally load plugins. <code>packer</code> itself\ndoesn’t run any code until you call <code>require('packer')</code>, so it should be\nfine to keep it as a start package.</p>\n</blockquote>\n<p><a href=\"https://github.com/wbthomason/packer.nvim/discussions/823#discussioncomment-2184455\">Opt</a></p>\n</li>\n</ol>\n<h3 id=\"lsp\"><a class=\"markdownIt-Anchor\" href=\"#lsp\"></a> LSP</h3>\n<h4 id=\"the-setup-process\"><a class=\"markdownIt-Anchor\" href=\"#the-setup-process\"></a> The setup process</h4>\n<ol>\n<li>the setup function of a lsp server is defined by the files in\n<code>~/.local/share/lunarvim/site/after/ftplugin</code>. <code>ftplugin</code> directory means\nfile type plugin. Vim will auto load this directory when it is in the runtime\npath. However, only the <code>filetype.lua/vim</code> will be loaded when open a file of\nparticular filetype. <code>~/.local/share/lunarvim/site/after/ftplugin</code> is\ncreated by <code>~/.local/share/lunarvim/lvim/lua/lvim/lsp/templates.lua</code> (see\nline 67). The server list is given in line 58. The content in the files in\nftplugins is given in line 40. The <code>ft.lua</code> will call <code>lvim.lsp.manager</code>\nwhich is a function defined in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/lsp/manager.lua</code>. It setup the lsp\nservers since when <code>ft.lua</code> is removed, the lsp server will not start.</li>\n<li>The configuration files of <code>nvim-lspconfig</code> are listed in\n<code>~/.local/share/lunarvim/site/pack/packer/start/nvim-lspconfig.git/lua/lspconfig/server_configurations</code>.\nWhich can be modified.</li>\n<li>The servers installed by <code>lsp-installer</code> are installed in\n<code>~/.local/share/nvim/lsp_servers</code></li>\n<li>see <code>setup</code> function in <code>manager.lua</code></li>\n</ol>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">M.setup</span><span class=\"params\">(server_name, user_config)</span></span></span><br><span class=\"line\">  vim.validate &#123; name = &#123; server_name, <span class=\"string\">&quot;string&quot;</span> &#125; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> lvim_lsp_utils.is_client_active(server_name) <span class=\"keyword\">or</span> client_is_configured(server_name) <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">local</span> <span class=\"built_in\">config</span> = resolve_config(server_name, user_config)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">local</span> servers = <span class=\"built_in\">require</span> <span class=\"string\">&quot;nvim-lsp-installer.servers&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">local</span> server_available, requested_server = servers.get_server(server_name)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">-- if not server available in nvim-lsp-installer, call lspconfig[server_name].setup(config)</span></span><br><span class=\"line\">  <span class=\"comment\">-- if the server is  available it will be set up by nvim-lsp-installer.</span></span><br><span class=\"line\">  <span class=\"comment\">-- that is to say all the servers will preferentially be set upped by nvim-lsp-installer.</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">-- NOTE THAT</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">-- Most servers will be set uppped by nvim-lsp-installer by this way.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> server_available <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\">-- The pcall function calls its first argument in protected mode, so that it</span></span><br><span class=\"line\">    <span class=\"comment\">-- catches any errors while the function is running. If there are no errors, pcall</span></span><br><span class=\"line\">    <span class=\"comment\">-- returns true, plus any values returned by the call. Otherwise, it returns false,</span></span><br><span class=\"line\">    <span class=\"comment\">-- plus the error message.</span></span><br><span class=\"line\">    <span class=\"built_in\">pcall</span>(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span></span><br><span class=\"line\">      <span class=\"built_in\">require</span>(<span class=\"string\">&quot;lspconfig&quot;</span>)[server_name].setup(<span class=\"built_in\">config</span>)</span><br><span class=\"line\">      buf_try_add(server_name)</span><br><span class=\"line\">    <span class=\"keyword\">end</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">local</span> install_notification = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> requested_server:is_installed() <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> lvim.lsp.automatic_servers_installation <span class=\"keyword\">then</span></span><br><span class=\"line\">      Log:<span class=\"built_in\">debug</span> <span class=\"string\">&quot;Automatic server installation detected&quot;</span></span><br><span class=\"line\">      requested_server:install()</span><br><span class=\"line\">      install_notification = <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      Log:<span class=\"built_in\">debug</span>(requested_server.name .. <span class=\"string\">&quot; is not managed by the automatic installer&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  requested_server:on_ready(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> install_notification <span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"comment\">-- `vim.notify` is defined in `log.lua` in lvim folder.</span></span><br><span class=\"line\">      <span class=\"comment\">-- &gt; `vim.notify` A fancy, configurable, notification manager for NeoVim.</span></span><br><span class=\"line\">      <span class=\"comment\">-- `vim.log.levels.INFO` is defined in the `lua-dev` plunin defined in `plugins.lua`.</span></span><br><span class=\"line\">      <span class=\"comment\">-- &gt; `lua-dev` setup for init.lua and plugin development with full signature help,</span></span><br><span class=\"line\">      <span class=\"comment\">-- &gt; docs and completion for the nvim lua API.</span></span><br><span class=\"line\">      <span class=\"comment\">-- i do not find where the vim.log.levels is required by `manager.lua`.</span></span><br><span class=\"line\">      <span class=\"comment\">-- I think vim.log.levels must be in the search path of nvim thus it can find it</span></span><br><span class=\"line\">      <span class=\"comment\">-- though the search path.</span></span><br><span class=\"line\">      vim.notify(<span class=\"built_in\">string</span>.<span class=\"built_in\">format</span>(<span class=\"string\">&quot;Installation complete for [%s] server&quot;</span>, requested_server.name), vim.<span class=\"built_in\">log</span>.levels.INFO)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">    install_notification = <span class=\"literal\">false</span></span><br><span class=\"line\">    requested_server:setup(<span class=\"built_in\">config</span>)</span><br><span class=\"line\">    <span class=\"comment\">-- Log:warn(config)</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span>)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<p>From the code we know that most of the servers will be setup by\n<code>nvim-lsp-installer</code> (see <code>requested_server:setup(config)</code>). However, thought\nthis the configuration for manually setup server is not works. From the document\nof <code>nvim-lsp-installer</code>,\n<a href=\"https://github.com/williamboman/nvim-lsp-installer/blob/40442b67a151fc2a58a790fd7e74a7487f1f9157/doc/nvim-lsp-installer.txt#L349\">server.setup</a>\nis deprecated. Thus I change the <code>setup</code> function in <code>manager.lua</code>.</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">M.setup</span><span class=\"params\">(server_name, user_config)</span></span></span><br><span class=\"line\">  vim.validate &#123; name = &#123; server_name, <span class=\"string\">&quot;string&quot;</span> &#125; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> lvim_lsp_utils.is_client_active(server_name) <span class=\"keyword\">or</span> client_is_configured(server_name) <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">local</span> <span class=\"built_in\">config</span> = resolve_config(server_name, user_config)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">local</span> servers = <span class=\"built_in\">require</span> <span class=\"string\">&quot;nvim-lsp-installer.servers&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">local</span> server_available, requested_server = servers.get_server(server_name)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">-- if the server is installed then setup by lspconfig</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> requested_server:is_installed() <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">pcall</span>(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span></span><br><span class=\"line\">      <span class=\"built_in\">require</span>(<span class=\"string\">&quot;lspconfig&quot;</span>)[server_name].setup(<span class=\"built_in\">config</span>)</span><br><span class=\"line\">      buf_try_add(server_name)</span><br><span class=\"line\">    <span class=\"keyword\">end</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">local</span> install_notification = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">-- if the server is not installed, install it</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> requested_server:is_installed() <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> lvim.lsp.automatic_servers_installation <span class=\"keyword\">then</span></span><br><span class=\"line\">      Log:<span class=\"built_in\">debug</span> <span class=\"string\">&quot;Automatic server installation detected&quot;</span></span><br><span class=\"line\">      requested_server:install()</span><br><span class=\"line\">      install_notification = <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      Log:<span class=\"built_in\">debug</span>(requested_server.name .. <span class=\"string\">&quot; is not managed by the automatic installer&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  requested_server:on_ready(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> install_notification <span class=\"keyword\">then</span></span><br><span class=\"line\">      vim.notify(<span class=\"built_in\">string</span>.<span class=\"built_in\">format</span>(<span class=\"string\">&quot;Installation complete for [%s] server&quot;</span>, requested_server.name), vim.<span class=\"built_in\">log</span>.levels.INFO)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">    install_notification = <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"comment\">-- requested_server:setup(config)</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span>)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"the-relationship-between-lspconfig-and-null-ls\"><a class=\"markdownIt-Anchor\" href=\"#the-relationship-between-lspconfig-and-null-ls\"></a> the relationship between <code>lspconfig</code> and <code>null-ls</code></h4>\n<ol>\n<li>Both of them can use <code>latexindent</code> to format the tex file</li>\n<li><code>lspconfig</code> can not use <code>prettier</code>.</li>\n</ol>\n<p>Thus <code>null-ls</code> provide an extension tools for <code>lspconfig</code>. When <code>lspconfig</code> can\nmatch our requirement, we do not need to use <code>null-ls</code>, e.g., tools for tex\nfile.</p>\n<h4 id=\"the-relationship-between-lspconfig-and-lsp-installer\"><a class=\"markdownIt-Anchor\" href=\"#the-relationship-between-lspconfig-and-lsp-installer\"></a> the relationship between <code>lspconfig</code> and <code>lsp-installer</code></h4>\n<ol>\n<li><code>lsp-installer</code> depends on <code>lspconfig</code> as in the readme of <code>lsp-installer</code>.</li>\n<li>lvim strives to have support for all major languages. This is made possible\nby plugins such as <code>nvim-lspconfig</code>, for LSP support, and <code>null-ls</code> to\nprovide support for handing external formatters, such as <code>prettier</code> and\n<code>eslint</code>.</li>\n</ol>\n<p><code>lua print(vim.inspect(vim.lsp.buf_get_clients()[2].resolved_capabilities))</code> see\nthe detail of server clients.</p>\n<h4 id=\"code-action\"><a class=\"markdownIt-Anchor\" href=\"#code-action\"></a> Code Action</h4>\n<p>Code action = quick fixes and refactoring</p>\n<h3 id=\"the-lualine\"><a class=\"markdownIt-Anchor\" href=\"#the-lualine\"></a> The lualine</h3>\n<p>The status line is defined in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/core/lualine/init.lua</code> line 5 which can\nbe chose as <code>default</code>, <code>lvim</code>, or <code>none</code>. The are defined in the\n<code>~/.local/share/lunarvim/lvim/lua/lvim/core/lualine/styles.lua</code> file. The\ncomponent are defined in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/core/lualine/components.lua</code>.</p>\n<h3 id=\"the-whichkey\"><a class=\"markdownIt-Anchor\" href=\"#the-whichkey\"></a> The whichkey</h3>\n<p>Which key can define key mappings for vim. They are defined in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/core/which-key.lua</code>. The use of\n<code>telescope</code> can be learned by reading <code>which-key.lua</code>, since the key mapping of\n<code>telescope</code> is defined in it.</p>\n<p>The lsp also used which key, which is defined in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/lsp/config.lua</code> and used/registered in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/lsp/init.lua</code>. Which key makes the key\nmappings more organized.</p>\n<h4 id=\"modify-which-key-map\"><a class=\"markdownIt-Anchor\" href=\"#modify-which-key-map\"></a> Modify which key map</h4>\n<p>To modify which key maps, for example, <code>&lt;leader&gt;sp</code> is defined in\n<code>whichkey.lua</code>. I want to change it in <code>config.lua</code>.\n<code>lvim.builtin.which_key.mappings[&quot;sp&quot;] = &#123; &quot;&lt;CMD&gt;Telescope projects&lt;CR&gt;&quot;, &quot;Project&quot; &#125;</code>\ndoes not work.</p>\n<p><code>lvim.builtin.which_key.mappings.s[&quot;p&quot;] = &#123; &quot;&lt;CMD&gt;Telescope projects&lt;CR&gt;&quot;, &quot;Project&quot; &#125;</code>\nworks. <code>lvim.builtin.which_key.mappings.s</code> is a table, and the <code>config</code> function\nin <code>which-key.lua</code> is executed in front of the <code>config.lua</code>. So that the value\nof key <code>p</code> can be modified.</p>\n<h3 id=\"the-alpha\"><a class=\"markdownIt-Anchor\" href=\"#the-alpha\"></a> The alpha</h3>\n<p>The start cover is defined in\n<code>~/.local/share/lunarvim/lvim/lua/lvim/core/alpha/startify.lua</code>.</p>\n<h3 id=\"nvim-notify\"><a class=\"markdownIt-Anchor\" href=\"#nvim-notify\"></a> nvim-notify</h3>\n<p>The notation manager and message manager for nvim.</p>\n"},{"title":"Construct Your Blog with Hexo and Github","hidden":true,"description":"Hexo, Next等的使用和介绍。","abbrlink":"e526ae32","date":"2021-11-24T08:20:43.000Z","_content":"\n\n# 主要参考博客\n\nhttps://segmentfault.com/a/1190000017986794\n\nhttps://godweiyang.com/2018/04/13/hexo-blog/\n\nhttps://blog.guaoxiaohei.com/posts/Hexo-Level/\n\nhttps://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/\n\nhttps://www.zhangxinxu.com/wordpress/2021/05/css-html-hr/\n\ntypora标题和大纲编号\n\nhttps://zhuanlan.zhihu.com/p/110257979\n\n# 实现的时候也遇到了一些问题\n\n## 本地显示没问题，hexo d之后 在GitHub无法显示主题样式\n\n更改主目录下面的_config.yml文件\n\n\n\nurl: github远程仓库的地址, 如 https://xyegithub.github.io/myBlog/\n\nroot: url的最后一段，如/myBlog/\n\n更改保存之后，hexo clean; hexo g; hexo d\n\n##  git在推送的时候很容易出现网络错误\n\n参考博客\n\nhttps://juejin.cn/post/6844904193170341896\n\n刷新dns管理员cmd下运行 ipconfig /flushdns\n\n但是这个方法不是很管用\n\n### 更好的方法\n\n可以不用代理，将hexo _config.yml里的git地址由`https://github.com/xxx`修改为ssh `git@github.com:xxx/xxx`也可以\n\n## 将github page 设置为谷歌可搜索\n\n参考博客\n\nhttps://mizeri.github.io/2021/04/18/hexo-sitemap-google/\n\n## 绑定自己的域名\n\n1. 用freenom申请一个免费的域名，如yexiang.ml\n2. 用腾讯云的DNSpod为域名添加服务器，设置A记录，具体方法，参见github page的教程\n\n","source":"_posts/Construct-Your-Blog-with-Hexo-and-Github.md","raw":"---\ntitle: Construct Your Blog with Hexo and Github\nhidden: true\ndescription: 'Hexo, Next等的使用和介绍。'\ntags:\n  - Hexo\ncategories:\n  - Little Things\n  - Hexo\nabbrlink: e526ae32\ndate: 2021-11-24 16:20:43\n---\n\n\n# 主要参考博客\n\nhttps://segmentfault.com/a/1190000017986794\n\nhttps://godweiyang.com/2018/04/13/hexo-blog/\n\nhttps://blog.guaoxiaohei.com/posts/Hexo-Level/\n\nhttps://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/\n\nhttps://www.zhangxinxu.com/wordpress/2021/05/css-html-hr/\n\ntypora标题和大纲编号\n\nhttps://zhuanlan.zhihu.com/p/110257979\n\n# 实现的时候也遇到了一些问题\n\n## 本地显示没问题，hexo d之后 在GitHub无法显示主题样式\n\n更改主目录下面的_config.yml文件\n\n\n\nurl: github远程仓库的地址, 如 https://xyegithub.github.io/myBlog/\n\nroot: url的最后一段，如/myBlog/\n\n更改保存之后，hexo clean; hexo g; hexo d\n\n##  git在推送的时候很容易出现网络错误\n\n参考博客\n\nhttps://juejin.cn/post/6844904193170341896\n\n刷新dns管理员cmd下运行 ipconfig /flushdns\n\n但是这个方法不是很管用\n\n### 更好的方法\n\n可以不用代理，将hexo _config.yml里的git地址由`https://github.com/xxx`修改为ssh `git@github.com:xxx/xxx`也可以\n\n## 将github page 设置为谷歌可搜索\n\n参考博客\n\nhttps://mizeri.github.io/2021/04/18/hexo-sitemap-google/\n\n## 绑定自己的域名\n\n1. 用freenom申请一个免费的域名，如yexiang.ml\n2. 用腾讯云的DNSpod为域名添加服务器，设置A记录，具体方法，参见github page的教程\n\n","slug":"Construct-Your-Blog-with-Hexo-and-Github","published":1,"updated":"2022-06-13T07:38:40.681Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpge000dy7ml19wyc1db","content":"<html><head></head><body><h1 id=\"主要参考博客\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#主要参考博客\"></a> 主要参考博客</h1>\n<p><a href=\"https://segmentfault.com/a/1190000017986794\">https://segmentfault.com/a/1190000017986794</a></p>\n<p><a href=\"https://godweiyang.com/2018/04/13/hexo-blog/\">https://godweiyang.com/2018/04/13/hexo-blog/</a></p>\n<p><a href=\"https://blog.guaoxiaohei.com/posts/Hexo-Level/\">https://blog.guaoxiaohei.com/posts/Hexo-Level/</a></p>\n<p><a href=\"https://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/\">https://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/</a></p>\n<p><a href=\"https://www.zhangxinxu.com/wordpress/2021/05/css-html-hr/\">https://www.zhangxinxu.com/wordpress/2021/05/css-html-hr/</a></p>\n<p>typora标题和大纲编号</p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/110257979\">https://zhuanlan.zhihu.com/p/110257979</a></p>\n<h1 id=\"实现的时候也遇到了一些问题\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#实现的时候也遇到了一些问题\"></a> 实现的时候也遇到了一些问题</h1>\n<h2 id=\"本地显示没问题hexo-d之后-在github无法显示主题样式\"><span class=\"post-title-index\">2.1. </span><a class=\"markdownIt-Anchor\" href=\"#本地显示没问题hexo-d之后-在github无法显示主题样式\"></a> 本地显示没问题，hexo d之后 在GitHub无法显示主题样式</h2>\n<p>更改主目录下面的_config.yml文件</p>\n<p>url: github远程仓库的地址, 如 <a href=\"https://xyegithub.github.io/myBlog/\">https://xyegithub.github.io/myBlog/</a></p>\n<p>root: url的最后一段，如/myBlog/</p>\n<p>更改保存之后，hexo clean; hexo g; hexo d</p>\n<h2 id=\"git在推送的时候很容易出现网络错误\"><span class=\"post-title-index\">2.2. </span><a class=\"markdownIt-Anchor\" href=\"#git在推送的时候很容易出现网络错误\"></a> git在推送的时候很容易出现网络错误</h2>\n<p>参考博客</p>\n<p><a href=\"https://juejin.cn/post/6844904193170341896\">https://juejin.cn/post/6844904193170341896</a></p>\n<p>刷新dns管理员cmd下运行 ipconfig /flushdns</p>\n<p>但是这个方法不是很管用</p>\n<h3 id=\"更好的方法\"><span class=\"post-title-index\">2.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#更好的方法\"></a> 更好的方法</h3>\n<p>可以不用代理，将hexo _config.yml里的git地址由<code>https://github.com/xxx</code>修改为ssh <code>git@github.com:xxx/xxx</code>也可以</p>\n<h2 id=\"将github-page-设置为谷歌可搜索\"><span class=\"post-title-index\">2.3. </span><a class=\"markdownIt-Anchor\" href=\"#将github-page-设置为谷歌可搜索\"></a> 将github page 设置为谷歌可搜索</h2>\n<p>参考博客</p>\n<p><a href=\"https://mizeri.github.io/2021/04/18/hexo-sitemap-google/\">https://mizeri.github.io/2021/04/18/hexo-sitemap-google/</a></p>\n<h2 id=\"绑定自己的域名\"><span class=\"post-title-index\">2.4. </span><a class=\"markdownIt-Anchor\" href=\"#绑定自己的域名\"></a> 绑定自己的域名</h2>\n<ol>\n<li>用freenom申请一个免费的域名，<a href=\"http://xn--yexiang-i22m.ml\">如yexiang.ml</a></li>\n<li>用腾讯云的DNSpod为域名添加服务器，设置A记录，具体方法，参见github page的教程</li>\n</ol>\n<!-- flag of hidden posts --></body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"主要参考博客\"><a class=\"markdownIt-Anchor\" href=\"#主要参考博客\"></a> 主要参考博客</h1>\n<p><a href=\"https://segmentfault.com/a/1190000017986794\">https://segmentfault.com/a/1190000017986794</a></p>\n<p><a href=\"https://godweiyang.com/2018/04/13/hexo-blog/\">https://godweiyang.com/2018/04/13/hexo-blog/</a></p>\n<p><a href=\"https://blog.guaoxiaohei.com/posts/Hexo-Level/\">https://blog.guaoxiaohei.com/posts/Hexo-Level/</a></p>\n<p><a href=\"https://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/\">https://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/</a></p>\n<p><a href=\"https://www.zhangxinxu.com/wordpress/2021/05/css-html-hr/\">https://www.zhangxinxu.com/wordpress/2021/05/css-html-hr/</a></p>\n<p>typora标题和大纲编号</p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/110257979\">https://zhuanlan.zhihu.com/p/110257979</a></p>\n<h1 id=\"实现的时候也遇到了一些问题\"><a class=\"markdownIt-Anchor\" href=\"#实现的时候也遇到了一些问题\"></a> 实现的时候也遇到了一些问题</h1>\n<h2 id=\"本地显示没问题hexo-d之后-在github无法显示主题样式\"><a class=\"markdownIt-Anchor\" href=\"#本地显示没问题hexo-d之后-在github无法显示主题样式\"></a> 本地显示没问题，hexo d之后 在GitHub无法显示主题样式</h2>\n<p>更改主目录下面的_config.yml文件</p>\n<p>url: github远程仓库的地址, 如 <a href=\"https://xyegithub.github.io/myBlog/\">https://xyegithub.github.io/myBlog/</a></p>\n<p>root: url的最后一段，如/myBlog/</p>\n<p>更改保存之后，hexo clean; hexo g; hexo d</p>\n<h2 id=\"git在推送的时候很容易出现网络错误\"><a class=\"markdownIt-Anchor\" href=\"#git在推送的时候很容易出现网络错误\"></a> git在推送的时候很容易出现网络错误</h2>\n<p>参考博客</p>\n<p><a href=\"https://juejin.cn/post/6844904193170341896\">https://juejin.cn/post/6844904193170341896</a></p>\n<p>刷新dns管理员cmd下运行 ipconfig /flushdns</p>\n<p>但是这个方法不是很管用</p>\n<h3 id=\"更好的方法\"><a class=\"markdownIt-Anchor\" href=\"#更好的方法\"></a> 更好的方法</h3>\n<p>可以不用代理，将hexo _config.yml里的git地址由<code>https://github.com/xxx</code>修改为ssh <code>git@github.com:xxx/xxx</code>也可以</p>\n<h2 id=\"将github-page-设置为谷歌可搜索\"><a class=\"markdownIt-Anchor\" href=\"#将github-page-设置为谷歌可搜索\"></a> 将github page 设置为谷歌可搜索</h2>\n<p>参考博客</p>\n<p><a href=\"https://mizeri.github.io/2021/04/18/hexo-sitemap-google/\">https://mizeri.github.io/2021/04/18/hexo-sitemap-google/</a></p>\n<h2 id=\"绑定自己的域名\"><a class=\"markdownIt-Anchor\" href=\"#绑定自己的域名\"></a> 绑定自己的域名</h2>\n<ol>\n<li>用freenom申请一个免费的域名，<a href=\"http://xn--yexiang-i22m.ml\">如yexiang.ml</a></li>\n<li>用腾讯云的DNSpod为域名添加服务器，设置A记录，具体方法，参见github page的教程</li>\n</ol>\n"},{"title":"Experiments","top":false,"cover":false,"toc":true,"mathjax":true,"description":"发现统计规律，记录一些自己diy的实验。","abbrlink":"b8eefd24","date":"2021-12-17T02:00:56.000Z","password":null,"summary":null,"_content":"\n# Deep Learning\n\n## Feature Map Multiplication\n\n### dataset: Caltech101\n\n[source code](https://github.com/xyegithub/Featrue-map-multiplication)\n\n3 号服务器\n\n/media/new*2t/yexiang/image_classification/multiply/from*#1/ffmnst/Caltech101\n\n#### bn，sig\n\n| 配置                                                                                                                                                   | accuracy |\n| ------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- |\n| `out = self.bn(out) + self.shortcut(x) `                                                                                                               | 87.62    |\n| `out = (out.sigmoid() + 1)* self.bn_s(self.shortcut(x))`                                                                                               | 78.23    |\n| `out = (self.bn(out).sigmoid() + 1) * self.bn_s(self.shortcut(x))`                                                                                     | 78.69    |\n| `(self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x)) `                                                                                        | 78.57    |\n| `self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid() + 1) * self.bn_s(self.shortcut(x)) `                                                      | 82.26    |\n| `self.bn_s.bias.data[:]=1` <br>`out = (self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x)) `                                                   | 84.10    |\n| ` self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x)) `                       | 84.85    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid()) * self.bn_s(self.shortcut(x))`                               | 85.83    |\n| `self.bn.bias.data[:]=0`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid()) * self.bn_s(self.shortcut(x))` | 81.57    |\n\n1. 从这个结果看出 shortcut 的均值为 1，会使得优化更好\n2. Res 分支的 sigmoid 不需要加 0.5 或者 1，性能提高了。乘以 sigmoid 本身有恒等的\n   特性。sigmoid 分支输出都为 0 时，sigmoid 输入都是 0.5。\n3. 在 Res 分支的 sigmoid 之前，先对 out 进行 bn 归一化，会优化的更好，而且让归一\n   化的均值为 0，会优化的更好。但是如果同时也控制归一化的方差，效果变差。无参的\n   bn 限制了表达能力。\n\n#### sig, bn\n\n| 配置                                                                                                                                                   | accuracy |\n| ------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- |\n| `out = self.bn(out) + self.shortcut(x) `                                                                                                               | 87.62    |\n| `out = (self.shortcut(x).sigmoid() + 1)* self.bn_s(out)`                                                                                               | 83.93    |\n| `out = (self.bn(self.shortcut(x)).sigmoid() + 1) * self.bn_s(out)`                                                                                     | 85.54    |\n| `(self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out) `                                                                                        | 85.14    |\n| `self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid() + 1) * self.bn_s(out) `                                                      | 85.43    |\n| `self.bn_s.bias.data[:]=1` <br>`out = (self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out) `                                                   | 87.44    |\n| ` self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out) `                       | 84.39    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid()) * self.bn_s(out)`                               | 84.39    |\n| `self.bn.bias.data[:]=0`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid()) * self.bn_s(out)` | 84.91    |\n\n**sig, bn 比 bn, sig 的效果好。原因可能是，sig 本来就有梯度的问题，然而\n，shortcut 分支没有需要优化的参数，所以把 sigmoid 放在 shortcut 分支更好？**\n\n#### bn, bn\n\n| 配置                                                                                                                                                                      | Accuracy |\n| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |\n| `out = self.bn(out)* self.bn_s(self.shortcut(x))`                                                                                                                         | 77.13    |\n| `self.bn_s.bias.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x)) `                                                                                          | 75.75    |\n| `self.bn.bias.data[:] = 1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))`                                                                                           | 79.55    |\n| `self.bn.bias.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))`                                                               | 81.39    |\n| `self.bn.bias.data[:]=1`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))`                                 | 81.05    |\n| `self.bn.bias.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`self.bn_s.weight.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))`                               | 80.24    |\n| `self.bn.bias.data[:]=1`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`self.bn_s.weight.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))` | 81.22    |\n\n均值为 1 的话，一般来说还是会获益。但是 bn 的效果不是很好。\n\n#### sig, sig\n\n| 配置                                                         | Accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out = (self.shortcut(x).sigmoid()) * out.sigmoid())`        | 79.44    |\n| `out = (self.shortcut(x).sigmoid()) * (out.sigmoid() + 0.5)` | 70.05    |\n| `out = (self.shortcut(x).sigmoid() + 0.5) * (out.sigmoid())` | 76.61    |\n| `out = (self.shortcut(x).sigmoid()) * (out.sigmoid() + 1)`   | 72.64    |\n| `out = (self.shortcut(x).sigmoid() + 1) * (out.sigmoid())`   | 71.77    |\n\n没有加 bn，sigmoid 会过饱和，效果不是很好。一边加 bn\n\n| 配置                                                                                                | Accuracy |\n| --------------------------------------------------------------------------------------------------- | -------- |\n| `out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()`                                       | 86.69    |\n| `out = (self.bn_s(self.shortcut(x)).sigmoid()) * out.sigmoid()`                                     | 79.90    |\n| `self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * out.sigmoid()`       | 76.32    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()`           | 83.99    |\n| `self.bn.bias.data[:]=0 `<br>` out = (self.shortcut(x).sigmoid()) * (self.bn(out).sigmoid() + 0.5)` | 86.52    |\n| `self.bn.bias.data[:]=0 `<br>`out = (self.shortcut(x).sigmoid()) * (self.bn(out).sigmoid() + 1) `   | 82.83    |\n| `self.bn.weight.data[:]=1`<br>`out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()`         | 78.74    |\n| `self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * out.sigmoid()` | 73.39    |\n\n两边加 bn\n\n| 配置                                                                                                                                                                 | Accuracy |\n| -------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |\n| ` out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()`                                                                                            | 86.23    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()`                                                                 | 86.41    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 1)`                                                           | 85.83    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 0.5)`                                                         | 86.23    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()`                                  | 86.52    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`self.bn_s.weight.data[:]=1`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 82.49    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn.weight.data[:]=1`<br/>`self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()`   | 83.47    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 0.5)`                           | 84.91    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * self.bn(out).sigmoid())`                          | 86.92    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 1) * self.bn(out).sigmoid())`                            | 86.75    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * (self.bn(out).sigmoid() + 0.5)`                   | 84.79    |\n| `self.bn.weight.data[:]=1`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()`                                                               | 81.91    |\n| `self.bn_s.weight.data[:]=1`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()`                                                             | 80.93    |\n\n#### Resdual 分支内部使用乘法\n\n| 配置                                                                                                                                    | Accuracy |\n| --------------------------------------------------------------------------------------------------------------------------------------- | -------- |\n| `out_1 = F.relu(self.bn2(out_1))`<br>`out *= self.adap(out_1)`                                                                          | 86.06    |\n| `out_1 = F.relu(self.bn2(out_1))`<br>`out *= self.adap(out_1).sigmoid()`                                                                | 87.33    |\n| `out_1 = self.bn2(out_1)`<br>`out = self.conv2(out_1)`<br>`out *= self.adap(out_1).sigmoid()`                                           | 85.71    |\n| `out_1 = self.bn2(out_1)`<br/>`out = self.conv2(out_1.relu())`<br/>`out *= self.adap(out_1).sigmoid()`                                  | 87.85    |\n| `self.bn2.bias.data[:]=0`<br>`out_1 = self.bn2(out_1)`<br>`out = self.conv2(out_1)`<br>`out *= self.adap(out_1).sigmoid()`              | 86.64    |\n| `self.bn2.bias.data[:]=0`<br/>`out_1 = self.bn2(out_1)`<br/>`out = self.conv2(out_1.relu())`<br/>`out *= self.adap(out_1).sigmoid()`    | 81.51    |\n| `self.bn2.bias.data[:]=0`<br/>`out_1 = self.bn2(out_1)`<br/>`out = self.conv2(out_1.sigmoid())`<br/>`out *= self.adap(out_1).sigmoid()` | 82.66    |\n| `out_1 = F.relu(self.bn2(out_1))`<br>`out = self.conv2(out_1).sigmoid()`<br>`out = self.adap(out_1) * out`                              | 84.22    |\n|                                                                                                                                         |          |\n\n#### 借鉴 NAM\n\n1. 用了 sigmoid 乘以原矩阵\n2. sigmoid 之前用了 bn\n3. 还在每个通道上乘以了和为 1 的数\n\n$$\n\\begin{align}\natt &= norm(x) \\\\\natt &= att \\times \\gamma + \\delta \\\\\natt &= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &= att.sigmoid() \\times x\n\\end{align}\n$$\n\n| 配置                                 | Accuracy |\n| ------------------------------------ | -------- |\n| `out = self.nam(x) + self.bn_s(out)` | 86.41    |\n","source":"_posts/Experiments.md","raw":"---\ntitle: Experiments\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndescription: 发现统计规律，记录一些自己diy的实验。\ncategories:\n  - Machine Learning\n  - Experiments\ntags:\n  - Personal Thought\n  - Experiments\n  - private\nabbrlink: b8eefd24\ndate: 2021-12-17 10:00:56\npassword:\nsummary:\n---\n\n# Deep Learning\n\n## Feature Map Multiplication\n\n### dataset: Caltech101\n\n[source code](https://github.com/xyegithub/Featrue-map-multiplication)\n\n3 号服务器\n\n/media/new*2t/yexiang/image_classification/multiply/from*#1/ffmnst/Caltech101\n\n#### bn，sig\n\n| 配置                                                                                                                                                   | accuracy |\n| ------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- |\n| `out = self.bn(out) + self.shortcut(x) `                                                                                                               | 87.62    |\n| `out = (out.sigmoid() + 1)* self.bn_s(self.shortcut(x))`                                                                                               | 78.23    |\n| `out = (self.bn(out).sigmoid() + 1) * self.bn_s(self.shortcut(x))`                                                                                     | 78.69    |\n| `(self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x)) `                                                                                        | 78.57    |\n| `self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid() + 1) * self.bn_s(self.shortcut(x)) `                                                      | 82.26    |\n| `self.bn_s.bias.data[:]=1` <br>`out = (self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x)) `                                                   | 84.10    |\n| ` self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x)) `                       | 84.85    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid()) * self.bn_s(self.shortcut(x))`                               | 85.83    |\n| `self.bn.bias.data[:]=0`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(out).sigmoid()) * self.bn_s(self.shortcut(x))` | 81.57    |\n\n1. 从这个结果看出 shortcut 的均值为 1，会使得优化更好\n2. Res 分支的 sigmoid 不需要加 0.5 或者 1，性能提高了。乘以 sigmoid 本身有恒等的\n   特性。sigmoid 分支输出都为 0 时，sigmoid 输入都是 0.5。\n3. 在 Res 分支的 sigmoid 之前，先对 out 进行 bn 归一化，会优化的更好，而且让归一\n   化的均值为 0，会优化的更好。但是如果同时也控制归一化的方差，效果变差。无参的\n   bn 限制了表达能力。\n\n#### sig, bn\n\n| 配置                                                                                                                                                   | accuracy |\n| ------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- |\n| `out = self.bn(out) + self.shortcut(x) `                                                                                                               | 87.62    |\n| `out = (self.shortcut(x).sigmoid() + 1)* self.bn_s(out)`                                                                                               | 83.93    |\n| `out = (self.bn(self.shortcut(x)).sigmoid() + 1) * self.bn_s(out)`                                                                                     | 85.54    |\n| `(self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out) `                                                                                        | 85.14    |\n| `self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid() + 1) * self.bn_s(out) `                                                      | 85.43    |\n| `self.bn_s.bias.data[:]=1` <br>`out = (self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out) `                                                   | 87.44    |\n| ` self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out) `                       | 84.39    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid()) * self.bn_s(out)`                               | 84.39    |\n| `self.bn.bias.data[:]=0`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = (self.bn(self.shortcut(x)).sigmoid()) * self.bn_s(out)` | 84.91    |\n\n**sig, bn 比 bn, sig 的效果好。原因可能是，sig 本来就有梯度的问题，然而\n，shortcut 分支没有需要优化的参数，所以把 sigmoid 放在 shortcut 分支更好？**\n\n#### bn, bn\n\n| 配置                                                                                                                                                                      | Accuracy |\n| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |\n| `out = self.bn(out)* self.bn_s(self.shortcut(x))`                                                                                                                         | 77.13    |\n| `self.bn_s.bias.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x)) `                                                                                          | 75.75    |\n| `self.bn.bias.data[:] = 1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))`                                                                                           | 79.55    |\n| `self.bn.bias.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))`                                                               | 81.39    |\n| `self.bn.bias.data[:]=1`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))`                                 | 81.05    |\n| `self.bn.bias.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`self.bn_s.weight.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))`                               | 80.24    |\n| `self.bn.bias.data[:]=1`<br>`self.bn.weight.data[:]=1`<br>`self.bn_s.bias.data[:]=1`<br>`self.bn_s.weight.data[:]=1`<br>`out = self.bn(out)* self.bn_s(self.shortcut(x))` | 81.22    |\n\n均值为 1 的话，一般来说还是会获益。但是 bn 的效果不是很好。\n\n#### sig, sig\n\n| 配置                                                         | Accuracy |\n| ------------------------------------------------------------ | -------- |\n| `out = (self.shortcut(x).sigmoid()) * out.sigmoid())`        | 79.44    |\n| `out = (self.shortcut(x).sigmoid()) * (out.sigmoid() + 0.5)` | 70.05    |\n| `out = (self.shortcut(x).sigmoid() + 0.5) * (out.sigmoid())` | 76.61    |\n| `out = (self.shortcut(x).sigmoid()) * (out.sigmoid() + 1)`   | 72.64    |\n| `out = (self.shortcut(x).sigmoid() + 1) * (out.sigmoid())`   | 71.77    |\n\n没有加 bn，sigmoid 会过饱和，效果不是很好。一边加 bn\n\n| 配置                                                                                                | Accuracy |\n| --------------------------------------------------------------------------------------------------- | -------- |\n| `out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()`                                       | 86.69    |\n| `out = (self.bn_s(self.shortcut(x)).sigmoid()) * out.sigmoid()`                                     | 79.90    |\n| `self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * out.sigmoid()`       | 76.32    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()`           | 83.99    |\n| `self.bn.bias.data[:]=0 `<br>` out = (self.shortcut(x).sigmoid()) * (self.bn(out).sigmoid() + 0.5)` | 86.52    |\n| `self.bn.bias.data[:]=0 `<br>`out = (self.shortcut(x).sigmoid()) * (self.bn(out).sigmoid() + 1) `   | 82.83    |\n| `self.bn.weight.data[:]=1`<br>`out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()`         | 78.74    |\n| `self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * out.sigmoid()` | 73.39    |\n\n两边加 bn\n\n| 配置                                                                                                                                                                 | Accuracy |\n| -------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |\n| ` out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()`                                                                                            | 86.23    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()`                                                                 | 86.41    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 1)`                                                           | 85.83    |\n| `self.bn.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 0.5)`                                                         | 86.23    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()`                                  | 86.52    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`self.bn_s.weight.data[:]=1`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()` | 82.49    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn.weight.data[:]=1`<br/>`self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()`   | 83.47    |\n| `self.bn.bias.data[:]=0`<br>`self.bn_s.bias.data[:]=0`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 0.5)`                           | 84.91    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * self.bn(out).sigmoid())`                          | 86.92    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 1) * self.bn(out).sigmoid())`                            | 86.75    |\n| `self.bn.bias.data[:]=0`<br/>`self.bn_s.bias.data[:]=0`<br/>`out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * (self.bn(out).sigmoid() + 0.5)`                   | 84.79    |\n| `self.bn.weight.data[:]=1`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()`                                                               | 81.91    |\n| `self.bn_s.weight.data[:]=1`<br>`out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()`                                                             | 80.93    |\n\n#### Resdual 分支内部使用乘法\n\n| 配置                                                                                                                                    | Accuracy |\n| --------------------------------------------------------------------------------------------------------------------------------------- | -------- |\n| `out_1 = F.relu(self.bn2(out_1))`<br>`out *= self.adap(out_1)`                                                                          | 86.06    |\n| `out_1 = F.relu(self.bn2(out_1))`<br>`out *= self.adap(out_1).sigmoid()`                                                                | 87.33    |\n| `out_1 = self.bn2(out_1)`<br>`out = self.conv2(out_1)`<br>`out *= self.adap(out_1).sigmoid()`                                           | 85.71    |\n| `out_1 = self.bn2(out_1)`<br/>`out = self.conv2(out_1.relu())`<br/>`out *= self.adap(out_1).sigmoid()`                                  | 87.85    |\n| `self.bn2.bias.data[:]=0`<br>`out_1 = self.bn2(out_1)`<br>`out = self.conv2(out_1)`<br>`out *= self.adap(out_1).sigmoid()`              | 86.64    |\n| `self.bn2.bias.data[:]=0`<br/>`out_1 = self.bn2(out_1)`<br/>`out = self.conv2(out_1.relu())`<br/>`out *= self.adap(out_1).sigmoid()`    | 81.51    |\n| `self.bn2.bias.data[:]=0`<br/>`out_1 = self.bn2(out_1)`<br/>`out = self.conv2(out_1.sigmoid())`<br/>`out *= self.adap(out_1).sigmoid()` | 82.66    |\n| `out_1 = F.relu(self.bn2(out_1))`<br>`out = self.conv2(out_1).sigmoid()`<br>`out = self.adap(out_1) * out`                              | 84.22    |\n|                                                                                                                                         |          |\n\n#### 借鉴 NAM\n\n1. 用了 sigmoid 乘以原矩阵\n2. sigmoid 之前用了 bn\n3. 还在每个通道上乘以了和为 1 的数\n\n$$\n\\begin{align}\natt &= norm(x) \\\\\natt &= att \\times \\gamma + \\delta \\\\\natt &= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &= att.sigmoid() \\times x\n\\end{align}\n$$\n\n| 配置                                 | Accuracy |\n| ------------------------------------ | -------- |\n| `out = self.nam(x) + self.bn_s(out)` | 86.41    |\n","slug":"Experiments","published":1,"updated":"2022-06-13T07:38:40.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgh000gy7ml4hc06vkz","content":"<div class=\"hbe hbe-container\" id=\"hexo-blog-encrypt\" data-wpm=\"Oh, this is an invalid password. Check and try again, please.\" data-whm=\"OOPS, these decrypted content may changed, but you can still have a look.\">\n  <script id=\"hbeData\" type=\"hbeData\" data-hmacdigest=\"43e126f1924f7084e07de12b0868d77f2dbe8b2c3f112ac4d624a7fa9c593b8e\">253d24b99cd7a34be71a536fc48a861e24280f85c5d92437d59d46d319bd5ad689cb46e2d80f5d3c08f50582b841f61ef78b4913d19d9c0ced47726e006c992120dec993466d1458457784d47372e9ad6b6c785b61e6c57a468cdf4e8c6c04ce797fb240f22ed4e38213649c083b811125ffca69743bca59a11165c33e4fb305c26badf7c147b24c9a4badd2111eafb1b4c2400acabe08b9f662e97889bd1703896bce400d1b2fba4ee5033c7aceef2e886e6f7b8b75ce85d0ed76b78330e3b7d94afc4063b616c95fd946018504191d2a2153850f9dcdc6937fb47184bdbea8290373b612cf43766a38c787431198d2e84999cc23405fa415cf89e43b6c015a986285433e7d2f6b90021b6dc48454f56a469a709ed2237ca082c979933b784aa12dfc584fc2e67f008674b87cebd1d2ad8963b660af4caa4b2b2610228f60ad441cc949231245303fe450f3070a2b829b713c479d9d2303b0ec7d2f057fd9dd41f788cea0deef036e15ad67979dca23a693e45bbd8c8a5d9da5b7d20629dc6c7c98621e24a3cef35158d361a642ab3243eefe63445b9516b1537dc87139602142a423ca800d2fe7714bf4e61b23215243efe1a819358b8a6a3c5cb69de271dc062e1843ccadcdf60bcfe0cebde0f0419bd3da485027e80f5415980658c848c317d3ed31b54a3d86ba650bbb605838292ac87d70f378e263c4f5dfa23380f264b345a35fcf87ec0ec3d7c2ad204a6976a5c7e3ec724e7d830b63c29f19a7591ad5ea7a99abb2df4632cb8f54d9b5957f1a4746f37f98c9c33bf77d5bd5c9edf67f10aeed7e0e88c28b0b961e7213a83612eb874c07581a461fb54d2c422190e33a03628b26beca5716127885372c68b25238d140c9a0510e8377a03c3ef5a794dc4d230b6333d9a0b08ad8b0ebeb6dff007fa44280cfa466c3c6cb48c03a8c45dda03bec2977820375933bc93a17ac5c372cd3c5ad412de458ff7b3ecc39ddff73b92bc163f5f9b108c3dd369aaf67efe6523a8568825d4a185622883dabf45832be06b52cc9d0742c7f667d86ea58dd00029404fc2f9e7caaf66e0ea525415a51d89d74f7ccc4937432365850ad1514e7ab159f35c35c1f92c5cce01eb68052cc9c2a05da41128f8b833e6ae8a637fd70e86c30c25f85658f9156975bb5ac969ecc365e792abf62eb3c2a104c742153008714150e839eb9d39afb444eaa4c01b1c3222bc4bf2530e3f597a9b0927a16c7307bcc23a29589aec7a8250d10992d99010fa1f10072af1ae513c3fb29c0df1083e7909354e51fd84cf79f9d140ba01e06f84afcd22a529833e50913016641749d2971e0aef9666170cbdf68d545868a5df3db9a08c6b1a64a61e99edd241418cc08a41010c1365ca3118e3b8db901cfec08fcf8ed934bb5e2f0c41bc54d28256e7856c3dbb8f7e4c64951b7d049cc1af0f9ad6de0ec9e00da7eab2e53a1af38fe61ae5624470153baf6d2ac15722aa3302408b15c36afe166949da75117c64c0a562078a0e5712696e0d90e6fec3e51626d903ec9c13f2293729cf3df6783bd795882b80c1188174685e9f1fb3d8583513062d3d7aef85a346da7556bc213ced0742689554b03fb58ac04b2f6cea1d36aa6fef844bb3be531c146e8384f2636f491d64e9ecd9b9c29b3b517e7db09fa817c48b785d597526fbac4a8a9932ed93275ab5ea01f79bb8b56a400b7b240dc602b4268fe6d09816d9d87852f462fc602c65372356e77aff7bc048966f6f769abbdeb55cf19cf282aa68317ad9faa5328278dd8a9c4d2f02f5d71ed08dc01c0cce9f9d0babf5368773dfa822a1e87b7d0eb896fab42eaddc1b6323d8cfeb1ab7d862236c35177ef1677973ae71183e638a1b85a298fc90ba40cb8fe4b0c8a089e5327755b700d4f5a3d36a4971fd161b51b15d3f181abc014e2dfba35a89a49e6d42323e0cf74b3d4f6e90ca34e4ce259137373d6446a52a157914b51112b029c79d966823416335fdd7586c67fdcd9bed5b35622311322255799c63910fcec67e83ec55c6611015c8e98fcd15eeda062b5f938b55d0fcb35fb360a244f4c43b2b145252e6b3680cbbee05e106d05edc696de7116d685bda924698d8f44b656bdac30aa0d7f68fe62fc7229830bf5c1bc33d9102c78453ee2252390d91c3ebfbed9380d001e1ccf36c6832ec3da7a488fe5e1cdcbe0c73e54067d83d26c262cdd26f14be1ae21be60fa00ed32fff5ac10bd697bc8727b9768c6b8031b8f0447e92f2db1da513553cb22c34051a86f3afc7b218edfd838306b630dc0ecd7eacd33c4dcd77a89a667119c07f5af0a224a8a46111dd21649f2cfb3c03b349ee9fd93741fe7872f9dbfb2d7aa2ae11429a6e7443662b2bfeea95ba26e96806193a0696024431e5d291bfc3f93074ecc53b1aa6c86786c528460e276f03ed6cfbf4abdfd3f1c16d07a540579cb28e1fae57bb9bc6c3ff2edef52ae580d7c3be9ee36521012dfb4ecc9ff7638079e6e346b1b9b4c7919edb6784c0187b120846b85b7a0a524af2e2b673fa035ce29cf5959ecec597d6a7ba3cd2f035cfac7821984d82e1d0eade2ae81ec13f4a3f854dc0ee12dfb8219dfa1adfe4156cf38f3cedf82564ee1915cdf3adde05f42bd69b3bdcdd8a381c7caa7004127feaf8c6539c51e7945010bae26c7246b37af9ede0094cb4ac97a1a1d9ffa37d8a67121cc872ed85ac252e29d666a9c12875c54b5969d80e8b79614dd7b7198c97fa3e2f4667555f1c4d862fcbd81fbf454b2cc08fa0e38927fecabafafbb3dba10eb0a198eb9a0ef3e3eaacdd5a5538c2672bfe8c03b4d6a4e439278a4f4cbe534526c33ea7fbfc8af4692b1abaae11f65673712dc98c704b7b12566bfce328f81f0b0168deae606f0ff069120840ce6db593b8f0f7f52a38dc32973bb43d3a4380d70b49fccabd232d8393c538aa9e59e0fa14b11545817afc723de3d9568a339e5409e922be36a669b2cd486e33d62522764d0a1711410597a8219219b3565761ab56b5fd24d4660441369fc17857fdd2064d26c375e8500ad0ee7c35fc8f258fb824cdc402305d6e55b8ccfcf6d0f8cada8855cb434319dc83372c7c7d39b49c94e0cdd06800ba2435d5401cf04242771755b81227f8a49e64450d3d2d462bab990779e33c3d9fd6e2678e1a653190e1fb1f47d4eaca10d08a90d97bdcd7f37f38340c578b95536006ae645cc1e4bc61d4c7ea5666f3b4e082553961fedb2203044cfbb51ff359e958584b772b207167b3318c3b96de1f51491913898ca96de19afee0b308e046bb2e7dcb8fe2555cc379c5a9adbfde8f31c572aa28ec572b7266de5afb241442a88ae147a556d399b0bd8b0c83c64bc7f05901bbaf50b6c872b3df401b0b60009db63975348bbe9e381d8abdb187d3a8cbd86c49fac7657fc2b00f1fa4767b420da187184edb80f3ad43d0fc31012209723c59abfe0b3a0c4afddde3df2366679f274f12b0568ed21b80c067de07cf813900feb72d1d7c95f7722a79b45a5f300a5af0458482ff622ab1c529c603e7216bc8e71252810fac7c296f64bd27d5d4359f5b2edcc22be44afaf5fec62596e5f71fb2524884cdd156eecf092327a60c38ba594064826c33c049dc45ec931537d4ef10df18d1b88596601d0004699fe2f2412b3ff155c9f5897c81cf98d9f520724486b959c3d0fcd9c49a5ce4a759ab86f7d30461a73304fc323bf99ce3aff80678d3fc7d006d9f350633c6ef531f8967453eb07bb3c4433cb104f65293026bf4129702acb9febac647867c680b9413b5bb0ea6286d0683f1b71e68e97f0f4fff4e5765c70f5bc4d6cb81103f3f77c5e9af797fae1eefbb77c0551c13d3c810b2e5f9a91138a78a1f861d958dcbdd12780de040a7990292ebeaf392910991c5db11aedb2621802c522998dcd4c2ca38362f4d7dfb1e7f3625f6e7e58e29f2f85a6e48cf4dc505849805ca381ea1aaaf43637c974743b1983edaaeb45ff3762b6b473422bfcc0c717ec17b0c3a45f52560ab36dc65e230997e2d4af672c9435773a3cdc18f7f94659af3fbc3745692ba98cd779111ae182b0a5d6a05932fd5deb1feba25a8015cb41aa9c797243d2647fb94b0de163508ea4851299708286790902120f7e3cf88194b94f95c91debe110dcd62258eb9fdbb76c725fa0ec051f2b2ea7ee17af7df3cb7685c1169faa7c1a33ffb6ea25d5d167b7a87b69137bbe2c724fb486b0347229f7e333b1131e28f44ec0b489907afe2c0b30a43a3c939741885debca6b1bcf41c755932cdab9172f431acc23a98cdc30e9d6f6afde87acdb5c1dacdb280e99c322227329c24c20f95256d41763851b3c52f3c4f12a50f6714746c8262caf6a46012b8ffe459d35d2fe8732b018317032080b56b272fdc637acc1d92d355dc6d7c41c03fc74f60d23776e8fdf5e2b2eb01c3aab0ff6e6a36852064e15586f17b9e8a6efffdfd879398e2e9267935e6be7fa8bfc5a047b67252cf7dbb2505d1869c50f4e08ed084d68580b57f926a5bbf07557219dc58199a6733e3e68e90b4ecbc217f71cab266f179e9abf83ae79f10783c2103974882801b64e463ca3a2615bd5628c37aca5a60c178a1b496b9a1dfcf6f437fda8fb054c224c2cdfc3a764dcf34f93431a05891f98573a6546e72de75481c0d36c4973476ce6f88910de79068ecb0acb492000310624fae79883142ddd27d9fd76b6eda9b3a56eb72712964d432054733e3766d7c93c23cc5063998b0faa33b9837ca3c50b564f1dea3a7b865252897f1fcc914b953066c876e0b781251f8a891272b4140603c0e7d69e4e78b3ee09bc2dccc588ea7fc24132891a2a7a3ebf85445d43554a73b0df5638006e01d05c6b069c48e89c5b59037d68d2d452ff409233d7ff1452f1c8f5d61da4f597af797b55aaab1b91eb1cdd4419f071e6e699f3d2dd547d7ea562fa345ab3b4a2c3c41dce535bb9d3f6083f4623037cd7f8259e2f64a7acfd8f94dc0073ddc33c54b112d1db60e091193fb99c395feeed67c739a6b9a33bdc47257cb39aa1383f3dcd3d0e1d011e42af211e651cefc02d289e1712cd0fd5e2a8a087d30ff3523129de8e96d6100a681516451a69ccf4b9f7777b02bc8c7c0184ad37b07c5dbe88fe1da69de59528c27096e85294cd4cc8aca6c0d5bb1ae8f0cf2bd2fb0950d1e3ad97031934cbf163e4566edbb3859baafde8524ef002707350e96612bf2b39cc39d6f603f4cf5f7b4814ea6cab22f2478428d90b74794aafcf39d3c16e5f635695a1522530367b97e21e74337978d0ab0e49f52e3f8f4bfb2f21a36e67f38a285e407dbde32b4daa72816ce9072145a67385854447803f56a2df78c611b204fabf718e00cb2bfd579d733b416e89b71175b2ecc3bfbb47fce4da3654790b6137ce8bf1624b596dce211515647ef59f15ffa9af44a4db07a35c58aed02c3cdbd0ef6e2dbdbcca93d6ae6239758856b2f3586d23851ef4458efc50c0eb4dad476f99656a20122c24ff2c7a190fd1c8e8923ee0ff2f98c9057824e398ed7d9c9559bd5f28e3f5fe3cd6dff6409f1dc3992663a7dd67874f1bc2e4418521241ca380bd7fd7051476964692cb57a891af09d397e43afc9d5b8d96e81521c69acb84a2f561d7e4d4fa8fbad60058d3ba2829ae841b964924f182924c676033912a83c3ad710ade9c4ee07d1ae98ea013ca41d157547a793ed9e36a2bcd9256026046ad22b8a48d720340cb2727c01ac861efe035b427e37d4a99a5eb2ca7b2dac5e265d46bc2628d197049ee7eff55c7ab782353cfbadcf65da6cd3fe058d42a5d8f0e9f46396215b8316463d637ec6ca105d61001ee70d9f2a8b3b2d9dd03f508a1a419f6fc43c429f842233c9a03c337f6ce153138f65222c3a05c7df514c321128830a66061b9238c154a7ecbf692b7213b1210148c1bded89731891f9367e7daca5608cb742de08262267e9291f6a4e9e0ee89a9b4f33f0b7dcebde7b11e9e6d1e16774290782e5ef029fdfd9a582aac177aeb1cd355ad597e21e36a76afe5790ad4fec9534618293cd27d6126a0a6d9239574944488ee7fbf7ea5983bed0b8e8ad329b5cc655375f2b4bc7c23bdbd5907dd3d9b3ead186b01e28d2e0fbcb940b636d745ead81865a68bfa9e10dbd5a9c809d3806c763cd4f848caa67219e66248ef63a9dfb8ca4afa6b718ac0c9e79c8e4039b6b6c1a1a77df98ecd4b1bac23bced554e6d51151a01be4a71e8a82345d6ad68bf0313cf721ba592288c28febccecc80700198e9b6fc6619819a6b660449b4ea4b4f40c973ab840ccd77953728265d34772260e6655b6fcd7b8ad8f8b684d60b47dbc386ff2c84499783359bc7a040c40f4fa3a6fad36b68ea81c02450b775691cfab45ec7f46cbd174b2adc50c0adf8a018c4d5c60e084d2ed84b1abffe513f59911d5381c4faf0e01492c0cdae86d4f5716423c34d25256bafb0930a8dd9b3bbfd4c91d2d6d3ce0876d7eaff1f24248ae9178e81af7931e4cd07e4bab9d9aa1e509a0bdc13f0dfe4a9de00901647c808b36b9d447eebc82bcf6d4c228a3ad98f4913ef4a894732a766069c819c6444f75286bb165fba4341ac666b872e134e1842635f35b7656f72358ce0d9f10073a53e7bd9af5293dbd8d0331d4ff8a751e30b7483c30b0069ab2868c40636cef88cf26f9167fd584663170545e20743dcacb214121ca3efa6ecab86823cbeef7bb75fb358a36033e346a95fdb370da12fb3a94a49f8cb701c46fcc3565f5caff04dafef76d54789fda3cfa30e59dbd258ae7caaf4ca864d1d0e6b53ca1356ec0a42695628e65a9db6fce96bb1c1b231d57a3699434e373c682a3dc807f74634c17f55942102c6ba42ecce01476e952aa9666457a125f784a250d3887f0559447091b6b5f0ca1deff329939f03e8e122e9a5375525bc37a02cb2081936f0d1b6454343b7e7b6e71bc15f21d7585f0033c8067da51f3a999df2af7b5460723adb12fda8a85a3fe4cf0689613d2a80a727e2b13f73671ac8db146c0cd5a823e3fb29d1263251f6cb74d1fa117544a11741098af6521655273b02e53879105ee02386e0f09d672655d5e9d4902b3546a7f9cb4dc7d230616e0ecf227228aaf92f99ef957ab1e3ff1561da26981bed2007bf7040bab599d0ef79af08edfb46224d02fffcbf3ea8fecc7866da06bdea28b1e7ddc07be604af9d4ec0ac1ecefb9978a1029ee6a77e2d5cd33b78cbe7f1b0efbbefb4cde3bc1e84c516ac0fc6896e260cf56c44e40e895317dadf1f30fa031e00d7e001b5167283896669be6319f38e49daea17fbefbdba36fc3b5378a35992df5697fddee05d63d11e4a329a7318e5e66b0a4b7414058f5c3ced4a19b3be3c77c637381c0dd25db05bb8d7f6171ff6aaa869a74e4bb516dfe525ac3cf277cc38c3d0a7a0763e4f22af098b8af58cff93f84383c29ab749fd83f850658f91bf215960550d3e1ce688c057b0336ef72da1c7c37455c5c6ed04f3e1142521c4d0756966ede3180fbfd352ac569560a8e59259f8abdd7cf5209fbb0f4f1c283350759bf4a033076b79da172ecaf2fb2dda694c8426f78da28a49c0e0d388658c549eb6f81b144c15155f1345e1ae9df80e17b403a240de04bdf605a4088839855dae0e5460319b14a26c13107468989d347cfd9098df419580611c72e7ec1c9e464f33f89be9f2d65970079ebb8b47788f795caf13ae728d320714f33c41a3265a456eda440c43b1465cd18f619d6ceadb14833089e80ebc6d6c562393093909d4227a80ed7d198615adebf49cdd0cc2c8f884580554c44b4b506ea351550995e3b5bb924ac50ee2b4768dce50da553c20b400f5c270c2cc77f55b086fdacfdb2ff47e97783fa0b7edf9fb6f0e9c6d33243caff2db988d8e6566034b6251d25b7d457a29fb56f13310a4b0b590802ccc4851e3fd23616e1c93e8f3393c5afb08202cb61eae56c4612e44d410525527ae63bee449876a3ead16066516f9264bf88c622085d08a2dc0dd83af9e27351f623851939394a5884143befa733bc4b2ddfdd7272a66a89c7aa3699eadc0ca8a1c24abb62dd75dfc95614d1e3f9560d32d40d412244bd70fe9d1eed89622e863a8dd3f19be1697816c8fadd65863d766e2e717f5292be9563cfd2ff75602e46461a89574f4673fb163b04c1bff1c0291d9f269c9e6f6dcf673f88d1f2b2ad47c194f124b91eb318c9105a79ecdb1b8d59b93d872454233e10e198e4234b6ac6f347c065b29bdf73a841f9bc3725f77f7f07bfedbfa2b86d7f649a471812bd8d53343a46811c2ceb930fcef0087b02984a9608c8302c5dda014c701c6db210a54d227ea370bcab659fc041cd350722fb703029b475ea7050636e256530fff83f3c1db8028dbbb0fc9508816701f34496d84b66612fb77bde2ee50e6c1336cf9815c63c385ae9c9173ddc160a67b1ba63b156f11edcf663eb38c8019137e2f1577d876d487c593c59e03be039cc74b780c73c77376f71cccc4fbb3a46b83214076fe9ae209e75817f1a75695c6dbb22c7946c1d0af9ca22587d194e853c3dd177b214378fafa4bde744f22b036e474b9606d30c26e92a0864be8b530f730ec6defe3a7790e688344eb13ee0384df60f63856cf7b49e562a7dc45d94174bbc575c1d7144759c4ed3b70b79e221698f1f1d7f8eeb4245847b79a796e26579b770382c6036b34fb5d7df61f143af92a287d6e0d2d1c5a7e6729f0622bdb1aa06598c265edd2d4b80e20b5b4d8980ec5a5bbb7cdd27d8d663750c83d13cb4318ac23afe64e39100504b294ede96e64503432b2319b7647f9f1be29c93a1cf268bd51bd107e74acf27c493fba3c6b415929db11fe79491e5d81c02cb8a64ea095b423a6db815c8cd74749a0956a42e4080adf0e34e1491b1bfdf8b5cef4edd0b11d4f3b865baa8caf10962b3a3ec55152281780ae0750baf0f60567714204e3fae52823d917e94978518c3694064c2b1e106627781dde681a0647dec53aaece8be0ab764d89722de1cb6610f069c60bcd2186a82ec121c10809339af5eeaf626dcd66901f9bc5230b8f6fbfb831b4b5076750e275ef346cf0f2630294ac7b375d23564c871be49a1e9bcef75b6e00dee9f3b10e024c449761aff8f840698332e0f5a955bdf7d1cd3424d2e1e29918eaf277ad34123e4a41de25e632a42c4204614db8061b6c874a2f13c5885b10fab046917a38a726e5b4fa822e17d178d5d2fbaad9734a176cc30b638497ecde6498d8e32fcb738124749aa99f71d0a269f79f4bc8840e0c04d8433193896aac1ebe1ab1b0e881bb306883b5096c22b800bd3e015cd5d30408e5046870d155f33d2cc2c69a0f149d735d8e3a05daeba588a8b7b3cb1562220068e0b8dc8687772339aa42391ca627839c09ea9477d567bca3a9d38e29e8ae1478cb121bf372b14693311efd7e3b2e5d54665523aeee620359a0ca78376e2232f9ffafe47c43bda1dd1287317dddaa13b36acad2fc059cf84696b69835442a781660e97cbe50ea54df12167a4562444b9a432d3bfa4e84584f82ee3a28170f9e2c416787f9b37110141cbcc3fca481aa8fb7388ff79f3987d4cd6f3a8e5c810c6b79f4afdeb52314c21c881ccebf063ac2bff2946dd66bf907b49d30c870e150f52fe31b8c34ce274e7e4b23c33f5fdfc05d9a7c2043df0201e8664cb04ff527abc775683f2ded9106767e3c2f281825bddeae9a4350c387a01ca68f9800d8a47761b1d87d0e27616f3148ba88b99b5b858f54c1e972e838d3985cf718983bd9073430739087f9d1424f1e03a4d8fca61429218c9f066e3c82409e3b4622df443b6dc64a9dbd374b35b185eebc5df7e3f8aa47a5591ed8690563856192e5413d36679e02bb03e5ebe1ca1565a0fb7e36b9a64909c43dbdc686b3c5ba557a4cd9b715c78b80c2be92efe0d807d5dbe64728b9f133f452e07c60545b1db7de6c4edcfc9200a934accb830ec192ea717660d99a94c39d41329a40e2686223dc4c5506421c3c2dd486372a80e7b23bed3873744f343023526359e8c8a52c9628247833d839ddf859d4754ab248c6d1a27ad4f89fe934fbb12c57ab5dd5a0a5f6984bc219a75983b6e85b1f883a4e1937fb343591a56b11d9176cd55460deb29d539850a892b3ac13d9adfcc438435df566c4c6480d7efbe5a26fe44f3ac39b01253b3b0cfd4d0af3827bee1536508542941bb3afacdd00cfcb8752005dd792fdb76aa6d1c537ccc3a6625a4788b46fd9209e5797b52107b39023586ab67c5c8969f6a8fb5180c4f8a7dc0601fa3c4a58a9651bdb0f8fd76d9c809e1abc87da0c9a65daffff503ac12ff3dfb8a465b60387249bcb40cccab469f4601fa0c74adec501a4b8588d167cbb01adc0c473bd440624b2e802e8483a673d019d4c636c7dc181655434fdd4f93c22e34b340c1ff62a8e27ec690f937df9c06122d7a59d7dc344d814de7cca699fd88ae41bec2572be6b7ff1f95dad1c6a46b91aa159ba10e5956bda646df9027db37941f95ab5a0d8cc185c14014404e0c2321fab4072acf97eba08518f9c169e01152219c4d00f9ffd54c5da5c1b34edde7faef800e49bc00c4708109b761cdd56490cc4ad00314f080739f64c87f65560ec0e9f4909c1756ee0b27cf327cc647fd7eb613ab2106171fc6c277cd5a5f89fba95e3f6709a6635a6177c81e2d0704ba67f3fe5c030ae603883d08bdea0487280c379dd0efb151d7f44e6ac5857c71181f0cb84b0747ce7845d059c4ff8c2dc230eecda88e32da531040cb7facf065898096b06984723d46e7125e1b7d5ab196bcfdb07a5fc07e7cdff24cb81356c7b7544e49407a6f34e7158c94e8b627c9d3d2acbb24df20853bbce9e733be60d24e9682403e85b3598b552609ddde58d26fb3d71964ed34bd1f60a6723630310a0a2782d22fa11e57411699bb3a9ae8c7b4c9bb40d883c6a409ef87c715f17826a0781461a26f8446fe8a87ffae48181353cb4e32c183aeb019134fd6884f2f4e5f3d13d50b2ebfb2e800d4d3644671469bc0205130fec2d2862bb326117495cf9e34366d013d910a4e3347f8ffcf969aea593b84dcdddc722c343b5d6a870440aa5564166f6f1331481e1ebc2f5637f0719c46833be6b7107d999d20ff301c182440dcce868db0a25d8f7b2f93599d62629735199f727c5e97b8baee196c3209ffd3aaf4126d5e843ea02c6e45355ba001e81f1417ba740229c7b565f781bd6e3388491eb72386ce09e554567f77659bd3ee53e71782946045ea8e061f6eac308e90de51073e884a2e9c432d726caec68eb8a29b5f2d71caaa7eacc0455c50783872f2195afb4752722e3cf466678020656b99b37882d49cdf699a6751522a784699223abdf47fa4e718f0f19924b23d8be7bb8b42fd810c374e11a69b18affb6fcf8b9295f1aa58a7f29d94f1dae5f398fadc2d17723cf316bada2ab6528a17e681f1485decafbd06c13ff2334848ad7370a5c32be7c7352ce527114041da7d3608398e9b91db21d89faeedc8d7ded7920b9424515d04c23654b5163cdfbe59b91c0f2d1243cf033103f8736cfa2592f794c3e1db62747518206d90f9f9daec354ff6844ad04001554fb1d5c202c2150714de4f451a12fb04ea0ddde0a8b2321902fb98f082fe8bbd33cc32b36f7ee20dc0f4c6202b5732b316213ac0fe345dc3e7e19b1b7ef2a84d23ff3b6c97b409145f68cea8591b37421838a0f2edba70d3478735701ef8e5e3f3aec9b1e99b3c5324aef50d4c3265d136f81207d91599b996eeabadf909069b13d5fb49b81575db7ede5175d107d22fc60c5c15300b567a70e59de7530616ea954f78f9ef2a181639a6ffcbd44a3b5b92ba280b77d15562a01355caa271e15fce2645ce33ad35978486cb4f96addd244d998ccc7d73775a8fdc0c802bcf6a96ae603c8e379c5c9304e6215b1a499ea79cd3765e23bc40b60e4a2fce84c1c5e90a485dac14a5d99d0b56bfd1f4749b3aa26b6013ab1ffa105c85028697c344458f6153b54508ffc2e549151327613fab080dd21465da880e99d39f6d5dc300da26a25a585abaad6429340c19f0ca7a65496cacc1f4be45f57536671e8e2e164f87fc82de4c932404081f7f82536a6ee0fac29034f458c5830687cbc065af6f344ff65b0a7cb579881d0ed2f70d98bf1f89a1679af6e7a9473692fcb426f14dd76776f3e7d19ebfc7e269bec5b4e0bf272b2543fcf099ae5840fc435d7785b59d751a02b32a4290d541cbcb8ce209b417142221fe9b127a118708be5a4ebd2bf069d968b385e78064263e7d9e657db8af2c21262ac943994b5e79ebdcfdc32f40e3f91c8c61b3fe1b0a3ed18808e4ee45fcc7a809996d908a636a2f5e16a1255ef8955885ef83dc5c9fd2a3b071d5b0ad64c6b193c6c0f13c6af92a2eaa6f18053f8a0eb390440867c69238a94b062226c3ffbad6802d64674bf57b5b2db755171591c3ef4954d406ab5df4bc9186584b62c08a55937cfac0318ed5bdb16f7fdd3b27a0514ac1b197fb2241aaa77e58b339d6a1557acc0e6b21f014929de00995807ae1cf5528bf41b867257b61e384deebab14730a4fd67aaaa07186e7afd86200679154e79add26f12eb38920d665008a4a095a10f907e0365a7129dd80b9dc40abfc47e1ae958422667358701c88b08fb64919c7b0d72137e6f81a74f03e9d10e2d1412d8105c6c28e2b6a52096e4e9748f5a7fe12e70cebbad3246369f0e5c54bfd56699dcc7ddde60f74ba1889c70e79b8294fb2f1184f24981f6552930642acd5a043e8f4f2ace2f8fb66e4036ad524a5ba4ca856d440bf54663abd8184ec1825259771c379e7380aa718ad983cb6d6c2c4e9573d118ae67d324c600806cac23119f2d13ccb74b06fa939709c66a22ffef47a46bdfa6b3a40070629e5803fd7b3484f1fb26cd3f1781e1d9210730a597a47372000c14b9172bdedf7ebb8db2961b1a3b8898c4d91ae4876c0dcd20eeff8d5a0e6df65191088ca8ec95e7ab1862b0abc7eef454c0b8a0f6ca7ea2fe1478494962825b5a7ff617c3eda8de2b9f14e44977b6155a39cb7c291be22e71c9c5fc67ddf4a3a9f0184747a0ff8514e374454be0da573feceeacb294319b345181fe84580cad6c62dafc0d4722f763009b82ce9d3dd18c75b0ab47fb2f64718d42d6bb745de230c57079c85a45e4bdc843295e0efa1e277d5b944e2c439fe16ef96d1ad07b32a989cec3aefd4b9b6848d59f6d0e4ad66040cab7b08c999f5452cc1f79d44ee2ce866a6b82c75b3e797c50e675454472a8440ac6c6daa22da5049c1a8e54670e120f7b50f6e1468635ab4e0bf8d1045aed791265f7a6950856ede660df2f3a8f74f9a3d422ef5c125eca22eb6ce61bc360f74d9f229ce6c67949a2c675f7b0f9d400da9ea7da049fbd9caeac07beb535729baa4c27a756df3cba33c1f9b1fdf7a8de407ea4b4e771921fba4a0fc52631b7643409d406b6daf1cc663b0ebeb77d56eda1799433338580bed6dd6a76c9ffc633d435b84f61eb222006329f1088b0282d9240b4715f4d24318e6dd05bb3bd8e5c730861204dc77f82c792ca2590a61903c5a821b74cef91cb9183b87f95d49da9e31386468c656a82d4803f3fef4cacf7186237ddce1478db41476ffd5642662f1bdade447f07a4656692f93f0c0550ed3d98230ab75487c458737a190bf1bce061aceaf446e53b3b9905b0ad52e0a895cdcbea639596f0860c86d20ca387c424f4aae5c46a2a91b745378b23d4a7b9fdc662e0bc06001945d3eb1be4505864381b6b8b760553015fcfebdae60a31c2cb163898904652aaee9306a05430f99af1257343ea66bb0b75d82e5c78ec3fa8c38fb4b9d2c44af965494d67d15d9fd643d8f15410d9dba51cb64fa2fdde0b507123df623fcf1f7494c9bb60b3034ce0b2c3bf6a724ead4227fd5683dc33bc0e7a061e7d7c59c939ee23f98f8f7c818a27af79e3137d0ecdadfb22a5542aadeab16423b4263cbf790e79f5078dad997c97c9876712194b9bc65b49cafba7d055d0b699c596e5bd73bd6e6136d30dfd0d4ad74f130f5713f5c84ff94848154f515103e080e0976fe83cbd7c6f2fcda9872705204abf955a1139901051e5bf4e7d542998f454a27d919038ce24aa24ce3a4d5ecedae82beec48e3e389464133bca956306a9ce64c9a140cf717c1c386d92308cb461b6bc859629756c323fe6cdd44dde518ff5d3475c3ca3c0e275b5944c3e6850c446bc50607776cbd6a2b675de5dbd06a56c9e1ecffdab38802c3ba023094738ede146a5db25857beaf0efed1115ab1f4af0b9f64e942eb31c9c359ffb3e397c0ef7e69c8b122a28c50d8acf78743112ed06cfcfd09b82b3c6f866a01db94f01c0ebe66645e93e215caa12ce95ad2076cdb770654d901f2b5ffecad6c30bd8f4e26dcfc8003aa08c23d793842b0ba84638be231460b6cc2d051dc35c58c064e6be82570678058a4300a686ea31914df4ab4907a2a85614ee20519e93a2d0933aa7932d3fe671146cdf7a29e4571a3e86f521a096f3898fa76002a6de1f5da8fa83fb9e4faf01ae81f6dd0aeb3673d7ee52e3620dea1d0a534aeb23d0212ac7193f144f49d155c5ffc387c58c2d0c327b923037dbc65794c237e737e000f416770c7debdc99a1a1b7756ab192e78eb3b8fcf0e234ee457113141fa8e3e4f52cc31442f88084e369b069fead884ef9812314b0b321b4671067780a2077fa0109ef9ae160f62e854963106f1a35b081128af27eba4ef38cf316b167325494c175451fd07c78242fb46c1190fc2bd97e388a904154ffd51dd7343186629a1f79bd378c845bc9f07da5fc2e330c60fb3618834dccae9e3c4cfdd928d99981e48bd71db07edc2418e3f048634f75865fb285cf9e1df94cb75399310adcfb0d9bb021e1db865b4ea4a41153ac7aee2d50c4be9d2031218bfd619ba3f9ff5e7bb80be4295f5490026dc0d3e5e59f9b0b6be8141a04ab091c3338a693d9e53c4aa17eaa24dc9cb492c2bf561f9d7212e4cf52bdee37e23f7c13e2fd3281aeda50dcbbadaf6ce7865da2e410ab8ce6d19da08b25ccdf619636ef9d9f3e64970ef6985a7d0e9dc286f1a430401020442fe79e2bb96bc993db906a63d74a82fa45d3922d7f56a491382ff3de39c885485bf302a98fee26a18c29ace7f8ada0a96e00b9c716a3e8961182f30457821ece6ce3a2dc95844280e8acd4383ada8cd7ac7c7a7a49fda696deaa5144dc2dfc01d5c2ceaa78db61104d57608b12a9322ed2bbf934591b58839d1abb55372fb13afc97592cd1f6553de1fd5dfe0de9a0262153c6ffafd6ba1c3d836f30b964db66241c80e5abd3c6406e14a1ef6e89d2cd9321fd618bebf26e37729609f15c29cdceb0a8e0f440f87e4c868b4e7b991328f13732512cc98a223669a3e5bce631f3e15ec1b7c438db1ef986fe617f2bda541c099c4fd9f6bad083b570f9601b7af11d334ac3963987fc079fc1c8dfa2b8aa3137a87a6e2332016bd8a0bddb5023d43b90977361dffd7e4a3b41165293a826b1407c900ffc4776defa433bcac837ce6e042897ca29847a341e2e63928dde77ce85465703e65c530dfffd15b252094e46c55bdca9b3ecf39a443134de42e5d85a3db2ea14d9313278d9ba463159bcbf1e0f7bca952f858c517b2983a95a227d2cc01913e253138bd1800de1ac5ad5fb23dd1f738f7263b3bc49f4311a089c213551db5546e23793b6a902b565547f4efcce0d3fe91b941ed2c0017797b6284636b9c4c150874842c46484bff42357f8310c0c936c481efde721eb413254fc52567cca131c0a0a5572b8c6a283ca57fcdb64fb42950e288be449ba9e10866349c37f6a4f8e273ccc2dcab9877f7f77b9c2619c0cf6240db3d2bfa23a0dd2e1d40732d836d756a7daa7446a11a37781c74c911d43cf0b950a8c3035ee35211ab43cd28b62d966b6b5890328dce8338c91dbf6a0b6409b118ff3d6341e4eb8696ece457c96dcd677ec4a9fa1d153b0a9cc2fda7cab6327529acaca565548749e82473c36ea65f04a582194ccfd375bf831273e0e20c554a06ccabf8eaba9ca1e1d13b53708cfcb9cf9d07a48e45acc89f8a05125d4faf64c9608cdfab80b6d9e9cd9c354a0f2a4aae46a87ab5c9c0114f34bbe18581ca0fc5dec037fa71bfad44efdcc7853349e1d98e5d3a4dd52d7d72eafcf56bff2a3b347b6ed78775c3d4457b42152c3d0a49763054368502616016e5608867bccad46c49209606b1d1bd2d4669ea0b22ad21d9cb23c4cca1eb36667444325bd9d51ad820815419008b5e54f740c19df1a74b2468cdcf97f46e09626d17e4d0da43d38f3fd78eb52e9e2688d677c06f4d462be126d483f658620c870f459e7ccb4d40827e94976f207b5660f220d6ade4c9a6158c9f37711e40d7c47973452543d549bd875f282b0cb1da251fbc4e9b837e1d800d513de617dda8df63b59367203ff8b68e8d6ebae14efde59bbd3b567f21a8db3190a850ea7263733e6a1a17db2a3bd463beda6bc09cf235c50bd1d039c1d2ef8c1b171ef464317427f8aa70a7b88be394c703f35de00bae1646f95dfcd43667a214b678eb75f71e3bd751fe4c60c20b58459a0b16292081844264dfdde7f74cb28b2f2a2b95d2596286cfd2704ebf436b654c7e7ab7c130d271938df049248d72d56f007206f453eb983bde87650b3e1f34b25d9f09e827c80ac344224f87f9f596edbf71994196b20d66a61ea173835bdc3560c9f16e51f1afdbedf78bbd24cfa277f93573913c2380708201527b8428404611acd851152c0855d5a0664d1a4c5a2f82f670ffecb15a7ca8640e138a3555fa877759d67ed2d64b8b03ff61221d4f922164baf0d610bcf74e451e86cb5e34db35a1fcca702a1ab479ae3185c11c259d73f329382567dc578803109a0956158b13808e7c1b8af2812fd5375af62621c60097d7b6ccf8c57e41ec5605d7e0cfc514fa2bd4c9fa867dc264e716be7a1b1c1fbeb401502a2d6451152cb2225742eead18821d9d85e7eb1c9c6f1cc2ff7ec32aafbd92bdfe822ef7e975d3616ebc1f913f40d6ab3f72bcb58f6dbd6bcbed1f37f20d675d423bfaaf22752c75f3973c27df606c71c2f87f9bc10cf0e1e5848fbff480124db2afe563318c905d258b7d58f6f257f741d0ab3a1d800014a6b2b20423e88f74bbdf190836ae1a13352ae2ef85ddc56195b43f674834836a3ec112b880e866af9c5c6d0e3b958759810cb81bf5a7a4e2a22f1ef2fe8baa91297334683fe976f8aaccfa2394785d63f0a570e61085ce887c8b95f4b8383e818dd384a34a641240374b0420a2b910abe4dfc40a54afff32d06f2cd4aab783934c9c40e81d1b179dc397fc54a73c20fa1a6e8e972ddc6cd0f680d90da861cd374bcf81e8929cf793860dd309a65137fc9964f09a10f7305ba4a396d1b7cb7cc4ea99d73b979c464c6f663b43c76881b2e61b2280e4904d769ec1fd2bd6d0f5a4a06bab917aaec22b841bcc75231369bb8a0831f4270c2b79a2fb7f17a4055eccf204262a1d4879ed29581504b783a15dce9e1d4f275169b093d7e304d1e1f8e0ac55ee33b1629baad3dba61ad213090380ccd8f8e72307b891029ea4029b44b94509273d1d851ad237e04b965019c5f2ce85231c273078cc4b08aa5cc9d8b21fb3cfad8aee9b3690db2af79d30df6e5559f6688a3accb8624c41ebd2cbda0d8859d73bf13d2ae1cac90682e051d04ba16c7e651c52584191d3f6a767d1d4c799c014c559149aca60a1e6d4bf3c062e06b7da7828867de930d89686bcc7772cece25f4b1cc028255fce7a12cf310f21216005262a8b76ed991d767ac7241d288f088dc6580f90ccdaad4e79bb37eb42ab55050f7a1fb10726dfe08bfc7e0a1fa6cb86c27afda998883b9a75d25fb320d8ce358b21d9752f35f13a08bb84be7635730778cd6ce987f3dfc26646e701ddfefa09a5d77bf146292bd5834f288e48065b7c7f102547cfec410ef2f01417c04dcea9a473896a26a7f68e06e42b82eafe6690c8a73a85a9a10e809196121b3ebb3ed3cde841e7760917dd686a45cde22b7940d3d328995fb3ad701dc8d77a7339922663904a84eb0d31d6811145eee3bc29f6ad211296f0bfc366709140c34aa4415e59f9179a42a52c9085515edd4a7b3b156ed67039781945cc3cbdc2b674b8c6032ab7b69a2fb28a9f56ad1480d6cb2557e298a5d559418085535737d1fd6e093d223ccf641523146b0e795a7428d5ef6f58337db2b7d03a553b4e8e5440d50d1c813c33778610e7e154ddd613ea7c57b49d170cd5f45494a419527100fa293ea3a1cd01fff528e83aa2ebff45698f390d916d2af221101e55b53180c4b0c74f8db770d7afa5b294a0b448d9c8fd368a6fd1517c7290ca0d72fa6b70661ffcc33bc9e637cba8ea10662fcd6f2fa6b06566d387dfd5be7c25bd6eb0153d16318fe3a9c4e7488bcdc3bebc2866c5b3790b1be4842e1c9ae04d601159d1f92e28baa2c1511a91592fff0578677352b036dd48f34346637005b2890a7c91f9a25ce803c411c870fef33a507742ff922b954ea3829102b1168fe13354ffd7881692b0078089a3341c9abcec9d2fbc4bc6997f600400c44255ed8f9d87c21d3e4ca3cb811626a7b068744b76fffb79f26087d6cf28aa1901c70fe487f3476f2b6094ffd82411ed88c1e37f723f255cae4173f00e4f5bd1a</script>\n  <div class=\"hbe hbe-content\">\n    <div class=\"hbe hbe-input hbe-input-default\">\n      <input class=\"hbe hbe-input-field hbe-input-field-default\" type=\"password\" id=\"hbePass\">\n      <label class=\"hbe hbe-input-label hbe-input-label-default\" for=\"hbePass\">\n        <span class=\"hbe hbe-input-label-content hbe-input-label-content-default\">Hey, password is required here.</span>\n      </label>\n    </div>\n  </div>\n</div>\n<script data-pjax src=\"/lib/hbe.js\"></script><link href=\"/css/hbe.style.css\" rel=\"stylesheet\" type=\"text/css\">","site":{"data":{}},"excerpt":"这是一篇加密文章，需要密码才能继续阅读。","more":"这是一篇加密文章，需要密码才能继续阅读。","origin":"<html><head></head><body><h1 id=\"deep-learning\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#deep-learning\"></a> Deep Learning</h1>\n<h2 id=\"feature-map-multiplication\"><span class=\"post-title-index\">1.1. </span><a class=\"markdownIt-Anchor\" href=\"#feature-map-multiplication\"></a> Feature Map Multiplication</h2>\n<h3 id=\"dataset-caltech101\"><span class=\"post-title-index\">1.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#dataset-caltech101\"></a> dataset: Caltech101</h3>\n<p><a href=\"https://github.com/xyegithub/Featrue-map-multiplication\">source code</a></p>\n<p>3 号服务器</p>\n<p>/media/new<em>2t/yexiang/image_classification/multiply/from</em>#1/ffmnst/Caltech101</p>\n<h4 id=\"bnsig\"><span class=\"post-title-index\">1.1.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#bnsig\"></a> bn，sig</h4>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = self.bn(out) + self.shortcut(x)</code></td>\n<td>87.62</td>\n</tr>\n<tr>\n<td><code>out = (out.sigmoid() + 1)* self.bn_s(self.shortcut(x))</code></td>\n<td>78.23</td>\n</tr>\n<tr>\n<td><code>out = (self.bn(out).sigmoid() + 1) * self.bn_s(self.shortcut(x))</code></td>\n<td>78.69</td>\n</tr>\n<tr>\n<td><code>(self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x))</code></td>\n<td>78.57</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(out).sigmoid() + 1) * self.bn_s(self.shortcut(x))</code></td>\n<td>82.26</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=1</code> <br><code>out = (self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x))</code></td>\n<td>84.10</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(out).sigmoid() + 0.5) * self.bn_s(self.shortcut(x))</code></td>\n<td>84.85</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(out).sigmoid()) * self.bn_s(self.shortcut(x))</code></td>\n<td>85.83</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn.weight.data[:]=1</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(out).sigmoid()) * self.bn_s(self.shortcut(x))</code></td>\n<td>81.57</td>\n</tr>\n</tbody>\n</table>\n<ol>\n<li>从这个结果看出 shortcut 的均值为 1，会使得优化更好</li>\n<li>Res 分支的 sigmoid 不需要加 0.5 或者 1，性能提高了。乘以 sigmoid 本身有恒等的\n特性。sigmoid 分支输出都为 0 时，sigmoid 输入都是 0.5。</li>\n<li>在 Res 分支的 sigmoid 之前，先对 out 进行 bn 归一化，会优化的更好，而且让归一\n化的均值为 0，会优化的更好。但是如果同时也控制归一化的方差，效果变差。无参的\nbn 限制了表达能力。</li>\n</ol>\n<h4 id=\"sig-bn\"><span class=\"post-title-index\">1.1.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#sig-bn\"></a> sig, bn</h4>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = self.bn(out) + self.shortcut(x)</code></td>\n<td>87.62</td>\n</tr>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid() + 1)* self.bn_s(out)</code></td>\n<td>83.93</td>\n</tr>\n<tr>\n<td><code>out = (self.bn(self.shortcut(x)).sigmoid() + 1) * self.bn_s(out)</code></td>\n<td>85.54</td>\n</tr>\n<tr>\n<td><code>(self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out)</code></td>\n<td>85.14</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(self.shortcut(x)).sigmoid() + 1) * self.bn_s(out)</code></td>\n<td>85.43</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=1</code> <br><code>out = (self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out)</code></td>\n<td>87.44</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(self.shortcut(x)).sigmoid() + 0.5) * self.bn_s(out)</code></td>\n<td>84.39</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(self.shortcut(x)).sigmoid()) * self.bn_s(out)</code></td>\n<td>84.39</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn.weight.data[:]=1</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = (self.bn(self.shortcut(x)).sigmoid()) * self.bn_s(out)</code></td>\n<td>84.91</td>\n</tr>\n</tbody>\n</table>\n<p><strong>sig, bn 比 bn, sig 的效果好。原因可能是，sig 本来就有梯度的问题，然而\n，shortcut 分支没有需要优化的参数，所以把 sigmoid 放在 shortcut 分支更好？</strong></p>\n<h4 id=\"bn-bn\"><span class=\"post-title-index\">1.1.1.3. </span><a class=\"markdownIt-Anchor\" href=\"#bn-bn\"></a> bn, bn</h4>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>Accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>77.13</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=1</code><br><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>75.75</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:] = 1</code><br><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>79.55</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=1</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>81.39</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=1</code><br><code>self.bn.weight.data[:]=1</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>81.05</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=1</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>self.bn_s.weight.data[:]=1</code><br><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>80.24</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=1</code><br><code>self.bn.weight.data[:]=1</code><br><code>self.bn_s.bias.data[:]=1</code><br><code>self.bn_s.weight.data[:]=1</code><br><code>out = self.bn(out)* self.bn_s(self.shortcut(x))</code></td>\n<td>81.22</td>\n</tr>\n</tbody>\n</table>\n<p>均值为 1 的话，一般来说还是会获益。但是 bn 的效果不是很好。</p>\n<h4 id=\"sig-sig\"><span class=\"post-title-index\">1.1.1.4. </span><a class=\"markdownIt-Anchor\" href=\"#sig-sig\"></a> sig, sig</h4>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>Accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid()) * out.sigmoid())</code></td>\n<td>79.44</td>\n</tr>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid()) * (out.sigmoid() + 0.5)</code></td>\n<td>70.05</td>\n</tr>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid() + 0.5) * (out.sigmoid())</code></td>\n<td>76.61</td>\n</tr>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid()) * (out.sigmoid() + 1)</code></td>\n<td>72.64</td>\n</tr>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid() + 1) * (out.sigmoid())</code></td>\n<td>71.77</td>\n</tr>\n</tbody>\n</table>\n<p>没有加 bn，sigmoid 会过饱和，效果不是很好。一边加 bn</p>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>Accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>86.69</td>\n</tr>\n<tr>\n<td><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * out.sigmoid()</code></td>\n<td>79.90</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * out.sigmoid()</code></td>\n<td>76.32</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>83.99</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>out = (self.shortcut(x).sigmoid()) * (self.bn(out).sigmoid() + 0.5)</code></td>\n<td>86.52</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>out = (self.shortcut(x).sigmoid()) * (self.bn(out).sigmoid() + 1)</code></td>\n<td>82.83</td>\n</tr>\n<tr>\n<td><code>self.bn.weight.data[:]=1</code><br><code>out = (self.shortcut(x).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>78.74</td>\n</tr>\n<tr>\n<td><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * out.sigmoid()</code></td>\n<td>73.39</td>\n</tr>\n</tbody>\n</table>\n<p>两边加 bn</p>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>Accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>86.23</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>86.41</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 1)</code></td>\n<td>85.83</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 0.5)</code></td>\n<td>86.23</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>86.52</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>self.bn_s.weight.data[:]=1</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>82.49</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn.weight.data[:]=1</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>83.47</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * (self.bn(out).sigmoid() + 0.5)</code></td>\n<td>84.91</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * self.bn(out).sigmoid())</code></td>\n<td>86.92</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid() + 1) * self.bn(out).sigmoid())</code></td>\n<td>86.75</td>\n</tr>\n<tr>\n<td><code>self.bn.bias.data[:]=0</code><br><code>self.bn_s.bias.data[:]=0</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid() + 0.5) * (self.bn(out).sigmoid() + 0.5)</code></td>\n<td>84.79</td>\n</tr>\n<tr>\n<td><code>self.bn.weight.data[:]=1</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>81.91</td>\n</tr>\n<tr>\n<td><code>self.bn_s.weight.data[:]=1</code><br><code>out = (self.bn_s(self.shortcut(x)).sigmoid()) * self.bn(out).sigmoid()</code></td>\n<td>80.93</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"resdual-分支内部使用乘法\"><span class=\"post-title-index\">1.1.1.5. </span><a class=\"markdownIt-Anchor\" href=\"#resdual-分支内部使用乘法\"></a> Resdual 分支内部使用乘法</h4>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>Accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out_1 = F.relu(self.bn2(out_1))</code><br><code>out *= self.adap(out_1)</code></td>\n<td>86.06</td>\n</tr>\n<tr>\n<td><code>out_1 = F.relu(self.bn2(out_1))</code><br><code>out *= self.adap(out_1).sigmoid()</code></td>\n<td>87.33</td>\n</tr>\n<tr>\n<td><code>out_1 = self.bn2(out_1)</code><br><code>out = self.conv2(out_1)</code><br><code>out *= self.adap(out_1).sigmoid()</code></td>\n<td>85.71</td>\n</tr>\n<tr>\n<td><code>out_1 = self.bn2(out_1)</code><br><code>out = self.conv2(out_1.relu())</code><br><code>out *= self.adap(out_1).sigmoid()</code></td>\n<td>87.85</td>\n</tr>\n<tr>\n<td><code>self.bn2.bias.data[:]=0</code><br><code>out_1 = self.bn2(out_1)</code><br><code>out = self.conv2(out_1)</code><br><code>out *= self.adap(out_1).sigmoid()</code></td>\n<td>86.64</td>\n</tr>\n<tr>\n<td><code>self.bn2.bias.data[:]=0</code><br><code>out_1 = self.bn2(out_1)</code><br><code>out = self.conv2(out_1.relu())</code><br><code>out *= self.adap(out_1).sigmoid()</code></td>\n<td>81.51</td>\n</tr>\n<tr>\n<td><code>self.bn2.bias.data[:]=0</code><br><code>out_1 = self.bn2(out_1)</code><br><code>out = self.conv2(out_1.sigmoid())</code><br><code>out *= self.adap(out_1).sigmoid()</code></td>\n<td>82.66</td>\n</tr>\n<tr>\n<td><code>out_1 = F.relu(self.bn2(out_1))</code><br><code>out = self.conv2(out_1).sigmoid()</code><br><code>out = self.adap(out_1) * out</code></td>\n<td>84.22</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"借鉴-nam\"><span class=\"post-title-index\">1.1.1.6. </span><a class=\"markdownIt-Anchor\" href=\"#借鉴-nam\"></a> 借鉴 NAM</h4>\n<ol>\n<li>用了 sigmoid 乘以原矩阵</li>\n<li>sigmoid 之前用了 bn</li>\n<li>还在每个通道上乘以了和为 1 的数</li>\n</ol>\n<p class=\"katex-block katex-error\" title=\"ParseError: KaTeX parse error: No such environment: align at position 7: \\begin{̲a̲l̲i̲g̲n̲}̲\natt &amp;= norm(x)…\">\\begin{align}\natt &amp;= norm(x) \\\\\natt &amp;= att \\times \\gamma + \\delta \\\\\natt &amp;= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &amp;= att.sigmoid() \\times x\n\\end{align}\n</p>\n<table>\n<thead>\n<tr>\n<th>配置</th>\n<th>Accuracy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>out = self.nam(x) + self.bn_s(out)</code></td>\n<td>86.41</td>\n</tr>\n</tbody>\n</table>\n</body></html>","encrypt":true},{"title":"First Step to Reinforcement Learning","description":"An introduction to Reinforcement Learning","abbrlink":"1e331e4a","date":"2021-12-03T08:48:41.000Z","_content":"\n### 什么是强化学习，关于强化学习的几点疑问\n\n<font color=green size=3>强化学习三要素：环境状态，行动，奖励</font>\n\n<font color=green size=3>目标：尽量多的获得奖励</font>\n\n<font color=green size=3>本质：连续决策</font>\n\n基本的强化学习模型包括：\n\n- 环境状态的集合 S\n- 动作的集合 A\n- 状态之间的转换规则（是环境的一部分）\n- 规定转换后“即时奖励”的规则（是环境的一部分）\n- 描述主体（智能体）能够观察到什么的规则（是环境的一部分）\n- 能够做出决策/动作的主体（智能体）\n\n#### 区别于深度学习，强化学习的本质特点是什么？\n\n**两个定义**\n\n1，强化学习是机器学习的一个重要分支，主要用来解决连续决策问题。\n\n2，强化学习又称 再励学习，评价学习或增强学习，是机器学习的范式和方法论之一，用于\n描述和解决智能体（agent）在于环境交互过程中通过学习策略以达成回报最大或实现特定\n目标的问题。\n\n强化学习的本质是<font color=deeppink> 描述和解决智能体（agent）在于环境交互过程\n中通过学习策略以达成回报最大或实现特定目标的问题。</font>它本质是这样一种场景，\n在这种场景中它为了达到某种目的，做出连续的决策。这样符合这种场景，那就是强化学习\n。\n\n强化学习和深度学习这两个名词的维度是不一样的。深度学习描述的是算法本身的特点，深\n度够不够，是不是连接主义的模型。深度学习可以用来做无监督，也可以用来做半监督，也\n可以用来做弱监督，甚至可以用来作为强化学习算法的一部分。深度学习这个名词，不管应\n用场景只管模型本身是不是满足深度学习的特点。\n\n而强化学习描述的是应用场景的特点，只要能提供智能体决策的算法，管它是什么模型，什\n么结构，那就是强化学习的算法。从这个角度上讲，我现在认为强化学习和监督学习，无监\n督学习，弱监督学习，是并列的，是对应用场景的描述。和深度学习不是同一维度的。\n\n<font color=deeppink>强化学习的本质在于目标给定的形式，不像无监督学习那样完全没\n有学习目标，也不像监督学习那样有非常明确的目标（label），强化学习的目标一般是变\n化的，不明确的，甚至可能不存在绝对正确的目标。，强化学习的问题都可以抽象成，环境\n状态，行动和奖励。应该说只要能抽象为这三个要素，目标是获得最大奖励的模型，就是强\n化学习的模型。</font>\n\n强化学习的最大的特点是“试错”，是尝试各种可能，而强化结果好的可能。（策略网络的特\n点，估值网络的特点是修正和预测获益）\n\n由于强化学习是一种决策学习，这个问题的特点就是离散型。但是离散并不就是强化学习（\n连续的决策才是，目标的模糊和不确定性是决策问题的特点）。深度学习本质是函数的拟合\n，所以连续可微是它的特点。并不能说连续可微的问题就是深度学习，离散的问题就是强化\n学习。\n\n#### 深度学习用梯度下降的算法实现模型的优化，强化学习无法求导，甚至连学习目标都是模糊的如何优化模型参数？\n\n这个问题要了解下一节，具体的强化学习方法。\n\n#### 强化学习与弱监督学习？\n\n弱监督是属于有监督学习，只是它学习的目标不是被给予的标签，而是比被给予标签更强的\n标签（强弱是指标签做含有的信息量），也就是说弱监督是根据少量信息的标签，推测出更\n多的信息。\n\n强化学习的本质是连续决策。连续决策的特点是目标的模糊和不确定性。\n\n所以，虽然弱监督和强化学习都没有给出最终准确的目标，但是他们任然很不同的\n\n#### 深度学习是死的，没有智能的机器学习算法，强化学习是“活的”，有智能的机器学习算法\n\n深度学习大部分我们用作有监督的学习算法。其实说深度学习是死的，不如说有监督学习是\n死的。\n\n有监督学习其实是完全的复刻标签里面含有的知识，它的本质就是一个函数拟合的问题，它\n无法摆脱对绝对的标签的依赖，无法超越标签。\n\n而强化学习，正由于它的目标是模糊和不确定的。使得算法在设计上必须具有随机性和探索\n性，它能够探索出人类从来没有到过的领域。就像在围棋上，下出人类完全无法理解的棋，\n人从来没有想过的一些下法。这就是强化学习算法探索出来的知识。所以我觉得它是活着的\n，拥有智能的算法。\n\n<font color=green>从感性的层面，强化学习算法很接近人脑的行为：感知环境，探索环境\n，强化有益行为</font>\n\n#### 关于深度学习，强化学习，连续可导性和离散不可导性的讨论\n\n1.  从函数的角度，深度学习和强化学习都需要学习一个函数映射。深度学习是从输入到\n    target 的映射。强化学习是学从环境状态到 Action 的映射。这两个映射可以看成性\n    质一样的，因为深度学习可以作为强化学习的智能体。所以从函数的角度，他们没有连\n    续和离散的区别。（PS. 深度学习模型和强化学习的智能体都是连续可导的函数\n    。target 和 Action 都可以是离散的或者连续的。）\n\n2.  深度学习作为用梯度下降算法优化的模型，无法优化对 loss 不可导的参数。如在深度\n    学习中，设计一个分支来决定模型是否应该包含某个模块，这个分支的参数是不可优化\n    的。因为包含和不包含是离散的，对 loss 不可导。\n\n不过假设，如果包含与不包含是连续的。也就是说，可以以 0.1 的权重包含。那么，这些\n参数是可以优化的。从这点来看，离散就是导致模型参数不可优化的原因。\n\n3.  强化学习在离散的情况下解决 2 中的问题。由此，我得到了一个概念，强化学习解决\n    离散的问题。\n\n4.  下面我们来分析一下这个场景。首先，决定一个模块该不该被使用，这个场景是一次\n    Action 的场景，不是连续决策的场景。也就是说 Action 一次，我就能知道最终\n    reward 多少了，只有单步的 reward。\n\n限于这个单次决策的场景来看，如果 Action 相对于 reward 是连续可导的，那么深度学习\n就能解决这个问题。如果 Action 相对于 reward 是离散的，那么仅仅深度学习无法解决这\n个问题，要靠强化学习。\n\n<font color=green>这里单次 Action 就知道 reward，实际上这个问题就退化为了有监督\n学习，因为这个单步的 reward 就可以看成我的标签了。所以深度学习解决这个问题是很自\n然的。</font>\n\n5.  多次决策的问题，无论是连续的还是离散的都只能用强化学习的方法。因为多次决策，\n    这个问题就不可以退化为监督学习的问题了。它是一个真正的强化学习的问题。\n\n综上所诉，强化学习解决深度学习解决不了的离散问题，那只是在单次决策的时候，这个问\n题退化为了有监督学习。强化学习的方法，恰好可以提供离散变量的学习。\n\n强化学习方法解决深度学习中的离散问题，仅仅是强化学习附带的一个小福利。\n\n**<font color=green>因为它能把经验转化为可导的目标，就拿策略网络来说，从梯度的角\n度，它只管增加当前随机 Action 的概率，而加入 advatage 之后，自动就优化除了想要的\n大 reward 的行为。</font>**\n\n#### 深度学习优化和强化学习优化的感性理解\n\n前面说了深度学习优化可导的参数，强化学习可以优化不可导的参数。这里说一下对深度学\n习优化方法和强化学习优化方法的感性理解。\n\n还是说前面包不会包含某模块的例子，由于连续可导，对于每一个参数值，深度学习模型其\n实都同时参与了两种 Action（包含和不包含）。score = 0.1 包含，其实其中包含了含有\n的成分，也包含了不含有的成分。所以我们可以连续的变动 score，看看包含多好，还是不\n好含多好。这其实就是梯度下降算法的方式。得益于每一个参数，其实我都对包含和不包含\n的情况都有了解，我当然知道哪个更好，就往那边移动（优化）。\n\n然而，对于离散的情况，要么只能包含，要么只能不包含。当选择包含的时候，模型对不包\n含的情况完全是无知的。可能更好，也可能差。当不包含的时候，也是一样的。无论哪种情\n况，我都没有办法优化，两种情况是完全隔离开的，信息不沟通的，是离散的。所以梯度下\n降算法无法优化它。\n\n强化学习用随机探索的方法让两者信息又沟通起来。包含一下试一下，然后，不包含也试一\n下。尝试的结果是哪种 reward 多，就增大哪种的概率。\n\n**<font color=green>所以，无论哪种优化方法，信息的沟通都是必要的。要对所有的\naction 都了解，才能知道选择哪种 action。 只是深度学习是连续的，它的每一种参数，\n都包含了所有 Action 的信息（reward），每一种 Action 都参与了，所以它能直接连续的\n梯度下降的优化，不需要随机探索了。而对于离散的，每种 action 只能知道自己的\nreward，对其他 Action 一无所知的时候，梯度的优化是不行的。必须要探索各种\nAction，还是要知道了每一种 Action 的情况(reward)之后，才能优化。这是方法论\n。</font>**\n\n更进一步，离散的地方，相对于 reward 一定是不可导的，所以深度学习不行。而强化学习\n，更准确的说是策略网络，相当于给离散的地方加了标签，这样它就在离散的地方有监督了\n，它就可以根据增加的标签优化。而标签的设计就是根据探索的结果，增大 reward 大的\nAction，reward 大的 Action 就是它的标签，而且这个标签是动态的，是对抗得出的。\n\n强化学习方法算出的梯度是策略梯度。\n\n**<font color=green>强化学习： 不知道选哪边了； 试试呗；按试出来 reward 大的\nAction 优化它。</font>**\n\n**<font color=green>强化学习：它离散，对于 reward 不可导；不直接用 reward 优化它\n，给它加个标签，把试出来 reward 大的 Action，作为标签去优化</font>**\n\n在不可导的地方加标签。\n\n**<font color=green>由此，强化学习算法的本质是制作标签，无论是连续决策，标签不确\n定的情况，还是它能解决离散问题的情况，它都是用制作标签的方法解决的。</font>**\n\n### 策略网络(Policy Network)和估值网络(Value Network)\n\nAlphaGo 使用了快速走子，策略网络，估值网络和蒙特卡洛搜索树等技术。\n\n强化学习算法的一个关键是<font color=green>随机性和探索性</font>，我们需要让算法\n通过试验样本自己学习什么才是某个环境状态下比较好的 Action，而不是像有监督学习一\n样，告诉模型什么是好的 Action，因为我们也不知道什么是好的 Action.\n\n深度强化学习模型的本质是神经网络，神经网络是工具，根据问题转化以及建模的不同，主\n要分为策略网络和估值网络。\n\n强化学习中最重要的两类方法**Policy-based,Value-based**。第一种直接预测在某个环境\n下应该采取的行动（直接输出改采取 Action 的概率）。第二种预测在某个环境下所有行动\n的期望价值，然后通过选择 q 值最高的行动执行策略。\n\n他们都能完成决策，但由于建模的不同，估值网络包含有更多的信息，它不仅能提供决策，\n还预测了决策带来的收益。\n\n<font color=deeppink>策略网络是隐式的学习了某一 Action 所带来的全部获益（当前获\n益+后续获益），而估值网络直接显示的学习 Action 所带来的全部获益。</font>强化学习\n算法做出最佳抉择只需要知道哪个 Action 全部获益最大，策略网络就是这样做的，估值网\n络不仅学习了哪个 Action 全部获益最大，还把每个 Action 的全部获益给计算出来了。\n\n<font color=green>相对来说，策略网络的性能会比估值网络好一些。</font>\n\n<font color=green>Value Based 方法适合仅有少量 Action 的环境，而 Policy Based 方\n法更通用，适合 Action 种类非常多，或者具有连续取值的 Action 的环境。结合了深度学\n习之后，Policy Based 方法就变成了策略网络，Value Based 方法就变成了估值网络\n。</font>\n\n#### 策略网络(Policy Network)\n\n直接看一个例子，学习的目标是，左右用力使得木棍不倒地\n[Policy_Network.py](https://github.com/xyegithub/myBlog/blob/main/posts/1e331e4a/policy_network.py)\n\n关键代码\n\n```python\nscore = tf.matmul(layer1,W2)\nprobability = tf.nn.sigmoid(score)#网络输出采取Action 1的概率。\ninput_y = tf.placeholder(tf.float32,[None,1], \\\\\nname=\"input_y\")# 输入采取过的行为，这个行为是随机生成的。\nadvantages = tf.placeholder(tf.float32,name=\"reward_signal\")\n# 输入获益\nloglik = tf.log(input_y*(input_y - probability) + \\\\\n(1 - input_y)*(input_y + probability))\n# 损失函数，如果行为是1，则增大\n\n#概率，如果行为是 0，则减小概率（相当于也是增加0的概率），也就是说这个损\n#失函数无论当前行为是什么都会增大当前行为的概率。\nloss = -tf.reduce_mean(loglik * advantages) # 这行代码很关键，\n#相当于给损失函数成了一个权重advantages，得到最终的损失函数。\n#advantages是当前试验的全部获益。如果全部获益大，将以更大的权重，增加\n#当前行为的概率。\n\n#所以，策略网络其实也是一个对抗学习的过程，增加所有采取过行为的概率，只是\n#获益多的行为以更大的权重增加。\n\n#一个试验： 由初始状态开始，随机采取一连串的行为\n#（Policy_Network.py 中是根据当前模型输出的概率,来生成随机的行为，但\n#是我感觉直接用0.5的概率随机生成一连串的0和1的行为也是可以的，下面将实\n#验一下），直到任务结束。\n\n## 由于每个试验，都可以一直行为到任务结束，所以每个action，我们都可以得\n#到它在该试验中的全部获益（当前获益 + 之后所有行为的获益）\n\n## 随机生成了n个试验，其中又各种各样的决策（随机探索），全部获益大的\n#action，它的advantages也大，那么它的概率就增大的多，它被强化的厉害。\n\n##试验生成的过程，实际上就是数据集构建的过程。策略网络的数据集是由环境\n#和一系列随机的行为构成的。它提供了环境在各种行为下的反应（获益）。模型\n#学习为环境带来高获益的行为的规律。\n```\n\n由上面的代码可知，从策略网络的角度看强化学习的话，强化学习的关键其实是对数据集的\n构建---如何构建数据集。\n\n在构建数据集的时候，随机探索肯定是必要的。随机探索的结果会得到一系列好的行为，也\n会得到一系列不好的行为。如何强化好的行为就是算法设计的时候需要注意的。\n\n上面的代码在探索阶段借用了当前的模型，即根据当前模型输出的概率随机生成行为，从而\n形成数据集。如果完全的随机（一直使用 0.5 的概率随机的生成 Action）会什么样呢？\n\n##### 数据集是否可以和模型无关（不随着模型变化）？\n\n关键修改代码\n\n```python\n###基于当前模型，根据当前的状态x，生成Action 1的概率\ntfprob = sess.run(probability,feed_dict={observations: x})\n### 基于预测概率，随机生成行为，并试探环境。生成数据集。\naction = 1 if np.random.uniform() < tfprob else 0\n```\n\n修改后\n\n```python\n### 注释掉这句，并不需要根据当前模型生成概率\n### tfprob = sess.run(probability,feed_dict={observations: x})\n### 直接设置概率为0.5，随机完全随机探索生成数据集。\ntfprob = 0.5\naction = 1 if np.random.uniform() < tfprob else 0\n```\n\n结果：修改后，模型无法收敛。\n\n完全随机很小的概率能探索出很好的试验，这些好的行为也很难持续的得到强化。\n\n所以，强化学习也有一种效果叠加的感觉。在完全随机的情况下 ，探索出相对好的\naction，再在这个相对好的 action 的基础上，在探索探索出更好的 action。\n\n如果数据集不依赖模型，就是一直在完全随机的基础上探索。这样很难收敛。\n\n也可以这样看，完全随机的话，最多能学到前几步的策略（因为完全随机就走不了几步，探\n索的经验就只有那几步）。依赖于模型，探索的行为更有价值，因为是依赖于学到过的知识\n的，一方面确认了，按学到的知识走，确实获益多，一方面又在学到的知识的基础上，做了\n一些随机，探索更好的知识。\n\n#### 估值网络(Value Network，Q-learning)\n\nQ-Learing 用神经网络实现，得到的模型就是估值网络。\n\n也看一个例子\n，[Value_Network.py](https://github.com/xyegithub/myBlog/blob/main/posts/1e331e4a/q_learning.py)\n\n学习每个 Action 所对应的 reward 的期望。\n\n我们先看看数据集的结构\n\n```python\n###Save the experience to our episode buffer.\nepisodeBuffer.add(np.reshape(np.array([s,a,r,s1,d]),[1,5]))\n### 其中s是当前时刻的环境状态，a是当前随机采取的Action，r是这个Action的当前reward\n### s1是采取Action之后的下一状态，d是布尔型表示是否任务结束。\n```\n\n1.  现在目标是学习 Q(s<sub>t</sub>, a<sub>t</sub>)，也就是当前环境状态，采取行为\n    a 的全部 reward 的期望。\n\n2.  现在假设我们有模型 Q<sub>desird</sub>，可以预测全部 reward 了，那么这个模型\n    应该满足条件，Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r +\n    $\\lambda$ Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，这有点递\n    归的感觉了。\n\n3.  现在我们能不能根据这个公式 ， 来优化出 Q<sub>desired</sub>。肯定是能的。对于\n    探索过的所有试验，公式都满足的话，此时的模型就可以看成我们想要的模型了。我感\n    觉这就是估值网络方法的核心。\n\n直接看关键代码\n\n```python\n###Choose an action by greedily (with e chance of random action)\n### from the Q-network\nif np.random.rand(1) < e or total_steps < pre_train_steps:\na = np.random.randint(0,4)\nelse:\na = sess.run(mainQN.predict,feed_dict={mainQN.scalarInput:[s]})[0]\n### 这段代码其实是探索的代码，当最开始的时候是完全随机探索（total_steps < pre_train_steps的时候）\n### 当total_steps >= pre_train_steps之后呢，就不是完全随机探索了。\n### 有e的概率是随机探索的，（1-e）的概率是由训练好的模型决定之后的Action。\n### 这里是估值网络和策略网络的不同，策略网络本身就具有随机性，所以不需要引入\n### 额外的参数e和pre_train_steps来控制随机探索的强度。\n### 策略网络在训练的过程中，本身就是由随机性大，到慢慢的收敛到好的Action\n### 所以可以直接得到好的探索的训练样本。估值网络没有这样好的性质，它连\n### 随机性都没有，就需要人为的制造，满足从完全随机探索，到在好的Action的\n### 基础上具有一定的随机性进行探索。\n```\n\n**这是策略网络和估值网络的共通之处，其实这也最上面那个注释\"by greedily (with e\nchance of random action) from the Q-network\"的意思。**\n\n**<font color=green>“贪心”两个字完美的诠释了强化学习，无论是策略网络还是估值网络\n，在探索阶段，在生成数据集上的特点。</font>**\n\n在策略网络那一节，我做的那个试验，和模型无关生成数据集。其实就是不贪心了，不贪心\n不行。\n\n```python\nif total_steps > pre_train_steps:\nif e > endE:\ne -= stepDrop\n### 完全随机了之后，开始慢慢减小随机性。\n### 模型约不可靠的时候，探索性和随机性越强。后来模型慢慢变得可靠就减弱随机性。\n### 因为模型越来越可靠的时候，随机性大就会得到很多远远低于当前模型性能的试验\n### 这些试验都是早就被pass了的，学不到什么东西，损坏模型的探索。\n### endE=0.1 说明无论训练的多好，模型都保持了随机性，保持了探索性\n###　人永远要有好奇心，永远要觉得自己的知识还可能不是最好的\n```\n\n下面的代码是将在数据集弄好的情况下，如何训练模型的。\n\n```python\nif total_steps % (update_freq) == 0:\ntrainBatch = myBuffer.sample(batch_size) #Get a random batch of experiences.\n#Below we perform the Double-DQN update to the target Q-values\n# 主网络预测了下一刻需要采取的Action，trainBatch[:,3]是当前的下一刻的环境\n# 回顾公式，Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)\n# 这里主函数预测的Action就是t+1时刻（下一时刻）获益值最大的Action\nQ1 = sess.run(mainQN.predict,feed_dict={mainQN.scalarInput:np.vstack(trainBatch[:,3])})\n# target网络预测了下一时刻的reward\nQ2 = sess.run(targetQN.Qout,feed_dict={targetQN.scalarInput:np.vstack(trainBatch[:,3])})\nend_multiplier = -(trainBatch[:,4] - 1)\n# 用主网络预测出的Action以及target网络预测出的所有行为的reward\n# 选择了最大的reward,也就是公式中的 Max Q(s_t+1, a)\ndoubleQ = Q2[range(batch_size),Q1]\n# 这里得到的就是公式Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)\n# 的右边，当前reward加上乘以衰减系数之后的，下一步最大reward\ntargetQ = trainBatch[:,2] + (y*doubleQ * end_multiplier)\n#Update the network with our target values.\n# 公式右边得到了之后，在把真正的当前状态输入进去，得到左边\n# 左边以右边作为标签进行学习。更新主网络的参数\n_ = sess.run(mainQN.updateModel, \\\nfeed_dict={mainQN.scalarInput:np.vstack(trainBatch[:,0]),mainQN.targetQ:targetQ, mainQN.actions:trainBatch[:,1]})\n# 更新target网络的参数。\nupdateTarget(targetOps,sess) #Update the target network toward the primary network.\n```\n\ntarget 网络参数的更新方式代码\n\n````python\ndef updateTargetGraph(tfVars,tau):\ntotal_vars = len(tfVars)\nop_holder = []\n# 主网络是和target网络一样的，前一半参数正好是主网络的参数\nfor idx,var in enumerate(tfVars[0:total_vars//2]):\n# idx+total_vars对应的时候后一半的参数也就是target网络的参数\n# 这里相当于是target参数 = 主网络参数 * tau + （1- tau）*target参数\n# 也就是说target网络在以一定的速度向主网络靠近\n# 结合前面的代码，主网络才是真正学习的网络，target网络的作用仅仅是得到等式\n# 右边的值，即标签，即使是等式右边，也不是target网络完全决定的\n# target网络得到了所有Action的reward，最大的Action是主网络选择的\n# 为什么要这么做，target网络也是在模仿主网络，只用主网络也能得到等式的右边\n# 理论上其实右边也应该是主网络决定，现在搞了个主网络的模仿者target网络\n# 是出于优化的考虑。我们后面叙述。\nop_holder.append(tfVars[idx+total_vars//2].assign\\\\\n((var.value()*tau) \\\\\n                      + ((1-tau)*tfVars[idx+total_vars//2].value())))\n                      return op_holder\n\n                      def updateTarget(op_holder,sess):\n                      for op in op_holder:\n                      sess.run(op)\n\n                      ```\n\n                      现在其实我们把关键的代码都看了，在这段代码实现中，引入了一些state of the art的trick，下面我们结合看过的代码在提一遍。\n\n                      1.  引入卷积层，这段代码比较简单，我们没有看。环境状态是用图片的形式给的，用CNN提取特征是比较自然的。\n                      2.  Experience replay。估值网络不像策略网络一样得到试验之后，用一次就扔掉再去制作新的试验（数据集）来训练。它把每次试验都放在一个试验池里面。试验池长度为N，如果超过了N，那就把最老的试验样本扔掉。每次 训练的时候从试验池里面随机选择batchsize个样本进行训练，保持了对样本的利用率，同时其实也增加了模型的稳定性，因为数据集是相对稳定的（相比于N=1而言，每次训练了就扔掉，进来的都是新的，不那么稳定）。\n                      3.  使用target网络来辅助训练。\\*\\*之所以要用target网络来制造训练目标，用主网络来实际训练，是为了让Q-Learing训练的目标保持平稳。\\*\\*强化学习不像普通的监督学习，它的目标是变化的，\\*\\*因为学习目标的一部分就是模型本身输出的。\\*\\*每次更新模型参数都会导致学习目标发生变化，如果更新频繁，幅度很大，我们的训练过程就会变得非常不稳定并且失控。\\*\\*DQN的训练会陷入目标Q与预测Q的反馈循环中，震荡发散。\\*\\*所以用target网络来制造目标，target网络和主网络又不是矛盾的，因为target网络会逼近主网络，它是主网络的模仿者，所以它提供的目标Q也是有权威的。\n                      4.  Double DQN。这个trick源于target网络选的最大Action不准。模仿的不够好，现在就让主网络来帮它选。也就是上面代码中我们看过了主网络输出action，选择target网络输出的reward，得到公式的右边。\n                      5.  Dueling DQN。上代码\n\n                      ```python\n                      self.AW = tf.Variable(xavier_init([h_size//2,env.actions]))\n                      self.VW = tf.Variable(xavier_init([h_size//2,1]))\n                      self.Advantage = tf.matmul(self.streamA,self.AW)\n                      self.Value = tf.matmul(self.streamV,self.VW)\n\n###Then combine them together to get our final Q-values.\n### 看这里Qout是网络最终预测的所有Action的reward。它由两部分组成Value和Advantage\n### 由最上面两行可以看出Value是一维的，是实数，advantage是#action维度的向量\n### 所以，Dueling DQN就是将reward裁成了两部分，一部分是环境状态本身具有的价值Value\n### 另一部分就是Action本身具有的价值，相加起来就是在这个环境下Action具有的价值。\n### 其实我感觉这些解释都是人为的，具体是不是这样谁也不知道，可能只是这样优化的好。\n###　因为即使不分为两部分，网络输出Ｑout的时候，输入也是环境状态，肯定都会把环境考虑\n### 进去才有Action的价值。然而直接输出这个价值，发现优化的不好，分为两部分之后，发现\n### 优化的好了。其实谁也不知道其中到底是什么原因起作用。\nself.Qout = self.Value + tf.subtract(self.Advantage,tf.reduce_mean(self.Advantage,axis=1,keep_dims=True))\n\n````\n\n#### 策略网络和估值网络的不同\n\n从策略网络和估值网络看，强化学习都有探索和对抗两个过程。通过探索，得到数据集，包\n含了各种可能性。通过对抗，让数据集中好的（reward 高的试验胜出）。他们的不同点在\n于对抗的方法。\n\n1.  策略网络：对抗的焦点在于选择 Action 的概率。\n2.  估值网络：对抗的焦点在于评估 Action 的 reward。\n3.  两者都会影响数据集的制作，而且影响的方式是相同的：贪心和随机探索\n4.  比起策略网络，估值网络更加没有对抗的感觉。因为策略网络在提高某一个 Action 的\n    概率的时候，会抑制其他 Action 的概率（总的概率为 1）。而估值网络在提高某一个\n    Action 的 reward 的时候，和其他 Action 是无关的。**而且其实不能说是提高\n    reward，它是预测出正确的 reward。**（这是两者的很大的不同处，策略网络更像是\n    一个分类问题，而估值网络像是一个回归问题）\n\n### 回顾\n\n强化学习的本质是连续决策。强化学习算法的关键是标签制作，数据集制作。\n\n连续决策问题是没有确定的标签的，它通过探索试验得到数据集和标签，为没有提供标签的\n问题，做了标签，让问题可以解决。\n\n深度学习无法优化离散的不可导的参数，强化学习也可以通过在离散的地方做数据集做标签\n，把它转换为可导的，可用 sgd 优化的问题。\n\n做标签和数据集的关键是随机性以及贪心，贪心让它立足于以往的知识，随机让它不刚愎自\n用，保持谦卑，给新的可能保留空间。\n\n无论是策略网络还是估值网络，在数据集的制作上都是一样的，随机性和贪心。估值网络的\n数据集制作，可以看出强化学习探索的本质（由于估值网络本身没有随机性，它在制作数据\n集的时候，显示的暴露了，探索和贪心的本质。策略网络这方面还不太好看出来，因为它是\n隐式的利用探索和贪心）。\n\n策略网络，增大所有行为的概率，但是对于 reward 大 的行为增大的权重大。这个思路在\n我得感觉上更加符合强化两个字。强化好的行为嘛。\n\n估值网络的本质是公式 Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r +\n$\\lambda$ Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，有点递归的感\n觉。\n\n策略网络和估值网络数据集也有一点不同，策略网络的数据集是纵向的，一串行为一起的。\n而估值网络的数据集是单个单个的。\n\n由下面代码可以看出，策略网络中，每一窜试验就会训练一次，只是网络参数更新会积累了\n好几次试验之后才更新。策略网络关心从开始到结束一系列行为。而估值网络只关心当前和\n下一状态。\n\n```python\nif done:\nepisode_number += 1\nepx = np.vstack(xs)\nepy = np.vstack(ys)\nepr = np.vstack(drs)\ntfp = tfps\nxs,hs,dlogps,drs,ys,tfps = [],[],[],[],[],[]\n\ndiscounted_epr = discount_rewards(epr)\ndiscounted_epr -= np.mean(discounted_epr)\ndiscounted_epr //= np.std(discounted_epr)\n\ntGrad = sess.run(newGrads,feed_dict={observations: epx, input_y: epy, advantages: discounted_epr})\nfor ix,grad in enumerate(tGrad):\ngradBuffer[ix] += grad\n\nif episode_number % batch_size == 0:\nsess.run(updateGrads,feed_dict={W1Grad: gradBuffer[0],W1_1Grad:gradBuffer[1],W2Grad:gradBuffer[2]})\n```\n\n估值网络人为的控制随机强度，也是一个值得考虑的问题。\n","source":"_posts/First-Step-to-RL.md","raw":"---\ntitle: First Step to Reinforcement Learning\ndescription: An introduction to Reinforcement Learning\ntags:\n  - Reinforcement Learning\ncategories:\n  - Machine Learning\n  - Methods\n  - Reinforcement Learning\nabbrlink: 1e331e4a\ndate: 2021-12-03 16:48:41\n---\n\n### 什么是强化学习，关于强化学习的几点疑问\n\n<font color=green size=3>强化学习三要素：环境状态，行动，奖励</font>\n\n<font color=green size=3>目标：尽量多的获得奖励</font>\n\n<font color=green size=3>本质：连续决策</font>\n\n基本的强化学习模型包括：\n\n- 环境状态的集合 S\n- 动作的集合 A\n- 状态之间的转换规则（是环境的一部分）\n- 规定转换后“即时奖励”的规则（是环境的一部分）\n- 描述主体（智能体）能够观察到什么的规则（是环境的一部分）\n- 能够做出决策/动作的主体（智能体）\n\n#### 区别于深度学习，强化学习的本质特点是什么？\n\n**两个定义**\n\n1，强化学习是机器学习的一个重要分支，主要用来解决连续决策问题。\n\n2，强化学习又称 再励学习，评价学习或增强学习，是机器学习的范式和方法论之一，用于\n描述和解决智能体（agent）在于环境交互过程中通过学习策略以达成回报最大或实现特定\n目标的问题。\n\n强化学习的本质是<font color=deeppink> 描述和解决智能体（agent）在于环境交互过程\n中通过学习策略以达成回报最大或实现特定目标的问题。</font>它本质是这样一种场景，\n在这种场景中它为了达到某种目的，做出连续的决策。这样符合这种场景，那就是强化学习\n。\n\n强化学习和深度学习这两个名词的维度是不一样的。深度学习描述的是算法本身的特点，深\n度够不够，是不是连接主义的模型。深度学习可以用来做无监督，也可以用来做半监督，也\n可以用来做弱监督，甚至可以用来作为强化学习算法的一部分。深度学习这个名词，不管应\n用场景只管模型本身是不是满足深度学习的特点。\n\n而强化学习描述的是应用场景的特点，只要能提供智能体决策的算法，管它是什么模型，什\n么结构，那就是强化学习的算法。从这个角度上讲，我现在认为强化学习和监督学习，无监\n督学习，弱监督学习，是并列的，是对应用场景的描述。和深度学习不是同一维度的。\n\n<font color=deeppink>强化学习的本质在于目标给定的形式，不像无监督学习那样完全没\n有学习目标，也不像监督学习那样有非常明确的目标（label），强化学习的目标一般是变\n化的，不明确的，甚至可能不存在绝对正确的目标。，强化学习的问题都可以抽象成，环境\n状态，行动和奖励。应该说只要能抽象为这三个要素，目标是获得最大奖励的模型，就是强\n化学习的模型。</font>\n\n强化学习的最大的特点是“试错”，是尝试各种可能，而强化结果好的可能。（策略网络的特\n点，估值网络的特点是修正和预测获益）\n\n由于强化学习是一种决策学习，这个问题的特点就是离散型。但是离散并不就是强化学习（\n连续的决策才是，目标的模糊和不确定性是决策问题的特点）。深度学习本质是函数的拟合\n，所以连续可微是它的特点。并不能说连续可微的问题就是深度学习，离散的问题就是强化\n学习。\n\n#### 深度学习用梯度下降的算法实现模型的优化，强化学习无法求导，甚至连学习目标都是模糊的如何优化模型参数？\n\n这个问题要了解下一节，具体的强化学习方法。\n\n#### 强化学习与弱监督学习？\n\n弱监督是属于有监督学习，只是它学习的目标不是被给予的标签，而是比被给予标签更强的\n标签（强弱是指标签做含有的信息量），也就是说弱监督是根据少量信息的标签，推测出更\n多的信息。\n\n强化学习的本质是连续决策。连续决策的特点是目标的模糊和不确定性。\n\n所以，虽然弱监督和强化学习都没有给出最终准确的目标，但是他们任然很不同的\n\n#### 深度学习是死的，没有智能的机器学习算法，强化学习是“活的”，有智能的机器学习算法\n\n深度学习大部分我们用作有监督的学习算法。其实说深度学习是死的，不如说有监督学习是\n死的。\n\n有监督学习其实是完全的复刻标签里面含有的知识，它的本质就是一个函数拟合的问题，它\n无法摆脱对绝对的标签的依赖，无法超越标签。\n\n而强化学习，正由于它的目标是模糊和不确定的。使得算法在设计上必须具有随机性和探索\n性，它能够探索出人类从来没有到过的领域。就像在围棋上，下出人类完全无法理解的棋，\n人从来没有想过的一些下法。这就是强化学习算法探索出来的知识。所以我觉得它是活着的\n，拥有智能的算法。\n\n<font color=green>从感性的层面，强化学习算法很接近人脑的行为：感知环境，探索环境\n，强化有益行为</font>\n\n#### 关于深度学习，强化学习，连续可导性和离散不可导性的讨论\n\n1.  从函数的角度，深度学习和强化学习都需要学习一个函数映射。深度学习是从输入到\n    target 的映射。强化学习是学从环境状态到 Action 的映射。这两个映射可以看成性\n    质一样的，因为深度学习可以作为强化学习的智能体。所以从函数的角度，他们没有连\n    续和离散的区别。（PS. 深度学习模型和强化学习的智能体都是连续可导的函数\n    。target 和 Action 都可以是离散的或者连续的。）\n\n2.  深度学习作为用梯度下降算法优化的模型，无法优化对 loss 不可导的参数。如在深度\n    学习中，设计一个分支来决定模型是否应该包含某个模块，这个分支的参数是不可优化\n    的。因为包含和不包含是离散的，对 loss 不可导。\n\n不过假设，如果包含与不包含是连续的。也就是说，可以以 0.1 的权重包含。那么，这些\n参数是可以优化的。从这点来看，离散就是导致模型参数不可优化的原因。\n\n3.  强化学习在离散的情况下解决 2 中的问题。由此，我得到了一个概念，强化学习解决\n    离散的问题。\n\n4.  下面我们来分析一下这个场景。首先，决定一个模块该不该被使用，这个场景是一次\n    Action 的场景，不是连续决策的场景。也就是说 Action 一次，我就能知道最终\n    reward 多少了，只有单步的 reward。\n\n限于这个单次决策的场景来看，如果 Action 相对于 reward 是连续可导的，那么深度学习\n就能解决这个问题。如果 Action 相对于 reward 是离散的，那么仅仅深度学习无法解决这\n个问题，要靠强化学习。\n\n<font color=green>这里单次 Action 就知道 reward，实际上这个问题就退化为了有监督\n学习，因为这个单步的 reward 就可以看成我的标签了。所以深度学习解决这个问题是很自\n然的。</font>\n\n5.  多次决策的问题，无论是连续的还是离散的都只能用强化学习的方法。因为多次决策，\n    这个问题就不可以退化为监督学习的问题了。它是一个真正的强化学习的问题。\n\n综上所诉，强化学习解决深度学习解决不了的离散问题，那只是在单次决策的时候，这个问\n题退化为了有监督学习。强化学习的方法，恰好可以提供离散变量的学习。\n\n强化学习方法解决深度学习中的离散问题，仅仅是强化学习附带的一个小福利。\n\n**<font color=green>因为它能把经验转化为可导的目标，就拿策略网络来说，从梯度的角\n度，它只管增加当前随机 Action 的概率，而加入 advatage 之后，自动就优化除了想要的\n大 reward 的行为。</font>**\n\n#### 深度学习优化和强化学习优化的感性理解\n\n前面说了深度学习优化可导的参数，强化学习可以优化不可导的参数。这里说一下对深度学\n习优化方法和强化学习优化方法的感性理解。\n\n还是说前面包不会包含某模块的例子，由于连续可导，对于每一个参数值，深度学习模型其\n实都同时参与了两种 Action（包含和不包含）。score = 0.1 包含，其实其中包含了含有\n的成分，也包含了不含有的成分。所以我们可以连续的变动 score，看看包含多好，还是不\n好含多好。这其实就是梯度下降算法的方式。得益于每一个参数，其实我都对包含和不包含\n的情况都有了解，我当然知道哪个更好，就往那边移动（优化）。\n\n然而，对于离散的情况，要么只能包含，要么只能不包含。当选择包含的时候，模型对不包\n含的情况完全是无知的。可能更好，也可能差。当不包含的时候，也是一样的。无论哪种情\n况，我都没有办法优化，两种情况是完全隔离开的，信息不沟通的，是离散的。所以梯度下\n降算法无法优化它。\n\n强化学习用随机探索的方法让两者信息又沟通起来。包含一下试一下，然后，不包含也试一\n下。尝试的结果是哪种 reward 多，就增大哪种的概率。\n\n**<font color=green>所以，无论哪种优化方法，信息的沟通都是必要的。要对所有的\naction 都了解，才能知道选择哪种 action。 只是深度学习是连续的，它的每一种参数，\n都包含了所有 Action 的信息（reward），每一种 Action 都参与了，所以它能直接连续的\n梯度下降的优化，不需要随机探索了。而对于离散的，每种 action 只能知道自己的\nreward，对其他 Action 一无所知的时候，梯度的优化是不行的。必须要探索各种\nAction，还是要知道了每一种 Action 的情况(reward)之后，才能优化。这是方法论\n。</font>**\n\n更进一步，离散的地方，相对于 reward 一定是不可导的，所以深度学习不行。而强化学习\n，更准确的说是策略网络，相当于给离散的地方加了标签，这样它就在离散的地方有监督了\n，它就可以根据增加的标签优化。而标签的设计就是根据探索的结果，增大 reward 大的\nAction，reward 大的 Action 就是它的标签，而且这个标签是动态的，是对抗得出的。\n\n强化学习方法算出的梯度是策略梯度。\n\n**<font color=green>强化学习： 不知道选哪边了； 试试呗；按试出来 reward 大的\nAction 优化它。</font>**\n\n**<font color=green>强化学习：它离散，对于 reward 不可导；不直接用 reward 优化它\n，给它加个标签，把试出来 reward 大的 Action，作为标签去优化</font>**\n\n在不可导的地方加标签。\n\n**<font color=green>由此，强化学习算法的本质是制作标签，无论是连续决策，标签不确\n定的情况，还是它能解决离散问题的情况，它都是用制作标签的方法解决的。</font>**\n\n### 策略网络(Policy Network)和估值网络(Value Network)\n\nAlphaGo 使用了快速走子，策略网络，估值网络和蒙特卡洛搜索树等技术。\n\n强化学习算法的一个关键是<font color=green>随机性和探索性</font>，我们需要让算法\n通过试验样本自己学习什么才是某个环境状态下比较好的 Action，而不是像有监督学习一\n样，告诉模型什么是好的 Action，因为我们也不知道什么是好的 Action.\n\n深度强化学习模型的本质是神经网络，神经网络是工具，根据问题转化以及建模的不同，主\n要分为策略网络和估值网络。\n\n强化学习中最重要的两类方法**Policy-based,Value-based**。第一种直接预测在某个环境\n下应该采取的行动（直接输出改采取 Action 的概率）。第二种预测在某个环境下所有行动\n的期望价值，然后通过选择 q 值最高的行动执行策略。\n\n他们都能完成决策，但由于建模的不同，估值网络包含有更多的信息，它不仅能提供决策，\n还预测了决策带来的收益。\n\n<font color=deeppink>策略网络是隐式的学习了某一 Action 所带来的全部获益（当前获\n益+后续获益），而估值网络直接显示的学习 Action 所带来的全部获益。</font>强化学习\n算法做出最佳抉择只需要知道哪个 Action 全部获益最大，策略网络就是这样做的，估值网\n络不仅学习了哪个 Action 全部获益最大，还把每个 Action 的全部获益给计算出来了。\n\n<font color=green>相对来说，策略网络的性能会比估值网络好一些。</font>\n\n<font color=green>Value Based 方法适合仅有少量 Action 的环境，而 Policy Based 方\n法更通用，适合 Action 种类非常多，或者具有连续取值的 Action 的环境。结合了深度学\n习之后，Policy Based 方法就变成了策略网络，Value Based 方法就变成了估值网络\n。</font>\n\n#### 策略网络(Policy Network)\n\n直接看一个例子，学习的目标是，左右用力使得木棍不倒地\n[Policy_Network.py](https://github.com/xyegithub/myBlog/blob/main/posts/1e331e4a/policy_network.py)\n\n关键代码\n\n```python\nscore = tf.matmul(layer1,W2)\nprobability = tf.nn.sigmoid(score)#网络输出采取Action 1的概率。\ninput_y = tf.placeholder(tf.float32,[None,1], \\\\\nname=\"input_y\")# 输入采取过的行为，这个行为是随机生成的。\nadvantages = tf.placeholder(tf.float32,name=\"reward_signal\")\n# 输入获益\nloglik = tf.log(input_y*(input_y - probability) + \\\\\n(1 - input_y)*(input_y + probability))\n# 损失函数，如果行为是1，则增大\n\n#概率，如果行为是 0，则减小概率（相当于也是增加0的概率），也就是说这个损\n#失函数无论当前行为是什么都会增大当前行为的概率。\nloss = -tf.reduce_mean(loglik * advantages) # 这行代码很关键，\n#相当于给损失函数成了一个权重advantages，得到最终的损失函数。\n#advantages是当前试验的全部获益。如果全部获益大，将以更大的权重，增加\n#当前行为的概率。\n\n#所以，策略网络其实也是一个对抗学习的过程，增加所有采取过行为的概率，只是\n#获益多的行为以更大的权重增加。\n\n#一个试验： 由初始状态开始，随机采取一连串的行为\n#（Policy_Network.py 中是根据当前模型输出的概率,来生成随机的行为，但\n#是我感觉直接用0.5的概率随机生成一连串的0和1的行为也是可以的，下面将实\n#验一下），直到任务结束。\n\n## 由于每个试验，都可以一直行为到任务结束，所以每个action，我们都可以得\n#到它在该试验中的全部获益（当前获益 + 之后所有行为的获益）\n\n## 随机生成了n个试验，其中又各种各样的决策（随机探索），全部获益大的\n#action，它的advantages也大，那么它的概率就增大的多，它被强化的厉害。\n\n##试验生成的过程，实际上就是数据集构建的过程。策略网络的数据集是由环境\n#和一系列随机的行为构成的。它提供了环境在各种行为下的反应（获益）。模型\n#学习为环境带来高获益的行为的规律。\n```\n\n由上面的代码可知，从策略网络的角度看强化学习的话，强化学习的关键其实是对数据集的\n构建---如何构建数据集。\n\n在构建数据集的时候，随机探索肯定是必要的。随机探索的结果会得到一系列好的行为，也\n会得到一系列不好的行为。如何强化好的行为就是算法设计的时候需要注意的。\n\n上面的代码在探索阶段借用了当前的模型，即根据当前模型输出的概率随机生成行为，从而\n形成数据集。如果完全的随机（一直使用 0.5 的概率随机的生成 Action）会什么样呢？\n\n##### 数据集是否可以和模型无关（不随着模型变化）？\n\n关键修改代码\n\n```python\n###基于当前模型，根据当前的状态x，生成Action 1的概率\ntfprob = sess.run(probability,feed_dict={observations: x})\n### 基于预测概率，随机生成行为，并试探环境。生成数据集。\naction = 1 if np.random.uniform() < tfprob else 0\n```\n\n修改后\n\n```python\n### 注释掉这句，并不需要根据当前模型生成概率\n### tfprob = sess.run(probability,feed_dict={observations: x})\n### 直接设置概率为0.5，随机完全随机探索生成数据集。\ntfprob = 0.5\naction = 1 if np.random.uniform() < tfprob else 0\n```\n\n结果：修改后，模型无法收敛。\n\n完全随机很小的概率能探索出很好的试验，这些好的行为也很难持续的得到强化。\n\n所以，强化学习也有一种效果叠加的感觉。在完全随机的情况下 ，探索出相对好的\naction，再在这个相对好的 action 的基础上，在探索探索出更好的 action。\n\n如果数据集不依赖模型，就是一直在完全随机的基础上探索。这样很难收敛。\n\n也可以这样看，完全随机的话，最多能学到前几步的策略（因为完全随机就走不了几步，探\n索的经验就只有那几步）。依赖于模型，探索的行为更有价值，因为是依赖于学到过的知识\n的，一方面确认了，按学到的知识走，确实获益多，一方面又在学到的知识的基础上，做了\n一些随机，探索更好的知识。\n\n#### 估值网络(Value Network，Q-learning)\n\nQ-Learing 用神经网络实现，得到的模型就是估值网络。\n\n也看一个例子\n，[Value_Network.py](https://github.com/xyegithub/myBlog/blob/main/posts/1e331e4a/q_learning.py)\n\n学习每个 Action 所对应的 reward 的期望。\n\n我们先看看数据集的结构\n\n```python\n###Save the experience to our episode buffer.\nepisodeBuffer.add(np.reshape(np.array([s,a,r,s1,d]),[1,5]))\n### 其中s是当前时刻的环境状态，a是当前随机采取的Action，r是这个Action的当前reward\n### s1是采取Action之后的下一状态，d是布尔型表示是否任务结束。\n```\n\n1.  现在目标是学习 Q(s<sub>t</sub>, a<sub>t</sub>)，也就是当前环境状态，采取行为\n    a 的全部 reward 的期望。\n\n2.  现在假设我们有模型 Q<sub>desird</sub>，可以预测全部 reward 了，那么这个模型\n    应该满足条件，Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r +\n    $\\lambda$ Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，这有点递\n    归的感觉了。\n\n3.  现在我们能不能根据这个公式 ， 来优化出 Q<sub>desired</sub>。肯定是能的。对于\n    探索过的所有试验，公式都满足的话，此时的模型就可以看成我们想要的模型了。我感\n    觉这就是估值网络方法的核心。\n\n直接看关键代码\n\n```python\n###Choose an action by greedily (with e chance of random action)\n### from the Q-network\nif np.random.rand(1) < e or total_steps < pre_train_steps:\na = np.random.randint(0,4)\nelse:\na = sess.run(mainQN.predict,feed_dict={mainQN.scalarInput:[s]})[0]\n### 这段代码其实是探索的代码，当最开始的时候是完全随机探索（total_steps < pre_train_steps的时候）\n### 当total_steps >= pre_train_steps之后呢，就不是完全随机探索了。\n### 有e的概率是随机探索的，（1-e）的概率是由训练好的模型决定之后的Action。\n### 这里是估值网络和策略网络的不同，策略网络本身就具有随机性，所以不需要引入\n### 额外的参数e和pre_train_steps来控制随机探索的强度。\n### 策略网络在训练的过程中，本身就是由随机性大，到慢慢的收敛到好的Action\n### 所以可以直接得到好的探索的训练样本。估值网络没有这样好的性质，它连\n### 随机性都没有，就需要人为的制造，满足从完全随机探索，到在好的Action的\n### 基础上具有一定的随机性进行探索。\n```\n\n**这是策略网络和估值网络的共通之处，其实这也最上面那个注释\"by greedily (with e\nchance of random action) from the Q-network\"的意思。**\n\n**<font color=green>“贪心”两个字完美的诠释了强化学习，无论是策略网络还是估值网络\n，在探索阶段，在生成数据集上的特点。</font>**\n\n在策略网络那一节，我做的那个试验，和模型无关生成数据集。其实就是不贪心了，不贪心\n不行。\n\n```python\nif total_steps > pre_train_steps:\nif e > endE:\ne -= stepDrop\n### 完全随机了之后，开始慢慢减小随机性。\n### 模型约不可靠的时候，探索性和随机性越强。后来模型慢慢变得可靠就减弱随机性。\n### 因为模型越来越可靠的时候，随机性大就会得到很多远远低于当前模型性能的试验\n### 这些试验都是早就被pass了的，学不到什么东西，损坏模型的探索。\n### endE=0.1 说明无论训练的多好，模型都保持了随机性，保持了探索性\n###　人永远要有好奇心，永远要觉得自己的知识还可能不是最好的\n```\n\n下面的代码是将在数据集弄好的情况下，如何训练模型的。\n\n```python\nif total_steps % (update_freq) == 0:\ntrainBatch = myBuffer.sample(batch_size) #Get a random batch of experiences.\n#Below we perform the Double-DQN update to the target Q-values\n# 主网络预测了下一刻需要采取的Action，trainBatch[:,3]是当前的下一刻的环境\n# 回顾公式，Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)\n# 这里主函数预测的Action就是t+1时刻（下一时刻）获益值最大的Action\nQ1 = sess.run(mainQN.predict,feed_dict={mainQN.scalarInput:np.vstack(trainBatch[:,3])})\n# target网络预测了下一时刻的reward\nQ2 = sess.run(targetQN.Qout,feed_dict={targetQN.scalarInput:np.vstack(trainBatch[:,3])})\nend_multiplier = -(trainBatch[:,4] - 1)\n# 用主网络预测出的Action以及target网络预测出的所有行为的reward\n# 选择了最大的reward,也就是公式中的 Max Q(s_t+1, a)\ndoubleQ = Q2[range(batch_size),Q1]\n# 这里得到的就是公式Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)\n# 的右边，当前reward加上乘以衰减系数之后的，下一步最大reward\ntargetQ = trainBatch[:,2] + (y*doubleQ * end_multiplier)\n#Update the network with our target values.\n# 公式右边得到了之后，在把真正的当前状态输入进去，得到左边\n# 左边以右边作为标签进行学习。更新主网络的参数\n_ = sess.run(mainQN.updateModel, \\\nfeed_dict={mainQN.scalarInput:np.vstack(trainBatch[:,0]),mainQN.targetQ:targetQ, mainQN.actions:trainBatch[:,1]})\n# 更新target网络的参数。\nupdateTarget(targetOps,sess) #Update the target network toward the primary network.\n```\n\ntarget 网络参数的更新方式代码\n\n````python\ndef updateTargetGraph(tfVars,tau):\ntotal_vars = len(tfVars)\nop_holder = []\n# 主网络是和target网络一样的，前一半参数正好是主网络的参数\nfor idx,var in enumerate(tfVars[0:total_vars//2]):\n# idx+total_vars对应的时候后一半的参数也就是target网络的参数\n# 这里相当于是target参数 = 主网络参数 * tau + （1- tau）*target参数\n# 也就是说target网络在以一定的速度向主网络靠近\n# 结合前面的代码，主网络才是真正学习的网络，target网络的作用仅仅是得到等式\n# 右边的值，即标签，即使是等式右边，也不是target网络完全决定的\n# target网络得到了所有Action的reward，最大的Action是主网络选择的\n# 为什么要这么做，target网络也是在模仿主网络，只用主网络也能得到等式的右边\n# 理论上其实右边也应该是主网络决定，现在搞了个主网络的模仿者target网络\n# 是出于优化的考虑。我们后面叙述。\nop_holder.append(tfVars[idx+total_vars//2].assign\\\\\n((var.value()*tau) \\\\\n                      + ((1-tau)*tfVars[idx+total_vars//2].value())))\n                      return op_holder\n\n                      def updateTarget(op_holder,sess):\n                      for op in op_holder:\n                      sess.run(op)\n\n                      ```\n\n                      现在其实我们把关键的代码都看了，在这段代码实现中，引入了一些state of the art的trick，下面我们结合看过的代码在提一遍。\n\n                      1.  引入卷积层，这段代码比较简单，我们没有看。环境状态是用图片的形式给的，用CNN提取特征是比较自然的。\n                      2.  Experience replay。估值网络不像策略网络一样得到试验之后，用一次就扔掉再去制作新的试验（数据集）来训练。它把每次试验都放在一个试验池里面。试验池长度为N，如果超过了N，那就把最老的试验样本扔掉。每次 训练的时候从试验池里面随机选择batchsize个样本进行训练，保持了对样本的利用率，同时其实也增加了模型的稳定性，因为数据集是相对稳定的（相比于N=1而言，每次训练了就扔掉，进来的都是新的，不那么稳定）。\n                      3.  使用target网络来辅助训练。\\*\\*之所以要用target网络来制造训练目标，用主网络来实际训练，是为了让Q-Learing训练的目标保持平稳。\\*\\*强化学习不像普通的监督学习，它的目标是变化的，\\*\\*因为学习目标的一部分就是模型本身输出的。\\*\\*每次更新模型参数都会导致学习目标发生变化，如果更新频繁，幅度很大，我们的训练过程就会变得非常不稳定并且失控。\\*\\*DQN的训练会陷入目标Q与预测Q的反馈循环中，震荡发散。\\*\\*所以用target网络来制造目标，target网络和主网络又不是矛盾的，因为target网络会逼近主网络，它是主网络的模仿者，所以它提供的目标Q也是有权威的。\n                      4.  Double DQN。这个trick源于target网络选的最大Action不准。模仿的不够好，现在就让主网络来帮它选。也就是上面代码中我们看过了主网络输出action，选择target网络输出的reward，得到公式的右边。\n                      5.  Dueling DQN。上代码\n\n                      ```python\n                      self.AW = tf.Variable(xavier_init([h_size//2,env.actions]))\n                      self.VW = tf.Variable(xavier_init([h_size//2,1]))\n                      self.Advantage = tf.matmul(self.streamA,self.AW)\n                      self.Value = tf.matmul(self.streamV,self.VW)\n\n###Then combine them together to get our final Q-values.\n### 看这里Qout是网络最终预测的所有Action的reward。它由两部分组成Value和Advantage\n### 由最上面两行可以看出Value是一维的，是实数，advantage是#action维度的向量\n### 所以，Dueling DQN就是将reward裁成了两部分，一部分是环境状态本身具有的价值Value\n### 另一部分就是Action本身具有的价值，相加起来就是在这个环境下Action具有的价值。\n### 其实我感觉这些解释都是人为的，具体是不是这样谁也不知道，可能只是这样优化的好。\n###　因为即使不分为两部分，网络输出Ｑout的时候，输入也是环境状态，肯定都会把环境考虑\n### 进去才有Action的价值。然而直接输出这个价值，发现优化的不好，分为两部分之后，发现\n### 优化的好了。其实谁也不知道其中到底是什么原因起作用。\nself.Qout = self.Value + tf.subtract(self.Advantage,tf.reduce_mean(self.Advantage,axis=1,keep_dims=True))\n\n````\n\n#### 策略网络和估值网络的不同\n\n从策略网络和估值网络看，强化学习都有探索和对抗两个过程。通过探索，得到数据集，包\n含了各种可能性。通过对抗，让数据集中好的（reward 高的试验胜出）。他们的不同点在\n于对抗的方法。\n\n1.  策略网络：对抗的焦点在于选择 Action 的概率。\n2.  估值网络：对抗的焦点在于评估 Action 的 reward。\n3.  两者都会影响数据集的制作，而且影响的方式是相同的：贪心和随机探索\n4.  比起策略网络，估值网络更加没有对抗的感觉。因为策略网络在提高某一个 Action 的\n    概率的时候，会抑制其他 Action 的概率（总的概率为 1）。而估值网络在提高某一个\n    Action 的 reward 的时候，和其他 Action 是无关的。**而且其实不能说是提高\n    reward，它是预测出正确的 reward。**（这是两者的很大的不同处，策略网络更像是\n    一个分类问题，而估值网络像是一个回归问题）\n\n### 回顾\n\n强化学习的本质是连续决策。强化学习算法的关键是标签制作，数据集制作。\n\n连续决策问题是没有确定的标签的，它通过探索试验得到数据集和标签，为没有提供标签的\n问题，做了标签，让问题可以解决。\n\n深度学习无法优化离散的不可导的参数，强化学习也可以通过在离散的地方做数据集做标签\n，把它转换为可导的，可用 sgd 优化的问题。\n\n做标签和数据集的关键是随机性以及贪心，贪心让它立足于以往的知识，随机让它不刚愎自\n用，保持谦卑，给新的可能保留空间。\n\n无论是策略网络还是估值网络，在数据集的制作上都是一样的，随机性和贪心。估值网络的\n数据集制作，可以看出强化学习探索的本质（由于估值网络本身没有随机性，它在制作数据\n集的时候，显示的暴露了，探索和贪心的本质。策略网络这方面还不太好看出来，因为它是\n隐式的利用探索和贪心）。\n\n策略网络，增大所有行为的概率，但是对于 reward 大 的行为增大的权重大。这个思路在\n我得感觉上更加符合强化两个字。强化好的行为嘛。\n\n估值网络的本质是公式 Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r +\n$\\lambda$ Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，有点递归的感\n觉。\n\n策略网络和估值网络数据集也有一点不同，策略网络的数据集是纵向的，一串行为一起的。\n而估值网络的数据集是单个单个的。\n\n由下面代码可以看出，策略网络中，每一窜试验就会训练一次，只是网络参数更新会积累了\n好几次试验之后才更新。策略网络关心从开始到结束一系列行为。而估值网络只关心当前和\n下一状态。\n\n```python\nif done:\nepisode_number += 1\nepx = np.vstack(xs)\nepy = np.vstack(ys)\nepr = np.vstack(drs)\ntfp = tfps\nxs,hs,dlogps,drs,ys,tfps = [],[],[],[],[],[]\n\ndiscounted_epr = discount_rewards(epr)\ndiscounted_epr -= np.mean(discounted_epr)\ndiscounted_epr //= np.std(discounted_epr)\n\ntGrad = sess.run(newGrads,feed_dict={observations: epx, input_y: epy, advantages: discounted_epr})\nfor ix,grad in enumerate(tGrad):\ngradBuffer[ix] += grad\n\nif episode_number % batch_size == 0:\nsess.run(updateGrads,feed_dict={W1Grad: gradBuffer[0],W1_1Grad:gradBuffer[1],W2Grad:gradBuffer[2]})\n```\n\n估值网络人为的控制随机强度，也是一个值得考虑的问题。\n","slug":"First-Step-to-RL","published":1,"updated":"2022-06-24T09:14:20.990Z","_id":"cl4s7rpgi000iy7ml0q073rkm","comments":1,"layout":"post","photos":[],"link":"","content":"<html><head></head><body><h3 id=\"什么是强化学习关于强化学习的几点疑问\"><span class=\"post-title-index\">.1. </span><a class=\"markdownIt-Anchor\" href=\"#什么是强化学习关于强化学习的几点疑问\"></a> 什么是强化学习，关于强化学习的几点疑问</h3>\n<p><font color=\"green\" size=\"3\">强化学习三要素：环境状态，行动，奖励</font></p>\n<p><font color=\"green\" size=\"3\">目标：尽量多的获得奖励</font></p>\n<p><font color=\"green\" size=\"3\">本质：连续决策</font></p>\n<p>基本的强化学习模型包括：</p>\n<ul>\n<li>环境状态的集合 S</li>\n<li>动作的集合 A</li>\n<li>状态之间的转换规则（是环境的一部分）</li>\n<li>规定转换后“即时奖励”的规则（是环境的一部分）</li>\n<li>描述主体（智能体）能够观察到什么的规则（是环境的一部分）</li>\n<li>能够做出决策/动作的主体（智能体）</li>\n</ul>\n<h4 id=\"区别于深度学习强化学习的本质特点是什么\"><span class=\"post-title-index\">.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#区别于深度学习强化学习的本质特点是什么\"></a> 区别于深度学习，强化学习的本质特点是什么？</h4>\n<p><strong>两个定义</strong></p>\n<p>1，强化学习是机器学习的一个重要分支，主要用来解决连续决策问题。</p>\n<p>2，强化学习又称 再励学习，评价学习或增强学习，是机器学习的范式和方法论之一，用于\n描述和解决智能体（agent）在于环境交互过程中通过学习策略以达成回报最大或实现特定\n目标的问题。</p>\n<p>强化学习的本质是<font color=\"deeppink\"> 描述和解决智能体（agent）在于环境交互过程\n中通过学习策略以达成回报最大或实现特定目标的问题。</font>它本质是这样一种场景，\n在这种场景中它为了达到某种目的，做出连续的决策。这样符合这种场景，那就是强化学习\n。</p>\n<p>强化学习和深度学习这两个名词的维度是不一样的。深度学习描述的是算法本身的特点，深\n度够不够，是不是连接主义的模型。深度学习可以用来做无监督，也可以用来做半监督，也\n可以用来做弱监督，甚至可以用来作为强化学习算法的一部分。深度学习这个名词，不管应\n用场景只管模型本身是不是满足深度学习的特点。</p>\n<p>而强化学习描述的是应用场景的特点，只要能提供智能体决策的算法，管它是什么模型，什\n么结构，那就是强化学习的算法。从这个角度上讲，我现在认为强化学习和监督学习，无监\n督学习，弱监督学习，是并列的，是对应用场景的描述。和深度学习不是同一维度的。</p>\n<p><font color=\"deeppink\">强化学习的本质在于目标给定的形式，不像无监督学习那样完全没\n有学习目标，也不像监督学习那样有非常明确的目标（label），强化学习的目标一般是变\n化的，不明确的，甚至可能不存在绝对正确的目标。，强化学习的问题都可以抽象成，环境\n状态，行动和奖励。应该说只要能抽象为这三个要素，目标是获得最大奖励的模型，就是强\n化学习的模型。</font></p>\n<p>强化学习的最大的特点是“试错”，是尝试各种可能，而强化结果好的可能。（策略网络的特\n点，估值网络的特点是修正和预测获益）</p>\n<p>由于强化学习是一种决策学习，这个问题的特点就是离散型。但是离散并不就是强化学习（\n连续的决策才是，目标的模糊和不确定性是决策问题的特点）。深度学习本质是函数的拟合\n，所以连续可微是它的特点。并不能说连续可微的问题就是深度学习，离散的问题就是强化\n学习。</p>\n<h4 id=\"深度学习用梯度下降的算法实现模型的优化强化学习无法求导甚至连学习目标都是模糊的如何优化模型参数\"><span class=\"post-title-index\">.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#深度学习用梯度下降的算法实现模型的优化强化学习无法求导甚至连学习目标都是模糊的如何优化模型参数\"></a> 深度学习用梯度下降的算法实现模型的优化，强化学习无法求导，甚至连学习目标都是模糊的如何优化模型参数？</h4>\n<p>这个问题要了解下一节，具体的强化学习方法。</p>\n<h4 id=\"强化学习与弱监督学习\"><span class=\"post-title-index\">.1.3. </span><a class=\"markdownIt-Anchor\" href=\"#强化学习与弱监督学习\"></a> 强化学习与弱监督学习？</h4>\n<p>弱监督是属于有监督学习，只是它学习的目标不是被给予的标签，而是比被给予标签更强的\n标签（强弱是指标签做含有的信息量），也就是说弱监督是根据少量信息的标签，推测出更\n多的信息。</p>\n<p>强化学习的本质是连续决策。连续决策的特点是目标的模糊和不确定性。</p>\n<p>所以，虽然弱监督和强化学习都没有给出最终准确的目标，但是他们任然很不同的</p>\n<h4 id=\"深度学习是死的没有智能的机器学习算法强化学习是活的有智能的机器学习算法\"><span class=\"post-title-index\">.1.4. </span><a class=\"markdownIt-Anchor\" href=\"#深度学习是死的没有智能的机器学习算法强化学习是活的有智能的机器学习算法\"></a> 深度学习是死的，没有智能的机器学习算法，强化学习是“活的”，有智能的机器学习算法</h4>\n<p>深度学习大部分我们用作有监督的学习算法。其实说深度学习是死的，不如说有监督学习是\n死的。</p>\n<p>有监督学习其实是完全的复刻标签里面含有的知识，它的本质就是一个函数拟合的问题，它\n无法摆脱对绝对的标签的依赖，无法超越标签。</p>\n<p>而强化学习，正由于它的目标是模糊和不确定的。使得算法在设计上必须具有随机性和探索\n性，它能够探索出人类从来没有到过的领域。就像在围棋上，下出人类完全无法理解的棋，\n人从来没有想过的一些下法。这就是强化学习算法探索出来的知识。所以我觉得它是活着的\n，拥有智能的算法。</p>\n<p><font color=\"green\">从感性的层面，强化学习算法很接近人脑的行为：感知环境，探索环境\n，强化有益行为</font></p>\n<h4 id=\"关于深度学习强化学习连续可导性和离散不可导性的讨论\"><span class=\"post-title-index\">.1.5. </span><a class=\"markdownIt-Anchor\" href=\"#关于深度学习强化学习连续可导性和离散不可导性的讨论\"></a> 关于深度学习，强化学习，连续可导性和离散不可导性的讨论</h4>\n<ol>\n<li>\n<p>从函数的角度，深度学习和强化学习都需要学习一个函数映射。深度学习是从输入到\ntarget 的映射。强化学习是学从环境状态到 Action 的映射。这两个映射可以看成性\n质一样的，因为深度学习可以作为强化学习的智能体。所以从函数的角度，他们没有连\n续和离散的区别。（PS. 深度学习模型和强化学习的智能体都是连续可导的函数\n。target 和 Action 都可以是离散的或者连续的。）</p>\n</li>\n<li>\n<p>深度学习作为用梯度下降算法优化的模型，无法优化对 loss 不可导的参数。如在深度\n学习中，设计一个分支来决定模型是否应该包含某个模块，这个分支的参数是不可优化\n的。因为包含和不包含是离散的，对 loss 不可导。</p>\n</li>\n</ol>\n<p>不过假设，如果包含与不包含是连续的。也就是说，可以以 0.1 的权重包含。那么，这些\n参数是可以优化的。从这点来看，离散就是导致模型参数不可优化的原因。</p>\n<ol start=\"3\">\n<li>\n<p>强化学习在离散的情况下解决 2 中的问题。由此，我得到了一个概念，强化学习解决\n离散的问题。</p>\n</li>\n<li>\n<p>下面我们来分析一下这个场景。首先，决定一个模块该不该被使用，这个场景是一次\nAction 的场景，不是连续决策的场景。也就是说 Action 一次，我就能知道最终\nreward 多少了，只有单步的 reward。</p>\n</li>\n</ol>\n<p>限于这个单次决策的场景来看，如果 Action 相对于 reward 是连续可导的，那么深度学习\n就能解决这个问题。如果 Action 相对于 reward 是离散的，那么仅仅深度学习无法解决这\n个问题，要靠强化学习。</p>\n<p><font color=\"green\">这里单次 Action 就知道 reward，实际上这个问题就退化为了有监督\n学习，因为这个单步的 reward 就可以看成我的标签了。所以深度学习解决这个问题是很自\n然的。</font></p>\n<ol start=\"5\">\n<li>多次决策的问题，无论是连续的还是离散的都只能用强化学习的方法。因为多次决策，\n这个问题就不可以退化为监督学习的问题了。它是一个真正的强化学习的问题。</li>\n</ol>\n<p>综上所诉，强化学习解决深度学习解决不了的离散问题，那只是在单次决策的时候，这个问\n题退化为了有监督学习。强化学习的方法，恰好可以提供离散变量的学习。</p>\n<p>强化学习方法解决深度学习中的离散问题，仅仅是强化学习附带的一个小福利。</p>\n<p><strong><font color=\"green\">因为它能把经验转化为可导的目标，就拿策略网络来说，从梯度的角\n度，它只管增加当前随机 Action 的概率，而加入 advatage 之后，自动就优化除了想要的\n大 reward 的行为。</font></strong></p>\n<h4 id=\"深度学习优化和强化学习优化的感性理解\"><span class=\"post-title-index\">.1.6. </span><a class=\"markdownIt-Anchor\" href=\"#深度学习优化和强化学习优化的感性理解\"></a> 深度学习优化和强化学习优化的感性理解</h4>\n<p>前面说了深度学习优化可导的参数，强化学习可以优化不可导的参数。这里说一下对深度学\n习优化方法和强化学习优化方法的感性理解。</p>\n<p>还是说前面包不会包含某模块的例子，由于连续可导，对于每一个参数值，深度学习模型其\n实都同时参与了两种 Action（包含和不包含）。score = 0.1 包含，其实其中包含了含有\n的成分，也包含了不含有的成分。所以我们可以连续的变动 score，看看包含多好，还是不\n好含多好。这其实就是梯度下降算法的方式。得益于每一个参数，其实我都对包含和不包含\n的情况都有了解，我当然知道哪个更好，就往那边移动（优化）。</p>\n<p>然而，对于离散的情况，要么只能包含，要么只能不包含。当选择包含的时候，模型对不包\n含的情况完全是无知的。可能更好，也可能差。当不包含的时候，也是一样的。无论哪种情\n况，我都没有办法优化，两种情况是完全隔离开的，信息不沟通的，是离散的。所以梯度下\n降算法无法优化它。</p>\n<p>强化学习用随机探索的方法让两者信息又沟通起来。包含一下试一下，然后，不包含也试一\n下。尝试的结果是哪种 reward 多，就增大哪种的概率。</p>\n<p><strong><font color=\"green\">所以，无论哪种优化方法，信息的沟通都是必要的。要对所有的\naction 都了解，才能知道选择哪种 action。 只是深度学习是连续的，它的每一种参数，\n都包含了所有 Action 的信息（reward），每一种 Action 都参与了，所以它能直接连续的\n梯度下降的优化，不需要随机探索了。而对于离散的，每种 action 只能知道自己的\nreward，对其他 Action 一无所知的时候，梯度的优化是不行的。必须要探索各种\nAction，还是要知道了每一种 Action 的情况(reward)之后，才能优化。这是方法论\n。</font></strong></p>\n<p>更进一步，离散的地方，相对于 reward 一定是不可导的，所以深度学习不行。而强化学习\n，更准确的说是策略网络，相当于给离散的地方加了标签，这样它就在离散的地方有监督了\n，它就可以根据增加的标签优化。而标签的设计就是根据探索的结果，增大 reward 大的\nAction，reward 大的 Action 就是它的标签，而且这个标签是动态的，是对抗得出的。</p>\n<p>强化学习方法算出的梯度是策略梯度。</p>\n<p><strong><font color=\"green\">强化学习： 不知道选哪边了； 试试呗；按试出来 reward 大的\nAction 优化它。</font></strong></p>\n<p><strong><font color=\"green\">强化学习：它离散，对于 reward 不可导；不直接用 reward 优化它\n，给它加个标签，把试出来 reward 大的 Action，作为标签去优化</font></strong></p>\n<p>在不可导的地方加标签。</p>\n<p><strong><font color=\"green\">由此，强化学习算法的本质是制作标签，无论是连续决策，标签不确\n定的情况，还是它能解决离散问题的情况，它都是用制作标签的方法解决的。</font></strong></p>\n<h3 id=\"策略网络policy-network和估值网络value-network\"><span class=\"post-title-index\">.2. </span><a class=\"markdownIt-Anchor\" href=\"#策略网络policy-network和估值网络value-network\"></a> 策略网络(Policy Network)和估值网络(Value Network)</h3>\n<p>AlphaGo 使用了快速走子，策略网络，估值网络和蒙特卡洛搜索树等技术。</p>\n<p>强化学习算法的一个关键是<font color=\"green\">随机性和探索性</font>，我们需要让算法\n通过试验样本自己学习什么才是某个环境状态下比较好的 Action，而不是像有监督学习一\n样，告诉模型什么是好的 Action，因为我们也不知道什么是好的 Action.</p>\n<p>深度强化学习模型的本质是神经网络，神经网络是工具，根据问题转化以及建模的不同，主\n要分为策略网络和估值网络。</p>\n<p>强化学习中最重要的两类方法<strong>Policy-based,Value-based</strong>。第一种直接预测在某个环境\n下应该采取的行动（直接输出改采取 Action 的概率）。第二种预测在某个环境下所有行动\n的期望价值，然后通过选择 q 值最高的行动执行策略。</p>\n<p>他们都能完成决策，但由于建模的不同，估值网络包含有更多的信息，它不仅能提供决策，\n还预测了决策带来的收益。</p>\n<p><font color=\"deeppink\">策略网络是隐式的学习了某一 Action 所带来的全部获益（当前获\n益+后续获益），而估值网络直接显示的学习 Action 所带来的全部获益。</font>强化学习\n算法做出最佳抉择只需要知道哪个 Action 全部获益最大，策略网络就是这样做的，估值网\n络不仅学习了哪个 Action 全部获益最大，还把每个 Action 的全部获益给计算出来了。</p>\n<p><font color=\"green\">相对来说，策略网络的性能会比估值网络好一些。</font></p>\n<p><font color=\"green\">Value Based 方法适合仅有少量 Action 的环境，而 Policy Based 方\n法更通用，适合 Action 种类非常多，或者具有连续取值的 Action 的环境。结合了深度学\n习之后，Policy Based 方法就变成了策略网络，Value Based 方法就变成了估值网络\n。</font></p>\n<h4 id=\"策略网络policy-network\"><span class=\"post-title-index\">.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#策略网络policy-network\"></a> 策略网络(Policy Network)</h4>\n<p>直接看一个例子，学习的目标是，左右用力使得木棍不倒地\n<a href=\"https://github.com/xyegithub/myBlog/blob/main/posts/1e331e4a/policy_network.py\">Policy_Network.py</a></p>\n<p>关键代码</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">score = tf.matmul(layer1,W2)</span><br><span class=\"line\">probability = tf.nn.sigmoid(score)<span class=\"comment\">#网络输出采取Action 1的概率。</span></span><br><span class=\"line\">input_y = tf.placeholder(tf.float32,[<span class=\"literal\">None</span>,<span class=\"number\">1</span>], \\\\</span><br><span class=\"line\">name=<span class=\"string\">\"input_y\"</span>)<span class=\"comment\"># 输入采取过的行为，这个行为是随机生成的。</span></span><br><span class=\"line\">advantages = tf.placeholder(tf.float32,name=<span class=\"string\">\"reward_signal\"</span>)</span><br><span class=\"line\"><span class=\"comment\"># 输入获益</span></span><br><span class=\"line\">loglik = tf.log(input_y*(input_y - probability) + \\\\</span><br><span class=\"line\">(<span class=\"number\">1</span> - input_y)*(input_y + probability))</span><br><span class=\"line\"><span class=\"comment\"># 损失函数，如果行为是1，则增大</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#概率，如果行为是 0，则减小概率（相当于也是增加0的概率），也就是说这个损</span></span><br><span class=\"line\"><span class=\"comment\">#失函数无论当前行为是什么都会增大当前行为的概率。</span></span><br><span class=\"line\">loss = -tf.reduce_mean(loglik * advantages) <span class=\"comment\"># 这行代码很关键，</span></span><br><span class=\"line\"><span class=\"comment\">#相当于给损失函数成了一个权重advantages，得到最终的损失函数。</span></span><br><span class=\"line\"><span class=\"comment\">#advantages是当前试验的全部获益。如果全部获益大，将以更大的权重，增加</span></span><br><span class=\"line\"><span class=\"comment\">#当前行为的概率。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#所以，策略网络其实也是一个对抗学习的过程，增加所有采取过行为的概率，只是</span></span><br><span class=\"line\"><span class=\"comment\">#获益多的行为以更大的权重增加。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#一个试验： 由初始状态开始，随机采取一连串的行为</span></span><br><span class=\"line\"><span class=\"comment\">#（Policy_Network.py 中是根据当前模型输出的概率,来生成随机的行为，但</span></span><br><span class=\"line\"><span class=\"comment\">#是我感觉直接用0.5的概率随机生成一连串的0和1的行为也是可以的，下面将实</span></span><br><span class=\"line\"><span class=\"comment\">#验一下），直到任务结束。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 由于每个试验，都可以一直行为到任务结束，所以每个action，我们都可以得</span></span><br><span class=\"line\"><span class=\"comment\">#到它在该试验中的全部获益（当前获益 + 之后所有行为的获益）</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 随机生成了n个试验，其中又各种各样的决策（随机探索），全部获益大的</span></span><br><span class=\"line\"><span class=\"comment\">#action，它的advantages也大，那么它的概率就增大的多，它被强化的厉害。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##试验生成的过程，实际上就是数据集构建的过程。策略网络的数据集是由环境</span></span><br><span class=\"line\"><span class=\"comment\">#和一系列随机的行为构成的。它提供了环境在各种行为下的反应（获益）。模型</span></span><br><span class=\"line\"><span class=\"comment\">#学习为环境带来高获益的行为的规律。</span></span><br></pre></td></tr></tbody></table></figure>\n<p>由上面的代码可知，从策略网络的角度看强化学习的话，强化学习的关键其实是对数据集的\n构建—如何构建数据集。</p>\n<p>在构建数据集的时候，随机探索肯定是必要的。随机探索的结果会得到一系列好的行为，也\n会得到一系列不好的行为。如何强化好的行为就是算法设计的时候需要注意的。</p>\n<p>上面的代码在探索阶段借用了当前的模型，即根据当前模型输出的概率随机生成行为，从而\n形成数据集。如果完全的随机（一直使用 0.5 的概率随机的生成 Action）会什么样呢？</p>\n<h5 id=\"数据集是否可以和模型无关不随着模型变化\"><span class=\"post-title-index\">.2.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#数据集是否可以和模型无关不随着模型变化\"></a> 数据集是否可以和模型无关（不随着模型变化）？</h5>\n<p>关键修改代码</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###基于当前模型，根据当前的状态x，生成Action 1的概率</span></span><br><span class=\"line\">tfprob = sess.run(probability,feed_dict={observations: x})</span><br><span class=\"line\"><span class=\"comment\">### 基于预测概率，随机生成行为，并试探环境。生成数据集。</span></span><br><span class=\"line\">action = <span class=\"number\">1</span> <span class=\"keyword\">if</span> np.random.uniform() &lt; tfprob <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br></pre></td></tr></tbody></table></figure>\n<p>修改后</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### 注释掉这句，并不需要根据当前模型生成概率</span></span><br><span class=\"line\"><span class=\"comment\">### tfprob = sess.run(probability,feed_dict={observations: x})</span></span><br><span class=\"line\"><span class=\"comment\">### 直接设置概率为0.5，随机完全随机探索生成数据集。</span></span><br><span class=\"line\">tfprob = <span class=\"number\">0.5</span></span><br><span class=\"line\">action = <span class=\"number\">1</span> <span class=\"keyword\">if</span> np.random.uniform() &lt; tfprob <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br></pre></td></tr></tbody></table></figure>\n<p>结果：修改后，模型无法收敛。</p>\n<p>完全随机很小的概率能探索出很好的试验，这些好的行为也很难持续的得到强化。</p>\n<p>所以，强化学习也有一种效果叠加的感觉。在完全随机的情况下 ，探索出相对好的\naction，再在这个相对好的 action 的基础上，在探索探索出更好的 action。</p>\n<p>如果数据集不依赖模型，就是一直在完全随机的基础上探索。这样很难收敛。</p>\n<p>也可以这样看，完全随机的话，最多能学到前几步的策略（因为完全随机就走不了几步，探\n索的经验就只有那几步）。依赖于模型，探索的行为更有价值，因为是依赖于学到过的知识\n的，一方面确认了，按学到的知识走，确实获益多，一方面又在学到的知识的基础上，做了\n一些随机，探索更好的知识。</p>\n<h4 id=\"估值网络value-networkq-learning\"><span class=\"post-title-index\">.2.2. </span><a class=\"markdownIt-Anchor\" href=\"#估值网络value-networkq-learning\"></a> 估值网络(Value Network，Q-learning)</h4>\n<p>Q-Learing 用神经网络实现，得到的模型就是估值网络。</p>\n<p>也看一个例子\n，<a href=\"https://github.com/xyegithub/myBlog/blob/main/posts/1e331e4a/q_learning.py\">Value_Network.py</a></p>\n<p>学习每个 Action 所对应的 reward 的期望。</p>\n<p>我们先看看数据集的结构</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###Save the experience to our episode buffer.</span></span><br><span class=\"line\">episodeBuffer.add(np.reshape(np.array([s,a,r,s1,d]),[<span class=\"number\">1</span>,<span class=\"number\">5</span>]))</span><br><span class=\"line\"><span class=\"comment\">### 其中s是当前时刻的环境状态，a是当前随机采取的Action，r是这个Action的当前reward</span></span><br><span class=\"line\"><span class=\"comment\">### s1是采取Action之后的下一状态，d是布尔型表示是否任务结束。</span></span><br></pre></td></tr></tbody></table></figure>\n<ol>\n<li>\n<p>现在目标是学习 Q(s<sub>t</sub>, a<sub>t</sub>)，也就是当前环境状态，采取行为\na 的全部 reward 的期望。</p>\n</li>\n<li>\n<p>现在假设我们有模型 Q<sub>desird</sub>，可以预测全部 reward 了，那么这个模型\n应该满足条件，Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r +\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">λ</span></span></span></span> Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，这有点递\n归的感觉了。</p>\n</li>\n<li>\n<p>现在我们能不能根据这个公式 ， 来优化出 Q<sub>desired</sub>。肯定是能的。对于\n探索过的所有试验，公式都满足的话，此时的模型就可以看成我们想要的模型了。我感\n觉这就是估值网络方法的核心。</p>\n</li>\n</ol>\n<p>直接看关键代码</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###Choose an action by greedily (with e chance of random action)</span></span><br><span class=\"line\"><span class=\"comment\">### from the Q-network</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> np.random.rand(<span class=\"number\">1</span>) &lt; e <span class=\"keyword\">or</span> total_steps &lt; pre_train_steps:</span><br><span class=\"line\">a = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">4</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">a = sess.run(mainQN.predict,feed_dict={mainQN.scalarInput:[s]})[<span class=\"number\">0</span>]</span><br><span class=\"line\"><span class=\"comment\">### 这段代码其实是探索的代码，当最开始的时候是完全随机探索（total_steps &lt; pre_train_steps的时候）</span></span><br><span class=\"line\"><span class=\"comment\">### 当total_steps &gt;= pre_train_steps之后呢，就不是完全随机探索了。</span></span><br><span class=\"line\"><span class=\"comment\">### 有e的概率是随机探索的，（1-e）的概率是由训练好的模型决定之后的Action。</span></span><br><span class=\"line\"><span class=\"comment\">### 这里是估值网络和策略网络的不同，策略网络本身就具有随机性，所以不需要引入</span></span><br><span class=\"line\"><span class=\"comment\">### 额外的参数e和pre_train_steps来控制随机探索的强度。</span></span><br><span class=\"line\"><span class=\"comment\">### 策略网络在训练的过程中，本身就是由随机性大，到慢慢的收敛到好的Action</span></span><br><span class=\"line\"><span class=\"comment\">### 所以可以直接得到好的探索的训练样本。估值网络没有这样好的性质，它连</span></span><br><span class=\"line\"><span class=\"comment\">### 随机性都没有，就需要人为的制造，满足从完全随机探索，到在好的Action的</span></span><br><span class=\"line\"><span class=\"comment\">### 基础上具有一定的随机性进行探索。</span></span><br></pre></td></tr></tbody></table></figure>\n<p><strong>这是策略网络和估值网络的共通之处，其实这也最上面那个注释\"by greedily (with e\nchance of random action) from the Q-network\"的意思。</strong></p>\n<p><strong><font color=\"green\">“贪心”两个字完美的诠释了强化学习，无论是策略网络还是估值网络\n，在探索阶段，在生成数据集上的特点。</font></strong></p>\n<p>在策略网络那一节，我做的那个试验，和模型无关生成数据集。其实就是不贪心了，不贪心\n不行。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> total_steps &gt; pre_train_steps:</span><br><span class=\"line\"><span class=\"keyword\">if</span> e &gt; endE:</span><br><span class=\"line\">e -= stepDrop</span><br><span class=\"line\"><span class=\"comment\">### 完全随机了之后，开始慢慢减小随机性。</span></span><br><span class=\"line\"><span class=\"comment\">### 模型约不可靠的时候，探索性和随机性越强。后来模型慢慢变得可靠就减弱随机性。</span></span><br><span class=\"line\"><span class=\"comment\">### 因为模型越来越可靠的时候，随机性大就会得到很多远远低于当前模型性能的试验</span></span><br><span class=\"line\"><span class=\"comment\">### 这些试验都是早就被pass了的，学不到什么东西，损坏模型的探索。</span></span><br><span class=\"line\"><span class=\"comment\">### endE=0.1 说明无论训练的多好，模型都保持了随机性，保持了探索性</span></span><br><span class=\"line\"><span class=\"comment\">###　人永远要有好奇心，永远要觉得自己的知识还可能不是最好的</span></span><br></pre></td></tr></tbody></table></figure>\n<p>下面的代码是将在数据集弄好的情况下，如何训练模型的。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> total_steps % (update_freq) == <span class=\"number\">0</span>:</span><br><span class=\"line\">trainBatch = myBuffer.sample(batch_size) <span class=\"comment\">#Get a random batch of experiences.</span></span><br><span class=\"line\"><span class=\"comment\">#Below we perform the Double-DQN update to the target Q-values</span></span><br><span class=\"line\"><span class=\"comment\"># 主网络预测了下一刻需要采取的Action，trainBatch[:,3]是当前的下一刻的环境</span></span><br><span class=\"line\"><span class=\"comment\"># 回顾公式，Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)</span></span><br><span class=\"line\"><span class=\"comment\"># 这里主函数预测的Action就是t+1时刻（下一时刻）获益值最大的Action</span></span><br><span class=\"line\">Q1 = sess.run(mainQN.predict,feed_dict={mainQN.scalarInput:np.vstack(trainBatch[:,<span class=\"number\">3</span>])})</span><br><span class=\"line\"><span class=\"comment\"># target网络预测了下一时刻的reward</span></span><br><span class=\"line\">Q2 = sess.run(targetQN.Qout,feed_dict={targetQN.scalarInput:np.vstack(trainBatch[:,<span class=\"number\">3</span>])})</span><br><span class=\"line\">end_multiplier = -(trainBatch[:,<span class=\"number\">4</span>] - <span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"comment\"># 用主网络预测出的Action以及target网络预测出的所有行为的reward</span></span><br><span class=\"line\"><span class=\"comment\"># 选择了最大的reward,也就是公式中的 Max Q(s_t+1, a)</span></span><br><span class=\"line\">doubleQ = Q2[<span class=\"built_in\">range</span>(batch_size),Q1]</span><br><span class=\"line\"><span class=\"comment\"># 这里得到的就是公式Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)</span></span><br><span class=\"line\"><span class=\"comment\"># 的右边，当前reward加上乘以衰减系数之后的，下一步最大reward</span></span><br><span class=\"line\">targetQ = trainBatch[:,<span class=\"number\">2</span>] + (y*doubleQ * end_multiplier)</span><br><span class=\"line\"><span class=\"comment\">#Update the network with our target values.</span></span><br><span class=\"line\"><span class=\"comment\"># 公式右边得到了之后，在把真正的当前状态输入进去，得到左边</span></span><br><span class=\"line\"><span class=\"comment\"># 左边以右边作为标签进行学习。更新主网络的参数</span></span><br><span class=\"line\">_ = sess.run(mainQN.updateModel, \\</span><br><span class=\"line\">feed_dict={mainQN.scalarInput:np.vstack(trainBatch[:,<span class=\"number\">0</span>]),mainQN.targetQ:targetQ, mainQN.actions:trainBatch[:,<span class=\"number\">1</span>]})</span><br><span class=\"line\"><span class=\"comment\"># 更新target网络的参数。</span></span><br><span class=\"line\">updateTarget(targetOps,sess) <span class=\"comment\">#Update the target network toward the primary network.</span></span><br></pre></td></tr></tbody></table></figure>\n<p>target 网络参数的更新方式代码</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">updateTargetGraph</span>(<span class=\"params\">tfVars,tau</span>):</span></span><br><span class=\"line\">total_vars = <span class=\"built_in\">len</span>(tfVars)</span><br><span class=\"line\">op_holder = []</span><br><span class=\"line\"><span class=\"comment\"># 主网络是和target网络一样的，前一半参数正好是主网络的参数</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> idx,var <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(tfVars[<span class=\"number\">0</span>:total_vars//<span class=\"number\">2</span>]):</span><br><span class=\"line\"><span class=\"comment\"># idx+total_vars对应的时候后一半的参数也就是target网络的参数</span></span><br><span class=\"line\"><span class=\"comment\"># 这里相当于是target参数 = 主网络参数 * tau + （1- tau）*target参数</span></span><br><span class=\"line\"><span class=\"comment\"># 也就是说target网络在以一定的速度向主网络靠近</span></span><br><span class=\"line\"><span class=\"comment\"># 结合前面的代码，主网络才是真正学习的网络，target网络的作用仅仅是得到等式</span></span><br><span class=\"line\"><span class=\"comment\"># 右边的值，即标签，即使是等式右边，也不是target网络完全决定的</span></span><br><span class=\"line\"><span class=\"comment\"># target网络得到了所有Action的reward，最大的Action是主网络选择的</span></span><br><span class=\"line\"><span class=\"comment\"># 为什么要这么做，target网络也是在模仿主网络，只用主网络也能得到等式的右边</span></span><br><span class=\"line\"><span class=\"comment\"># 理论上其实右边也应该是主网络决定，现在搞了个主网络的模仿者target网络</span></span><br><span class=\"line\"><span class=\"comment\"># 是出于优化的考虑。我们后面叙述。</span></span><br><span class=\"line\">op_holder.append(tfVars[idx+total_vars//<span class=\"number\">2</span>].assign\\\\</span><br><span class=\"line\">((var.value()*tau) \\\\</span><br><span class=\"line\">                      + ((<span class=\"number\">1</span>-tau)*tfVars[idx+total_vars//<span class=\"number\">2</span>].value())))</span><br><span class=\"line\">                      <span class=\"keyword\">return</span> op_holder</span><br><span class=\"line\"></span><br><span class=\"line\">                      <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">updateTarget</span>(<span class=\"params\">op_holder,sess</span>):</span></span><br><span class=\"line\">                      <span class=\"keyword\">for</span> op <span class=\"keyword\">in</span> op_holder:</span><br><span class=\"line\">                      sess.run(op)</span><br><span class=\"line\"></span><br><span class=\"line\">                      ```</span><br><span class=\"line\"></span><br><span class=\"line\">                      现在其实我们把关键的代码都看了，在这段代码实现中，引入了一些state of the art的trick，下面我们结合看过的代码在提一遍。</span><br><span class=\"line\"></span><br><span class=\"line\">                      <span class=\"number\">1.</span>  引入卷积层，这段代码比较简单，我们没有看。环境状态是用图片的形式给的，用CNN提取特征是比较自然的。</span><br><span class=\"line\">                      <span class=\"number\">2.</span>  Experience replay。估值网络不像策略网络一样得到试验之后，用一次就扔掉再去制作新的试验（数据集）来训练。它把每次试验都放在一个试验池里面。试验池长度为N，如果超过了N，那就把最老的试验样本扔掉。每次 训练的时候从试验池里面随机选择batchsize个样本进行训练，保持了对样本的利用率，同时其实也增加了模型的稳定性，因为数据集是相对稳定的（相比于N=<span class=\"number\">1</span>而言，每次训练了就扔掉，进来的都是新的，不那么稳定）。</span><br><span class=\"line\">                      <span class=\"number\">3.</span>  使用target网络来辅助训练。\\*\\*之所以要用target网络来制造训练目标，用主网络来实际训练，是为了让Q-Learing训练的目标保持平稳。\\*\\*强化学习不像普通的监督学习，它的目标是变化的，\\*\\*因为学习目标的一部分就是模型本身输出的。\\*\\*每次更新模型参数都会导致学习目标发生变化，如果更新频繁，幅度很大，我们的训练过程就会变得非常不稳定并且失控。\\*\\*DQN的训练会陷入目标Q与预测Q的反馈循环中，震荡发散。\\*\\*所以用target网络来制造目标，target网络和主网络又不是矛盾的，因为target网络会逼近主网络，它是主网络的模仿者，所以它提供的目标Q也是有权威的。</span><br><span class=\"line\">                      <span class=\"number\">4.</span>  Double DQN。这个trick源于target网络选的最大Action不准。模仿的不够好，现在就让主网络来帮它选。也就是上面代码中我们看过了主网络输出action，选择target网络输出的reward，得到公式的右边。</span><br><span class=\"line\">                      <span class=\"number\">5.</span>  Dueling DQN。上代码</span><br><span class=\"line\"></span><br><span class=\"line\">                      ```python</span><br><span class=\"line\">                      self.AW = tf.Variable(xavier_init([h_size//<span class=\"number\">2</span>,env.actions]))</span><br><span class=\"line\">                      self.VW = tf.Variable(xavier_init([h_size//<span class=\"number\">2</span>,<span class=\"number\">1</span>]))</span><br><span class=\"line\">                      self.Advantage = tf.matmul(self.streamA,self.AW)</span><br><span class=\"line\">                      self.Value = tf.matmul(self.streamV,self.VW)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###Then combine them together to get our final Q-values.</span></span><br><span class=\"line\"><span class=\"comment\">### 看这里Qout是网络最终预测的所有Action的reward。它由两部分组成Value和Advantage</span></span><br><span class=\"line\"><span class=\"comment\">### 由最上面两行可以看出Value是一维的，是实数，advantage是#action维度的向量</span></span><br><span class=\"line\"><span class=\"comment\">### 所以，Dueling DQN就是将reward裁成了两部分，一部分是环境状态本身具有的价值Value</span></span><br><span class=\"line\"><span class=\"comment\">### 另一部分就是Action本身具有的价值，相加起来就是在这个环境下Action具有的价值。</span></span><br><span class=\"line\"><span class=\"comment\">### 其实我感觉这些解释都是人为的，具体是不是这样谁也不知道，可能只是这样优化的好。</span></span><br><span class=\"line\"><span class=\"comment\">###　因为即使不分为两部分，网络输出Ｑout的时候，输入也是环境状态，肯定都会把环境考虑</span></span><br><span class=\"line\"><span class=\"comment\">### 进去才有Action的价值。然而直接输出这个价值，发现优化的不好，分为两部分之后，发现</span></span><br><span class=\"line\"><span class=\"comment\">### 优化的好了。其实谁也不知道其中到底是什么原因起作用。</span></span><br><span class=\"line\">self.Qout = self.Value + tf.subtract(self.Advantage,tf.reduce_mean(self.Advantage,axis=<span class=\"number\">1</span>,keep_dims=<span class=\"literal\">True</span>))</span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure>\n<h4 id=\"策略网络和估值网络的不同\"><span class=\"post-title-index\">.2.3. </span><a class=\"markdownIt-Anchor\" href=\"#策略网络和估值网络的不同\"></a> 策略网络和估值网络的不同</h4>\n<p>从策略网络和估值网络看，强化学习都有探索和对抗两个过程。通过探索，得到数据集，包\n含了各种可能性。通过对抗，让数据集中好的（reward 高的试验胜出）。他们的不同点在\n于对抗的方法。</p>\n<ol>\n<li>策略网络：对抗的焦点在于选择 Action 的概率。</li>\n<li>估值网络：对抗的焦点在于评估 Action 的 reward。</li>\n<li>两者都会影响数据集的制作，而且影响的方式是相同的：贪心和随机探索</li>\n<li>比起策略网络，估值网络更加没有对抗的感觉。因为策略网络在提高某一个 Action 的\n概率的时候，会抑制其他 Action 的概率（总的概率为 1）。而估值网络在提高某一个\nAction 的 reward 的时候，和其他 Action 是无关的。<strong>而且其实不能说是提高\nreward，它是预测出正确的 reward。</strong>（这是两者的很大的不同处，策略网络更像是\n一个分类问题，而估值网络像是一个回归问题）</li>\n</ol>\n<h3 id=\"回顾\"><span class=\"post-title-index\">.3. </span><a class=\"markdownIt-Anchor\" href=\"#回顾\"></a> 回顾</h3>\n<p>强化学习的本质是连续决策。强化学习算法的关键是标签制作，数据集制作。</p>\n<p>连续决策问题是没有确定的标签的，它通过探索试验得到数据集和标签，为没有提供标签的\n问题，做了标签，让问题可以解决。</p>\n<p>深度学习无法优化离散的不可导的参数，强化学习也可以通过在离散的地方做数据集做标签\n，把它转换为可导的，可用 sgd 优化的问题。</p>\n<p>做标签和数据集的关键是随机性以及贪心，贪心让它立足于以往的知识，随机让它不刚愎自\n用，保持谦卑，给新的可能保留空间。</p>\n<p>无论是策略网络还是估值网络，在数据集的制作上都是一样的，随机性和贪心。估值网络的\n数据集制作，可以看出强化学习探索的本质（由于估值网络本身没有随机性，它在制作数据\n集的时候，显示的暴露了，探索和贪心的本质。策略网络这方面还不太好看出来，因为它是\n隐式的利用探索和贪心）。</p>\n<p>策略网络，增大所有行为的概率，但是对于 reward 大 的行为增大的权重大。这个思路在\n我得感觉上更加符合强化两个字。强化好的行为嘛。</p>\n<p>估值网络的本质是公式 Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r +\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">λ</span></span></span></span> Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，有点递归的感\n觉。</p>\n<p>策略网络和估值网络数据集也有一点不同，策略网络的数据集是纵向的，一串行为一起的。\n而估值网络的数据集是单个单个的。</p>\n<p>由下面代码可以看出，策略网络中，每一窜试验就会训练一次，只是网络参数更新会积累了\n好几次试验之后才更新。策略网络关心从开始到结束一系列行为。而估值网络只关心当前和\n下一状态。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> done:</span><br><span class=\"line\">episode_number += <span class=\"number\">1</span></span><br><span class=\"line\">epx = np.vstack(xs)</span><br><span class=\"line\">epy = np.vstack(ys)</span><br><span class=\"line\">epr = np.vstack(drs)</span><br><span class=\"line\">tfp = tfps</span><br><span class=\"line\">xs,hs,dlogps,drs,ys,tfps = [],[],[],[],[],[]</span><br><span class=\"line\"></span><br><span class=\"line\">discounted_epr = discount_rewards(epr)</span><br><span class=\"line\">discounted_epr -= np.mean(discounted_epr)</span><br><span class=\"line\">discounted_epr //= np.std(discounted_epr)</span><br><span class=\"line\"></span><br><span class=\"line\">tGrad = sess.run(newGrads,feed_dict={observations: epx, input_y: epy, advantages: discounted_epr})</span><br><span class=\"line\"><span class=\"keyword\">for</span> ix,grad <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(tGrad):</span><br><span class=\"line\">gradBuffer[ix] += grad</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> episode_number % batch_size == <span class=\"number\">0</span>:</span><br><span class=\"line\">sess.run(updateGrads,feed_dict={W1Grad: gradBuffer[<span class=\"number\">0</span>],W1_1Grad:gradBuffer[<span class=\"number\">1</span>],W2Grad:gradBuffer[<span class=\"number\">2</span>]})</span><br></pre></td></tr></tbody></table></figure>\n<p>估值网络人为的控制随机强度，也是一个值得考虑的问题。</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h3 id=\"什么是强化学习关于强化学习的几点疑问\"><a class=\"markdownIt-Anchor\" href=\"#什么是强化学习关于强化学习的几点疑问\"></a> 什么是强化学习，关于强化学习的几点疑问</h3>\n<p><font color=green size=3>强化学习三要素：环境状态，行动，奖励</font></p>\n<p><font color=green size=3>目标：尽量多的获得奖励</font></p>\n<p><font color=green size=3>本质：连续决策</font></p>\n<p>基本的强化学习模型包括：</p>\n<ul>\n<li>环境状态的集合 S</li>\n<li>动作的集合 A</li>\n<li>状态之间的转换规则（是环境的一部分）</li>\n<li>规定转换后“即时奖励”的规则（是环境的一部分）</li>\n<li>描述主体（智能体）能够观察到什么的规则（是环境的一部分）</li>\n<li>能够做出决策/动作的主体（智能体）</li>\n</ul>\n<h4 id=\"区别于深度学习强化学习的本质特点是什么\"><a class=\"markdownIt-Anchor\" href=\"#区别于深度学习强化学习的本质特点是什么\"></a> 区别于深度学习，强化学习的本质特点是什么？</h4>\n<p><strong>两个定义</strong></p>\n<p>1，强化学习是机器学习的一个重要分支，主要用来解决连续决策问题。</p>\n<p>2，强化学习又称 再励学习，评价学习或增强学习，是机器学习的范式和方法论之一，用于\n描述和解决智能体（agent）在于环境交互过程中通过学习策略以达成回报最大或实现特定\n目标的问题。</p>\n<p>强化学习的本质是<font color=deeppink> 描述和解决智能体（agent）在于环境交互过程\n中通过学习策略以达成回报最大或实现特定目标的问题。</font>它本质是这样一种场景，\n在这种场景中它为了达到某种目的，做出连续的决策。这样符合这种场景，那就是强化学习\n。</p>\n<p>强化学习和深度学习这两个名词的维度是不一样的。深度学习描述的是算法本身的特点，深\n度够不够，是不是连接主义的模型。深度学习可以用来做无监督，也可以用来做半监督，也\n可以用来做弱监督，甚至可以用来作为强化学习算法的一部分。深度学习这个名词，不管应\n用场景只管模型本身是不是满足深度学习的特点。</p>\n<p>而强化学习描述的是应用场景的特点，只要能提供智能体决策的算法，管它是什么模型，什\n么结构，那就是强化学习的算法。从这个角度上讲，我现在认为强化学习和监督学习，无监\n督学习，弱监督学习，是并列的，是对应用场景的描述。和深度学习不是同一维度的。</p>\n<p><font color=deeppink>强化学习的本质在于目标给定的形式，不像无监督学习那样完全没\n有学习目标，也不像监督学习那样有非常明确的目标（label），强化学习的目标一般是变\n化的，不明确的，甚至可能不存在绝对正确的目标。，强化学习的问题都可以抽象成，环境\n状态，行动和奖励。应该说只要能抽象为这三个要素，目标是获得最大奖励的模型，就是强\n化学习的模型。</font></p>\n<p>强化学习的最大的特点是“试错”，是尝试各种可能，而强化结果好的可能。（策略网络的特\n点，估值网络的特点是修正和预测获益）</p>\n<p>由于强化学习是一种决策学习，这个问题的特点就是离散型。但是离散并不就是强化学习（\n连续的决策才是，目标的模糊和不确定性是决策问题的特点）。深度学习本质是函数的拟合\n，所以连续可微是它的特点。并不能说连续可微的问题就是深度学习，离散的问题就是强化\n学习。</p>\n<h4 id=\"深度学习用梯度下降的算法实现模型的优化强化学习无法求导甚至连学习目标都是模糊的如何优化模型参数\"><a class=\"markdownIt-Anchor\" href=\"#深度学习用梯度下降的算法实现模型的优化强化学习无法求导甚至连学习目标都是模糊的如何优化模型参数\"></a> 深度学习用梯度下降的算法实现模型的优化，强化学习无法求导，甚至连学习目标都是模糊的如何优化模型参数？</h4>\n<p>这个问题要了解下一节，具体的强化学习方法。</p>\n<h4 id=\"强化学习与弱监督学习\"><a class=\"markdownIt-Anchor\" href=\"#强化学习与弱监督学习\"></a> 强化学习与弱监督学习？</h4>\n<p>弱监督是属于有监督学习，只是它学习的目标不是被给予的标签，而是比被给予标签更强的\n标签（强弱是指标签做含有的信息量），也就是说弱监督是根据少量信息的标签，推测出更\n多的信息。</p>\n<p>强化学习的本质是连续决策。连续决策的特点是目标的模糊和不确定性。</p>\n<p>所以，虽然弱监督和强化学习都没有给出最终准确的目标，但是他们任然很不同的</p>\n<h4 id=\"深度学习是死的没有智能的机器学习算法强化学习是活的有智能的机器学习算法\"><a class=\"markdownIt-Anchor\" href=\"#深度学习是死的没有智能的机器学习算法强化学习是活的有智能的机器学习算法\"></a> 深度学习是死的，没有智能的机器学习算法，强化学习是“活的”，有智能的机器学习算法</h4>\n<p>深度学习大部分我们用作有监督的学习算法。其实说深度学习是死的，不如说有监督学习是\n死的。</p>\n<p>有监督学习其实是完全的复刻标签里面含有的知识，它的本质就是一个函数拟合的问题，它\n无法摆脱对绝对的标签的依赖，无法超越标签。</p>\n<p>而强化学习，正由于它的目标是模糊和不确定的。使得算法在设计上必须具有随机性和探索\n性，它能够探索出人类从来没有到过的领域。就像在围棋上，下出人类完全无法理解的棋，\n人从来没有想过的一些下法。这就是强化学习算法探索出来的知识。所以我觉得它是活着的\n，拥有智能的算法。</p>\n<p><font color=green>从感性的层面，强化学习算法很接近人脑的行为：感知环境，探索环境\n，强化有益行为</font></p>\n<h4 id=\"关于深度学习强化学习连续可导性和离散不可导性的讨论\"><a class=\"markdownIt-Anchor\" href=\"#关于深度学习强化学习连续可导性和离散不可导性的讨论\"></a> 关于深度学习，强化学习，连续可导性和离散不可导性的讨论</h4>\n<ol>\n<li>\n<p>从函数的角度，深度学习和强化学习都需要学习一个函数映射。深度学习是从输入到\ntarget 的映射。强化学习是学从环境状态到 Action 的映射。这两个映射可以看成性\n质一样的，因为深度学习可以作为强化学习的智能体。所以从函数的角度，他们没有连\n续和离散的区别。（PS. 深度学习模型和强化学习的智能体都是连续可导的函数\n。target 和 Action 都可以是离散的或者连续的。）</p>\n</li>\n<li>\n<p>深度学习作为用梯度下降算法优化的模型，无法优化对 loss 不可导的参数。如在深度\n学习中，设计一个分支来决定模型是否应该包含某个模块，这个分支的参数是不可优化\n的。因为包含和不包含是离散的，对 loss 不可导。</p>\n</li>\n</ol>\n<p>不过假设，如果包含与不包含是连续的。也就是说，可以以 0.1 的权重包含。那么，这些\n参数是可以优化的。从这点来看，离散就是导致模型参数不可优化的原因。</p>\n<ol start=\"3\">\n<li>\n<p>强化学习在离散的情况下解决 2 中的问题。由此，我得到了一个概念，强化学习解决\n离散的问题。</p>\n</li>\n<li>\n<p>下面我们来分析一下这个场景。首先，决定一个模块该不该被使用，这个场景是一次\nAction 的场景，不是连续决策的场景。也就是说 Action 一次，我就能知道最终\nreward 多少了，只有单步的 reward。</p>\n</li>\n</ol>\n<p>限于这个单次决策的场景来看，如果 Action 相对于 reward 是连续可导的，那么深度学习\n就能解决这个问题。如果 Action 相对于 reward 是离散的，那么仅仅深度学习无法解决这\n个问题，要靠强化学习。</p>\n<p><font color=green>这里单次 Action 就知道 reward，实际上这个问题就退化为了有监督\n学习，因为这个单步的 reward 就可以看成我的标签了。所以深度学习解决这个问题是很自\n然的。</font></p>\n<ol start=\"5\">\n<li>多次决策的问题，无论是连续的还是离散的都只能用强化学习的方法。因为多次决策，\n这个问题就不可以退化为监督学习的问题了。它是一个真正的强化学习的问题。</li>\n</ol>\n<p>综上所诉，强化学习解决深度学习解决不了的离散问题，那只是在单次决策的时候，这个问\n题退化为了有监督学习。强化学习的方法，恰好可以提供离散变量的学习。</p>\n<p>强化学习方法解决深度学习中的离散问题，仅仅是强化学习附带的一个小福利。</p>\n<p><strong><font color=green>因为它能把经验转化为可导的目标，就拿策略网络来说，从梯度的角\n度，它只管增加当前随机 Action 的概率，而加入 advatage 之后，自动就优化除了想要的\n大 reward 的行为。</font></strong></p>\n<h4 id=\"深度学习优化和强化学习优化的感性理解\"><a class=\"markdownIt-Anchor\" href=\"#深度学习优化和强化学习优化的感性理解\"></a> 深度学习优化和强化学习优化的感性理解</h4>\n<p>前面说了深度学习优化可导的参数，强化学习可以优化不可导的参数。这里说一下对深度学\n习优化方法和强化学习优化方法的感性理解。</p>\n<p>还是说前面包不会包含某模块的例子，由于连续可导，对于每一个参数值，深度学习模型其\n实都同时参与了两种 Action（包含和不包含）。score = 0.1 包含，其实其中包含了含有\n的成分，也包含了不含有的成分。所以我们可以连续的变动 score，看看包含多好，还是不\n好含多好。这其实就是梯度下降算法的方式。得益于每一个参数，其实我都对包含和不包含\n的情况都有了解，我当然知道哪个更好，就往那边移动（优化）。</p>\n<p>然而，对于离散的情况，要么只能包含，要么只能不包含。当选择包含的时候，模型对不包\n含的情况完全是无知的。可能更好，也可能差。当不包含的时候，也是一样的。无论哪种情\n况，我都没有办法优化，两种情况是完全隔离开的，信息不沟通的，是离散的。所以梯度下\n降算法无法优化它。</p>\n<p>强化学习用随机探索的方法让两者信息又沟通起来。包含一下试一下，然后，不包含也试一\n下。尝试的结果是哪种 reward 多，就增大哪种的概率。</p>\n<p><strong><font color=green>所以，无论哪种优化方法，信息的沟通都是必要的。要对所有的\naction 都了解，才能知道选择哪种 action。 只是深度学习是连续的，它的每一种参数，\n都包含了所有 Action 的信息（reward），每一种 Action 都参与了，所以它能直接连续的\n梯度下降的优化，不需要随机探索了。而对于离散的，每种 action 只能知道自己的\nreward，对其他 Action 一无所知的时候，梯度的优化是不行的。必须要探索各种\nAction，还是要知道了每一种 Action 的情况(reward)之后，才能优化。这是方法论\n。</font></strong></p>\n<p>更进一步，离散的地方，相对于 reward 一定是不可导的，所以深度学习不行。而强化学习\n，更准确的说是策略网络，相当于给离散的地方加了标签，这样它就在离散的地方有监督了\n，它就可以根据增加的标签优化。而标签的设计就是根据探索的结果，增大 reward 大的\nAction，reward 大的 Action 就是它的标签，而且这个标签是动态的，是对抗得出的。</p>\n<p>强化学习方法算出的梯度是策略梯度。</p>\n<p><strong><font color=green>强化学习： 不知道选哪边了； 试试呗；按试出来 reward 大的\nAction 优化它。</font></strong></p>\n<p><strong><font color=green>强化学习：它离散，对于 reward 不可导；不直接用 reward 优化它\n，给它加个标签，把试出来 reward 大的 Action，作为标签去优化</font></strong></p>\n<p>在不可导的地方加标签。</p>\n<p><strong><font color=green>由此，强化学习算法的本质是制作标签，无论是连续决策，标签不确\n定的情况，还是它能解决离散问题的情况，它都是用制作标签的方法解决的。</font></strong></p>\n<h3 id=\"策略网络policy-network和估值网络value-network\"><a class=\"markdownIt-Anchor\" href=\"#策略网络policy-network和估值网络value-network\"></a> 策略网络(Policy Network)和估值网络(Value Network)</h3>\n<p>AlphaGo 使用了快速走子，策略网络，估值网络和蒙特卡洛搜索树等技术。</p>\n<p>强化学习算法的一个关键是<font color=green>随机性和探索性</font>，我们需要让算法\n通过试验样本自己学习什么才是某个环境状态下比较好的 Action，而不是像有监督学习一\n样，告诉模型什么是好的 Action，因为我们也不知道什么是好的 Action.</p>\n<p>深度强化学习模型的本质是神经网络，神经网络是工具，根据问题转化以及建模的不同，主\n要分为策略网络和估值网络。</p>\n<p>强化学习中最重要的两类方法<strong>Policy-based,Value-based</strong>。第一种直接预测在某个环境\n下应该采取的行动（直接输出改采取 Action 的概率）。第二种预测在某个环境下所有行动\n的期望价值，然后通过选择 q 值最高的行动执行策略。</p>\n<p>他们都能完成决策，但由于建模的不同，估值网络包含有更多的信息，它不仅能提供决策，\n还预测了决策带来的收益。</p>\n<p><font color=deeppink>策略网络是隐式的学习了某一 Action 所带来的全部获益（当前获\n益+后续获益），而估值网络直接显示的学习 Action 所带来的全部获益。</font>强化学习\n算法做出最佳抉择只需要知道哪个 Action 全部获益最大，策略网络就是这样做的，估值网\n络不仅学习了哪个 Action 全部获益最大，还把每个 Action 的全部获益给计算出来了。</p>\n<p><font color=green>相对来说，策略网络的性能会比估值网络好一些。</font></p>\n<p><font color=green>Value Based 方法适合仅有少量 Action 的环境，而 Policy Based 方\n法更通用，适合 Action 种类非常多，或者具有连续取值的 Action 的环境。结合了深度学\n习之后，Policy Based 方法就变成了策略网络，Value Based 方法就变成了估值网络\n。</font></p>\n<h4 id=\"策略网络policy-network\"><a class=\"markdownIt-Anchor\" href=\"#策略网络policy-network\"></a> 策略网络(Policy Network)</h4>\n<p>直接看一个例子，学习的目标是，左右用力使得木棍不倒地\n<a href=\"https://github.com/xyegithub/myBlog/blob/main/posts/1e331e4a/policy_network.py\">Policy_Network.py</a></p>\n<p>关键代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">score = tf.matmul(layer1,W2)</span><br><span class=\"line\">probability = tf.nn.sigmoid(score)<span class=\"comment\">#网络输出采取Action 1的概率。</span></span><br><span class=\"line\">input_y = tf.placeholder(tf.float32,[<span class=\"literal\">None</span>,<span class=\"number\">1</span>], \\\\</span><br><span class=\"line\">name=<span class=\"string\">&quot;input_y&quot;</span>)<span class=\"comment\"># 输入采取过的行为，这个行为是随机生成的。</span></span><br><span class=\"line\">advantages = tf.placeholder(tf.float32,name=<span class=\"string\">&quot;reward_signal&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># 输入获益</span></span><br><span class=\"line\">loglik = tf.log(input_y*(input_y - probability) + \\\\</span><br><span class=\"line\">(<span class=\"number\">1</span> - input_y)*(input_y + probability))</span><br><span class=\"line\"><span class=\"comment\"># 损失函数，如果行为是1，则增大</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#概率，如果行为是 0，则减小概率（相当于也是增加0的概率），也就是说这个损</span></span><br><span class=\"line\"><span class=\"comment\">#失函数无论当前行为是什么都会增大当前行为的概率。</span></span><br><span class=\"line\">loss = -tf.reduce_mean(loglik * advantages) <span class=\"comment\"># 这行代码很关键，</span></span><br><span class=\"line\"><span class=\"comment\">#相当于给损失函数成了一个权重advantages，得到最终的损失函数。</span></span><br><span class=\"line\"><span class=\"comment\">#advantages是当前试验的全部获益。如果全部获益大，将以更大的权重，增加</span></span><br><span class=\"line\"><span class=\"comment\">#当前行为的概率。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#所以，策略网络其实也是一个对抗学习的过程，增加所有采取过行为的概率，只是</span></span><br><span class=\"line\"><span class=\"comment\">#获益多的行为以更大的权重增加。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#一个试验： 由初始状态开始，随机采取一连串的行为</span></span><br><span class=\"line\"><span class=\"comment\">#（Policy_Network.py 中是根据当前模型输出的概率,来生成随机的行为，但</span></span><br><span class=\"line\"><span class=\"comment\">#是我感觉直接用0.5的概率随机生成一连串的0和1的行为也是可以的，下面将实</span></span><br><span class=\"line\"><span class=\"comment\">#验一下），直到任务结束。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 由于每个试验，都可以一直行为到任务结束，所以每个action，我们都可以得</span></span><br><span class=\"line\"><span class=\"comment\">#到它在该试验中的全部获益（当前获益 + 之后所有行为的获益）</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 随机生成了n个试验，其中又各种各样的决策（随机探索），全部获益大的</span></span><br><span class=\"line\"><span class=\"comment\">#action，它的advantages也大，那么它的概率就增大的多，它被强化的厉害。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##试验生成的过程，实际上就是数据集构建的过程。策略网络的数据集是由环境</span></span><br><span class=\"line\"><span class=\"comment\">#和一系列随机的行为构成的。它提供了环境在各种行为下的反应（获益）。模型</span></span><br><span class=\"line\"><span class=\"comment\">#学习为环境带来高获益的行为的规律。</span></span><br></pre></td></tr></table></figure>\n<p>由上面的代码可知，从策略网络的角度看强化学习的话，强化学习的关键其实是对数据集的\n构建—如何构建数据集。</p>\n<p>在构建数据集的时候，随机探索肯定是必要的。随机探索的结果会得到一系列好的行为，也\n会得到一系列不好的行为。如何强化好的行为就是算法设计的时候需要注意的。</p>\n<p>上面的代码在探索阶段借用了当前的模型，即根据当前模型输出的概率随机生成行为，从而\n形成数据集。如果完全的随机（一直使用 0.5 的概率随机的生成 Action）会什么样呢？</p>\n<h5 id=\"数据集是否可以和模型无关不随着模型变化\"><a class=\"markdownIt-Anchor\" href=\"#数据集是否可以和模型无关不随着模型变化\"></a> 数据集是否可以和模型无关（不随着模型变化）？</h5>\n<p>关键修改代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###基于当前模型，根据当前的状态x，生成Action 1的概率</span></span><br><span class=\"line\">tfprob = sess.run(probability,feed_dict=&#123;observations: x&#125;)</span><br><span class=\"line\"><span class=\"comment\">### 基于预测概率，随机生成行为，并试探环境。生成数据集。</span></span><br><span class=\"line\">action = <span class=\"number\">1</span> <span class=\"keyword\">if</span> np.random.uniform() &lt; tfprob <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n<p>修改后</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### 注释掉这句，并不需要根据当前模型生成概率</span></span><br><span class=\"line\"><span class=\"comment\">### tfprob = sess.run(probability,feed_dict=&#123;observations: x&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">### 直接设置概率为0.5，随机完全随机探索生成数据集。</span></span><br><span class=\"line\">tfprob = <span class=\"number\">0.5</span></span><br><span class=\"line\">action = <span class=\"number\">1</span> <span class=\"keyword\">if</span> np.random.uniform() &lt; tfprob <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n<p>结果：修改后，模型无法收敛。</p>\n<p>完全随机很小的概率能探索出很好的试验，这些好的行为也很难持续的得到强化。</p>\n<p>所以，强化学习也有一种效果叠加的感觉。在完全随机的情况下 ，探索出相对好的\naction，再在这个相对好的 action 的基础上，在探索探索出更好的 action。</p>\n<p>如果数据集不依赖模型，就是一直在完全随机的基础上探索。这样很难收敛。</p>\n<p>也可以这样看，完全随机的话，最多能学到前几步的策略（因为完全随机就走不了几步，探\n索的经验就只有那几步）。依赖于模型，探索的行为更有价值，因为是依赖于学到过的知识\n的，一方面确认了，按学到的知识走，确实获益多，一方面又在学到的知识的基础上，做了\n一些随机，探索更好的知识。</p>\n<h4 id=\"估值网络value-networkq-learning\"><a class=\"markdownIt-Anchor\" href=\"#估值网络value-networkq-learning\"></a> 估值网络(Value Network，Q-learning)</h4>\n<p>Q-Learing 用神经网络实现，得到的模型就是估值网络。</p>\n<p>也看一个例子\n，<a href=\"https://github.com/xyegithub/myBlog/blob/main/posts/1e331e4a/q_learning.py\">Value_Network.py</a></p>\n<p>学习每个 Action 所对应的 reward 的期望。</p>\n<p>我们先看看数据集的结构</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###Save the experience to our episode buffer.</span></span><br><span class=\"line\">episodeBuffer.add(np.reshape(np.array([s,a,r,s1,d]),[<span class=\"number\">1</span>,<span class=\"number\">5</span>]))</span><br><span class=\"line\"><span class=\"comment\">### 其中s是当前时刻的环境状态，a是当前随机采取的Action，r是这个Action的当前reward</span></span><br><span class=\"line\"><span class=\"comment\">### s1是采取Action之后的下一状态，d是布尔型表示是否任务结束。</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>\n<p>现在目标是学习 Q(s<sub>t</sub>, a<sub>t</sub>)，也就是当前环境状态，采取行为\na 的全部 reward 的期望。</p>\n</li>\n<li>\n<p>现在假设我们有模型 Q<sub>desird</sub>，可以预测全部 reward 了，那么这个模型\n应该满足条件，Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r +\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">λ</span></span></span></span> Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，这有点递\n归的感觉了。</p>\n</li>\n<li>\n<p>现在我们能不能根据这个公式 ， 来优化出 Q<sub>desired</sub>。肯定是能的。对于\n探索过的所有试验，公式都满足的话，此时的模型就可以看成我们想要的模型了。我感\n觉这就是估值网络方法的核心。</p>\n</li>\n</ol>\n<p>直接看关键代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###Choose an action by greedily (with e chance of random action)</span></span><br><span class=\"line\"><span class=\"comment\">### from the Q-network</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> np.random.rand(<span class=\"number\">1</span>) &lt; e <span class=\"keyword\">or</span> total_steps &lt; pre_train_steps:</span><br><span class=\"line\">a = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">4</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">a = sess.run(mainQN.predict,feed_dict=&#123;mainQN.scalarInput:[s]&#125;)[<span class=\"number\">0</span>]</span><br><span class=\"line\"><span class=\"comment\">### 这段代码其实是探索的代码，当最开始的时候是完全随机探索（total_steps &lt; pre_train_steps的时候）</span></span><br><span class=\"line\"><span class=\"comment\">### 当total_steps &gt;= pre_train_steps之后呢，就不是完全随机探索了。</span></span><br><span class=\"line\"><span class=\"comment\">### 有e的概率是随机探索的，（1-e）的概率是由训练好的模型决定之后的Action。</span></span><br><span class=\"line\"><span class=\"comment\">### 这里是估值网络和策略网络的不同，策略网络本身就具有随机性，所以不需要引入</span></span><br><span class=\"line\"><span class=\"comment\">### 额外的参数e和pre_train_steps来控制随机探索的强度。</span></span><br><span class=\"line\"><span class=\"comment\">### 策略网络在训练的过程中，本身就是由随机性大，到慢慢的收敛到好的Action</span></span><br><span class=\"line\"><span class=\"comment\">### 所以可以直接得到好的探索的训练样本。估值网络没有这样好的性质，它连</span></span><br><span class=\"line\"><span class=\"comment\">### 随机性都没有，就需要人为的制造，满足从完全随机探索，到在好的Action的</span></span><br><span class=\"line\"><span class=\"comment\">### 基础上具有一定的随机性进行探索。</span></span><br></pre></td></tr></table></figure>\n<p><strong>这是策略网络和估值网络的共通之处，其实这也最上面那个注释&quot;by greedily (with e\nchance of random action) from the Q-network&quot;的意思。</strong></p>\n<p><strong><font color=green>“贪心”两个字完美的诠释了强化学习，无论是策略网络还是估值网络\n，在探索阶段，在生成数据集上的特点。</font></strong></p>\n<p>在策略网络那一节，我做的那个试验，和模型无关生成数据集。其实就是不贪心了，不贪心\n不行。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> total_steps &gt; pre_train_steps:</span><br><span class=\"line\"><span class=\"keyword\">if</span> e &gt; endE:</span><br><span class=\"line\">e -= stepDrop</span><br><span class=\"line\"><span class=\"comment\">### 完全随机了之后，开始慢慢减小随机性。</span></span><br><span class=\"line\"><span class=\"comment\">### 模型约不可靠的时候，探索性和随机性越强。后来模型慢慢变得可靠就减弱随机性。</span></span><br><span class=\"line\"><span class=\"comment\">### 因为模型越来越可靠的时候，随机性大就会得到很多远远低于当前模型性能的试验</span></span><br><span class=\"line\"><span class=\"comment\">### 这些试验都是早就被pass了的，学不到什么东西，损坏模型的探索。</span></span><br><span class=\"line\"><span class=\"comment\">### endE=0.1 说明无论训练的多好，模型都保持了随机性，保持了探索性</span></span><br><span class=\"line\"><span class=\"comment\">###　人永远要有好奇心，永远要觉得自己的知识还可能不是最好的</span></span><br></pre></td></tr></table></figure>\n<p>下面的代码是将在数据集弄好的情况下，如何训练模型的。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> total_steps % (update_freq) == <span class=\"number\">0</span>:</span><br><span class=\"line\">trainBatch = myBuffer.sample(batch_size) <span class=\"comment\">#Get a random batch of experiences.</span></span><br><span class=\"line\"><span class=\"comment\">#Below we perform the Double-DQN update to the target Q-values</span></span><br><span class=\"line\"><span class=\"comment\"># 主网络预测了下一刻需要采取的Action，trainBatch[:,3]是当前的下一刻的环境</span></span><br><span class=\"line\"><span class=\"comment\"># 回顾公式，Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)</span></span><br><span class=\"line\"><span class=\"comment\"># 这里主函数预测的Action就是t+1时刻（下一时刻）获益值最大的Action</span></span><br><span class=\"line\">Q1 = sess.run(mainQN.predict,feed_dict=&#123;mainQN.scalarInput:np.vstack(trainBatch[:,<span class=\"number\">3</span>])&#125;)</span><br><span class=\"line\"><span class=\"comment\"># target网络预测了下一时刻的reward</span></span><br><span class=\"line\">Q2 = sess.run(targetQN.Qout,feed_dict=&#123;targetQN.scalarInput:np.vstack(trainBatch[:,<span class=\"number\">3</span>])&#125;)</span><br><span class=\"line\">end_multiplier = -(trainBatch[:,<span class=\"number\">4</span>] - <span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"comment\"># 用主网络预测出的Action以及target网络预测出的所有行为的reward</span></span><br><span class=\"line\"><span class=\"comment\"># 选择了最大的reward,也就是公式中的 Max Q(s_t+1, a)</span></span><br><span class=\"line\">doubleQ = Q2[<span class=\"built_in\">range</span>(batch_size),Q1]</span><br><span class=\"line\"><span class=\"comment\"># 这里得到的就是公式Q(st, at) = r + $\\lambda$ Max Q(s_t+1, a)</span></span><br><span class=\"line\"><span class=\"comment\"># 的右边，当前reward加上乘以衰减系数之后的，下一步最大reward</span></span><br><span class=\"line\">targetQ = trainBatch[:,<span class=\"number\">2</span>] + (y*doubleQ * end_multiplier)</span><br><span class=\"line\"><span class=\"comment\">#Update the network with our target values.</span></span><br><span class=\"line\"><span class=\"comment\"># 公式右边得到了之后，在把真正的当前状态输入进去，得到左边</span></span><br><span class=\"line\"><span class=\"comment\"># 左边以右边作为标签进行学习。更新主网络的参数</span></span><br><span class=\"line\">_ = sess.run(mainQN.updateModel, \\</span><br><span class=\"line\">feed_dict=&#123;mainQN.scalarInput:np.vstack(trainBatch[:,<span class=\"number\">0</span>]),mainQN.targetQ:targetQ, mainQN.actions:trainBatch[:,<span class=\"number\">1</span>]&#125;)</span><br><span class=\"line\"><span class=\"comment\"># 更新target网络的参数。</span></span><br><span class=\"line\">updateTarget(targetOps,sess) <span class=\"comment\">#Update the target network toward the primary network.</span></span><br></pre></td></tr></table></figure>\n<p>target 网络参数的更新方式代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">updateTargetGraph</span>(<span class=\"params\">tfVars,tau</span>):</span></span><br><span class=\"line\">total_vars = <span class=\"built_in\">len</span>(tfVars)</span><br><span class=\"line\">op_holder = []</span><br><span class=\"line\"><span class=\"comment\"># 主网络是和target网络一样的，前一半参数正好是主网络的参数</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> idx,var <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(tfVars[<span class=\"number\">0</span>:total_vars//<span class=\"number\">2</span>]):</span><br><span class=\"line\"><span class=\"comment\"># idx+total_vars对应的时候后一半的参数也就是target网络的参数</span></span><br><span class=\"line\"><span class=\"comment\"># 这里相当于是target参数 = 主网络参数 * tau + （1- tau）*target参数</span></span><br><span class=\"line\"><span class=\"comment\"># 也就是说target网络在以一定的速度向主网络靠近</span></span><br><span class=\"line\"><span class=\"comment\"># 结合前面的代码，主网络才是真正学习的网络，target网络的作用仅仅是得到等式</span></span><br><span class=\"line\"><span class=\"comment\"># 右边的值，即标签，即使是等式右边，也不是target网络完全决定的</span></span><br><span class=\"line\"><span class=\"comment\"># target网络得到了所有Action的reward，最大的Action是主网络选择的</span></span><br><span class=\"line\"><span class=\"comment\"># 为什么要这么做，target网络也是在模仿主网络，只用主网络也能得到等式的右边</span></span><br><span class=\"line\"><span class=\"comment\"># 理论上其实右边也应该是主网络决定，现在搞了个主网络的模仿者target网络</span></span><br><span class=\"line\"><span class=\"comment\"># 是出于优化的考虑。我们后面叙述。</span></span><br><span class=\"line\">op_holder.append(tfVars[idx+total_vars//<span class=\"number\">2</span>].assign\\\\</span><br><span class=\"line\">((var.value()*tau) \\\\</span><br><span class=\"line\">                      + ((<span class=\"number\">1</span>-tau)*tfVars[idx+total_vars//<span class=\"number\">2</span>].value())))</span><br><span class=\"line\">                      <span class=\"keyword\">return</span> op_holder</span><br><span class=\"line\"></span><br><span class=\"line\">                      <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">updateTarget</span>(<span class=\"params\">op_holder,sess</span>):</span></span><br><span class=\"line\">                      <span class=\"keyword\">for</span> op <span class=\"keyword\">in</span> op_holder:</span><br><span class=\"line\">                      sess.run(op)</span><br><span class=\"line\"></span><br><span class=\"line\">                      ```</span><br><span class=\"line\"></span><br><span class=\"line\">                      现在其实我们把关键的代码都看了，在这段代码实现中，引入了一些state of the art的trick，下面我们结合看过的代码在提一遍。</span><br><span class=\"line\"></span><br><span class=\"line\">                      <span class=\"number\">1.</span>  引入卷积层，这段代码比较简单，我们没有看。环境状态是用图片的形式给的，用CNN提取特征是比较自然的。</span><br><span class=\"line\">                      <span class=\"number\">2.</span>  Experience replay。估值网络不像策略网络一样得到试验之后，用一次就扔掉再去制作新的试验（数据集）来训练。它把每次试验都放在一个试验池里面。试验池长度为N，如果超过了N，那就把最老的试验样本扔掉。每次 训练的时候从试验池里面随机选择batchsize个样本进行训练，保持了对样本的利用率，同时其实也增加了模型的稳定性，因为数据集是相对稳定的（相比于N=<span class=\"number\">1</span>而言，每次训练了就扔掉，进来的都是新的，不那么稳定）。</span><br><span class=\"line\">                      <span class=\"number\">3.</span>  使用target网络来辅助训练。\\*\\*之所以要用target网络来制造训练目标，用主网络来实际训练，是为了让Q-Learing训练的目标保持平稳。\\*\\*强化学习不像普通的监督学习，它的目标是变化的，\\*\\*因为学习目标的一部分就是模型本身输出的。\\*\\*每次更新模型参数都会导致学习目标发生变化，如果更新频繁，幅度很大，我们的训练过程就会变得非常不稳定并且失控。\\*\\*DQN的训练会陷入目标Q与预测Q的反馈循环中，震荡发散。\\*\\*所以用target网络来制造目标，target网络和主网络又不是矛盾的，因为target网络会逼近主网络，它是主网络的模仿者，所以它提供的目标Q也是有权威的。</span><br><span class=\"line\">                      <span class=\"number\">4.</span>  Double DQN。这个trick源于target网络选的最大Action不准。模仿的不够好，现在就让主网络来帮它选。也就是上面代码中我们看过了主网络输出action，选择target网络输出的reward，得到公式的右边。</span><br><span class=\"line\">                      <span class=\"number\">5.</span>  Dueling DQN。上代码</span><br><span class=\"line\"></span><br><span class=\"line\">                      ```python</span><br><span class=\"line\">                      self.AW = tf.Variable(xavier_init([h_size//<span class=\"number\">2</span>,env.actions]))</span><br><span class=\"line\">                      self.VW = tf.Variable(xavier_init([h_size//<span class=\"number\">2</span>,<span class=\"number\">1</span>]))</span><br><span class=\"line\">                      self.Advantage = tf.matmul(self.streamA,self.AW)</span><br><span class=\"line\">                      self.Value = tf.matmul(self.streamV,self.VW)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###Then combine them together to get our final Q-values.</span></span><br><span class=\"line\"><span class=\"comment\">### 看这里Qout是网络最终预测的所有Action的reward。它由两部分组成Value和Advantage</span></span><br><span class=\"line\"><span class=\"comment\">### 由最上面两行可以看出Value是一维的，是实数，advantage是#action维度的向量</span></span><br><span class=\"line\"><span class=\"comment\">### 所以，Dueling DQN就是将reward裁成了两部分，一部分是环境状态本身具有的价值Value</span></span><br><span class=\"line\"><span class=\"comment\">### 另一部分就是Action本身具有的价值，相加起来就是在这个环境下Action具有的价值。</span></span><br><span class=\"line\"><span class=\"comment\">### 其实我感觉这些解释都是人为的，具体是不是这样谁也不知道，可能只是这样优化的好。</span></span><br><span class=\"line\"><span class=\"comment\">###　因为即使不分为两部分，网络输出Ｑout的时候，输入也是环境状态，肯定都会把环境考虑</span></span><br><span class=\"line\"><span class=\"comment\">### 进去才有Action的价值。然而直接输出这个价值，发现优化的不好，分为两部分之后，发现</span></span><br><span class=\"line\"><span class=\"comment\">### 优化的好了。其实谁也不知道其中到底是什么原因起作用。</span></span><br><span class=\"line\">self.Qout = self.Value + tf.subtract(self.Advantage,tf.reduce_mean(self.Advantage,axis=<span class=\"number\">1</span>,keep_dims=<span class=\"literal\">True</span>))</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"策略网络和估值网络的不同\"><a class=\"markdownIt-Anchor\" href=\"#策略网络和估值网络的不同\"></a> 策略网络和估值网络的不同</h4>\n<p>从策略网络和估值网络看，强化学习都有探索和对抗两个过程。通过探索，得到数据集，包\n含了各种可能性。通过对抗，让数据集中好的（reward 高的试验胜出）。他们的不同点在\n于对抗的方法。</p>\n<ol>\n<li>策略网络：对抗的焦点在于选择 Action 的概率。</li>\n<li>估值网络：对抗的焦点在于评估 Action 的 reward。</li>\n<li>两者都会影响数据集的制作，而且影响的方式是相同的：贪心和随机探索</li>\n<li>比起策略网络，估值网络更加没有对抗的感觉。因为策略网络在提高某一个 Action 的\n概率的时候，会抑制其他 Action 的概率（总的概率为 1）。而估值网络在提高某一个\nAction 的 reward 的时候，和其他 Action 是无关的。<strong>而且其实不能说是提高\nreward，它是预测出正确的 reward。</strong>（这是两者的很大的不同处，策略网络更像是\n一个分类问题，而估值网络像是一个回归问题）</li>\n</ol>\n<h3 id=\"回顾\"><a class=\"markdownIt-Anchor\" href=\"#回顾\"></a> 回顾</h3>\n<p>强化学习的本质是连续决策。强化学习算法的关键是标签制作，数据集制作。</p>\n<p>连续决策问题是没有确定的标签的，它通过探索试验得到数据集和标签，为没有提供标签的\n问题，做了标签，让问题可以解决。</p>\n<p>深度学习无法优化离散的不可导的参数，强化学习也可以通过在离散的地方做数据集做标签\n，把它转换为可导的，可用 sgd 优化的问题。</p>\n<p>做标签和数据集的关键是随机性以及贪心，贪心让它立足于以往的知识，随机让它不刚愎自\n用，保持谦卑，给新的可能保留空间。</p>\n<p>无论是策略网络还是估值网络，在数据集的制作上都是一样的，随机性和贪心。估值网络的\n数据集制作，可以看出强化学习探索的本质（由于估值网络本身没有随机性，它在制作数据\n集的时候，显示的暴露了，探索和贪心的本质。策略网络这方面还不太好看出来，因为它是\n隐式的利用探索和贪心）。</p>\n<p>策略网络，增大所有行为的概率，但是对于 reward 大 的行为增大的权重大。这个思路在\n我得感觉上更加符合强化两个字。强化好的行为嘛。</p>\n<p>估值网络的本质是公式 Q<sub>desired</sub>(s<sub>t</sub>, a<sub>t</sub>) = r +\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">λ</span></span></span></span> Max<sub>a</sub> Q<sub>desired</sub>(s<sub>t+1</sub>, a)，有点递归的感\n觉。</p>\n<p>策略网络和估值网络数据集也有一点不同，策略网络的数据集是纵向的，一串行为一起的。\n而估值网络的数据集是单个单个的。</p>\n<p>由下面代码可以看出，策略网络中，每一窜试验就会训练一次，只是网络参数更新会积累了\n好几次试验之后才更新。策略网络关心从开始到结束一系列行为。而估值网络只关心当前和\n下一状态。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> done:</span><br><span class=\"line\">episode_number += <span class=\"number\">1</span></span><br><span class=\"line\">epx = np.vstack(xs)</span><br><span class=\"line\">epy = np.vstack(ys)</span><br><span class=\"line\">epr = np.vstack(drs)</span><br><span class=\"line\">tfp = tfps</span><br><span class=\"line\">xs,hs,dlogps,drs,ys,tfps = [],[],[],[],[],[]</span><br><span class=\"line\"></span><br><span class=\"line\">discounted_epr = discount_rewards(epr)</span><br><span class=\"line\">discounted_epr -= np.mean(discounted_epr)</span><br><span class=\"line\">discounted_epr //= np.std(discounted_epr)</span><br><span class=\"line\"></span><br><span class=\"line\">tGrad = sess.run(newGrads,feed_dict=&#123;observations: epx, input_y: epy, advantages: discounted_epr&#125;)</span><br><span class=\"line\"><span class=\"keyword\">for</span> ix,grad <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(tGrad):</span><br><span class=\"line\">gradBuffer[ix] += grad</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> episode_number % batch_size == <span class=\"number\">0</span>:</span><br><span class=\"line\">sess.run(updateGrads,feed_dict=&#123;W1Grad: gradBuffer[<span class=\"number\">0</span>],W1_1Grad:gradBuffer[<span class=\"number\">1</span>],W2Grad:gradBuffer[<span class=\"number\">2</span>]&#125;)</span><br></pre></td></tr></table></figure>\n<p>估值网络人为的控制随机强度，也是一个值得考虑的问题。</p>\n"},{"title":"Fish Shell","top":false,"cover":false,"toc":true,"description":"everyday fish shell","abbrlink":"5fb5d34d","date":"2022-05-04T01:43:16.000Z","password":null,"summary":null,"_content":"\n# Configuration of shortcuts for fish\n\nUse bind to configure the shortcuts, e.g.,\n`bind -M insert \\ck 'accept-autosuggestion'`. `-M` is used to define the mode of\nthe shortcut. `accept-autosuggestion` is the input function, which means accept\nthe current autosuggestion. For more special function see\n[this](https://fishshell.com/docs/current/cmds/bind.html).\n\nIn fish `bind -M normal` can not work for normal mode of vi input method.\nHowever, `bind -M default` works fine for the normal mode of the vi input\nmethod.\n\n# Set the default editor in fish\n\n[fzf](https://github.com/jethrokuan/fzf) allows fish to use fuzzy search. `\\co`\nis a shortcut of fzf-fish to open a file by fuzzy search with default editor.\nThe default editor can be set by `set -gx EDITOR nvim`.\n","source":"_posts/Fish-Shell.md","raw":"---\ntitle: Fish Shell\ntop: false\ncover: false\ntoc: true\ndescription: everyday fish shell\ncategories:\n  - Programming\n  - Tools\n  - Shell\ntags:\n  - Fish\nabbrlink: 5fb5d34d\ndate: 2022-05-04 09:43:16\npassword:\nsummary:\n---\n\n# Configuration of shortcuts for fish\n\nUse bind to configure the shortcuts, e.g.,\n`bind -M insert \\ck 'accept-autosuggestion'`. `-M` is used to define the mode of\nthe shortcut. `accept-autosuggestion` is the input function, which means accept\nthe current autosuggestion. For more special function see\n[this](https://fishshell.com/docs/current/cmds/bind.html).\n\nIn fish `bind -M normal` can not work for normal mode of vi input method.\nHowever, `bind -M default` works fine for the normal mode of the vi input\nmethod.\n\n# Set the default editor in fish\n\n[fzf](https://github.com/jethrokuan/fzf) allows fish to use fuzzy search. `\\co`\nis a shortcut of fzf-fish to open a file by fuzzy search with default editor.\nThe default editor can be set by `set -gx EDITOR nvim`.\n","slug":"Fish-Shell","published":1,"updated":"2022-06-13T07:38:40.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgk000my7ml354o4mns","content":"<html><head></head><body><h1 id=\"configuration-of-shortcuts-for-fish\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#configuration-of-shortcuts-for-fish\"></a> Configuration of shortcuts for fish</h1>\n<p>Use bind to configure the shortcuts, e.g.,\n<code>bind -M insert \\ck 'accept-autosuggestion'</code>. <code>-M</code> is used to define the mode of\nthe shortcut. <code>accept-autosuggestion</code> is the input function, which means accept\nthe current autosuggestion. For more special function see\n<a href=\"https://fishshell.com/docs/current/cmds/bind.html\">this</a>.</p>\n<p>In fish <code>bind -M normal</code> can not work for normal mode of vi input method.\nHowever, <code>bind -M default</code> works fine for the normal mode of the vi input\nmethod.</p>\n<h1 id=\"set-the-default-editor-in-fish\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#set-the-default-editor-in-fish\"></a> Set the default editor in fish</h1>\n<p><a href=\"https://github.com/jethrokuan/fzf\">fzf</a> allows fish to use fuzzy search. <code>\\co</code>\nis a shortcut of fzf-fish to open a file by fuzzy search with default editor.\nThe default editor can be set by <code>set -gx EDITOR nvim</code>.</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"configuration-of-shortcuts-for-fish\"><a class=\"markdownIt-Anchor\" href=\"#configuration-of-shortcuts-for-fish\"></a> Configuration of shortcuts for fish</h1>\n<p>Use bind to configure the shortcuts, e.g.,\n<code>bind -M insert \\ck 'accept-autosuggestion'</code>. <code>-M</code> is used to define the mode of\nthe shortcut. <code>accept-autosuggestion</code> is the input function, which means accept\nthe current autosuggestion. For more special function see\n<a href=\"https://fishshell.com/docs/current/cmds/bind.html\">this</a>.</p>\n<p>In fish <code>bind -M normal</code> can not work for normal mode of vi input method.\nHowever, <code>bind -M default</code> works fine for the normal mode of the vi input\nmethod.</p>\n<h1 id=\"set-the-default-editor-in-fish\"><a class=\"markdownIt-Anchor\" href=\"#set-the-default-editor-in-fish\"></a> Set the default editor in fish</h1>\n<p><a href=\"https://github.com/jethrokuan/fzf\">fzf</a> allows fish to use fuzzy search. <code>\\co</code>\nis a shortcut of fzf-fish to open a file by fuzzy search with default editor.\nThe default editor can be set by <code>set -gx EDITOR nvim</code>.</p>\n"},{"title":"Foundation for Topological Data Analysis","top":false,"cover":false,"toc":true,"mathjax":true,"description":"An introduction to topological data analysis.","abbrlink":"617f6293","date":"2021-12-30T01:07:39.000Z","password":null,"summary":null,"_content":"\n# 持续同调\n\n## 同调群的目的是通过研究空洞和链的关系来刻画拓扑结构。本质上是要根据空洞的情况对链进行分类。为什么是定义为闭链群和边缘群的商群就能刻画拓扑，刻画空洞的情况。\n\n要建立起研究拓扑结构的数学模型，这里从直观概念出发，总结了与空洞和链相关的 3 个\n基本事实。根据这 3 个基本事实，我们可以更深刻的理解同调理论中的各种概念，比如闭\n链，边缘算子，同调等，为什么这样定义。\n\n1. 任意一个 q 维单纯形是“实心的”，没有空洞的。所以所有 q 维丹村行的边缘链，以及\n   边缘链的线性组合，都是同调的（等价的），因为都没有空洞。\n2. 如果拓扑结构中有一个 q 维空洞，那么它一定是一个空心的 q 维单纯形, i.e., 复形\n   中不含该 q 维单纯形，但含有该单纯形的所有 q-1 维边缘。\n3. 如果某一个链，它是一个实心或空洞的单纯形边缘，或其线性组合，那么它是闭链，否\n   则它不是闭链。\n\n由 2 和 3 可知，一定要研究闭链，而且只需要研究闭链，因为所有空洞都有围绕它的闭链\n，研究闭链不会落下任何一种空洞。但是闭链里面不一定都是空洞，有一部分闭链是实心的\n（边缘链）。所以同调群定义为闭链和边缘链的商群是很合适的。\n\n## 边缘算子的定义\n\n为什么这么定义边缘算子。猜测：只要这个定义和上面的三个假设是融洽的，就能研究拓扑\n结构中的空洞，具体怎么样定义边缘算子是无所谓的。\n\n## 上面这套解释，解释了闭链中有一个空洞的情况，但是有的闭链里面有多个空洞，这个包含同样空洞的链，如何同调\n\n再说明一个事实\n\n4. 包含同样空洞的任意两条闭链的差一定是边缘链。（好像前面 3 个事实可以推出 4）\n\n现有的同调里面里面的定义都是满足这 4 个事实的，应该能对链进行分类，分类的依据是\n它们包含空洞的不同。\n\n## 对闭链的直观理解\n\n闭链被定义为在边缘算子下结果为 0 的链。但从思维的角度来说，与其说闭链依赖边缘算\n子，不如说是边缘算子是为了满足闭链的性质 3，而设计的。\n\n知道闭链的定义，但它具体表现上是什么样的，给定一个链如何直观的看出它是不是闭链。\n\n根据 3 可知任意一个 q 维闭链一定是 q+1 维的空心或者实心单纯形的边缘，或其线性组\n合。\n\n给定一个 q 维闭链，它一定，而且只能把 q+1 维空间分割成不相交的若干区域。它是在\nq+1 维空间中封闭的，里面的点和外面的点无法连通。\n\n一个 q 维的链，只能围城 q+1 维的空洞。所以三棱锥的棱并没有围城三棱锥中间的空洞（\n空洞是三维的，一维的棱不能围城三维的空洞，不能封闭），三棱锥的面可以围城这个三维\n的空洞。\n","source":"_posts/Foundation-for-Topological-Data-Analysis.md","raw":"---\ntitle: Foundation for Topological Data Analysis\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndescription: An introduction to topological data analysis.\ncategories:\n  - Machine Learning\n  - Methods\n  - Topological Data Analysis\ntags:\n  - Topological Data Analysis\nabbrlink: 617f6293\ndate: 2021-12-30 09:07:39\npassword:\nsummary:\n---\n\n# 持续同调\n\n## 同调群的目的是通过研究空洞和链的关系来刻画拓扑结构。本质上是要根据空洞的情况对链进行分类。为什么是定义为闭链群和边缘群的商群就能刻画拓扑，刻画空洞的情况。\n\n要建立起研究拓扑结构的数学模型，这里从直观概念出发，总结了与空洞和链相关的 3 个\n基本事实。根据这 3 个基本事实，我们可以更深刻的理解同调理论中的各种概念，比如闭\n链，边缘算子，同调等，为什么这样定义。\n\n1. 任意一个 q 维单纯形是“实心的”，没有空洞的。所以所有 q 维丹村行的边缘链，以及\n   边缘链的线性组合，都是同调的（等价的），因为都没有空洞。\n2. 如果拓扑结构中有一个 q 维空洞，那么它一定是一个空心的 q 维单纯形, i.e., 复形\n   中不含该 q 维单纯形，但含有该单纯形的所有 q-1 维边缘。\n3. 如果某一个链，它是一个实心或空洞的单纯形边缘，或其线性组合，那么它是闭链，否\n   则它不是闭链。\n\n由 2 和 3 可知，一定要研究闭链，而且只需要研究闭链，因为所有空洞都有围绕它的闭链\n，研究闭链不会落下任何一种空洞。但是闭链里面不一定都是空洞，有一部分闭链是实心的\n（边缘链）。所以同调群定义为闭链和边缘链的商群是很合适的。\n\n## 边缘算子的定义\n\n为什么这么定义边缘算子。猜测：只要这个定义和上面的三个假设是融洽的，就能研究拓扑\n结构中的空洞，具体怎么样定义边缘算子是无所谓的。\n\n## 上面这套解释，解释了闭链中有一个空洞的情况，但是有的闭链里面有多个空洞，这个包含同样空洞的链，如何同调\n\n再说明一个事实\n\n4. 包含同样空洞的任意两条闭链的差一定是边缘链。（好像前面 3 个事实可以推出 4）\n\n现有的同调里面里面的定义都是满足这 4 个事实的，应该能对链进行分类，分类的依据是\n它们包含空洞的不同。\n\n## 对闭链的直观理解\n\n闭链被定义为在边缘算子下结果为 0 的链。但从思维的角度来说，与其说闭链依赖边缘算\n子，不如说是边缘算子是为了满足闭链的性质 3，而设计的。\n\n知道闭链的定义，但它具体表现上是什么样的，给定一个链如何直观的看出它是不是闭链。\n\n根据 3 可知任意一个 q 维闭链一定是 q+1 维的空心或者实心单纯形的边缘，或其线性组\n合。\n\n给定一个 q 维闭链，它一定，而且只能把 q+1 维空间分割成不相交的若干区域。它是在\nq+1 维空间中封闭的，里面的点和外面的点无法连通。\n\n一个 q 维的链，只能围城 q+1 维的空洞。所以三棱锥的棱并没有围城三棱锥中间的空洞（\n空洞是三维的，一维的棱不能围城三维的空洞，不能封闭），三棱锥的面可以围城这个三维\n的空洞。\n","slug":"Foundation-for-Topological-Data-Analysis","published":1,"updated":"2022-06-13T07:38:40.688Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgl000oy7ml4ute8sbb","content":"<html><head></head><body><h1 id=\"持续同调\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#持续同调\"></a> 持续同调</h1>\n<h2 id=\"同调群的目的是通过研究空洞和链的关系来刻画拓扑结构-本质上是要根据空洞的情况对链进行分类-为什么是定义为闭链群和边缘群的商群就能刻画拓扑刻画空洞的情况\"><span class=\"post-title-index\">1.1. </span><a class=\"markdownIt-Anchor\" href=\"#同调群的目的是通过研究空洞和链的关系来刻画拓扑结构-本质上是要根据空洞的情况对链进行分类-为什么是定义为闭链群和边缘群的商群就能刻画拓扑刻画空洞的情况\"></a> 同调群的目的是通过研究空洞和链的关系来刻画拓扑结构。本质上是要根据空洞的情况对链进行分类。为什么是定义为闭链群和边缘群的商群就能刻画拓扑，刻画空洞的情况。</h2>\n<p>要建立起研究拓扑结构的数学模型，这里从直观概念出发，总结了与空洞和链相关的 3 个\n基本事实。根据这 3 个基本事实，我们可以更深刻的理解同调理论中的各种概念，比如闭\n链，边缘算子，同调等，为什么这样定义。</p>\n<ol>\n<li>任意一个 q 维单纯形是“实心的”，没有空洞的。所以所有 q 维丹村行的边缘链，以及\n边缘链的线性组合，都是同调的（等价的），因为都没有空洞。</li>\n<li>如果拓扑结构中有一个 q 维空洞，那么它一定是一个空心的 q 维单纯形, i.e., 复形\n中不含该 q 维单纯形，但含有该单纯形的所有 q-1 维边缘。</li>\n<li>如果某一个链，它是一个实心或空洞的单纯形边缘，或其线性组合，那么它是闭链，否\n则它不是闭链。</li>\n</ol>\n<p>由 2 和 3 可知，一定要研究闭链，而且只需要研究闭链，因为所有空洞都有围绕它的闭链\n，研究闭链不会落下任何一种空洞。但是闭链里面不一定都是空洞，有一部分闭链是实心的\n（边缘链）。所以同调群定义为闭链和边缘链的商群是很合适的。</p>\n<h2 id=\"边缘算子的定义\"><span class=\"post-title-index\">1.2. </span><a class=\"markdownIt-Anchor\" href=\"#边缘算子的定义\"></a> 边缘算子的定义</h2>\n<p>为什么这么定义边缘算子。猜测：只要这个定义和上面的三个假设是融洽的，就能研究拓扑\n结构中的空洞，具体怎么样定义边缘算子是无所谓的。</p>\n<h2 id=\"上面这套解释解释了闭链中有一个空洞的情况但是有的闭链里面有多个空洞这个包含同样空洞的链如何同调\"><span class=\"post-title-index\">1.3. </span><a class=\"markdownIt-Anchor\" href=\"#上面这套解释解释了闭链中有一个空洞的情况但是有的闭链里面有多个空洞这个包含同样空洞的链如何同调\"></a> 上面这套解释，解释了闭链中有一个空洞的情况，但是有的闭链里面有多个空洞，这个包含同样空洞的链，如何同调</h2>\n<p>再说明一个事实</p>\n<ol start=\"4\">\n<li>包含同样空洞的任意两条闭链的差一定是边缘链。（好像前面 3 个事实可以推出 4）</li>\n</ol>\n<p>现有的同调里面里面的定义都是满足这 4 个事实的，应该能对链进行分类，分类的依据是\n它们包含空洞的不同。</p>\n<h2 id=\"对闭链的直观理解\"><span class=\"post-title-index\">1.4. </span><a class=\"markdownIt-Anchor\" href=\"#对闭链的直观理解\"></a> 对闭链的直观理解</h2>\n<p>闭链被定义为在边缘算子下结果为 0 的链。但从思维的角度来说，与其说闭链依赖边缘算\n子，不如说是边缘算子是为了满足闭链的性质 3，而设计的。</p>\n<p>知道闭链的定义，但它具体表现上是什么样的，给定一个链如何直观的看出它是不是闭链。</p>\n<p>根据 3 可知任意一个 q 维闭链一定是 q+1 维的空心或者实心单纯形的边缘，或其线性组\n合。</p>\n<p>给定一个 q 维闭链，它一定，而且只能把 q+1 维空间分割成不相交的若干区域。它是在\nq+1 维空间中封闭的，里面的点和外面的点无法连通。</p>\n<p>一个 q 维的链，只能围城 q+1 维的空洞。所以三棱锥的棱并没有围城三棱锥中间的空洞（\n空洞是三维的，一维的棱不能围城三维的空洞，不能封闭），三棱锥的面可以围城这个三维\n的空洞。</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"持续同调\"><a class=\"markdownIt-Anchor\" href=\"#持续同调\"></a> 持续同调</h1>\n<h2 id=\"同调群的目的是通过研究空洞和链的关系来刻画拓扑结构-本质上是要根据空洞的情况对链进行分类-为什么是定义为闭链群和边缘群的商群就能刻画拓扑刻画空洞的情况\"><a class=\"markdownIt-Anchor\" href=\"#同调群的目的是通过研究空洞和链的关系来刻画拓扑结构-本质上是要根据空洞的情况对链进行分类-为什么是定义为闭链群和边缘群的商群就能刻画拓扑刻画空洞的情况\"></a> 同调群的目的是通过研究空洞和链的关系来刻画拓扑结构。本质上是要根据空洞的情况对链进行分类。为什么是定义为闭链群和边缘群的商群就能刻画拓扑，刻画空洞的情况。</h2>\n<p>要建立起研究拓扑结构的数学模型，这里从直观概念出发，总结了与空洞和链相关的 3 个\n基本事实。根据这 3 个基本事实，我们可以更深刻的理解同调理论中的各种概念，比如闭\n链，边缘算子，同调等，为什么这样定义。</p>\n<ol>\n<li>任意一个 q 维单纯形是“实心的”，没有空洞的。所以所有 q 维丹村行的边缘链，以及\n边缘链的线性组合，都是同调的（等价的），因为都没有空洞。</li>\n<li>如果拓扑结构中有一个 q 维空洞，那么它一定是一个空心的 q 维单纯形, i.e., 复形\n中不含该 q 维单纯形，但含有该单纯形的所有 q-1 维边缘。</li>\n<li>如果某一个链，它是一个实心或空洞的单纯形边缘，或其线性组合，那么它是闭链，否\n则它不是闭链。</li>\n</ol>\n<p>由 2 和 3 可知，一定要研究闭链，而且只需要研究闭链，因为所有空洞都有围绕它的闭链\n，研究闭链不会落下任何一种空洞。但是闭链里面不一定都是空洞，有一部分闭链是实心的\n（边缘链）。所以同调群定义为闭链和边缘链的商群是很合适的。</p>\n<h2 id=\"边缘算子的定义\"><a class=\"markdownIt-Anchor\" href=\"#边缘算子的定义\"></a> 边缘算子的定义</h2>\n<p>为什么这么定义边缘算子。猜测：只要这个定义和上面的三个假设是融洽的，就能研究拓扑\n结构中的空洞，具体怎么样定义边缘算子是无所谓的。</p>\n<h2 id=\"上面这套解释解释了闭链中有一个空洞的情况但是有的闭链里面有多个空洞这个包含同样空洞的链如何同调\"><a class=\"markdownIt-Anchor\" href=\"#上面这套解释解释了闭链中有一个空洞的情况但是有的闭链里面有多个空洞这个包含同样空洞的链如何同调\"></a> 上面这套解释，解释了闭链中有一个空洞的情况，但是有的闭链里面有多个空洞，这个包含同样空洞的链，如何同调</h2>\n<p>再说明一个事实</p>\n<ol start=\"4\">\n<li>包含同样空洞的任意两条闭链的差一定是边缘链。（好像前面 3 个事实可以推出 4）</li>\n</ol>\n<p>现有的同调里面里面的定义都是满足这 4 个事实的，应该能对链进行分类，分类的依据是\n它们包含空洞的不同。</p>\n<h2 id=\"对闭链的直观理解\"><a class=\"markdownIt-Anchor\" href=\"#对闭链的直观理解\"></a> 对闭链的直观理解</h2>\n<p>闭链被定义为在边缘算子下结果为 0 的链。但从思维的角度来说，与其说闭链依赖边缘算\n子，不如说是边缘算子是为了满足闭链的性质 3，而设计的。</p>\n<p>知道闭链的定义，但它具体表现上是什么样的，给定一个链如何直观的看出它是不是闭链。</p>\n<p>根据 3 可知任意一个 q 维闭链一定是 q+1 维的空心或者实心单纯形的边缘，或其线性组\n合。</p>\n<p>给定一个 q 维闭链，它一定，而且只能把 q+1 维空间分割成不相交的若干区域。它是在\nq+1 维空间中封闭的，里面的点和外面的点无法连通。</p>\n<p>一个 q 维的链，只能围城 q+1 维的空洞。所以三棱锥的棱并没有围城三棱锥中间的空洞（\n空洞是三维的，一维的棱不能围城三维的空洞，不能封闭），三棱锥的面可以围城这个三维\n的空洞。</p>\n"},{"title":"Hexo","top":false,"cover":false,"toc":true,"description":"Configure Hexo","abbrlink":"b132932","date":"2022-06-12T08:53:47.000Z","password":null,"summary":null,"_content":"\n# Enable Gitalk\n\nI use the `Next` theme of `hexo`.\n\nModify the `_config.yml` of `next`.\n\nUse gitalk as the comment system.\n\n```yml\ncomments:\n  # Available values: tabs | buttons\n  style: tabs\n  # Choose a comment system to be displayed by default.\n  # Available values: disqus | disqusjs | changyan | livere | gitalk | utterances\n  active: gitalk\n  # Setting `true` means remembering the comment system selected by the visitor.\n  storage: true\n  # Lazyload all comment systems.\n  lazyload: false\n  # Modify texts or order for any naves, here are some examples.\n  nav:\n    # disqus:\n    #  text: Load Disqus\n    #  order: -1\n    gitalk:\n      order: -1\n```\n\nEnable gitalk.\n\n```yml\n# Gitalk\n# For more information: https://gitalk.github.io\ngitalk:\n  enable: true\n  github_id: xyegithub # GitHub repo owner\n  repo: hexo_comment # Repository name to store issues\n  client_id: xxxx # GitHub Application Client ID\n  client_secret: xxxxxx # GitHub Application Client Secret\n  admin_user: xyegithub # GitHub repo owner and collaborators, only these guys can initialize gitHub issues\n  distraction_free_mode: false # Facebook-like distraction free mode\n  # When the official proxy is not available, you can change it to your own proxy address\n  proxy: https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token # This is official proxy address\n  # proxy: /login/oauth/access_token\n  # Gitalk's display language depends on user's browser or system environment\n  # If you want everyone visiting your site to see a uniform language, you can set a force language value\n  # Available values: en | es-ES | fr | ru | zh-CN | zh-TW\n  language: en\n```\n\n`client_id/secret` is your id/secret of `OAuth Apps` in your github.\n\n> A GitHub OAuth App is an application that acts on behalf of the authorizing\n> user. It only has access to the user's resources. Removing a user from a\n> repository will remove the application access.\n\n`repo` is your github repo name which is used to store the comment data. So you\nshould create a github repo at first. In my examples it is name with\nhexo_comment. `issues` should be enabled for `hexo_comment`.\n\nIf your blog is hosted by github. You can just use your blog repo as the repo to\nstore the comment data.\n\n`distraction_free_mode` should be set into `false`. When set into `true`, the\nother part of your blog will get black when one write his comment.\n\n# Baidu/Google Search\n\nTwo steps are needed.\n\n1. Add the site to baidu/google, which need a file verifying.\n2. Add the sitemap to baidu/google.\n\nTo add the sitemap file.\n\n```bash\n# add the sitemap plugin which will create sitemap.xml or baidusitemap.xml when hexo d is ran\nnpm install hexo-generator-sitemap --save\nnpm install hexo-generator-baidu-sitemap --save\n# the original link of each blog is related to the data creating the blog and the name of the blog.\n# which is not fixed (once the name of the blog changed.)\n# the plugin that fix the link of each blog in the sitemap file.\nnpm install hexo-abbrlink --save\n```\n\nthen change the `_config.yml`. This is the Configuration of `hexo-abbrlink`.\n\n```yml\npermalink: :year/:month:abbrlink.html\nabbrlink:\n  alg: crc32 #算法选项：crc16丨crc32\n  rep: hex #输出进制：dec为十进制，hex为十六进制\n```\n","source":"_posts/Hexo.md","raw":"---\ntitle: Hexo\ntop: false\ncover: false\ntoc: true\ndescription: Configure Hexo\ncategories:\n  - Programming\n  - Tools\n  - Hexo\ntags:\n  - Hexo\n  - Blog\nabbrlink: b132932\ndate: 2022-06-12 16:53:47\npassword:\nsummary:\n---\n\n# Enable Gitalk\n\nI use the `Next` theme of `hexo`.\n\nModify the `_config.yml` of `next`.\n\nUse gitalk as the comment system.\n\n```yml\ncomments:\n  # Available values: tabs | buttons\n  style: tabs\n  # Choose a comment system to be displayed by default.\n  # Available values: disqus | disqusjs | changyan | livere | gitalk | utterances\n  active: gitalk\n  # Setting `true` means remembering the comment system selected by the visitor.\n  storage: true\n  # Lazyload all comment systems.\n  lazyload: false\n  # Modify texts or order for any naves, here are some examples.\n  nav:\n    # disqus:\n    #  text: Load Disqus\n    #  order: -1\n    gitalk:\n      order: -1\n```\n\nEnable gitalk.\n\n```yml\n# Gitalk\n# For more information: https://gitalk.github.io\ngitalk:\n  enable: true\n  github_id: xyegithub # GitHub repo owner\n  repo: hexo_comment # Repository name to store issues\n  client_id: xxxx # GitHub Application Client ID\n  client_secret: xxxxxx # GitHub Application Client Secret\n  admin_user: xyegithub # GitHub repo owner and collaborators, only these guys can initialize gitHub issues\n  distraction_free_mode: false # Facebook-like distraction free mode\n  # When the official proxy is not available, you can change it to your own proxy address\n  proxy: https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token # This is official proxy address\n  # proxy: /login/oauth/access_token\n  # Gitalk's display language depends on user's browser or system environment\n  # If you want everyone visiting your site to see a uniform language, you can set a force language value\n  # Available values: en | es-ES | fr | ru | zh-CN | zh-TW\n  language: en\n```\n\n`client_id/secret` is your id/secret of `OAuth Apps` in your github.\n\n> A GitHub OAuth App is an application that acts on behalf of the authorizing\n> user. It only has access to the user's resources. Removing a user from a\n> repository will remove the application access.\n\n`repo` is your github repo name which is used to store the comment data. So you\nshould create a github repo at first. In my examples it is name with\nhexo_comment. `issues` should be enabled for `hexo_comment`.\n\nIf your blog is hosted by github. You can just use your blog repo as the repo to\nstore the comment data.\n\n`distraction_free_mode` should be set into `false`. When set into `true`, the\nother part of your blog will get black when one write his comment.\n\n# Baidu/Google Search\n\nTwo steps are needed.\n\n1. Add the site to baidu/google, which need a file verifying.\n2. Add the sitemap to baidu/google.\n\nTo add the sitemap file.\n\n```bash\n# add the sitemap plugin which will create sitemap.xml or baidusitemap.xml when hexo d is ran\nnpm install hexo-generator-sitemap --save\nnpm install hexo-generator-baidu-sitemap --save\n# the original link of each blog is related to the data creating the blog and the name of the blog.\n# which is not fixed (once the name of the blog changed.)\n# the plugin that fix the link of each blog in the sitemap file.\nnpm install hexo-abbrlink --save\n```\n\nthen change the `_config.yml`. This is the Configuration of `hexo-abbrlink`.\n\n```yml\npermalink: :year/:month:abbrlink.html\nabbrlink:\n  alg: crc32 #算法选项：crc16丨crc32\n  rep: hex #输出进制：dec为十进制，hex为十六进制\n```\n","slug":"Hexo","published":1,"updated":"2022-06-13T08:19:52.221Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgn000ry7mldhxy1tmw","content":"<html><head></head><body><h1 id=\"enable-gitalk\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#enable-gitalk\"></a> Enable Gitalk</h1>\n<p>I use the <code>Next</code> theme of <code>hexo</code>.</p>\n<p>Modify the <code>_config.yml</code> of <code>next</code>.</p>\n<p>Use gitalk as the comment system.</p>\n<figure class=\"highlight yml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">comments:</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: tabs | buttons</span></span><br><span class=\"line\">  <span class=\"attr\">style:</span> <span class=\"string\">tabs</span></span><br><span class=\"line\">  <span class=\"comment\"># Choose a comment system to be displayed by default.</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: disqus | disqusjs | changyan | livere | gitalk | utterances</span></span><br><span class=\"line\">  <span class=\"attr\">active:</span> <span class=\"string\">gitalk</span></span><br><span class=\"line\">  <span class=\"comment\"># Setting `true` means remembering the comment system selected by the visitor.</span></span><br><span class=\"line\">  <span class=\"attr\">storage:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># Lazyload all comment systems.</span></span><br><span class=\"line\">  <span class=\"attr\">lazyload:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># Modify texts or order for any naves, here are some examples.</span></span><br><span class=\"line\">  <span class=\"attr\">nav:</span></span><br><span class=\"line\">    <span class=\"comment\"># disqus:</span></span><br><span class=\"line\">    <span class=\"comment\">#  text: Load Disqus</span></span><br><span class=\"line\">    <span class=\"comment\">#  order: -1</span></span><br><span class=\"line\">    <span class=\"attr\">gitalk:</span></span><br><span class=\"line\">      <span class=\"attr\">order:</span> <span class=\"number\">-1</span></span><br></pre></td></tr></tbody></table></figure>\n<p>Enable gitalk.</p>\n<figure class=\"highlight yml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Gitalk</span></span><br><span class=\"line\"><span class=\"comment\"># For more information: https://gitalk.github.io</span></span><br><span class=\"line\"><span class=\"attr\">gitalk:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">github_id:</span> <span class=\"string\">xyegithub</span> <span class=\"comment\"># GitHub repo owner</span></span><br><span class=\"line\">  <span class=\"attr\">repo:</span> <span class=\"string\">hexo_comment</span> <span class=\"comment\"># Repository name to store issues</span></span><br><span class=\"line\">  <span class=\"attr\">client_id:</span> <span class=\"string\">xxxx</span> <span class=\"comment\"># GitHub Application Client ID</span></span><br><span class=\"line\">  <span class=\"attr\">client_secret:</span> <span class=\"string\">xxxxxx</span> <span class=\"comment\"># GitHub Application Client Secret</span></span><br><span class=\"line\">  <span class=\"attr\">admin_user:</span> <span class=\"string\">xyegithub</span> <span class=\"comment\"># GitHub repo owner and collaborators, only these guys can initialize gitHub issues</span></span><br><span class=\"line\">  <span class=\"attr\">distraction_free_mode:</span> <span class=\"literal\">false</span> <span class=\"comment\"># Facebook-like distraction free mode</span></span><br><span class=\"line\">  <span class=\"comment\"># When the official proxy is not available, you can change it to your own proxy address</span></span><br><span class=\"line\">  <span class=\"attr\">proxy:</span> <span class=\"string\">https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token</span> <span class=\"comment\"># This is official proxy address</span></span><br><span class=\"line\">  <span class=\"comment\"># proxy: /login/oauth/access_token</span></span><br><span class=\"line\">  <span class=\"comment\"># Gitalk's display language depends on user's browser or system environment</span></span><br><span class=\"line\">  <span class=\"comment\"># If you want everyone visiting your site to see a uniform language, you can set a force language value</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: en | es-ES | fr | ru | zh-CN | zh-TW</span></span><br><span class=\"line\">  <span class=\"attr\">language:</span> <span class=\"string\">en</span></span><br></pre></td></tr></tbody></table></figure>\n<p><code>client_id/secret</code> is your id/secret of <code>OAuth Apps</code> in your github.</p>\n<blockquote>\n<p>A GitHub OAuth App is an application that acts on behalf of the authorizing\nuser. It only has access to the user’s resources. Removing a user from a\nrepository will remove the application access.</p>\n</blockquote>\n<p><code>repo</code> is your github repo name which is used to store the comment data. So you\nshould create a github repo at first. In my examples it is name with\nhexo_comment. <code>issues</code> should be enabled for <code>hexo_comment</code>.</p>\n<p>If your blog is hosted by github. You can just use your blog repo as the repo to\nstore the comment data.</p>\n<p><code>distraction_free_mode</code> should be set into <code>false</code>. When set into <code>true</code>, the\nother part of your blog will get black when one write his comment.</p>\n<h1 id=\"baidugoogle-search\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#baidugoogle-search\"></a> Baidu/Google Search</h1>\n<p>Two steps are needed.</p>\n<ol>\n<li>Add the site to baidu/google, which need a file verifying.</li>\n<li>Add the sitemap to baidu/google.</li>\n</ol>\n<p>To add the sitemap file.</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># add the sitemap plugin which will create sitemap.xml or baidusitemap.xml when hexo d is ran</span></span><br><span class=\"line\">npm install hexo-generator-sitemap --save</span><br><span class=\"line\">npm install hexo-generator-baidu-sitemap --save</span><br><span class=\"line\"><span class=\"comment\"># the original link of each blog is related to the data creating the blog and the name of the blog.</span></span><br><span class=\"line\"><span class=\"comment\"># which is not fixed (once the name of the blog changed.)</span></span><br><span class=\"line\"><span class=\"comment\"># the plugin that fix the link of each blog in the sitemap file.</span></span><br><span class=\"line\">npm install hexo-abbrlink --save</span><br></pre></td></tr></tbody></table></figure>\n<p>then change the <code>_config.yml</code>. This is the Configuration of <code>hexo-abbrlink</code>.</p>\n<figure class=\"highlight yml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">permalink:</span> <span class=\"string\">:year/:month:abbrlink.html</span></span><br><span class=\"line\"><span class=\"attr\">abbrlink:</span></span><br><span class=\"line\">  <span class=\"attr\">alg:</span> <span class=\"string\">crc32</span> <span class=\"comment\">#算法选项：crc16丨crc32</span></span><br><span class=\"line\">  <span class=\"attr\">rep:</span> <span class=\"string\">hex</span> <span class=\"comment\">#输出进制：dec为十进制，hex为十六进制</span></span><br></pre></td></tr></tbody></table></figure>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"enable-gitalk\"><a class=\"markdownIt-Anchor\" href=\"#enable-gitalk\"></a> Enable Gitalk</h1>\n<p>I use the <code>Next</code> theme of <code>hexo</code>.</p>\n<p>Modify the <code>_config.yml</code> of <code>next</code>.</p>\n<p>Use gitalk as the comment system.</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">comments:</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: tabs | buttons</span></span><br><span class=\"line\">  <span class=\"attr\">style:</span> <span class=\"string\">tabs</span></span><br><span class=\"line\">  <span class=\"comment\"># Choose a comment system to be displayed by default.</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: disqus | disqusjs | changyan | livere | gitalk | utterances</span></span><br><span class=\"line\">  <span class=\"attr\">active:</span> <span class=\"string\">gitalk</span></span><br><span class=\"line\">  <span class=\"comment\"># Setting `true` means remembering the comment system selected by the visitor.</span></span><br><span class=\"line\">  <span class=\"attr\">storage:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># Lazyload all comment systems.</span></span><br><span class=\"line\">  <span class=\"attr\">lazyload:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># Modify texts or order for any naves, here are some examples.</span></span><br><span class=\"line\">  <span class=\"attr\">nav:</span></span><br><span class=\"line\">    <span class=\"comment\"># disqus:</span></span><br><span class=\"line\">    <span class=\"comment\">#  text: Load Disqus</span></span><br><span class=\"line\">    <span class=\"comment\">#  order: -1</span></span><br><span class=\"line\">    <span class=\"attr\">gitalk:</span></span><br><span class=\"line\">      <span class=\"attr\">order:</span> <span class=\"number\">-1</span></span><br></pre></td></tr></table></figure>\n<p>Enable gitalk.</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Gitalk</span></span><br><span class=\"line\"><span class=\"comment\"># For more information: https://gitalk.github.io</span></span><br><span class=\"line\"><span class=\"attr\">gitalk:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">github_id:</span> <span class=\"string\">xyegithub</span> <span class=\"comment\"># GitHub repo owner</span></span><br><span class=\"line\">  <span class=\"attr\">repo:</span> <span class=\"string\">hexo_comment</span> <span class=\"comment\"># Repository name to store issues</span></span><br><span class=\"line\">  <span class=\"attr\">client_id:</span> <span class=\"string\">xxxx</span> <span class=\"comment\"># GitHub Application Client ID</span></span><br><span class=\"line\">  <span class=\"attr\">client_secret:</span> <span class=\"string\">xxxxxx</span> <span class=\"comment\"># GitHub Application Client Secret</span></span><br><span class=\"line\">  <span class=\"attr\">admin_user:</span> <span class=\"string\">xyegithub</span> <span class=\"comment\"># GitHub repo owner and collaborators, only these guys can initialize gitHub issues</span></span><br><span class=\"line\">  <span class=\"attr\">distraction_free_mode:</span> <span class=\"literal\">false</span> <span class=\"comment\"># Facebook-like distraction free mode</span></span><br><span class=\"line\">  <span class=\"comment\"># When the official proxy is not available, you can change it to your own proxy address</span></span><br><span class=\"line\">  <span class=\"attr\">proxy:</span> <span class=\"string\">https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token</span> <span class=\"comment\"># This is official proxy address</span></span><br><span class=\"line\">  <span class=\"comment\"># proxy: /login/oauth/access_token</span></span><br><span class=\"line\">  <span class=\"comment\"># Gitalk&#x27;s display language depends on user&#x27;s browser or system environment</span></span><br><span class=\"line\">  <span class=\"comment\"># If you want everyone visiting your site to see a uniform language, you can set a force language value</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: en | es-ES | fr | ru | zh-CN | zh-TW</span></span><br><span class=\"line\">  <span class=\"attr\">language:</span> <span class=\"string\">en</span></span><br></pre></td></tr></table></figure>\n<p><code>client_id/secret</code> is your id/secret of <code>OAuth Apps</code> in your github.</p>\n<blockquote>\n<p>A GitHub OAuth App is an application that acts on behalf of the authorizing\nuser. It only has access to the user’s resources. Removing a user from a\nrepository will remove the application access.</p>\n</blockquote>\n<p><code>repo</code> is your github repo name which is used to store the comment data. So you\nshould create a github repo at first. In my examples it is name with\nhexo_comment. <code>issues</code> should be enabled for <code>hexo_comment</code>.</p>\n<p>If your blog is hosted by github. You can just use your blog repo as the repo to\nstore the comment data.</p>\n<p><code>distraction_free_mode</code> should be set into <code>false</code>. When set into <code>true</code>, the\nother part of your blog will get black when one write his comment.</p>\n<h1 id=\"baidugoogle-search\"><a class=\"markdownIt-Anchor\" href=\"#baidugoogle-search\"></a> Baidu/Google Search</h1>\n<p>Two steps are needed.</p>\n<ol>\n<li>Add the site to baidu/google, which need a file verifying.</li>\n<li>Add the sitemap to baidu/google.</li>\n</ol>\n<p>To add the sitemap file.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># add the sitemap plugin which will create sitemap.xml or baidusitemap.xml when hexo d is ran</span></span><br><span class=\"line\">npm install hexo-generator-sitemap --save</span><br><span class=\"line\">npm install hexo-generator-baidu-sitemap --save</span><br><span class=\"line\"><span class=\"comment\"># the original link of each blog is related to the data creating the blog and the name of the blog.</span></span><br><span class=\"line\"><span class=\"comment\"># which is not fixed (once the name of the blog changed.)</span></span><br><span class=\"line\"><span class=\"comment\"># the plugin that fix the link of each blog in the sitemap file.</span></span><br><span class=\"line\">npm install hexo-abbrlink --save</span><br></pre></td></tr></table></figure>\n<p>then change the <code>_config.yml</code>. This is the Configuration of <code>hexo-abbrlink</code>.</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">permalink:</span> <span class=\"string\">:year/:month:abbrlink.html</span></span><br><span class=\"line\"><span class=\"attr\">abbrlink:</span></span><br><span class=\"line\">  <span class=\"attr\">alg:</span> <span class=\"string\">crc32</span> <span class=\"comment\">#算法选项：crc16丨crc32</span></span><br><span class=\"line\">  <span class=\"attr\">rep:</span> <span class=\"string\">hex</span> <span class=\"comment\">#输出进制：dec为十进制，hex为十六进制</span></span><br></pre></td></tr></table></figure>\n"},{"title":"How to Balance Losses in Multi Task Training","top":false,"cover":false,"toc":true,"mathjax":true,"description":"在多任务模型中，如何平衡多个 loss 函数。","abbrlink":"6e9b1d38","date":"2022-01-10T06:34:19.000Z","password":null,"summary":null,"_content":"\n# 论文中有的方法\n\nTask Learning Using Uncertainty to Weigh Losses for Scene Geometry and Semantics\n\nMulti-Task Learning as Multi-Objective Optimization\n\nMulti-Task Learning Using Uncertainty to Weigh Losses for Scene Geometry and\nSemantics\n\nBounding Box Regression with Uncertainty for Accurate Object Detection\n\n这些论文主要是一种不确定性的方法，从预测不确定性的角度引入 Bayesian 框架，根据各\n个 loss 分量当前的大小自动设定其权重。\n\n# 利用 Focal loss\n\nDynamic Task Prioritization for Multitask Learning\n\n这里主要想讲的是利用 focal loss 的方法，比较简单。\n\n每个 task 都有一个 loss 函数和 KPI (key performance indicator)。KPI 其实就是任务\n的准确率，kpi 越高说明这个任务完成得越好。\n\n对于每个进来的 batch，每个$Task_i$ 有个 $loss_i$。每个 Task i 还有个不同的\n$KPI: k_i$。那根据 Focal loss 的定义\n，$FL(k_i, \\gamma_i) = -(1 - k_i)^{\\gamma_i} * \\log(k_i)$。一般来说我们 $\\gamma$\n取 2。\n\n最后 $loss = \\sum(FL(k_i, \\gamma_i) * loss_i)$，loss 前面乘以得这个系数 FL，就是\n一个自适应的权重，当任务完成得很好的时候，权重就比较小，不怎么优化这个 loss 了，\n当任务完成得不好的时候，权重就会比较大。\n","source":"_posts/How-to-Blance-Losses-in-Multi-Task-Training.md","raw":"---\ntitle: How to Balance Losses in Multi Task Training\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndescription: 在多任务模型中，如何平衡多个 loss 函数。\ncategories:\n  - Machine Learning\n  - Methods\n  - Optimization\ntags:\n  - Multi Task Training\nabbrlink: 6e9b1d38\ndate: 2022-01-10 14:34:19\npassword:\nsummary:\n---\n\n# 论文中有的方法\n\nTask Learning Using Uncertainty to Weigh Losses for Scene Geometry and Semantics\n\nMulti-Task Learning as Multi-Objective Optimization\n\nMulti-Task Learning Using Uncertainty to Weigh Losses for Scene Geometry and\nSemantics\n\nBounding Box Regression with Uncertainty for Accurate Object Detection\n\n这些论文主要是一种不确定性的方法，从预测不确定性的角度引入 Bayesian 框架，根据各\n个 loss 分量当前的大小自动设定其权重。\n\n# 利用 Focal loss\n\nDynamic Task Prioritization for Multitask Learning\n\n这里主要想讲的是利用 focal loss 的方法，比较简单。\n\n每个 task 都有一个 loss 函数和 KPI (key performance indicator)。KPI 其实就是任务\n的准确率，kpi 越高说明这个任务完成得越好。\n\n对于每个进来的 batch，每个$Task_i$ 有个 $loss_i$。每个 Task i 还有个不同的\n$KPI: k_i$。那根据 Focal loss 的定义\n，$FL(k_i, \\gamma_i) = -(1 - k_i)^{\\gamma_i} * \\log(k_i)$。一般来说我们 $\\gamma$\n取 2。\n\n最后 $loss = \\sum(FL(k_i, \\gamma_i) * loss_i)$，loss 前面乘以得这个系数 FL，就是\n一个自适应的权重，当任务完成得很好的时候，权重就比较小，不怎么优化这个 loss 了，\n当任务完成得不好的时候，权重就会比较大。\n","slug":"How-to-Blance-Losses-in-Multi-Task-Training","published":1,"updated":"2022-06-13T07:38:40.688Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgo000ty7ml0reb1t76","content":"<html><head></head><body><h1 id=\"论文中有的方法\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#论文中有的方法\"></a> 论文中有的方法</h1>\n<p>Task Learning Using Uncertainty to Weigh Losses for Scene Geometry and Semantics</p>\n<p>Multi-Task Learning as Multi-Objective Optimization</p>\n<p>Multi-Task Learning Using Uncertainty to Weigh Losses for Scene Geometry and\nSemantics</p>\n<p>Bounding Box Regression with Uncertainty for Accurate Object Detection</p>\n<p>这些论文主要是一种不确定性的方法，从预测不确定性的角度引入 Bayesian 框架，根据各\n个 loss 分量当前的大小自动设定其权重。</p>\n<h1 id=\"利用-focal-loss\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#利用-focal-loss\"></a> 利用 Focal loss</h1>\n<p>Dynamic Task Prioritization for Multitask Learning</p>\n<p>这里主要想讲的是利用 focal loss 的方法，比较简单。</p>\n<p>每个 task 都有一个 loss 函数和 KPI (key performance indicator)。KPI 其实就是任务\n的准确率，kpi 越高说明这个任务完成得越好。</p>\n<p>对于每个进来的 batch，每个<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>T</mi><mi>a</mi><mi>s</mi><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">Task_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">s</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 有个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">loss_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。每个 Task i 还有个不同的\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>K</mi><mi>P</mi><mi>I</mi><mo>:</mo><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">KPI: k_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathdefault\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。那根据 Focal loss 的定义\n，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>F</mi><mi>L</mi><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>γ</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><msub><mi>k</mi><mi>i</mi></msub><msup><mo stretchy=\"false\">)</mo><msub><mi>γ</mi><mi>i</mi></msub></msup><mo>∗</mo><mi>log</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">FL(k_i, \\gamma_i) = -(1 - k_i)^{\\gamma_i} * \\log(k_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathdefault\">L</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05556em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">−</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05556em;\">γ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:-0.05556em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>。一般来说我们 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span></span></span></span>\n取 2。</p>\n<p>最后 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><mo>∑</mo><mo stretchy=\"false\">(</mo><mi>F</mi><mi>L</mi><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>γ</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>∗</mo><mi>l</mi><mi>o</mi><mi>s</mi><msub><mi>s</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">loss = \\sum(FL(k_i, \\gamma_i) * loss_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.00001em;vertical-align:-0.25001em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathdefault\">L</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05556em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>，loss 前面乘以得这个系数 FL，就是\n一个自适应的权重，当任务完成得很好的时候，权重就比较小，不怎么优化这个 loss 了，\n当任务完成得不好的时候，权重就会比较大。</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"论文中有的方法\"><a class=\"markdownIt-Anchor\" href=\"#论文中有的方法\"></a> 论文中有的方法</h1>\n<p>Task Learning Using Uncertainty to Weigh Losses for Scene Geometry and Semantics</p>\n<p>Multi-Task Learning as Multi-Objective Optimization</p>\n<p>Multi-Task Learning Using Uncertainty to Weigh Losses for Scene Geometry and\nSemantics</p>\n<p>Bounding Box Regression with Uncertainty for Accurate Object Detection</p>\n<p>这些论文主要是一种不确定性的方法，从预测不确定性的角度引入 Bayesian 框架，根据各\n个 loss 分量当前的大小自动设定其权重。</p>\n<h1 id=\"利用-focal-loss\"><a class=\"markdownIt-Anchor\" href=\"#利用-focal-loss\"></a> 利用 Focal loss</h1>\n<p>Dynamic Task Prioritization for Multitask Learning</p>\n<p>这里主要想讲的是利用 focal loss 的方法，比较简单。</p>\n<p>每个 task 都有一个 loss 函数和 KPI (key performance indicator)。KPI 其实就是任务\n的准确率，kpi 越高说明这个任务完成得越好。</p>\n<p>对于每个进来的 batch，每个<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>T</mi><mi>a</mi><mi>s</mi><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">Task_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">s</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 有个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">loss_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。每个 Task i 还有个不同的\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>K</mi><mi>P</mi><mi>I</mi><mo>:</mo><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">KPI: k_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathdefault\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。那根据 Focal loss 的定义\n，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>F</mi><mi>L</mi><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>γ</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><msub><mi>k</mi><mi>i</mi></msub><msup><mo stretchy=\"false\">)</mo><msub><mi>γ</mi><mi>i</mi></msub></msup><mo>∗</mo><mi>log</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">FL(k_i, \\gamma_i) = -(1 - k_i)^{\\gamma_i} * \\log(k_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathdefault\">L</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05556em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">−</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05556em;\">γ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:-0.05556em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>。一般来说我们 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span></span></span></span>\n取 2。</p>\n<p>最后 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><mo>∑</mo><mo stretchy=\"false\">(</mo><mi>F</mi><mi>L</mi><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>γ</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>∗</mo><mi>l</mi><mi>o</mi><mi>s</mi><msub><mi>s</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">loss = \\sum(FL(k_i, \\gamma_i) * loss_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.00001em;vertical-align:-0.25001em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathdefault\">L</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05556em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>，loss 前面乘以得这个系数 FL，就是\n一个自适应的权重，当任务完成得很好的时候，权重就比较小，不怎么优化这个 loss 了，\n当任务完成得不好的时候，权重就会比较大。</p>\n"},{"title":"Make and Cmake","top":false,"cover":false,"toc":true,"description":"Make and Cmake","abbrlink":"1174cd5f","date":"2022-06-11T01:27:25.000Z","password":null,"summary":null,"_content":"\n# Make\n\n# Cmake\n","source":"_posts/Make-and-Cmake.md","raw":"---\ntitle: Make and Cmake\ntop: false\ncover: false\ntoc: true\ndescription: Make and Cmake\ncategories:\n  - Programming\n  - Utile\n  - Compile\ntags:\n  - Compile\nabbrlink: 1174cd5f\ndate: 2022-06-11 09:27:25\npassword:\nsummary:\n---\n\n# Make\n\n# Cmake\n","slug":"Make-and-Cmake","published":1,"updated":"2022-06-13T07:38:40.688Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgp000vy7mlat752bsr","content":"<html><head></head><body><h1 id=\"make\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#make\"></a> Make</h1>\n<h1 id=\"cmake\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#cmake\"></a> Cmake</h1>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"make\"><a class=\"markdownIt-Anchor\" href=\"#make\"></a> Make</h1>\n<h1 id=\"cmake\"><a class=\"markdownIt-Anchor\" href=\"#cmake\"></a> Cmake</h1>\n"},{"title":"Personal Thought","top":false,"cover":false,"toc":true,"mathjax":true,"description":"记录自己在学术方面的一些想法。","abbrlink":"bf6e579a","date":"2021-12-15T08:01:28.000Z","password":null,"summary":null,"_content":"\n# Deep Learning\n\n## 泛化性能\n\n### 泛化性能的本质是什么样的拟合曲面是好的，一定要依靠先验，现实中曲面有哪些特点。\n\n深度学习的本质就是函数的拟合。泛化性能是衡量深度学习模型性能的指标。\n\n在两个模型都完全拟合训练集的情况下，i.e.，两个模型所表示的函数在训练点处的函数值\n都是完全正确的。泛化能力要求两函数在测试点处也具有正确的函数值。\n\n这个问题其实只能依赖先验。对于拟合曲面的先验，也就是说，什么样的拟合曲面是好的。\n\n比如，如果点 A 处函数值为 1，那么把 A 翻转，函数值也为 1。这是源于目标识别常识的\n先验。\n\n数据增广方法 mixup，发现不同图片之间函数值线性变换是好的。这是对函数曲面的另一个\n先验。在样本之间，函数线性变换好。\n\n所以，深度学习的本质问题是什么样的面是好的，如果我们知道什么样的面是好的。知道我\n们需要拟合的曲面的一些特点，那么就可以利用这些先验来进行数据增广，甚至进行模型的\n设计。\n\n比如，要拟合的曲面是几次的。是否需要高次非线性。如果需要我们就要引入特张图之间的\n乘法。强化学习的特征选择给模型带来另一种非线性。哪种非线性是好的？要回答这个问题\n，就要知道我们需要拟合的那个函数是几次的，是哪种非线性。\n\n**设想如果，有一种可视化方法，直接可视化高维数据。我们用它来可视化在 MNIST,\nCIFAR-10 等数据集上都达到 100%准确率的函数。我们总结这些函数曲面有什么特点，光不\n光滑？是几次的？有哪些对称性？。总结出适用于所有数据集的共性的曲面特点。那么我们\n就能根据这些特点，这些先验，设计出好的算法，提高模型的泛化性能。卷积神经网络之所\n以在图像上那么成功，也是源于，它拟合的函数一定具有某种对称性（因为对图像平移不变\n），而这种对称性，就是真实图像对应的理想函数所具有的。**\n\n洞察真实数据是什么样的，是提高模型泛化能力的最终途径。\n\n### neural tangent kernel\n\n**最新有论文表示[^1]，泛化性能和正切核有关，还有关于神经网络特征值方面的研究。值\n得探索。**\n\n[^1]: NEURAL TANGENT KERNEL EIGENVALUES ACCURATELY PREDICT GENERALIZATION\n\n## 高次非线性与注意力机制\n\n### 特征图乘法\n\n特征图乘法会带来高次非线性。如果把 ResNet 里面的加法改成乘法。\n\n```python\nshortcut(x) + out\n# 修改为\nshortcut(x) * out\n```\n\n**可以从两个角度这个乘法**\n\n1. 把 高次非线性，引入到 CNN 中\n2. 把 ResNet 的分支做成一个 3D 的 mask，形成一种无参数增加的 attention module\n\n### 和数据集有关\n\n在有的数据集上效果挺好，比如 Cifar-100。但是即使在 Cifar-10 上表现都一般。\n\n### 和优化有关？和表达的曲面性质有关？\n\n原因可能有两个\n\n1. 这样做乘法太粗糙，确实表达能力不行\n2. 优化的问题，乘法带来了梯度的问题，比如方差不可控等，导致优化的情况不好。\n\n现在其实也没能很清楚是是哪个问题，缺少研究这个问题的手段。\n\n为了减少优化上的缺陷。尝试过几种方法\n\n1. 为两端加 bn。`bn(shortcut(x)) * bn(out)`\n\n2. 把 bn 的 bias 设置为 1，保证 bn(shortcut(x))和 bn(out)的均值都是 1，这样可以\n   产生比较稳定的梯度。这个想法是源于\n\n   **1. 原始的 shortcut(x) + out。相当于 shortcut(x)乘以了一个 1 的因子，out 也\n   乘以了一个 1 的因子。**\n\n   **2. 保持恒等映射。当 out 是 0 的时候 shorcut 可以容易的实现恒等映射。**\n\n### sigmoid 容易饱和？\n\n3. 像 attention 一样，把一边或者两边都用 sigmoid 函数\n   。`bn(shortcut(x)) * out.sigmoid()`。这样的话，效果也不是很好，而且发现\n   sigmoid 函数给人一种感觉。就是训练不充分的感觉，有点像学习率太小，或者减小的\n   太快的感觉，所以陷入的局部最优点。猜想这是因为 sigmoid 函数太容易饱和了。\n4. soft attention 经常利用 sigmoid 函数，是否也存在过饱和的情况。为什么它没有出\n   现过饱和现象。1. 用的不多？ 2. 因为是 2d 或者 1d 的？就拿 SE-Net 举例，每个像\n   素点其实也都是乘以了 attention 的。只是空间乘以的是同一个 attention。\n","source":"_posts/Personal-Thought.md","raw":"---\ntitle: Personal Thought\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndescription: 记录自己在学术方面的一些想法。\ncategories:\n  - Machine Learning\n  - Paper Reading\ntags:\n  - Personal Thought\n  - Paper Reading\n  - private\nabbrlink: bf6e579a\ndate: 2021-12-15 16:01:28\npassword:\nsummary:\n---\n\n# Deep Learning\n\n## 泛化性能\n\n### 泛化性能的本质是什么样的拟合曲面是好的，一定要依靠先验，现实中曲面有哪些特点。\n\n深度学习的本质就是函数的拟合。泛化性能是衡量深度学习模型性能的指标。\n\n在两个模型都完全拟合训练集的情况下，i.e.，两个模型所表示的函数在训练点处的函数值\n都是完全正确的。泛化能力要求两函数在测试点处也具有正确的函数值。\n\n这个问题其实只能依赖先验。对于拟合曲面的先验，也就是说，什么样的拟合曲面是好的。\n\n比如，如果点 A 处函数值为 1，那么把 A 翻转，函数值也为 1。这是源于目标识别常识的\n先验。\n\n数据增广方法 mixup，发现不同图片之间函数值线性变换是好的。这是对函数曲面的另一个\n先验。在样本之间，函数线性变换好。\n\n所以，深度学习的本质问题是什么样的面是好的，如果我们知道什么样的面是好的。知道我\n们需要拟合的曲面的一些特点，那么就可以利用这些先验来进行数据增广，甚至进行模型的\n设计。\n\n比如，要拟合的曲面是几次的。是否需要高次非线性。如果需要我们就要引入特张图之间的\n乘法。强化学习的特征选择给模型带来另一种非线性。哪种非线性是好的？要回答这个问题\n，就要知道我们需要拟合的那个函数是几次的，是哪种非线性。\n\n**设想如果，有一种可视化方法，直接可视化高维数据。我们用它来可视化在 MNIST,\nCIFAR-10 等数据集上都达到 100%准确率的函数。我们总结这些函数曲面有什么特点，光不\n光滑？是几次的？有哪些对称性？。总结出适用于所有数据集的共性的曲面特点。那么我们\n就能根据这些特点，这些先验，设计出好的算法，提高模型的泛化性能。卷积神经网络之所\n以在图像上那么成功，也是源于，它拟合的函数一定具有某种对称性（因为对图像平移不变\n），而这种对称性，就是真实图像对应的理想函数所具有的。**\n\n洞察真实数据是什么样的，是提高模型泛化能力的最终途径。\n\n### neural tangent kernel\n\n**最新有论文表示[^1]，泛化性能和正切核有关，还有关于神经网络特征值方面的研究。值\n得探索。**\n\n[^1]: NEURAL TANGENT KERNEL EIGENVALUES ACCURATELY PREDICT GENERALIZATION\n\n## 高次非线性与注意力机制\n\n### 特征图乘法\n\n特征图乘法会带来高次非线性。如果把 ResNet 里面的加法改成乘法。\n\n```python\nshortcut(x) + out\n# 修改为\nshortcut(x) * out\n```\n\n**可以从两个角度这个乘法**\n\n1. 把 高次非线性，引入到 CNN 中\n2. 把 ResNet 的分支做成一个 3D 的 mask，形成一种无参数增加的 attention module\n\n### 和数据集有关\n\n在有的数据集上效果挺好，比如 Cifar-100。但是即使在 Cifar-10 上表现都一般。\n\n### 和优化有关？和表达的曲面性质有关？\n\n原因可能有两个\n\n1. 这样做乘法太粗糙，确实表达能力不行\n2. 优化的问题，乘法带来了梯度的问题，比如方差不可控等，导致优化的情况不好。\n\n现在其实也没能很清楚是是哪个问题，缺少研究这个问题的手段。\n\n为了减少优化上的缺陷。尝试过几种方法\n\n1. 为两端加 bn。`bn(shortcut(x)) * bn(out)`\n\n2. 把 bn 的 bias 设置为 1，保证 bn(shortcut(x))和 bn(out)的均值都是 1，这样可以\n   产生比较稳定的梯度。这个想法是源于\n\n   **1. 原始的 shortcut(x) + out。相当于 shortcut(x)乘以了一个 1 的因子，out 也\n   乘以了一个 1 的因子。**\n\n   **2. 保持恒等映射。当 out 是 0 的时候 shorcut 可以容易的实现恒等映射。**\n\n### sigmoid 容易饱和？\n\n3. 像 attention 一样，把一边或者两边都用 sigmoid 函数\n   。`bn(shortcut(x)) * out.sigmoid()`。这样的话，效果也不是很好，而且发现\n   sigmoid 函数给人一种感觉。就是训练不充分的感觉，有点像学习率太小，或者减小的\n   太快的感觉，所以陷入的局部最优点。猜想这是因为 sigmoid 函数太容易饱和了。\n4. soft attention 经常利用 sigmoid 函数，是否也存在过饱和的情况。为什么它没有出\n   现过饱和现象。1. 用的不多？ 2. 因为是 2d 或者 1d 的？就拿 SE-Net 举例，每个像\n   素点其实也都是乘以了 attention 的。只是空间乘以的是同一个 attention。\n","slug":"Personal-Thought","published":1,"updated":"2022-06-13T07:38:40.691Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgq000yy7mlgdcf052n","content":"<div class=\"hbe hbe-container\" id=\"hexo-blog-encrypt\" data-wpm=\"Oh, this is an invalid password. Check and try again, please.\" data-whm=\"OOPS, these decrypted content may changed, but you can still have a look.\">\n  <script id=\"hbeData\" type=\"hbeData\" data-hmacdigest=\"c183a69130aaee9d5ddacce9d014aa78a1b1bc728b98454cbfe313062ce9c69d\">253d24b99cd7a34be71a536fc48a861e24280f85c5d92437d59d46d319bd5ad689cb46e2d80f5d3c08f50582b841f61ef78b4913d19d9c0ced47726e006c992120dec993466d1458457784d47372e9ad6b6c785b61e6c57a468cdf4e8c6c04ce797fb240f22ed4e38213649c083b811125ffca69743bca59a11165c33e4fb305c26badf7c147b24c9a4badd2111eafb1b4c2400acabe08b9f662e97889bd1703896bce400d1b2fba4ee5033c7aceef2e886e6f7b8b75ce85d0ed76b78330e3b73d66d13ba017abda1b1d968a803884d36d6433a4fc8151c1d631ea309e8af78807f0cb854d54d107392c61a3d4622ba17d843c0296ba2fb856436e1f829282a7ce51b2fed86893ad0d495b6a4747e3d8efb9405844cbe7966e78d02b1302067c5e45dd1d70dccb88e39c88cdd189710edcd1c296f1ee40f59e84286291d44bd59563cf359f843a8925125a0c70dd9baabbb627c8d2a457cc75cf500b6100cb7bf86c5a08397015148e6e0cf8069605388ed1f958dbd1afc2734fd9206e9190680680080db560bbe8afa85d6361e921977741412bdb73f479733be0f5e46c0749840a94695c06c2898711db95f1526535ee91433e6fe0f4092546d70a7e63e7dec7f491ad689b73a3807fdc9b7184663363278a51f8112ee1e6e1044a578ebc3f89a39925e48fb3665b93816184ec6f179e775ba14521a96e5957a4a0fe64dd85b17b20c410d51dcfdddde62ba6f83172fdbe7a6429f383d69ba22815b998690e4e7df2633393b6558ac697d18077e541e891175773e3970c79a22f3b203962e0e485c6d7130a43d542fa6453c3806ab2926e9fa4df65ed3de015b70f8a45b3622e28d7c1486f042ef9959572296910ed424929c6da9ef05f9f5e6f17177b4a54cdcc69dc6e1d8cc1d8611f03b6e6814e57b2893b37be4351ef4d4a62dd847afbd0aa8e95619cac26b2b03caca54055a991188033249df360606b084bd3e057dd4bdc823cbd847dc598acae110f87d951b5ae999bb3435556bf825ad494c23e48e592d535cad692af9093cc6236989cc3f5763a9a87acd67f3cccfd84a7022f4bdfa5573e747d372c4132e5eecca2758855a4c53d8df84d3d3e8a27a4918769119407c1c8e5b5237d9bda2696c13714fded4906b36a853bb6acbbcbfda463f9ee705147fe3a6000dbc8c9910e966d18036b8f3868b3a2a40befb715c35529adb5d80b924bf0c241f33250d9798985cbeb3f641179d72d509122e6265662e9368ae30728adb1b3ad18bf70cbb620ddfcdc98898c1b43b4facd4ce1d1e5e4c15aa8d3ea0cd9a3daa25cf4d5239edc6ecd6b2515cf034f51fc01d799a51121f574082470e68b6ca4e79c141f3bffee601f1474d9dbac9484444b7817d17c446198f932c0f012ea21866b5edce7bd384f5c6fa6c044161a518dd8402ab10b9d279a8c1fe434e75ba3bfacfac07ec7a27a3c0a20132090f843c1901b722e4f3c88beca5a1e2ce8edca18a26389f29877118b51739a92f1292867cb8ea0309e0ea78964e036190ea526da6b74a1f84bd883bf2b6b7569fb98d863f3bcf4e08e85994f2c4d7a90c154105f3afdf695094096b1527b4efd8760f60d69aa0230f36c68801f90f12888ef1fa30e555a20d6b349f3535e260e13f2436a7a3978a205ff8c103be38a447ccd0879b083839b77f2205b9a5356c4d0517401660e7aa5c09fb275f0be1be82e9033a8643a459f8e080ee8d6637450c51f4c7f24c29d149f98edbb691b923d663617245f10e2775ccc3731ad2e7a5a3c4bfb94654e6755afdd0d563b6749accc9f91f0eae0bcc5c1367ae9a9626091a80ac3be1054a079dea06f256e9fd0099e998fc3888afc62438edb783119511bae3ccd87c07ab20ca42b00aff22075d636e10dd28d82ca93e04da968a99d9b14cb79c4eb1b351bb03b7500ad2865d4901fc7ee60996df75e747519d017e8f4fe73ef072e544ecaac56c7fd0eaedda946fdb4a43b2d95638820c94e627925df7e2eb081d03dc6c59bd0262cd2c63766e3e5d3588cd6916b0cc97a1608bc6a63d862d17adb2b9cad10e917db3b5fd81ce6f8c90ab71dec5a7100199884c9367443cbad144e662bf595513f25b7ecbcf555f843e3ddb7aad07a173a6bc9469c3a2066559234a1c8953ccdf947345b79f59a438b7b17c716e405081a14669c234dbb186db8f56d0bc58315c67cf3e87ca48ae8f499d35ac31cfb23cba0b336e9fde4d920d0af4f1e462f3ff739bb9a2ddba128c46cc125a41581b5fdc234df71892b43bff33789f59a5cfda69ee9646255743a7c4e10f15efc29847e3ec25a98818c4e8436b88dd0aa4a5fe81fec13813ffe90a7115ee44a1045c1d59f5e0816202ee0c92198adab85e4358e5565b89e1e1432580077ea2472e5fc3bc0f8ab08a218f60f1d50def03bd0ddc2c450603096aead3d99ee80e518d301a23522d8ad16e448b048a615fad12f4db9eadb86669a2fc8b6122d069fc34f3853c59594f03206dd118d87a9853a3cbec1b2a169bedf113ca1379c14ae7d5bb6b8c81c3708f1a6bc1fd6cbfd84280b56a225e68c0417965afa8a5f576c2a99c5241b46157f34baec07ee3f57580fb70b38851e935000ab732625fe6f199c95816c244f17435490744c48e24bec54d0ae46ad01f13c894cddf84245e0389080f2f3cc44f053304ae8ca05270242d29353536dbeb5301881dc537047d9490391285cc512623fe41ab1fad5467f7d18f7752dea43c57c3ea060b84857186579ffb64e01e9116a61050d22194234bd16eb691e18ffeb8f4d8a282fd50910f6867d395d795858ff7e65c05106a299eb33421ae5e40f2030a299fac8ec4148eebfa0632e31e71cb0d8b3996d760a7a89aa3aa8f7b4dd58b59d35908cd84fc281a0faf4641e2eba2d4d2d0a9a9298227d3413f7d7275f78cb587bb576951c98fea887ab285c59927890e70b2f7add5a8f115c0b343cb140900ce95308acc87e5c2adb0e418bf41a97673b77c88c3db0682c2a401b2433f09584383fcfd7f6b4561d8fae142a6f61e16bb67538a3a2ecdd4b0778db3af88049e1d06094c864788f2f492fe28cc7d458f1661fece515c24e6f869efed947044340862129894b7f6cdf0d0e86fc211dd7a981b6998b4d2305e35a6e38540c70390c9dc6a80186d1ac85979b30d47c89683aadd5151722b6826e8a1d378bc508006b0d21020a67cdc8edfc71e5990f59902c7a282aa466e34be1b76549105b070e544ebffc401a9b7a01dfd9c8aa1c47fc45d3db7f0d33efc88ae6f179a5f58545219b16b6e1c82b453df5c716e071bfa84b62cfb781309034c9688700cf63e422fd7dbab5716598515c634f11ff1029991e0dace9d6cd741ffc868e483162e3acefcd8494fc100b502e9f98d3a65e8e9d5434fb9f0dbb59e429cdb61b0eede5afd74b85e8bf486affb6c07b73d3932b0559a37b712515373dc21659890feed7751c6ed5696c0d9814eb5b02459b304172732ef205e017d838b68d4bec5156ad17897cc17ae5fb3b664ef4d1a0f4388ef7c01326b4dbecd9dfd3ef02a6531fb4515b19010a9877d3feb3b5f2cdccb300ba96393aedc1f2f8a8da73fb607f7918ca0895bc44f9a3979493e676ea3d35ff728ba07f829ffe5dbce602a1669c84a8c7ff8521954919b50dc3676f78988763c3d2e8551790f5120a544ac112b8ff1dd4425b113e4a20bbfff9835b8869378b9121f492dd98993257fa66466143c3173ad49f91335d11e16ecdb5c72d932d87a6a83f232ce4a99b8998de2e29ad7b076fb7d8fd18202bc208fb2270e6011247eac73b7be5808e9e7d022056a49fdcfed0f5faae61fd174ff8b7271ed2cca1679ddb1f51db541d4e3787507aeee98f3b25023f46f45d61344eb1d232503b271a17f5007ebd7b0356d6e3b81c2b9b98670b5455ed7a34c1ed57c3bc5cb7952c57f6c1f264fa0a08ea5e39d687fd707399886eb59e690aa462e28cd320c02ba34d07d8d943f5b2ebb6d4d70af5a6c3d437a4be14b9f096504c860901064187722da89eb958f5cd001e4fb8b4072d07ee12a002c27af5a6a5a260d12b240af28562ede2f305956d94ed90eede3fa6b22a19d6c0228a94019df67c77f132d8b3a984d76e209e8bf93aec60c11c500ce632ca34084e0485e2eca654b2445c8c835bb2bffc25a103dfcdaa7937b0600cacc413cf0bf6f1ecf685b71d21b842921c42786c5569377dfdf19bb8da480a33fdcff7f0d2f030c692cd4e6c3400485af3cb8eeae8772a5748bea5c23096edbcf7ea9468453369b6226f7947231e29fd26b3956cba63a7cbeb75c7750209757e36de20982f869206e7ebec4153f46f241e37d655048528d7c4003916934fce0c3cb802d00b04fc727bbae97cd99da50664d0ff422462836347718ca1de618805be6cdc110b5bc9d99201eff3a2023715b1f43570c3f38594f7f8937915551b06f433a1854df2fd93cdfe4974c1a27952abd70ba6a22a2ec6ae1d516277e4ed1601b8f6f31e2389c6dbc1f5421f2af15d6c7068c5e8274b5a4a57c4eee6272b1ecc200283fd1cf19fd51946af30bb12f7af5cc93800659ec39c495ad45f30c209773058daac3754dec752c3c33540070242ec0650bc0aa13cc4964a896abe8fb032254251997ecf6c8cb6afca32151635959499038b15e719d5be1888928035da44eb707b9c34ec3713d816b535fee4300da3b0e8b3da99efd49c5eb420ca9245278801f410d372231710a10c44abec6eae5d1ede8f48eb75bfbe3b545622af871a502c4314b2059cba2999219bd212b4b781d59d275eabc134e8294f76612033d364e7302903296c66b249d18c9a0a788abff98668b68fea08327cd782b1e204729ba023f4cc1f8f627a173542208f2857d0a8a8fda9ec2409e82618efff73d68e143cd21a642754006fdfa912e0d72af04c525169d41d7d4e51e7944a7d679dfa586499ed7a08aac22972e97745257920da593b2a53bd56c6cfeab2e15288a26784d74ff09d62ff4911ef75b5edafbaaf178b63b6398cc4e27579734016f5c67923a6c0333c76f37ee61bdeb8d5d7de4438e8e67b4dd41db91cb051400928a4183921e1b5aceeb95dffb40439573bfb5d6412efbb386095abbf7173512c5867ba154d24fa4c11a13be09eba559c6c187615faee1376cb20eca2279703122e8e4225657eca570fef2528080694dd696ef89ba31eba9d035bad7453539011b9e2b7f829090193f0eac8f952841564ce5d8207167f68ae4b0d4ef692bf18b83ca4cb92d3a9fbf48b3d5e3d78d9dfbdeee6a80bf539e75ef93f5c21844fb6bdc2306e3d4d3da4d17bb6cda982a63f74426511a1662da9af69f6d9c0a45c5e9010f290ab4dcd6f5591e29f9740bf391250dfaf1e17f24acc9f3b519d9aea7722e0993131a1cbb6cec9510db761c994ad565ac4513ff9fb6cb36d1831692232a4273dab49fd658cab4e74e66c83185db6c9b35519b320e82d33cc5aeb9f57901c43f6bbf4307af0b2999e2c7d73db698be0383295daf7aa397c203dd16648f6130d092e90091ebe009704b70b630401cf5048064c22020e2536dbb194063ee151221d98b89dd66805b8e3ca8002a9862df7f459a35cc00a385a8c53ed140aaace20d210604c962ea6924777be1a7057e7af287b4a3e6b4cb0f5d982983eb6b15e0e73849872101aabcfc1eb3b2d8984c6a674036b1d8c45ab811772fc82f4e429b30b0bd8b93a8aeeecbbede4a90ea90a89787e3ed077157778779ad4bd02318769551d191da12e4b25e9c4b7d69996183798fc454ec3582deca502701e5fe0e2b8e86d652d94dfde8c8752d1a6b58006bddc4b59eda8151d57a16fac318c3c5315c7bcc5d817e638e753140215c3dd2581321ab79990a3c7dc1039e96be68c42156b667236222e64d908a3047d6b779f2f03684db7953733e02155506145c6553f3a731b9d4373b469bdbcf2c22e6945c2ec68f4d1dc09c3596ea2d42dd8fb0dad6049a61bcb9d5e30b4ff5265e5a6b921c2ab01fd0795b1ebdcc67f5121e49635d2325ee20ab6ce08106ed67756fd3424095ee2ea34f3cc485d681f482dffeaab93b1c408f9460d75e3b73ed9e0d97f272a84e1eb5d7eddf7b0a054402b4580ec14aa80cea11fe2d45bd4335776105120d1caae39d75506bcab69d465525a76c722621d7de06b2b628d73cdc7d83d7cf43195a0a73fca92d29ba6a8847991e48eb613331bb0a04910269c85fa8f3f04672600c4027b7f5bfb75e66abfce8f6b640cf06ddd6b994662fd547910ca6d02f566710ed8e8a7863ca54dc6bb3898c2d8e3cbd0f0dd990649088a1454f8b575085f097aabd7c0929789fd9868015410c70e39cf113962db2b8fcba18a7e88c26ff26869954039cceabd5b6363d7dd04c013ae340212a171dadf6a3599143a601a3486c91044cb00fc16cc5dd4d5833303368c6f419992e188afca6930b14a17ac0b4c040f051897d01db4adfaa6e1397931bcfb20c7d1acc3bb481d90ccc393219a011798d6096345aa174dcb2fe0e9b784a3c9ebcf0567f6210730c6adbe52c59fdca61ab7808adbab85586f439d99b50c1afb561772ae31721c349c8921bcc04a7b401e45bb2f0dfb1bcf8edd69be9268bb77e4a0c518143ebb2930272ebc0a03adc68f7cb18af798bb6d293c5c65cea2f59c163af19cab16c94d5ad49f39be38530471667cd12c389889bab1eda5b8b327862e14f8a01e1736f5cf2805193b7c6d559bdaf7e23f53d9377a334372ef311b126fbf0d54952c83c7c971def94ff260fe0f1857dc05b2501ede5813c806fc5574e168bb40f0df611a89bfba9c0f88c89a084fcc68a9925af3b7d59a58f17f38156d0efef36d9279727dbc5cf1e7ff969c48d1c0d4511abfb17af7a6a66a5ea3947afbabb7f27f467abe920e0ea7eff0ae16f523e3353535675d191a550673eddf8160341ee4abe67d8976454de432f699fbc9f5fccf639dcc2fc7543cda5dd786b944a4de4ba6b55fe4b1b8dc5fc15efcfdc3443cc7df942edf57db130deaea505e3cc56ab45ad58f79f71ced13c053375b06e0778d9f575dff800b775f1f24b3dd1f3ed6a077ee198c300878b0ab41c989df3340a864de337727413d1402c0386b913955fadbbec7aff75bf4ca30fd6574a0ac065a57bca8d51d3b7965770bc7615f4986e00abf83730aa9bfe8b327e2afade0a873b0a757894b3da8897193be50f7146e2347a9bdc0d28544ee900b588e358adca2ff3ad5326fcea99d095356d2957b8f33a642432002d32445f1034e9e42a5a0558deabe5d791ff459c91944452ec8851d427c9e854ac0c0442d61e6c0cbf0d6544972028ec7f15ffb142937796aa17d9f1624ae5a7a57cd16136d0e7323cd2a03340861f7b7e7f4187c6d3c7371118121c71d3cb603306342dc7c32bdeb3473986fe54b7e1c94d3c0616de07cb411f61fbf4c0f84914548479cf30ac2438c58a70fc40c8a0c8544c0072cd77677d7aae4fd52fbdacde61905787b36ef22f4096df4c3b9f4f6cb3d46f39f29f825cbb1fef8e1b9690c549521193952c357315ae17e208cedd5e8c912f26d1a0313d56170dd2378999bd49ac752f6cb901e0f3dc075db5f10f7fc27145f57245f326613d65fabbc54b971f245e12df91b4bf0a18932a534fd81771419b124fff11d4c65ac2fab7274b90a6827a3ed6ed092c8a21ff80b363ee7a56218f8e94ee4df15838b46b0214bb6fe2fa5785ccfc81a490e26619e22378756f9e817118974c7c42365d4564b400f7f256327716333245489a4b924bc3b9f7885afeadfd41944c4329e6d32189ea24f0282ca0a63afa9a651c2a936176eb470eb44d96539fa180661543f6bd7650f13ec765a70aba68c2adad5eaf76d1fe83158d10739aebdc393e3a7146c475eb448c62dc7e1eb8189d793a1cad1129fc5944b64b78f89a3d0eb93691a39b787a6b67c7fdcb6c35aeaebebcf957dba331f63c8659ff332522e30d3f4f1bbffe505367f2bae9d1b2f5555bc5f1eca7e9a3e4142367ac4df606aa8d9f69d7a7cdbd2cc44c8026a64448e33f3c84effc0d9d673e6efef9312a1cfc5a87ff74082c4132bbbab91b1b76e65a2b983e44ee3e902286e0b760aaa21b02af636c5222b63c6ac6185404e5ab027d2515784c9a0865eef436de4a8ab341685dc185970b1df9f5e6f44c542e9681899d880d9dd789e9c1191d0b31ac5df973a5ec02af50b3807c8d097677be990cfdd1483734c47e622de9e368eb25630b4f210563dc6dce0979bbd680d82824781d178dd4b8fbe771eb5b0bc3e93c77f4a3dc4f1712b0a57041ece819be8a1f0ad9c53b6b777183a7f80b857d06df93c5fac6c113fac74bc5a6ae87d21bc28d3c577411b0f7b04047074e4f0a345b5726cbc89dfacfc7f5a616117fbdd837b1f727c5dfa6f3b079724f4fc7b815fbd5c39612f661fd37e9c5d871d3171be8cc542b93ee457a8e0f1ef86f3f4bbcccb9f156d26f6ff27708374545467619b839da73e0af8725861ed887f890ab531cead186ad0fcfa8d9436fbf41c9110dd9126e5d523e7484fad4927041c7c1b5e14808f0e890803cca70bb126d31ef6c21407c1266b13f72081a0946e123b146bc22eea61a9b1d53d46293ab0caf6933e4c6ccf6a512befa921d36ccc2df1b30c1d513cc3839a2a5fea7068def66ba36c2ddd2f6b548ffbe5f77515cd025423204ee6a20e754bb49db40635f80cdc51263f204888d25a1d9180e84979280f764533eafbe6b635d88843d71c4df7e543e62f16ca0f71b642ef3654288417a2b1613df94066f113b2366516fdd01778168645ba5ad8f2b5114c33e06f0a63594e4463e03f1431fe8be9daa82cb100af0e305563249873c5e0084eb02bd64f2ccd087cefe3b9247f19faad7890941fc716ca6f1ef6e6131d682e7009af310eba1035e1eb9b89f96d72985533d243a07f2812c04255258434202979181e07ec2cac473d9141c1c39938cd2390bc68ea663395c4da6c9194c49173642cbb61cc1bf28189e0c9c6f0c43c64ab8b3b3102ef13d44ddcccffb53d8a7eca28f2afd63521ac59fa2d82561f3d923551cfff018f5a16cb1d7c8c4b3e1cdfc02af4bcfae0eba0bd2388c66bde7ad48ddedfba800c62882bc1f2096db5c3e40fa486fbdfe7e31630300eafc2b6344ce1227f97db2d83a23f5d088d06f00f000b7058d00c6a78e394925731e05a18e5f38446bb1ae53a14bb31ab25d8c662e6155cf361127855b7e02fbcb7d7490630fda2d68b60c0591915f1c749629591fce6dcb1fdb0cb5503e11729a4376ee5a0e4d57f56a44d6ed93a26fc6e56a9be67154921ebd2e6defd0c9d8ec3ad573471eeb6c6b2c04622edd93943a9b2d15b3eb3e1bc8b1c543121b0d185238162434f49d3372e0994598c40f9faca4899c586933b9f679527fa8dc8f10762dc042cd4ce474c6f6a5c3a81b58ec9a0a4579c278bcafc07e4679cfbd625c43511fa5904747885606c7ace4d40577ac6f0cc4b48512ae91758201ba4d35162afee20824a0b14e75453424fa8b85e64ce157a2b7c1f5335ae2d1e2937f842ef46321841181e62e4c329dc6d2d520f6c81c83a8638929e64d645fbcda48a4e768b47a541eea92b1478b3e5e2896527b429b2ffa23b421ea18937b5710a981b9a030051dd7938af08102af5e625d645cdf89c145cb935a4dd02ede57f00faf0</script>\n  <div class=\"hbe hbe-content\">\n    <div class=\"hbe hbe-input hbe-input-default\">\n      <input class=\"hbe hbe-input-field hbe-input-field-default\" type=\"password\" id=\"hbePass\">\n      <label class=\"hbe hbe-input-label hbe-input-label-default\" for=\"hbePass\">\n        <span class=\"hbe hbe-input-label-content hbe-input-label-content-default\">Hey, password is required here.</span>\n      </label>\n    </div>\n  </div>\n</div>\n<script data-pjax src=\"/lib/hbe.js\"></script><link href=\"/css/hbe.style.css\" rel=\"stylesheet\" type=\"text/css\">","site":{"data":{}},"excerpt":"这是一篇加密文章，需要密码才能继续阅读。","more":"这是一篇加密文章，需要密码才能继续阅读。","origin":"<html><head></head><body><h1 id=\"deep-learning\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#deep-learning\"></a> Deep Learning</h1>\n<h2 id=\"泛化性能\"><span class=\"post-title-index\">1.1. </span><a class=\"markdownIt-Anchor\" href=\"#泛化性能\"></a> 泛化性能</h2>\n<h3 id=\"泛化性能的本质是什么样的拟合曲面是好的一定要依靠先验现实中曲面有哪些特点\"><span class=\"post-title-index\">1.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#泛化性能的本质是什么样的拟合曲面是好的一定要依靠先验现实中曲面有哪些特点\"></a> 泛化性能的本质是什么样的拟合曲面是好的，一定要依靠先验，现实中曲面有哪些特点。</h3>\n<p>深度学习的本质就是函数的拟合。泛化性能是衡量深度学习模型性能的指标。</p>\n<p>在两个模型都完全拟合训练集的情况下，i.e.，两个模型所表示的函数在训练点处的函数值\n都是完全正确的。泛化能力要求两函数在测试点处也具有正确的函数值。</p>\n<p>这个问题其实只能依赖先验。对于拟合曲面的先验，也就是说，什么样的拟合曲面是好的。</p>\n<p>比如，如果点 A 处函数值为 1，那么把 A 翻转，函数值也为 1。这是源于目标识别常识的\n先验。</p>\n<p>数据增广方法 mixup，发现不同图片之间函数值线性变换是好的。这是对函数曲面的另一个\n先验。在样本之间，函数线性变换好。</p>\n<p>所以，深度学习的本质问题是什么样的面是好的，如果我们知道什么样的面是好的。知道我\n们需要拟合的曲面的一些特点，那么就可以利用这些先验来进行数据增广，甚至进行模型的\n设计。</p>\n<p>比如，要拟合的曲面是几次的。是否需要高次非线性。如果需要我们就要引入特张图之间的\n乘法。强化学习的特征选择给模型带来另一种非线性。哪种非线性是好的？要回答这个问题\n，就要知道我们需要拟合的那个函数是几次的，是哪种非线性。</p>\n<p><strong>设想如果，有一种可视化方法，直接可视化高维数据。我们用它来可视化在 MNIST,\nCIFAR-10 等数据集上都达到 100%准确率的函数。我们总结这些函数曲面有什么特点，光不\n光滑？是几次的？有哪些对称性？。总结出适用于所有数据集的共性的曲面特点。那么我们\n就能根据这些特点，这些先验，设计出好的算法，提高模型的泛化性能。卷积神经网络之所\n以在图像上那么成功，也是源于，它拟合的函数一定具有某种对称性（因为对图像平移不变\n），而这种对称性，就是真实图像对应的理想函数所具有的。</strong></p>\n<p>洞察真实数据是什么样的，是提高模型泛化能力的最终途径。</p>\n<h3 id=\"neural-tangent-kernel\"><span class=\"post-title-index\">1.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#neural-tangent-kernel\"></a> neural tangent kernel</h3>\n<p><strong>最新有论文表示<sup id=\"fnref:1\"><a href=\"#fn:1\" rel=\"footnote\">1</a></sup>，泛化性能和正切核有关，还有关于神经网络特征值方面的研究。值\n得探索。</strong></p>\n<h2 id=\"高次非线性与注意力机制\"><span class=\"post-title-index\">1.2. </span><a class=\"markdownIt-Anchor\" href=\"#高次非线性与注意力机制\"></a> 高次非线性与注意力机制</h2>\n<h3 id=\"特征图乘法\"><span class=\"post-title-index\">1.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#特征图乘法\"></a> 特征图乘法</h3>\n<p>特征图乘法会带来高次非线性。如果把 ResNet 里面的加法改成乘法。</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shortcut(x) + out</span><br><span class=\"line\"><span class=\"comment\"># 修改为</span></span><br><span class=\"line\">shortcut(x) * out</span><br></pre></td></tr></tbody></table></figure>\n<p><strong>可以从两个角度这个乘法</strong></p>\n<ol>\n<li>把 高次非线性，引入到 CNN 中</li>\n<li>把 ResNet 的分支做成一个 3D 的 mask，形成一种无参数增加的 attention module</li>\n</ol>\n<h3 id=\"和数据集有关\"><span class=\"post-title-index\">1.2.2. </span><a class=\"markdownIt-Anchor\" href=\"#和数据集有关\"></a> 和数据集有关</h3>\n<p>在有的数据集上效果挺好，比如 Cifar-100。但是即使在 Cifar-10 上表现都一般。</p>\n<h3 id=\"和优化有关和表达的曲面性质有关\"><span class=\"post-title-index\">1.2.3. </span><a class=\"markdownIt-Anchor\" href=\"#和优化有关和表达的曲面性质有关\"></a> 和优化有关？和表达的曲面性质有关？</h3>\n<p>原因可能有两个</p>\n<ol>\n<li>这样做乘法太粗糙，确实表达能力不行</li>\n<li>优化的问题，乘法带来了梯度的问题，比如方差不可控等，导致优化的情况不好。</li>\n</ol>\n<p>现在其实也没能很清楚是是哪个问题，缺少研究这个问题的手段。</p>\n<p>为了减少优化上的缺陷。尝试过几种方法</p>\n<ol>\n<li>\n<p>为两端加 bn。<code>bn(shortcut(x)) * bn(out)</code></p>\n</li>\n<li>\n<p>把 bn 的 bias 设置为 1，保证 bn(shortcut(x))和 bn(out)的均值都是 1，这样可以\n产生比较稳定的梯度。这个想法是源于</p>\n<p><strong>1. 原始的 shortcut(x) + out。相当于 shortcut(x)乘以了一个 1 的因子，out 也\n乘以了一个 1 的因子。</strong></p>\n<p><strong>2. 保持恒等映射。当 out 是 0 的时候 shorcut 可以容易的实现恒等映射。</strong></p>\n</li>\n</ol>\n<h3 id=\"sigmoid-容易饱和\"><span class=\"post-title-index\">1.2.4. </span><a class=\"markdownIt-Anchor\" href=\"#sigmoid-容易饱和\"></a> sigmoid 容易饱和？</h3>\n<ol start=\"3\">\n<li>像 attention 一样，把一边或者两边都用 sigmoid 函数\n。<code>bn(shortcut(x)) * out.sigmoid()</code>。这样的话，效果也不是很好，而且发现\nsigmoid 函数给人一种感觉。就是训练不充分的感觉，有点像学习率太小，或者减小的\n太快的感觉，所以陷入的局部最优点。猜想这是因为 sigmoid 函数太容易饱和了。</li>\n<li>soft attention 经常利用 sigmoid 函数，是否也存在过饱和的情况。为什么它没有出\n现过饱和现象。1. 用的不多？ 2. 因为是 2d 或者 1d 的？就拿 SE-Net 举例，每个像\n素点其实也都是乘以了 attention 的。只是空间乘以的是同一个 attention。</li>\n</ol>\n<div id=\"footnotes\"><hr><div id=\"footnotelist\"><ol><li id=\"fn:1\">NEURAL TANGENT KERNEL EIGENVALUES ACCURATELY PREDICT GENERALIZATION<a href=\"#fnref:1\" rev=\"footnote\"> ↩</a></li></ol></div></div></body></html>","encrypt":true},{"title":"Regex","top":false,"cover":false,"toc":true,"description":"Learn Regex","abbrlink":"83c5d7ce","date":"2022-04-12T06:57:48.000Z","password":null,"summary":null,"_content":"\n# Regular Expressions in Vim\n\n## Lookahead and Lookbehind\n\nDirectly some examples.\n\nSee `:help /\\@=`, `:help /\\@!`, `:help /\\@<=`, and `:help /\\@<!` for detail.\n\n### Positive lookahead with `\\@=` and negative lookahead with `\\@!`\n\n```tex\nquick fox quick dog quick fox\nquick dog quick fox\ndog fox\n```\n\nFind `quick` if followed by `dog` with `/quick\\( dog\\)\\@=`.\n\nFind `quick` if not followed by `dog` with `/quick\\( dog\\)\\@!`.\n\n### Positive Lookbehind with `\\@<=` and negative Lookbehind with `\\@<!`\n\nFind `fox` preceded by `quick` with `\\(quick \\)\\@<=fox`.\n\nFind `fox` not preceded by `quick` with `\\(quick \\)\\@<!fox`.\n","source":"_posts/Regex.md","raw":"---\ntitle: Regex\ntop: false\ncover: false\ntoc: true\ndescription: Learn Regex\ncategories:\n  - Programming\n  - Utile\n  - Regex\ntags:\n  - Regex\nabbrlink: 83c5d7ce\ndate: 2022-04-12 14:57:48\npassword:\nsummary:\n---\n\n# Regular Expressions in Vim\n\n## Lookahead and Lookbehind\n\nDirectly some examples.\n\nSee `:help /\\@=`, `:help /\\@!`, `:help /\\@<=`, and `:help /\\@<!` for detail.\n\n### Positive lookahead with `\\@=` and negative lookahead with `\\@!`\n\n```tex\nquick fox quick dog quick fox\nquick dog quick fox\ndog fox\n```\n\nFind `quick` if followed by `dog` with `/quick\\( dog\\)\\@=`.\n\nFind `quick` if not followed by `dog` with `/quick\\( dog\\)\\@!`.\n\n### Positive Lookbehind with `\\@<=` and negative Lookbehind with `\\@<!`\n\nFind `fox` preceded by `quick` with `\\(quick \\)\\@<=fox`.\n\nFind `fox` not preceded by `quick` with `\\(quick \\)\\@<!fox`.\n","slug":"Regex","published":1,"updated":"2022-06-13T07:38:40.691Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgr0011y7ml37ekhd3o","content":"<html><head></head><body><h1 id=\"regular-expressions-in-vim\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#regular-expressions-in-vim\"></a> Regular Expressions in Vim</h1>\n<h2 id=\"lookahead-and-lookbehind\"><span class=\"post-title-index\">1.1. </span><a class=\"markdownIt-Anchor\" href=\"#lookahead-and-lookbehind\"></a> Lookahead and Lookbehind</h2>\n<p>Directly some examples.</p>\n<p>See <code>:help /\\@=</code>, <code>:help /\\@!</code>, <code>:help /\\@&lt;=</code>, and <code>:help /\\@&lt;!</code> for detail.</p>\n<h3 id=\"positive-lookahead-with-and-negative-lookahead-with\"><span class=\"post-title-index\">1.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#positive-lookahead-with-and-negative-lookahead-with\"></a> Positive lookahead with <code>\\@=</code> and negative lookahead with <code>\\@!</code></h3>\n<figure class=\"highlight tex\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">quick fox quick dog quick fox</span><br><span class=\"line\">quick dog quick fox</span><br><span class=\"line\">dog fox</span><br></pre></td></tr></tbody></table></figure>\n<p>Find <code>quick</code> if followed by <code>dog</code> with <code>/quick\\( dog\\)\\@=</code>.</p>\n<p>Find <code>quick</code> if not followed by <code>dog</code> with <code>/quick\\( dog\\)\\@!</code>.</p>\n<h3 id=\"positive-lookbehind-with-and-negative-lookbehind-with\"><span class=\"post-title-index\">1.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#positive-lookbehind-with-and-negative-lookbehind-with\"></a> Positive Lookbehind with <code>\\@&lt;=</code> and negative Lookbehind with <code>\\@&lt;!</code></h3>\n<p>Find <code>fox</code> preceded by <code>quick</code> with <code>\\(quick \\)\\@&lt;=fox</code>.</p>\n<p>Find <code>fox</code> not preceded by <code>quick</code> with <code>\\(quick \\)\\@&lt;!fox</code>.</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"regular-expressions-in-vim\"><a class=\"markdownIt-Anchor\" href=\"#regular-expressions-in-vim\"></a> Regular Expressions in Vim</h1>\n<h2 id=\"lookahead-and-lookbehind\"><a class=\"markdownIt-Anchor\" href=\"#lookahead-and-lookbehind\"></a> Lookahead and Lookbehind</h2>\n<p>Directly some examples.</p>\n<p>See <code>:help /\\@=</code>, <code>:help /\\@!</code>, <code>:help /\\@&lt;=</code>, and <code>:help /\\@&lt;!</code> for detail.</p>\n<h3 id=\"positive-lookahead-with-and-negative-lookahead-with\"><a class=\"markdownIt-Anchor\" href=\"#positive-lookahead-with-and-negative-lookahead-with\"></a> Positive lookahead with <code>\\@=</code> and negative lookahead with <code>\\@!</code></h3>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">quick fox quick dog quick fox</span><br><span class=\"line\">quick dog quick fox</span><br><span class=\"line\">dog fox</span><br></pre></td></tr></table></figure>\n<p>Find <code>quick</code> if followed by <code>dog</code> with <code>/quick\\( dog\\)\\@=</code>.</p>\n<p>Find <code>quick</code> if not followed by <code>dog</code> with <code>/quick\\( dog\\)\\@!</code>.</p>\n<h3 id=\"positive-lookbehind-with-and-negative-lookbehind-with\"><a class=\"markdownIt-Anchor\" href=\"#positive-lookbehind-with-and-negative-lookbehind-with\"></a> Positive Lookbehind with <code>\\@&lt;=</code> and negative Lookbehind with <code>\\@&lt;!</code></h3>\n<p>Find <code>fox</code> preceded by <code>quick</code> with <code>\\(quick \\)\\@&lt;=fox</code>.</p>\n<p>Find <code>fox</code> not preceded by <code>quick</code> with <code>\\(quick \\)\\@&lt;!fox</code>.</p>\n"},{"title":"Revealjs","top":false,"cover":false,"toc":true,"description":"Make PPT with Markdown","comments":1,"abbrlink":"b34f5ff8","date":"2022-06-11T01:25:44.000Z","password":null,"summary":null,"_content":"\nIt is hard to use reveal.js when you want to draw something like flow chart.\nThere maybe two solutions for this.\n\n1. Draw them use other tools and include the svg in the reveal.js.\n2. Use the online editor of reveal.js. It provide full feature for PPT. You can\n   design your ppt online and edit the html file by enable the `Developer Mode`.\n   Also you can export the reveal.js version of the html file.\n","source":"_posts/Revealjs.md","raw":"---\ntitle: Revealjs\ntop: false\ncover: false\ntoc: true\ndescription: Make PPT with Markdown\ncomments: true\ncategories:\n  - Programming\n  - Tools\n  - Revealjs\ntags:\n  - Revealjs\n  - PPT\nabbrlink: b34f5ff8\ndate: 2022-06-11 09:25:44\npassword:\nsummary:\n---\n\nIt is hard to use reveal.js when you want to draw something like flow chart.\nThere maybe two solutions for this.\n\n1. Draw them use other tools and include the svg in the reveal.js.\n2. Use the online editor of reveal.js. It provide full feature for PPT. You can\n   design your ppt online and edit the html file by enable the `Developer Mode`.\n   Also you can export the reveal.js version of the html file.\n","slug":"Revealjs","published":1,"updated":"2022-06-13T07:38:40.691Z","layout":"post","photos":[],"link":"","_id":"cl4s7rpgs0014y7mlhy0scdls","content":"<html><head></head><body><p>It is hard to use reveal.js when you want to draw something like flow chart.\nThere maybe two solutions for this.</p>\n<ol>\n<li>Draw them use other tools and include the svg in the reveal.js.</li>\n<li>Use the online editor of reveal.js. It provide full feature for PPT. You can\ndesign your ppt online and edit the html file by enable the <code>Developer Mode</code>.\nAlso you can export the reveal.js version of the html file.</li>\n</ol>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<p>It is hard to use reveal.js when you want to draw something like flow chart.\nThere maybe two solutions for this.</p>\n<ol>\n<li>Draw them use other tools and include the svg in the reveal.js.</li>\n<li>Use the online editor of reveal.js. It provide full feature for PPT. You can\ndesign your ppt online and edit the html file by enable the <code>Developer Mode</code>.\nAlso you can export the reveal.js version of the html file.</li>\n</ol>\n"},{"title":"Shorcut on Linux","top":false,"cover":false,"toc":true,"mathjax":true,"description":"Describe the shortcuts of linux and how to set them","abbrlink":"6d8ab470","date":"2022-02-10T01:22:15.000Z","password":null,"summary":null,"_content":"\n_Root in: I want to find out where the \"kill shortcut\", ctrl C, defined. I use\n`bind -P` to check the shortcuts. However, do not find ctrl C. Thus, I learned\nsomething about the shortcuts on linux. ctrl C is a shortcut of stty. However,\n`bind -P` lists the shortcuts of readline._\n\nThere may be two kinds of shortcuts, in practice,\n\n- stty shortcuts\n- readline shortcuts\n\n# stty (set tty, set teletypewriter)\n\nThe difference between shell, terminal and tty\n\ntty: Print the file name of the terminal connected to standard input.\n\nstty: change or print terminal characteristics, change and print terminal line\nsettings.\n\nThey are related to terminal.\n\n- terminal = tty = text input/output environment\n- console = physical terminal\n- shell = command line interpreter\n\nThe input of terminal or tty will used by readline, but not always readline.\n\n# gun readline - get a line from a user with editing\n\n## Synopsis\n\n```c\n#include <stdio.h>\n#include <readline/readline.h>\n#include <readline/history.h>\n\nchar *\nreadline (const char *prompt)\n\n```\n\n## Description\n\n**readline will read a line from the terminal and return it, using _prompt_ as a\nprompt.**\n\nIf prompt is NULL or the empty string, no prompt is issued. The line returned is\nallocated with `malloc`; the caller must free it when finished. The line\nreturned has the final newline removed, so only the text of the line remains.\n\n## Return Value\n\nreadline returns the text of the line read. A black line returns the empty\nstring. If EOF is encountered while reading a line, and the line is empty, NULL\nis returned. If an EOF is read with a non-empty line, it is treated as a\nnewline.\n\n## Initialization file\n\nReadline is customized by putting commands in an initialization file (the\n`inputrc` file). The name of this file is taken from the value of the INPUTRC\nenvironment variable. If that variable is unset, the default is `~/.inputrc`. If\nthat file does not exist or cannot be read, the ultimate default is\n`/etc/inputrc`.\n\nWhen a program which uses the readline library starts up, the init file is read,\nand the key bindings and variables are set.\n\nThere are only a few basic constructs allowed in the readline init file.\n\n1. Black lines are ignored.\n2. Lines beginning with a `#` are comments.\n3. Lines beginning with a `$` indicate conditional constructs.\n4. Other lines denote key bindings and variable settings.\n\nEach program using this library may add its own commands and bindings.\n\nFor example, placing\n\n```bash\nM-Control-u: universal-argment\n```\n\ninto the `inputrc` would make `M-C-u` execute the readline command\n`universal-argument`.\n\n# The difference of `help` and `man` on linux\n\n`help` displays information about builtin shell commands.\n\n`man` is s system-wide documentation system that provides short reference\nmanuals for individual commands, API functions, concepts, configuration file\nsyntax, file formats. It is the traditional Unix documentation system.\n\nWe can get the information of `cd` by `help cd`, but not by `man cd`. We can get\nthe information of `git/nvim/stty` by `man git/nvim/stty`, but not by\n`help git/nvim/stty`. `cd` is a shell command and `git/nvim/stty` is linux\nprojects.\n","source":"_posts/Shorcut-on-Linux.md","raw":"---\ntitle: Shorcut on Linux\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndescription: Describe the shortcuts of linux and how to set them\ncategories:\n  - Programming\n  - Tools\n  - Linux\ntags:\n  - Linux\nabbrlink: 6d8ab470\ndate: 2022-02-10 09:22:15\npassword:\nsummary:\n---\n\n_Root in: I want to find out where the \"kill shortcut\", ctrl C, defined. I use\n`bind -P` to check the shortcuts. However, do not find ctrl C. Thus, I learned\nsomething about the shortcuts on linux. ctrl C is a shortcut of stty. However,\n`bind -P` lists the shortcuts of readline._\n\nThere may be two kinds of shortcuts, in practice,\n\n- stty shortcuts\n- readline shortcuts\n\n# stty (set tty, set teletypewriter)\n\nThe difference between shell, terminal and tty\n\ntty: Print the file name of the terminal connected to standard input.\n\nstty: change or print terminal characteristics, change and print terminal line\nsettings.\n\nThey are related to terminal.\n\n- terminal = tty = text input/output environment\n- console = physical terminal\n- shell = command line interpreter\n\nThe input of terminal or tty will used by readline, but not always readline.\n\n# gun readline - get a line from a user with editing\n\n## Synopsis\n\n```c\n#include <stdio.h>\n#include <readline/readline.h>\n#include <readline/history.h>\n\nchar *\nreadline (const char *prompt)\n\n```\n\n## Description\n\n**readline will read a line from the terminal and return it, using _prompt_ as a\nprompt.**\n\nIf prompt is NULL or the empty string, no prompt is issued. The line returned is\nallocated with `malloc`; the caller must free it when finished. The line\nreturned has the final newline removed, so only the text of the line remains.\n\n## Return Value\n\nreadline returns the text of the line read. A black line returns the empty\nstring. If EOF is encountered while reading a line, and the line is empty, NULL\nis returned. If an EOF is read with a non-empty line, it is treated as a\nnewline.\n\n## Initialization file\n\nReadline is customized by putting commands in an initialization file (the\n`inputrc` file). The name of this file is taken from the value of the INPUTRC\nenvironment variable. If that variable is unset, the default is `~/.inputrc`. If\nthat file does not exist or cannot be read, the ultimate default is\n`/etc/inputrc`.\n\nWhen a program which uses the readline library starts up, the init file is read,\nand the key bindings and variables are set.\n\nThere are only a few basic constructs allowed in the readline init file.\n\n1. Black lines are ignored.\n2. Lines beginning with a `#` are comments.\n3. Lines beginning with a `$` indicate conditional constructs.\n4. Other lines denote key bindings and variable settings.\n\nEach program using this library may add its own commands and bindings.\n\nFor example, placing\n\n```bash\nM-Control-u: universal-argment\n```\n\ninto the `inputrc` would make `M-C-u` execute the readline command\n`universal-argument`.\n\n# The difference of `help` and `man` on linux\n\n`help` displays information about builtin shell commands.\n\n`man` is s system-wide documentation system that provides short reference\nmanuals for individual commands, API functions, concepts, configuration file\nsyntax, file formats. It is the traditional Unix documentation system.\n\nWe can get the information of `cd` by `help cd`, but not by `man cd`. We can get\nthe information of `git/nvim/stty` by `man git/nvim/stty`, but not by\n`help git/nvim/stty`. `cd` is a shell command and `git/nvim/stty` is linux\nprojects.\n","slug":"Shorcut-on-Linux","published":1,"updated":"2022-06-13T07:38:40.691Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgu0017y7ml2cmv59iz","content":"<html><head></head><body><p><em>Root in: I want to find out where the “kill shortcut”, ctrl C, defined. I use\n<code>bind -P</code> to check the shortcuts. However, do not find ctrl C. Thus, I learned\nsomething about the shortcuts on linux. ctrl C is a shortcut of stty. However,\n<code>bind -P</code> lists the shortcuts of readline.</em></p>\n<p>There may be two kinds of shortcuts, in practice,</p>\n<ul>\n<li>stty shortcuts</li>\n<li>readline shortcuts</li>\n</ul>\n<h1 id=\"stty-set-tty-set-teletypewriter\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#stty-set-tty-set-teletypewriter\"></a> stty (set tty, set teletypewriter)</h1>\n<p>The difference between shell, terminal and tty</p>\n<p>tty: Print the file name of the terminal connected to standard input.</p>\n<p>stty: change or print terminal characteristics, change and print terminal line\nsettings.</p>\n<p>They are related to terminal.</p>\n<ul>\n<li>terminal = tty = text input/output environment</li>\n<li>console = physical terminal</li>\n<li>shell = command line interpreter</li>\n</ul>\n<p>The input of terminal or tty will used by readline, but not always readline.</p>\n<h1 id=\"gun-readline-get-a-line-from-a-user-with-editing\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#gun-readline-get-a-line-from-a-user-with-editing\"></a> gun readline - get a line from a user with editing</h1>\n<h2 id=\"synopsis\"><span class=\"post-title-index\">2.1. </span><a class=\"markdownIt-Anchor\" href=\"#synopsis\"></a> Synopsis</h2>\n<figure class=\"highlight c\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;readline/readline.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;readline/history.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">char</span> *</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">readline</span> <span class=\"params\">(<span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *prompt)</span></span></span><br><span class=\"line\"><span class=\"function\"></span></span><br></pre></td></tr></tbody></table></figure>\n<h2 id=\"description\"><span class=\"post-title-index\">2.2. </span><a class=\"markdownIt-Anchor\" href=\"#description\"></a> Description</h2>\n<p><strong>readline will read a line from the terminal and return it, using <em>prompt</em> as a\nprompt.</strong></p>\n<p>If prompt is NULL or the empty string, no prompt is issued. The line returned is\nallocated with <code>malloc</code>; the caller must free it when finished. The line\nreturned has the final newline removed, so only the text of the line remains.</p>\n<h2 id=\"return-value\"><span class=\"post-title-index\">2.3. </span><a class=\"markdownIt-Anchor\" href=\"#return-value\"></a> Return Value</h2>\n<p>readline returns the text of the line read. A black line returns the empty\nstring. If EOF is encountered while reading a line, and the line is empty, NULL\nis returned. If an EOF is read with a non-empty line, it is treated as a\nnewline.</p>\n<h2 id=\"initialization-file\"><span class=\"post-title-index\">2.4. </span><a class=\"markdownIt-Anchor\" href=\"#initialization-file\"></a> Initialization file</h2>\n<p>Readline is customized by putting commands in an initialization file (the\n<code>inputrc</code> file). The name of this file is taken from the value of the INPUTRC\nenvironment variable. If that variable is unset, the default is <code>~/.inputrc</code>. If\nthat file does not exist or cannot be read, the ultimate default is\n<code>/etc/inputrc</code>.</p>\n<p>When a program which uses the readline library starts up, the init file is read,\nand the key bindings and variables are set.</p>\n<p>There are only a few basic constructs allowed in the readline init file.</p>\n<ol>\n<li>Black lines are ignored.</li>\n<li>Lines beginning with a <code>#</code> are comments.</li>\n<li>Lines beginning with a <code>$</code> indicate conditional constructs.</li>\n<li>Other lines denote key bindings and variable settings.</li>\n</ol>\n<p>Each program using this library may add its own commands and bindings.</p>\n<p>For example, placing</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">M-Control-u: universal-argment</span><br></pre></td></tr></tbody></table></figure>\n<p>into the <code>inputrc</code> would make <code>M-C-u</code> execute the readline command\n<code>universal-argument</code>.</p>\n<h1 id=\"the-difference-of-help-and-man-on-linux\"><span class=\"post-title-index\">3. </span><a class=\"markdownIt-Anchor\" href=\"#the-difference-of-help-and-man-on-linux\"></a> The difference of <code>help</code> and <code>man</code> on linux</h1>\n<p><code>help</code> displays information about builtin shell commands.</p>\n<p><code>man</code> is s system-wide documentation system that provides short reference\nmanuals for individual commands, API functions, concepts, configuration file\nsyntax, file formats. It is the traditional Unix documentation system.</p>\n<p>We can get the information of <code>cd</code> by <code>help cd</code>, but not by <code>man cd</code>. We can get\nthe information of <code>git/nvim/stty</code> by <code>man git/nvim/stty</code>, but not by\n<code>help git/nvim/stty</code>. <code>cd</code> is a shell command and <code>git/nvim/stty</code> is linux\nprojects.</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<p><em>Root in: I want to find out where the “kill shortcut”, ctrl C, defined. I use\n<code>bind -P</code> to check the shortcuts. However, do not find ctrl C. Thus, I learned\nsomething about the shortcuts on linux. ctrl C is a shortcut of stty. However,\n<code>bind -P</code> lists the shortcuts of readline.</em></p>\n<p>There may be two kinds of shortcuts, in practice,</p>\n<ul>\n<li>stty shortcuts</li>\n<li>readline shortcuts</li>\n</ul>\n<h1 id=\"stty-set-tty-set-teletypewriter\"><a class=\"markdownIt-Anchor\" href=\"#stty-set-tty-set-teletypewriter\"></a> stty (set tty, set teletypewriter)</h1>\n<p>The difference between shell, terminal and tty</p>\n<p>tty: Print the file name of the terminal connected to standard input.</p>\n<p>stty: change or print terminal characteristics, change and print terminal line\nsettings.</p>\n<p>They are related to terminal.</p>\n<ul>\n<li>terminal = tty = text input/output environment</li>\n<li>console = physical terminal</li>\n<li>shell = command line interpreter</li>\n</ul>\n<p>The input of terminal or tty will used by readline, but not always readline.</p>\n<h1 id=\"gun-readline-get-a-line-from-a-user-with-editing\"><a class=\"markdownIt-Anchor\" href=\"#gun-readline-get-a-line-from-a-user-with-editing\"></a> gun readline - get a line from a user with editing</h1>\n<h2 id=\"synopsis\"><a class=\"markdownIt-Anchor\" href=\"#synopsis\"></a> Synopsis</h2>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;readline/readline.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;readline/history.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">char</span> *</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">readline</span> <span class=\"params\">(<span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *prompt)</span></span></span><br><span class=\"line\"><span class=\"function\"></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"description\"><a class=\"markdownIt-Anchor\" href=\"#description\"></a> Description</h2>\n<p><strong>readline will read a line from the terminal and return it, using <em>prompt</em> as a\nprompt.</strong></p>\n<p>If prompt is NULL or the empty string, no prompt is issued. The line returned is\nallocated with <code>malloc</code>; the caller must free it when finished. The line\nreturned has the final newline removed, so only the text of the line remains.</p>\n<h2 id=\"return-value\"><a class=\"markdownIt-Anchor\" href=\"#return-value\"></a> Return Value</h2>\n<p>readline returns the text of the line read. A black line returns the empty\nstring. If EOF is encountered while reading a line, and the line is empty, NULL\nis returned. If an EOF is read with a non-empty line, it is treated as a\nnewline.</p>\n<h2 id=\"initialization-file\"><a class=\"markdownIt-Anchor\" href=\"#initialization-file\"></a> Initialization file</h2>\n<p>Readline is customized by putting commands in an initialization file (the\n<code>inputrc</code> file). The name of this file is taken from the value of the INPUTRC\nenvironment variable. If that variable is unset, the default is <code>~/.inputrc</code>. If\nthat file does not exist or cannot be read, the ultimate default is\n<code>/etc/inputrc</code>.</p>\n<p>When a program which uses the readline library starts up, the init file is read,\nand the key bindings and variables are set.</p>\n<p>There are only a few basic constructs allowed in the readline init file.</p>\n<ol>\n<li>Black lines are ignored.</li>\n<li>Lines beginning with a <code>#</code> are comments.</li>\n<li>Lines beginning with a <code>$</code> indicate conditional constructs.</li>\n<li>Other lines denote key bindings and variable settings.</li>\n</ol>\n<p>Each program using this library may add its own commands and bindings.</p>\n<p>For example, placing</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">M-Control-u: universal-argment</span><br></pre></td></tr></table></figure>\n<p>into the <code>inputrc</code> would make <code>M-C-u</code> execute the readline command\n<code>universal-argument</code>.</p>\n<h1 id=\"the-difference-of-help-and-man-on-linux\"><a class=\"markdownIt-Anchor\" href=\"#the-difference-of-help-and-man-on-linux\"></a> The difference of <code>help</code> and <code>man</code> on linux</h1>\n<p><code>help</code> displays information about builtin shell commands.</p>\n<p><code>man</code> is s system-wide documentation system that provides short reference\nmanuals for individual commands, API functions, concepts, configuration file\nsyntax, file formats. It is the traditional Unix documentation system.</p>\n<p>We can get the information of <code>cd</code> by <code>help cd</code>, but not by <code>man cd</code>. We can get\nthe information of <code>git/nvim/stty</code> by <code>man git/nvim/stty</code>, but not by\n<code>help git/nvim/stty</code>. <code>cd</code> is a shell command and <code>git/nvim/stty</code> is linux\nprojects.</p>\n"},{"title":"The First Step to GAN","top":false,"cover":false,"toc":true,"description":"The first step for learning GAN","abbrlink":"5f500d1b","date":"2022-05-13T02:17:22.000Z","password":null,"summary":null,"_content":"\n# Some Characteristics\n\n- Generate samples of real world\n- GANs training process does not depend on the maximum likelihood estimation.\n- GAN does not \"see\" the training data during the training process. Thus it\n  rarely suffers from the over-fitting issue.\n- GAN is good at capturing the distribution of data.\n- GAN does not need labeled data.\n- Meaningful latent vectors.\n\n# The thought of GAN from Game Theory\n\nThe adversarial process of GAN is related to Max-Min game in Game Theory.\n\nThe balance point of the generative model and discriminate model python\n\n# Model Collapse\n\nUsually you want GAN to produce a wide variety of outputs. You want, for\nexample, a different face for every random input to your face generator.\n\nHowever, if a generator produces an especially plausible output, the generator\nmay learn to produce only that output. In fact, the generator is always trying\nto find the one output that seems most plausible to the discriminator.\n\nEach iteration of generator over-optimizes for a particular discriminator, and\nthe discriminator never manages to lean its way out of the trap. As a result the\ngenerators rotate through a small set of output types. This form of GAN failure\nis called **model collapse**.\n\nGAN has a strong relationship with image super-resolution\n\n# Apache Spark\n\nUnified engine for large-scale data analytics. Apache spark is a multi-language\nengine for executing data engineering data science, and machine learning on\nsingle-node machines or clusters.\n\n# BigDL\n\nBigDL is a distributed deep learning library for Apache Spark, with BigDL users\ncan write their deep learning applications as standard Spark programs, which can\ndirectly run on top of existing Spark or Hadoop clusters.\n","source":"_posts/The-First-Step-to-GAN.md","raw":"---\ntitle: The First Step to GAN\ntop: false\ncover: false\ntoc: true\ndescription: The first step for learning GAN\ncategories:\n  - Machine Learning\n  - Methods\n  - Generative Adversarial Network\ntags:\n  - Generative Adversarial Network\nabbrlink: 5f500d1b\ndate: 2022-05-13 10:17:22\npassword:\nsummary:\n---\n\n# Some Characteristics\n\n- Generate samples of real world\n- GANs training process does not depend on the maximum likelihood estimation.\n- GAN does not \"see\" the training data during the training process. Thus it\n  rarely suffers from the over-fitting issue.\n- GAN is good at capturing the distribution of data.\n- GAN does not need labeled data.\n- Meaningful latent vectors.\n\n# The thought of GAN from Game Theory\n\nThe adversarial process of GAN is related to Max-Min game in Game Theory.\n\nThe balance point of the generative model and discriminate model python\n\n# Model Collapse\n\nUsually you want GAN to produce a wide variety of outputs. You want, for\nexample, a different face for every random input to your face generator.\n\nHowever, if a generator produces an especially plausible output, the generator\nmay learn to produce only that output. In fact, the generator is always trying\nto find the one output that seems most plausible to the discriminator.\n\nEach iteration of generator over-optimizes for a particular discriminator, and\nthe discriminator never manages to lean its way out of the trap. As a result the\ngenerators rotate through a small set of output types. This form of GAN failure\nis called **model collapse**.\n\nGAN has a strong relationship with image super-resolution\n\n# Apache Spark\n\nUnified engine for large-scale data analytics. Apache spark is a multi-language\nengine for executing data engineering data science, and machine learning on\nsingle-node machines or clusters.\n\n# BigDL\n\nBigDL is a distributed deep learning library for Apache Spark, with BigDL users\ncan write their deep learning applications as standard Spark programs, which can\ndirectly run on top of existing Spark or Hadoop clusters.\n","slug":"The-First-Step-to-GAN","published":1,"updated":"2022-06-13T07:38:40.691Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgv0019y7ml1dsw1ypg","content":"<html><head></head><body><h1 id=\"some-characteristics\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#some-characteristics\"></a> Some Characteristics</h1>\n<ul>\n<li>Generate samples of real world</li>\n<li>GANs training process does not depend on the maximum likelihood estimation.</li>\n<li>GAN does not “see” the training data during the training process. Thus it\nrarely suffers from the over-fitting issue.</li>\n<li>GAN is good at capturing the distribution of data.</li>\n<li>GAN does not need labeled data.</li>\n<li>Meaningful latent vectors.</li>\n</ul>\n<h1 id=\"the-thought-of-gan-from-game-theory\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#the-thought-of-gan-from-game-theory\"></a> The thought of GAN from Game Theory</h1>\n<p>The adversarial process of GAN is related to Max-Min game in Game Theory.</p>\n<p>The balance point of the generative model and discriminate model python</p>\n<h1 id=\"model-collapse\"><span class=\"post-title-index\">3. </span><a class=\"markdownIt-Anchor\" href=\"#model-collapse\"></a> Model Collapse</h1>\n<p>Usually you want GAN to produce a wide variety of outputs. You want, for\nexample, a different face for every random input to your face generator.</p>\n<p>However, if a generator produces an especially plausible output, the generator\nmay learn to produce only that output. In fact, the generator is always trying\nto find the one output that seems most plausible to the discriminator.</p>\n<p>Each iteration of generator over-optimizes for a particular discriminator, and\nthe discriminator never manages to lean its way out of the trap. As a result the\ngenerators rotate through a small set of output types. This form of GAN failure\nis called <strong>model collapse</strong>.</p>\n<p>GAN has a strong relationship with image super-resolution</p>\n<h1 id=\"apache-spark\"><span class=\"post-title-index\">4. </span><a class=\"markdownIt-Anchor\" href=\"#apache-spark\"></a> Apache Spark</h1>\n<p>Unified engine for large-scale data analytics. Apache spark is a multi-language\nengine for executing data engineering data science, and machine learning on\nsingle-node machines or clusters.</p>\n<h1 id=\"bigdl\"><span class=\"post-title-index\">5. </span><a class=\"markdownIt-Anchor\" href=\"#bigdl\"></a> BigDL</h1>\n<p>BigDL is a distributed deep learning library for Apache Spark, with BigDL users\ncan write their deep learning applications as standard Spark programs, which can\ndirectly run on top of existing Spark or Hadoop clusters.</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"some-characteristics\"><a class=\"markdownIt-Anchor\" href=\"#some-characteristics\"></a> Some Characteristics</h1>\n<ul>\n<li>Generate samples of real world</li>\n<li>GANs training process does not depend on the maximum likelihood estimation.</li>\n<li>GAN does not “see” the training data during the training process. Thus it\nrarely suffers from the over-fitting issue.</li>\n<li>GAN is good at capturing the distribution of data.</li>\n<li>GAN does not need labeled data.</li>\n<li>Meaningful latent vectors.</li>\n</ul>\n<h1 id=\"the-thought-of-gan-from-game-theory\"><a class=\"markdownIt-Anchor\" href=\"#the-thought-of-gan-from-game-theory\"></a> The thought of GAN from Game Theory</h1>\n<p>The adversarial process of GAN is related to Max-Min game in Game Theory.</p>\n<p>The balance point of the generative model and discriminate model python</p>\n<h1 id=\"model-collapse\"><a class=\"markdownIt-Anchor\" href=\"#model-collapse\"></a> Model Collapse</h1>\n<p>Usually you want GAN to produce a wide variety of outputs. You want, for\nexample, a different face for every random input to your face generator.</p>\n<p>However, if a generator produces an especially plausible output, the generator\nmay learn to produce only that output. In fact, the generator is always trying\nto find the one output that seems most plausible to the discriminator.</p>\n<p>Each iteration of generator over-optimizes for a particular discriminator, and\nthe discriminator never manages to lean its way out of the trap. As a result the\ngenerators rotate through a small set of output types. This form of GAN failure\nis called <strong>model collapse</strong>.</p>\n<p>GAN has a strong relationship with image super-resolution</p>\n<h1 id=\"apache-spark\"><a class=\"markdownIt-Anchor\" href=\"#apache-spark\"></a> Apache Spark</h1>\n<p>Unified engine for large-scale data analytics. Apache spark is a multi-language\nengine for executing data engineering data science, and machine learning on\nsingle-node machines or clusters.</p>\n<h1 id=\"bigdl\"><a class=\"markdownIt-Anchor\" href=\"#bigdl\"></a> BigDL</h1>\n<p>BigDL is a distributed deep learning library for Apache Spark, with BigDL users\ncan write their deep learning applications as standard Spark programs, which can\ndirectly run on top of existing Spark or Hadoop clusters.</p>\n"},{"title":"Tips in Papers","top":false,"cover":false,"toc":true,"mathjax":true,"description":"New things for paper reading.","abbrlink":"c94b2364","date":"2021-12-14T08:33:03.000Z","password":null,"summary":null,"_content":"\n# Attention\n\n## Hard and Soft Attention\n\n### Attention Mechanisms in CV: A Survey\n\n## Gumbel-Softmax Hard Attention\n\n### Categorical Reparameterization with Gumbel-Softmax\n\n#### 文章引出了一类神经网络，Stochastic Neural Networks with discrete random variables。\n\n具有离散随机变量的随机神经网络\n\n#### 文章引出了一个方向，Stochastic Gradient Estimation\n\n随机梯度估计，主要的方法就有 dumbel-softmax, score function estimator, biased\npath derivative estimator。\n\n> However, no existing gradient estimator has been formulated specifically for\n> categorical variables.\n\n## Reinforce Learnning Hard Attention\n\n### 2019 Scacader: Improving Accuracy of Hard Attention Models for Vision\n\n#### Hard Attention 选择相关的特征作为输入，是真正具有可解释性的。\n\n从下面第一段话，可以看出，hard attention 是真正和性能挂钩的。也一定和特征重要性\n是吻合的。但是 Soft Attention 不具有可解释性，小权重的特征并不一定不重\n要<div id=\"ap\"></div>\n\n> Our best models narrow the gap to common ImageNet baselines, achieving 75%\n> top-1 and 91% top-5 while attending to less than one-third of the image.We\n> further demonstrate that occluding the image patches prposed by the Saccader\n> model highly impairs classification, thus confirming these patches strong\n> relevance to the classification task.\n\n> Typical soft attention mechanisms rescale features at one or more stages of\n> the network. The soft mask used for rescaling often to provide some insight\n> into the model's decision-making process, but the model's final decision may\n> nonetheless rely on information provided by features with small weights \\[^1]\n\n\\[^1]:2018,Learn to pay attention.\n\n#### 文中 glimpse 的含义，可以理解成每一个位置，即每一个 patch，就是一个 glimpse。\n\n> Models that employ hard attention make decisions based on only a subset of\n> pixel in the input image, typically in the form of a series of glimpses.\n\n#### 文章提出了 Hard Attention 与双阶段目标检测算法的相似性。他们都是截取图像块作为输入，然后进行分类。不同的是，目标检测算法对于目标的位置是有标签的，而 Hard Attention 是无标签的。\n\n> Altough our aim in this work is to perform classification with only\n> image-level class labels, out approach bears some resembalance to two-stage\n> object detection models.\n\n> These models operate by generating many region proposals and then applying a\n> classification model to each proposal.\n\n> Unlike our work, these approaches use ground-truth bounding boxes to train the\n> classification model, and modern architectures also use bounding boxes to\n> supervise the proposal generator.\n\n**目标检测和 Hard Attention 的相似之处在于，他们都同时关注目标的位置和类别。相比\n于目标检测，Hard Attention 可以做的更精细, i.e., 它可以像目标检测一样在图像域上\n挑选特征，它还可以在任意一个特征域里挑选特征；它不仅可以像目标检测一样，挑选空域\n的特征，还可以挑选通道域的特征。**\n\n#### 总结构\n\n<img src=Saccader_Over.jpg width=80% height = 80%>\n\n最上面的 rep. net 以及 logits per location 之前都属于 representation network。这\n部分挺常规，但是使用了‘BagNet’\\[^2]的方法，该方法保持了输出特征图中每个像素的感\n受野大小。\n\n下面的 atten. net 就是几个卷积层的堆叠。没有 attention 机制。到 Sacadder cell 之\n前都是常规操作，除了一个 what 和 where 的 concat 得到 mixed。\n\nSaccader cell 是技术关键点。\n\n**coordinate at time t 的 slice 操作，对于坐标的选择而言，是一个不可导的操作。这\n里是强化学习介入的地方。而且注意，这里 t 是一个序列，最后的 prediction 是求平均\n。**\n\n\\[^2]:2019, Approximating CNNs with bag-of-local-features models works\nsurprisingly well on ImageNet.\n\n#### Saccader cell\n\n<img src=Saccader_Cell.jpg width=80% height = 80%>\n\n值得注意的几点\n\n1.  Cell state 是一个 state 的序列，每个 state 都是一个经过 2d softmax 的\n    logit。这个 logit 表示该 state 预测的位置。\n\n> This cell produces a sequence of locations. Elements in the sequence\n> correctpond to target locations.\n\n2.  需要保证 cell state 中预测之间都是不同的。$C^t$记录了 t 时刻位置探索过的所有\n    位置。那些位置的值是 1。所以$C^{t - 1}$两次介入$C^t$的计算都乘以一个非常小的\n    数$-10^5$ ，这样就保证了在 2d softmax 的时候，探索过的位置无法胜出。\n\n> The cell includes a 2D state ($C^t$) that keeps memory of the visited\n> locations until time t by placing 1 in the corresponding location in the cell\n> state. We use this state to prevent the network from returning to previously\n> seen locations.\n\n**从这里也看出 state 和 sequence 是不同的。state 是记录探索过的位置。从途中可以\n看出 state 是非 01 的，而由 1 可知，sequence 应该是图中右边产生 logic。state 的\n目的，其实也是为了产生 logic。**\n\n3.  在制作$C^t$的过程中，信息来源有两个 mixed feature 和$C^{t - 1}$。最后得到\n    的$C^t$通道是 1，所以 mixed feature 空间维度的压缩是必然的。在压缩的时候，选\n    用了 channel attention 机制。channel attention 机制又需要先空间压缩，这里不\n    像 SE-Net 一样直接压缩空间，而是又做了一个空间的 mask 压缩空间，这个 mask 用\n    了$C^{t - 1}$的信息，去除掉了已经探索的位置信息。\n\n4.  > At test time, the model extracts the logits at time $t$ from the\n    > representation network at location $argmax\\_{i,j}(\\hat{R}^t\\_{i,j})$.The\n    > final prediction is obtained by averaging the extracted logits across all\n    > times.\n\n**Saccader Cell 的关键就在于产生一系列的 sequence。这些 sequence 可以用强化学习\n算法优化，使其可以预测物体的位置，从而就进行了 feature 的选择。**\n\n#### 训练策略\n\n> The goal of our training is to learn a policy that predicts a sequence of\n> visual attentnion locations that is useful to the downsteam task (here image\n> classification) in absence of location labels.\n>\n> We performed a three step training procedure using only the training class\n> lables as supervision.\n\n![](Saccader_eq1.jpg)\n\n1.  预训练了 representation network\n\n这个公式增大了目标$y\\_{target}$的概率。增大的某个位置上$y\\_{target}$的概率，而且\n所有位置连乘之后的概率。这里假设 region of interest 的概率将会被增大的最多。通过\n这种方法就自动学习到了一些好的 position，在强化学习优化的时候，提供了一个好的探\n索的起点。\n\n> Key to Saccader is a pretraining step that require only class lables and\n> provides initial attention locations for policy gradient optimization.\n\n> Our pretraining procedure overcomes the sparse-reward problem that makes hard\n> attention models difficult to optimize. It requires access to only class\n> lables and prvides initial attention locations.These initial locations provide\n> better rewards for the policy gradient learning.\n\n![](Saccader_eq2.jpg)\n\n2.  训练了 location network (attention network, $1 \\times 1$ mixing convolution\n    and Sacader cell)\n\n这是一个自监督的预训练。提高了前 T = 12 次预测的点的概率。\n\n文中说排序了，我感觉排序的次序和预测的次序是一致的。第一次预测是概率最大的，最后\n一次预测是概率最小的。后面实验对比了该预训练对性能的影响。然而\n，<font color =deeppink>现在还并不能完全了解这个预训练的作用机制。 </font>\n\n![](Saccader_eq3.jpg)\n\n3.  > we trained the whole model to maximize the expected reward, where the\n    > reward ($r \\in {0, 1}$) represents whether the model final prediction\n    > after 6 glimpses (T = 6) is correct.\n\n<font color=deeppink>这个公式并没有完全读懂。</font>\n\n用的是策略网络的方法。$l^t_s$是按 saccader cell 输出的位置概率生成的位置。公式的\n第一行就是增大这个概率的值。当模型最后做出了正确预测的时候，r 权重大，损失函数以\n更大的权重增大这个预测的概率，这就是策略网络的方法。等式的第二行是修正分类网络，\n当预测正确的时候，那么有监督的增大这 T 个预测位置在$y\\_{target}$上的准确率\n。<div id=\"空间\"></div>\n\n**由公式 1 和公式 3 看出，对于图像空间，loss 函数只是增大预测点$y\\_{target}$的概\n率，然后不会理会，空间上其他点预测的是什么。**\n\n如果 saccader cell 的性能非常好，那么模型是没问题的。如果 saccader cell 预测会有\n误差，比如抗干扰能力不好，预测到目标以外的 patch 上，那么性能会被影响。\n\n**论文中说\n，[当预测的位置不存在的时候，模型的性能受到很大的影响。那么其实抑制预测之外的位置的，激活值会使得可以解释性更强？](#ap)**\n\n#### 论文对比了 ordered logits policy 和 Saccader\n\n> An ordered logits policy uses the BagNet model to pick the top K locations\n> based on the largest class logits.\n\nOrdered logits policy 选择了在空间上最大激活的位置，作为物体的位置，并把该预测作\n为物体类别的预测。\n\n> The ordered logits policy strats off with accuracy much higher than a random\n> policy, suggesting that the patches it initially picks are meaningful to\n> classification.\n>\n> However, accuracy is still lower than the learned Saccader model, and\n> **performacne improves only slowly with additional glimpese. The ordered\n> logits policy is able to capture some of the features relevant to\n> classification, but it is a greedy policy that produces glimpses that cluster\n> around a few top features (i.e., with low image coverage)**\n\nordered logits policy 的缺陷在于，只关注了最重要的少数的特征。它的预测都围绕在这\n些最重要的特征周围，所以增加 glimpese 的时候，很少新的信息引入，所以 performance\n增长的很慢，而 Saccader 没有这个问题，它关注了完整的信息。\n\n#### 空间上其他位置\n\n如[上文所说](#空间)，Sccader 只优化选中的位置，不管没有被选中的位置。那么当增加\nglimplese 的时候，它的性能应该会受到影响的。但是不是。\n\n> In fact, increasing the number of glimpses beyond the number used for DRAM\n> policy training leads to drop in performane, ulike the Saccader model that\n> generalizes to greater umbers of glimpses.\n\n<img src=Saccader_gl.jpg width=50% height = 50%>\n\n如图可以看出，增大 glimpses 的时候，准确率反而在增加。说明在训练的时候，没有被训\n练到的地方，Saccader 的预测也还可以，与[上文所说](#空间)的理解不同\n。<font color=deeppink>原因是什么还有待探究。</font>\n\n### Hard Attention for Scalable Image Classification\n\n#### 介绍\n\n<img src=Tnet_over.jpg width=50% height = 50%>\n\n> Muti-scale processing in the proposed TNet architecture. Starting from level\n> 1, the image is processed in low resolution to get a coarse description of its\n> content (red cube). Extracted features are used for (hard) selection of image\n> regions worth processing in higher resolution. The process is repeated\n> recursively (here to 2 additional levels). Features from all levels are\n> combined (arrows on the right) to create the final image representation used\n> for classificaiton (blue cube).\n\n先粗后细的粗粒不同尺度的图像，这篇文章使用和实现了 Saccader\n\n## Soft Attention\n\n### NAM, Normalization-based Attention Module\n\n#### 利用网络参数的信息，进一步处理数据（再利用）\n\n> Those methods successfully exploit the mutual information from different\n> dimensions of feawture. However, they lack consideration on the contributing\n> factors of weights, which is capable of furthr suppressing the insignificant\n> channels or pixels.\n\n网络参数本身是表达了一定的信息的，比如某个卷积核提取什么样的信息，本身也代表一种\n信息。神经网络中，每个参数都在图像的处理过程中使用一次，然而，**一次是否就已经用\n完了该参数的信息。它是否还有其他价值？**\n\n文章重复利用了 bn 层中的权重，文章任务 bn 层的权重可以表达特征图的重要程度。然而\nattention 正好又需要特征图的重要程度。所以文章在 attention 中利用了 bn 层的权重\n。**使得 bn 的权重出现重复利用的现象。**\n\n$$\n\\begin{aligned}\natt &= norm(x) \\\\\natt &= att \\times \\gamma + \\delta \\\\\natt &= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &= att.sigmoid() \\times x\n\\end{aligned}\n$$\n\n```python\nclass Channel_Att(nn.Module):\n    def __init__(self, channels, t=16):\n        super(Channel_Att, self).__init__()\n        self.channels = channels\n        self.bn2 = nn.BatchNorm2d(self.channels, affine=True)\n    def forward(self, x):\n        residual = x\n        x = self.bn2(x)\n        weight_bn = self.bn2.weight.data.abs() / torch.sum(self.bn2.weight.data.abs())\n        x = x.permute(0, 2, 3, 1).contiguous()\n        x = torch.mul(weight_bn, x)\n        x = x.permute(0, 3, 1, 2).contiguous()\n        x = torch.sigmoid(x) * residual\n        return x\n```\n\n#### 关于权重稀疏性\n\n> It applies a weightsparsity penalty to the attention modules, thus, making\n> them more computational efficient while retaining similar performance.\n>\n> To suppress the less salient weights, we add a regularization term into the\n> loss function.\n\n$$Loss = \\sum_{(x,y)}l(f(x, W), y) + p\\sum g(\\gamma) + p \\sum g(\\lambda)$$\n\n第一项是正常的损失函数，第二项和第三项的$g（）$是一范数，$\\gamma$是通道注意力中\nbn 的权重，$\\lambda$是空间注意力中 pix normalization 的权重。加上这两项使得通道\n和空间注意力都有了稀疏性。\n\n<font color=deeppink>loss 函数增加了权重的稀疏性，attention 把权重的稀疏性转换为\n了特征的稀疏性，然而这个稀疏性并不是丢弃了特征或者权重，为什么它能够带来\ncomputational efficient? 文章确实有 computational efficient，但是根据实验部分的\n列表，parameter 和 FLOPS 的优势都是这个注意力机制的结构带来的，相比于其他注意力\n机制，它是轻量而且计算低的。但是稀疏性和计算复杂度是无关的。</font>\n\n#### 启发\n\n<font color=deeppink>这篇文章给人一个启发是参数复用，神经网络中所有参数几乎不会\n复用。然而，除了文中提出的这个例子，是否还存在其他需要复用的场景或者理由\n。</font>\n\n<font color=deeppink>参数复用可以看成另一种权值共享，卷积是层内的权值共享，参数\n复用是层间的权值共享，它是一种正则化，它对不变性产生什么影响？</font>\n\n# Regularization\n\n## ADCM: Attentnion Dropout Convolutional Module\n\n![ADCM](ADCM.jpg)\n\n在 CBAM 的基础上加入了正则化，把 CBAM 产生的 attention weights 作为 Drop 的概率\n引导，来对 feature map 进行 drop。是一种对 attention 机制的正则化方法，很容以把\n它误解为 hard attention。\n","source":"_posts/Tips-in-Papers.md","raw":"---\ntitle: Tips in Papers\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndescription: New things for paper reading.\ncategories:\n  - Machine Learning\n  - Paper Reading\ntags:\n  - Paper Reading\nabbrlink: c94b2364\ndate: 2021-12-14 16:33:03\npassword:\nsummary:\n---\n\n# Attention\n\n## Hard and Soft Attention\n\n### Attention Mechanisms in CV: A Survey\n\n## Gumbel-Softmax Hard Attention\n\n### Categorical Reparameterization with Gumbel-Softmax\n\n#### 文章引出了一类神经网络，Stochastic Neural Networks with discrete random variables。\n\n具有离散随机变量的随机神经网络\n\n#### 文章引出了一个方向，Stochastic Gradient Estimation\n\n随机梯度估计，主要的方法就有 dumbel-softmax, score function estimator, biased\npath derivative estimator。\n\n> However, no existing gradient estimator has been formulated specifically for\n> categorical variables.\n\n## Reinforce Learnning Hard Attention\n\n### 2019 Scacader: Improving Accuracy of Hard Attention Models for Vision\n\n#### Hard Attention 选择相关的特征作为输入，是真正具有可解释性的。\n\n从下面第一段话，可以看出，hard attention 是真正和性能挂钩的。也一定和特征重要性\n是吻合的。但是 Soft Attention 不具有可解释性，小权重的特征并不一定不重\n要<div id=\"ap\"></div>\n\n> Our best models narrow the gap to common ImageNet baselines, achieving 75%\n> top-1 and 91% top-5 while attending to less than one-third of the image.We\n> further demonstrate that occluding the image patches prposed by the Saccader\n> model highly impairs classification, thus confirming these patches strong\n> relevance to the classification task.\n\n> Typical soft attention mechanisms rescale features at one or more stages of\n> the network. The soft mask used for rescaling often to provide some insight\n> into the model's decision-making process, but the model's final decision may\n> nonetheless rely on information provided by features with small weights \\[^1]\n\n\\[^1]:2018,Learn to pay attention.\n\n#### 文中 glimpse 的含义，可以理解成每一个位置，即每一个 patch，就是一个 glimpse。\n\n> Models that employ hard attention make decisions based on only a subset of\n> pixel in the input image, typically in the form of a series of glimpses.\n\n#### 文章提出了 Hard Attention 与双阶段目标检测算法的相似性。他们都是截取图像块作为输入，然后进行分类。不同的是，目标检测算法对于目标的位置是有标签的，而 Hard Attention 是无标签的。\n\n> Altough our aim in this work is to perform classification with only\n> image-level class labels, out approach bears some resembalance to two-stage\n> object detection models.\n\n> These models operate by generating many region proposals and then applying a\n> classification model to each proposal.\n\n> Unlike our work, these approaches use ground-truth bounding boxes to train the\n> classification model, and modern architectures also use bounding boxes to\n> supervise the proposal generator.\n\n**目标检测和 Hard Attention 的相似之处在于，他们都同时关注目标的位置和类别。相比\n于目标检测，Hard Attention 可以做的更精细, i.e., 它可以像目标检测一样在图像域上\n挑选特征，它还可以在任意一个特征域里挑选特征；它不仅可以像目标检测一样，挑选空域\n的特征，还可以挑选通道域的特征。**\n\n#### 总结构\n\n<img src=Saccader_Over.jpg width=80% height = 80%>\n\n最上面的 rep. net 以及 logits per location 之前都属于 representation network。这\n部分挺常规，但是使用了‘BagNet’\\[^2]的方法，该方法保持了输出特征图中每个像素的感\n受野大小。\n\n下面的 atten. net 就是几个卷积层的堆叠。没有 attention 机制。到 Sacadder cell 之\n前都是常规操作，除了一个 what 和 where 的 concat 得到 mixed。\n\nSaccader cell 是技术关键点。\n\n**coordinate at time t 的 slice 操作，对于坐标的选择而言，是一个不可导的操作。这\n里是强化学习介入的地方。而且注意，这里 t 是一个序列，最后的 prediction 是求平均\n。**\n\n\\[^2]:2019, Approximating CNNs with bag-of-local-features models works\nsurprisingly well on ImageNet.\n\n#### Saccader cell\n\n<img src=Saccader_Cell.jpg width=80% height = 80%>\n\n值得注意的几点\n\n1.  Cell state 是一个 state 的序列，每个 state 都是一个经过 2d softmax 的\n    logit。这个 logit 表示该 state 预测的位置。\n\n> This cell produces a sequence of locations. Elements in the sequence\n> correctpond to target locations.\n\n2.  需要保证 cell state 中预测之间都是不同的。$C^t$记录了 t 时刻位置探索过的所有\n    位置。那些位置的值是 1。所以$C^{t - 1}$两次介入$C^t$的计算都乘以一个非常小的\n    数$-10^5$ ，这样就保证了在 2d softmax 的时候，探索过的位置无法胜出。\n\n> The cell includes a 2D state ($C^t$) that keeps memory of the visited\n> locations until time t by placing 1 in the corresponding location in the cell\n> state. We use this state to prevent the network from returning to previously\n> seen locations.\n\n**从这里也看出 state 和 sequence 是不同的。state 是记录探索过的位置。从途中可以\n看出 state 是非 01 的，而由 1 可知，sequence 应该是图中右边产生 logic。state 的\n目的，其实也是为了产生 logic。**\n\n3.  在制作$C^t$的过程中，信息来源有两个 mixed feature 和$C^{t - 1}$。最后得到\n    的$C^t$通道是 1，所以 mixed feature 空间维度的压缩是必然的。在压缩的时候，选\n    用了 channel attention 机制。channel attention 机制又需要先空间压缩，这里不\n    像 SE-Net 一样直接压缩空间，而是又做了一个空间的 mask 压缩空间，这个 mask 用\n    了$C^{t - 1}$的信息，去除掉了已经探索的位置信息。\n\n4.  > At test time, the model extracts the logits at time $t$ from the\n    > representation network at location $argmax\\_{i,j}(\\hat{R}^t\\_{i,j})$.The\n    > final prediction is obtained by averaging the extracted logits across all\n    > times.\n\n**Saccader Cell 的关键就在于产生一系列的 sequence。这些 sequence 可以用强化学习\n算法优化，使其可以预测物体的位置，从而就进行了 feature 的选择。**\n\n#### 训练策略\n\n> The goal of our training is to learn a policy that predicts a sequence of\n> visual attentnion locations that is useful to the downsteam task (here image\n> classification) in absence of location labels.\n>\n> We performed a three step training procedure using only the training class\n> lables as supervision.\n\n![](Saccader_eq1.jpg)\n\n1.  预训练了 representation network\n\n这个公式增大了目标$y\\_{target}$的概率。增大的某个位置上$y\\_{target}$的概率，而且\n所有位置连乘之后的概率。这里假设 region of interest 的概率将会被增大的最多。通过\n这种方法就自动学习到了一些好的 position，在强化学习优化的时候，提供了一个好的探\n索的起点。\n\n> Key to Saccader is a pretraining step that require only class lables and\n> provides initial attention locations for policy gradient optimization.\n\n> Our pretraining procedure overcomes the sparse-reward problem that makes hard\n> attention models difficult to optimize. It requires access to only class\n> lables and prvides initial attention locations.These initial locations provide\n> better rewards for the policy gradient learning.\n\n![](Saccader_eq2.jpg)\n\n2.  训练了 location network (attention network, $1 \\times 1$ mixing convolution\n    and Sacader cell)\n\n这是一个自监督的预训练。提高了前 T = 12 次预测的点的概率。\n\n文中说排序了，我感觉排序的次序和预测的次序是一致的。第一次预测是概率最大的，最后\n一次预测是概率最小的。后面实验对比了该预训练对性能的影响。然而\n，<font color =deeppink>现在还并不能完全了解这个预训练的作用机制。 </font>\n\n![](Saccader_eq3.jpg)\n\n3.  > we trained the whole model to maximize the expected reward, where the\n    > reward ($r \\in {0, 1}$) represents whether the model final prediction\n    > after 6 glimpses (T = 6) is correct.\n\n<font color=deeppink>这个公式并没有完全读懂。</font>\n\n用的是策略网络的方法。$l^t_s$是按 saccader cell 输出的位置概率生成的位置。公式的\n第一行就是增大这个概率的值。当模型最后做出了正确预测的时候，r 权重大，损失函数以\n更大的权重增大这个预测的概率，这就是策略网络的方法。等式的第二行是修正分类网络，\n当预测正确的时候，那么有监督的增大这 T 个预测位置在$y\\_{target}$上的准确率\n。<div id=\"空间\"></div>\n\n**由公式 1 和公式 3 看出，对于图像空间，loss 函数只是增大预测点$y\\_{target}$的概\n率，然后不会理会，空间上其他点预测的是什么。**\n\n如果 saccader cell 的性能非常好，那么模型是没问题的。如果 saccader cell 预测会有\n误差，比如抗干扰能力不好，预测到目标以外的 patch 上，那么性能会被影响。\n\n**论文中说\n，[当预测的位置不存在的时候，模型的性能受到很大的影响。那么其实抑制预测之外的位置的，激活值会使得可以解释性更强？](#ap)**\n\n#### 论文对比了 ordered logits policy 和 Saccader\n\n> An ordered logits policy uses the BagNet model to pick the top K locations\n> based on the largest class logits.\n\nOrdered logits policy 选择了在空间上最大激活的位置，作为物体的位置，并把该预测作\n为物体类别的预测。\n\n> The ordered logits policy strats off with accuracy much higher than a random\n> policy, suggesting that the patches it initially picks are meaningful to\n> classification.\n>\n> However, accuracy is still lower than the learned Saccader model, and\n> **performacne improves only slowly with additional glimpese. The ordered\n> logits policy is able to capture some of the features relevant to\n> classification, but it is a greedy policy that produces glimpses that cluster\n> around a few top features (i.e., with low image coverage)**\n\nordered logits policy 的缺陷在于，只关注了最重要的少数的特征。它的预测都围绕在这\n些最重要的特征周围，所以增加 glimpese 的时候，很少新的信息引入，所以 performance\n增长的很慢，而 Saccader 没有这个问题，它关注了完整的信息。\n\n#### 空间上其他位置\n\n如[上文所说](#空间)，Sccader 只优化选中的位置，不管没有被选中的位置。那么当增加\nglimplese 的时候，它的性能应该会受到影响的。但是不是。\n\n> In fact, increasing the number of glimpses beyond the number used for DRAM\n> policy training leads to drop in performane, ulike the Saccader model that\n> generalizes to greater umbers of glimpses.\n\n<img src=Saccader_gl.jpg width=50% height = 50%>\n\n如图可以看出，增大 glimpses 的时候，准确率反而在增加。说明在训练的时候，没有被训\n练到的地方，Saccader 的预测也还可以，与[上文所说](#空间)的理解不同\n。<font color=deeppink>原因是什么还有待探究。</font>\n\n### Hard Attention for Scalable Image Classification\n\n#### 介绍\n\n<img src=Tnet_over.jpg width=50% height = 50%>\n\n> Muti-scale processing in the proposed TNet architecture. Starting from level\n> 1, the image is processed in low resolution to get a coarse description of its\n> content (red cube). Extracted features are used for (hard) selection of image\n> regions worth processing in higher resolution. The process is repeated\n> recursively (here to 2 additional levels). Features from all levels are\n> combined (arrows on the right) to create the final image representation used\n> for classificaiton (blue cube).\n\n先粗后细的粗粒不同尺度的图像，这篇文章使用和实现了 Saccader\n\n## Soft Attention\n\n### NAM, Normalization-based Attention Module\n\n#### 利用网络参数的信息，进一步处理数据（再利用）\n\n> Those methods successfully exploit the mutual information from different\n> dimensions of feawture. However, they lack consideration on the contributing\n> factors of weights, which is capable of furthr suppressing the insignificant\n> channels or pixels.\n\n网络参数本身是表达了一定的信息的，比如某个卷积核提取什么样的信息，本身也代表一种\n信息。神经网络中，每个参数都在图像的处理过程中使用一次，然而，**一次是否就已经用\n完了该参数的信息。它是否还有其他价值？**\n\n文章重复利用了 bn 层中的权重，文章任务 bn 层的权重可以表达特征图的重要程度。然而\nattention 正好又需要特征图的重要程度。所以文章在 attention 中利用了 bn 层的权重\n。**使得 bn 的权重出现重复利用的现象。**\n\n$$\n\\begin{aligned}\natt &= norm(x) \\\\\natt &= att \\times \\gamma + \\delta \\\\\natt &= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &= att.sigmoid() \\times x\n\\end{aligned}\n$$\n\n```python\nclass Channel_Att(nn.Module):\n    def __init__(self, channels, t=16):\n        super(Channel_Att, self).__init__()\n        self.channels = channels\n        self.bn2 = nn.BatchNorm2d(self.channels, affine=True)\n    def forward(self, x):\n        residual = x\n        x = self.bn2(x)\n        weight_bn = self.bn2.weight.data.abs() / torch.sum(self.bn2.weight.data.abs())\n        x = x.permute(0, 2, 3, 1).contiguous()\n        x = torch.mul(weight_bn, x)\n        x = x.permute(0, 3, 1, 2).contiguous()\n        x = torch.sigmoid(x) * residual\n        return x\n```\n\n#### 关于权重稀疏性\n\n> It applies a weightsparsity penalty to the attention modules, thus, making\n> them more computational efficient while retaining similar performance.\n>\n> To suppress the less salient weights, we add a regularization term into the\n> loss function.\n\n$$Loss = \\sum_{(x,y)}l(f(x, W), y) + p\\sum g(\\gamma) + p \\sum g(\\lambda)$$\n\n第一项是正常的损失函数，第二项和第三项的$g（）$是一范数，$\\gamma$是通道注意力中\nbn 的权重，$\\lambda$是空间注意力中 pix normalization 的权重。加上这两项使得通道\n和空间注意力都有了稀疏性。\n\n<font color=deeppink>loss 函数增加了权重的稀疏性，attention 把权重的稀疏性转换为\n了特征的稀疏性，然而这个稀疏性并不是丢弃了特征或者权重，为什么它能够带来\ncomputational efficient? 文章确实有 computational efficient，但是根据实验部分的\n列表，parameter 和 FLOPS 的优势都是这个注意力机制的结构带来的，相比于其他注意力\n机制，它是轻量而且计算低的。但是稀疏性和计算复杂度是无关的。</font>\n\n#### 启发\n\n<font color=deeppink>这篇文章给人一个启发是参数复用，神经网络中所有参数几乎不会\n复用。然而，除了文中提出的这个例子，是否还存在其他需要复用的场景或者理由\n。</font>\n\n<font color=deeppink>参数复用可以看成另一种权值共享，卷积是层内的权值共享，参数\n复用是层间的权值共享，它是一种正则化，它对不变性产生什么影响？</font>\n\n# Regularization\n\n## ADCM: Attentnion Dropout Convolutional Module\n\n![ADCM](ADCM.jpg)\n\n在 CBAM 的基础上加入了正则化，把 CBAM 产生的 attention weights 作为 Drop 的概率\n引导，来对 feature map 进行 drop。是一种对 attention 机制的正则化方法，很容以把\n它误解为 hard attention。\n","slug":"Tips-in-Papers","published":1,"updated":"2022-06-13T07:38:40.694Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgw001cy7ml5clvadp1","content":"<html><head></head><body><h1 id=\"attention\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#attention\"></a> Attention</h1>\n<h2 id=\"hard-and-soft-attention\"><span class=\"post-title-index\">1.1. </span><a class=\"markdownIt-Anchor\" href=\"#hard-and-soft-attention\"></a> Hard and Soft Attention</h2>\n<h3 id=\"attention-mechanisms-in-cv-a-survey\"><span class=\"post-title-index\">1.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#attention-mechanisms-in-cv-a-survey\"></a> Attention Mechanisms in CV: A Survey</h3>\n<h2 id=\"gumbel-softmax-hard-attention\"><span class=\"post-title-index\">1.2. </span><a class=\"markdownIt-Anchor\" href=\"#gumbel-softmax-hard-attention\"></a> Gumbel-Softmax Hard Attention</h2>\n<h3 id=\"categorical-reparameterization-with-gumbel-softmax\"><span class=\"post-title-index\">1.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#categorical-reparameterization-with-gumbel-softmax\"></a> Categorical Reparameterization with Gumbel-Softmax</h3>\n<h4 id=\"文章引出了一类神经网络stochastic-neural-networks-with-discrete-random-variables\"><span class=\"post-title-index\">1.2.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#文章引出了一类神经网络stochastic-neural-networks-with-discrete-random-variables\"></a> 文章引出了一类神经网络，Stochastic Neural Networks with discrete random variables。</h4>\n<p>具有离散随机变量的随机神经网络</p>\n<h4 id=\"文章引出了一个方向stochastic-gradient-estimation\"><span class=\"post-title-index\">1.2.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#文章引出了一个方向stochastic-gradient-estimation\"></a> 文章引出了一个方向，Stochastic Gradient Estimation</h4>\n<p>随机梯度估计，主要的方法就有 dumbel-softmax, score function estimator, biased\npath derivative estimator。</p>\n<blockquote>\n<p>However, no existing gradient estimator has been formulated specifically for\ncategorical variables.</p>\n</blockquote>\n<h2 id=\"reinforce-learnning-hard-attention\"><span class=\"post-title-index\">1.3. </span><a class=\"markdownIt-Anchor\" href=\"#reinforce-learnning-hard-attention\"></a> Reinforce Learnning Hard Attention</h2>\n<h3 id=\"2019-scacader-improving-accuracy-of-hard-attention-models-for-vision\"><span class=\"post-title-index\">1.3.1. </span><a class=\"markdownIt-Anchor\" href=\"#2019-scacader-improving-accuracy-of-hard-attention-models-for-vision\"></a> 2019 Scacader: Improving Accuracy of Hard Attention Models for Vision</h3>\n<h4 id=\"hard-attention-选择相关的特征作为输入是真正具有可解释性的\"><span class=\"post-title-index\">1.3.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#hard-attention-选择相关的特征作为输入是真正具有可解释性的\"></a> Hard Attention 选择相关的特征作为输入，是真正具有可解释性的。</h4>\n<p>从下面第一段话，可以看出，hard attention 是真正和性能挂钩的。也一定和特征重要性\n是吻合的。但是 Soft Attention 不具有可解释性，小权重的特征并不一定不重\n要</p><div id=\"ap\"></div><p></p>\n<blockquote>\n<p>Our best models narrow the gap to common ImageNet baselines, achieving 75%\ntop-1 and 91% top-5 while attending to less than one-third of the image.We\nfurther demonstrate that occluding the image patches prposed by the Saccader\nmodel highly impairs classification, thus confirming these patches strong\nrelevance to the classification task.</p>\n</blockquote>\n<blockquote>\n<p>Typical soft attention mechanisms rescale features at one or more stages of\nthe network. The soft mask used for rescaling often to provide some insight\ninto the model’s decision-making process, but the model’s final decision may\nnonetheless rely on information provided by features with small weights &lt;sup id=“fnref:1”&gt;<a href=\"#fn:1\" rel=\"footnote\">1</a></p>\n</blockquote>\n<p>\\</p>\n<h4 id=\"文中-glimpse-的含义可以理解成每一个位置即每一个-patch就是一个-glimpse\"><span class=\"post-title-index\">1.3.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#文中-glimpse-的含义可以理解成每一个位置即每一个-patch就是一个-glimpse\"></a> 文中 glimpse 的含义，可以理解成每一个位置，即每一个 patch，就是一个 glimpse。</h4>\n<blockquote>\n<p>Models that employ hard attention make decisions based on only a subset of\npixel in the input image, typically in the form of a series of glimpses.</p>\n</blockquote>\n<h4 id=\"文章提出了-hard-attention-与双阶段目标检测算法的相似性-他们都是截取图像块作为输入然后进行分类-不同的是目标检测算法对于目标的位置是有标签的而-hard-attention-是无标签的\"><span class=\"post-title-index\">1.3.1.3. </span><a class=\"markdownIt-Anchor\" href=\"#文章提出了-hard-attention-与双阶段目标检测算法的相似性-他们都是截取图像块作为输入然后进行分类-不同的是目标检测算法对于目标的位置是有标签的而-hard-attention-是无标签的\"></a> 文章提出了 Hard Attention 与双阶段目标检测算法的相似性。他们都是截取图像块作为输入，然后进行分类。不同的是，目标检测算法对于目标的位置是有标签的，而 Hard Attention 是无标签的。</h4>\n<blockquote>\n<p>Altough our aim in this work is to perform classification with only\nimage-level class labels, out approach bears some resembalance to two-stage\nobject detection models.</p>\n</blockquote>\n<blockquote>\n<p>These models operate by generating many region proposals and then applying a\nclassification model to each proposal.</p>\n</blockquote>\n<blockquote>\n<p>Unlike our work, these approaches use ground-truth bounding boxes to train the\nclassification model, and modern architectures also use bounding boxes to\nsupervise the proposal generator.</p>\n</blockquote>\n<p><strong>目标检测和 Hard Attention 的相似之处在于，他们都同时关注目标的位置和类别。相比\n于目标检测，Hard Attention 可以做的更精细, i.e., 它可以像目标检测一样在图像域上\n挑选特征，它还可以在任意一个特征域里挑选特征；它不仅可以像目标检测一样，挑选空域\n的特征，还可以挑选通道域的特征。</strong></p>\n<h4 id=\"总结构\"><span class=\"post-title-index\">1.3.1.4. </span><a class=\"markdownIt-Anchor\" href=\"#总结构\"></a> 总结构</h4>\n<img src=\"Saccader_Over.jpg\" width=\"80%\" height=\"80%\">\n<p>最上面的 rep. net 以及 logits per location 之前都属于 representation network。这\n部分挺常规，但是使用了‘BagNet’&lt;sup id=“fnref:2”&gt;<a href=\"#fn:2\" rel=\"footnote\">2</a>的方法，该方法保持了输出特征图中每个像素的感\n受野大小。</p>\n<p>下面的 atten. net 就是几个卷积层的堆叠。没有 attention 机制。到 Sacadder cell 之\n前都是常规操作，除了一个 what 和 where 的 concat 得到 mixed。</p>\n<p>Saccader cell 是技术关键点。</p>\n<p><strong>coordinate at time t 的 slice 操作，对于坐标的选择而言，是一个不可导的操作。这\n里是强化学习介入的地方。而且注意，这里 t 是一个序列，最后的 prediction 是求平均\n。</strong></p>\n<p>\\</p>\n<h4 id=\"saccader-cell\"><span class=\"post-title-index\">1.3.1.5. </span><a class=\"markdownIt-Anchor\" href=\"#saccader-cell\"></a> Saccader cell</h4>\n<img src=\"Saccader_Cell.jpg\" width=\"80%\" height=\"80%\">\n<p>值得注意的几点</p>\n<ol>\n<li>Cell state 是一个 state 的序列，每个 state 都是一个经过 2d softmax 的\nlogit。这个 logit 表示该 state 预测的位置。</li>\n</ol>\n<blockquote>\n<p>This cell produces a sequence of locations. Elements in the sequence\ncorrectpond to target locations.</p>\n</blockquote>\n<ol start=\"2\">\n<li>需要保证 cell state 中预测之间都是不同的。<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>记录了 t 时刻位置探索过的所有\n位置。那些位置的值是 1。所以<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">C^{t - 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>两次介入<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>的计算都乘以一个非常小的\n数<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>−</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">-10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span> ，这样就保证了在 2d softmax 的时候，探索过的位置无法胜出。</li>\n</ol>\n<blockquote>\n<p>The cell includes a 2D state (<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>) that keeps memory of the visited\nlocations until time t by placing 1 in the corresponding location in the cell\nstate. We use this state to prevent the network from returning to previously\nseen locations.</p>\n</blockquote>\n<p><strong>从这里也看出 state 和 sequence 是不同的。state 是记录探索过的位置。从途中可以\n看出 state 是非 01 的，而由 1 可知，sequence 应该是图中右边产生 logic。state 的\n目的，其实也是为了产生 logic。</strong></p>\n<ol start=\"3\">\n<li>\n<p>在制作<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>的过程中，信息来源有两个 mixed feature 和<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">C^{t - 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>。最后得到\n的<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>通道是 1，所以 mixed feature 空间维度的压缩是必然的。在压缩的时候，选\n用了 channel attention 机制。channel attention 机制又需要先空间压缩，这里不\n像 SE-Net 一样直接压缩空间，而是又做了一个空间的 mask 压缩空间，这个 mask 用\n了<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">C^{t - 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>的信息，去除掉了已经探索的位置信息。</p>\n</li>\n<li>\n<blockquote>\n<p>At test time, the model extracts the logits at time <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span> from the\nrepresentation network at location <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mi>r</mi><mi>g</mi><mi>m</mi><mi>a</mi><mi>x</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow><mo stretchy=\"false\">(</mo><msup><mover accent=\"true\"><mi>R</mi><mo>^</mo></mover><mi>t</mi></msup><mi mathvariant=\"normal\">_</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">argmax\\_{i,j}(\\hat{R}^t\\_{i,j})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.25677em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">x</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9467699999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.00773em;\">R</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.16666em;\">^</span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span><span class=\"mclose\">)</span></span></span></span>.The\nfinal prediction is obtained by averaging the extracted logits across all\ntimes.</p>\n</blockquote>\n</li>\n</ol>\n<p><strong>Saccader Cell 的关键就在于产生一系列的 sequence。这些 sequence 可以用强化学习\n算法优化，使其可以预测物体的位置，从而就进行了 feature 的选择。</strong></p>\n<h4 id=\"训练策略\"><span class=\"post-title-index\">1.3.1.6. </span><a class=\"markdownIt-Anchor\" href=\"#训练策略\"></a> 训练策略</h4>\n<blockquote>\n<p>The goal of our training is to learn a policy that predicts a sequence of\nvisual attentnion locations that is useful to the downsteam task (here image\nclassification) in absence of location labels.</p>\n<p>We performed a three step training procedure using only the training class\nlables as supervision.</p>\n</blockquote>\n<p><img src=\"Saccader_eq1.jpg\" alt=\"\"></p>\n<ol>\n<li>预训练了 representation network</li>\n</ol>\n<p>这个公式增大了目标<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>的概率。增大的某个位置上<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>的概率，而且\n所有位置连乘之后的概率。这里假设 region of interest 的概率将会被增大的最多。通过\n这种方法就自动学习到了一些好的 position，在强化学习优化的时候，提供了一个好的探\n索的起点。</p>\n<blockquote>\n<p>Key to Saccader is a pretraining step that require only class lables and\nprovides initial attention locations for policy gradient optimization.</p>\n</blockquote>\n<blockquote>\n<p>Our pretraining procedure overcomes the sparse-reward problem that makes hard\nattention models difficult to optimize. It requires access to only class\nlables and prvides initial attention locations.These initial locations provide\nbetter rewards for the policy gradient learning.</p>\n</blockquote>\n<p><img src=\"Saccader_eq2.jpg\" alt=\"\"></p>\n<ol start=\"2\">\n<li>训练了 location network (attention network, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>×</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1 \\times 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> mixing convolution\nand Sacader cell)</li>\n</ol>\n<p>这是一个自监督的预训练。提高了前 T = 12 次预测的点的概率。</p>\n<p>文中说排序了，我感觉排序的次序和预测的次序是一致的。第一次预测是概率最大的，最后\n一次预测是概率最小的。后面实验对比了该预训练对性能的影响。然而\n，<font color=\"deeppink\">现在还并不能完全了解这个预训练的作用机制。 </font></p>\n<p><img src=\"Saccader_eq3.jpg\" alt=\"\"></p>\n<ol start=\"3\">\n<li>\n<blockquote>\n<p>we trained the whole model to maximize the expected reward, where the\nreward (<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>r</mi><mo>∈</mo><mrow><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn></mrow></mrow><annotation encoding=\"application/x-tex\">r \\in {0, 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span></span></span></span></span>) represents whether the model final prediction\nafter 6 glimpses (T = 6) is correct.</p>\n</blockquote>\n</li>\n</ol>\n<p><font color=\"deeppink\">这个公式并没有完全读懂。</font></p>\n<p>用的是策略网络的方法。<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mi>l</mi><mi>s</mi><mi>t</mi></msubsup></mrow><annotation encoding=\"application/x-tex\">l^t_s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.040556em;vertical-align:-0.247em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">s</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span></span></span></span>是按 saccader cell 输出的位置概率生成的位置。公式的\n第一行就是增大这个概率的值。当模型最后做出了正确预测的时候，r 权重大，损失函数以\n更大的权重增大这个预测的概率，这就是策略网络的方法。等式的第二行是修正分类网络，\n当预测正确的时候，那么有监督的增大这 T 个预测位置在<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>上的准确率\n。</p><div id=\"空间\"></div><p></p>\n<p><strong>由公式 1 和公式 3 看出，对于图像空间，loss 函数只是增大预测点<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>的概\n率，然后不会理会，空间上其他点预测的是什么。</strong></p>\n<p>如果 saccader cell 的性能非常好，那么模型是没问题的。如果 saccader cell 预测会有\n误差，比如抗干扰能力不好，预测到目标以外的 patch 上，那么性能会被影响。</p>\n<p><strong>论文中说\n，<a href=\"#ap\">当预测的位置不存在的时候，模型的性能受到很大的影响。那么其实抑制预测之外的位置的，激活值会使得可以解释性更强？</a></strong></p>\n<h4 id=\"论文对比了-ordered-logits-policy-和-saccader\"><span class=\"post-title-index\">1.3.1.7. </span><a class=\"markdownIt-Anchor\" href=\"#论文对比了-ordered-logits-policy-和-saccader\"></a> 论文对比了 ordered logits policy 和 Saccader</h4>\n<blockquote>\n<p>An ordered logits policy uses the BagNet model to pick the top K locations\nbased on the largest class logits.</p>\n</blockquote>\n<p>Ordered logits policy 选择了在空间上最大激活的位置，作为物体的位置，并把该预测作\n为物体类别的预测。</p>\n<blockquote>\n<p>The ordered logits policy strats off with accuracy much higher than a random\npolicy, suggesting that the patches it initially picks are meaningful to\nclassification.</p>\n<p>However, accuracy is still lower than the learned Saccader model, and\n<strong>performacne improves only slowly with additional glimpese. The ordered\nlogits policy is able to capture some of the features relevant to\nclassification, but it is a greedy policy that produces glimpses that cluster\naround a few top features (i.e., with low image coverage)</strong></p>\n</blockquote>\n<p>ordered logits policy 的缺陷在于，只关注了最重要的少数的特征。它的预测都围绕在这\n些最重要的特征周围，所以增加 glimpese 的时候，很少新的信息引入，所以 performance\n增长的很慢，而 Saccader 没有这个问题，它关注了完整的信息。</p>\n<h4 id=\"空间上其他位置\"><span class=\"post-title-index\">1.3.1.8. </span><a class=\"markdownIt-Anchor\" href=\"#空间上其他位置\"></a> 空间上其他位置</h4>\n<p>如<a href=\"#%E7%A9%BA%E9%97%B4\">上文所说</a>，Sccader 只优化选中的位置，不管没有被选中的位置。那么当增加\nglimplese 的时候，它的性能应该会受到影响的。但是不是。</p>\n<blockquote>\n<p>In fact, increasing the number of glimpses beyond the number used for DRAM\npolicy training leads to drop in performane, ulike the Saccader model that\ngeneralizes to greater umbers of glimpses.</p>\n</blockquote>\n<img src=\"Saccader_gl.jpg\" width=\"50%\" height=\"50%\">\n<p>如图可以看出，增大 glimpses 的时候，准确率反而在增加。说明在训练的时候，没有被训\n练到的地方，Saccader 的预测也还可以，与<a href=\"#%E7%A9%BA%E9%97%B4\">上文所说</a>的理解不同\n。<font color=\"deeppink\">原因是什么还有待探究。</font></p>\n<h3 id=\"hard-attention-for-scalable-image-classification\"><span class=\"post-title-index\">1.3.2. </span><a class=\"markdownIt-Anchor\" href=\"#hard-attention-for-scalable-image-classification\"></a> Hard Attention for Scalable Image Classification</h3>\n<h4 id=\"介绍\"><span class=\"post-title-index\">1.3.2.1. </span><a class=\"markdownIt-Anchor\" href=\"#介绍\"></a> 介绍</h4>\n<img src=\"Tnet_over.jpg\" width=\"50%\" height=\"50%\">\n<blockquote>\n<p>Muti-scale processing in the proposed TNet architecture. Starting from level\n1, the image is processed in low resolution to get a coarse description of its\ncontent (red cube). Extracted features are used for (hard) selection of image\nregions worth processing in higher resolution. The process is repeated\nrecursively (here to 2 additional levels). Features from all levels are\ncombined (arrows on the right) to create the final image representation used\nfor classificaiton (blue cube).</p>\n</blockquote>\n<p>先粗后细的粗粒不同尺度的图像，这篇文章使用和实现了 Saccader</p>\n<h2 id=\"soft-attention\"><span class=\"post-title-index\">1.4. </span><a class=\"markdownIt-Anchor\" href=\"#soft-attention\"></a> Soft Attention</h2>\n<h3 id=\"nam-normalization-based-attention-module\"><span class=\"post-title-index\">1.4.1. </span><a class=\"markdownIt-Anchor\" href=\"#nam-normalization-based-attention-module\"></a> NAM, Normalization-based Attention Module</h3>\n<h4 id=\"利用网络参数的信息进一步处理数据再利用\"><span class=\"post-title-index\">1.4.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#利用网络参数的信息进一步处理数据再利用\"></a> 利用网络参数的信息，进一步处理数据（再利用）</h4>\n<blockquote>\n<p>Those methods successfully exploit the mutual information from different\ndimensions of feawture. However, they lack consideration on the contributing\nfactors of weights, which is capable of furthr suppressing the insignificant\nchannels or pixels.</p>\n</blockquote>\n<p>网络参数本身是表达了一定的信息的，比如某个卷积核提取什么样的信息，本身也代表一种\n信息。神经网络中，每个参数都在图像的处理过程中使用一次，然而，<strong>一次是否就已经用\n完了该参数的信息。它是否还有其他价值？</strong></p>\n<p>文章重复利用了 bn 层中的权重，文章任务 bn 层的权重可以表达特征图的重要程度。然而\nattention 正好又需要特征图的重要程度。所以文章在 attention 中利用了 bn 层的权重\n。<strong>使得 bn 的权重出现重复利用的现象。</strong></p>\n<p class=\"katex-block\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>a</mi><mi>t</mi><mi>t</mi><mo>×</mo><mi>γ</mi><mo>+</mo><mi>δ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>a</mi><mi>t</mi><mi>t</mi><mo>×</mo><mfrac><mi>γ</mi><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo stretchy=\"false\">(</mo><mi>γ</mi><mo stretchy=\"false\">)</mo></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>a</mi><mi>t</mi><mi>t</mi><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>o</mi><mi>i</mi><mi>d</mi><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">)</mo><mo>×</mo><mi>x</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\natt &amp;= norm(x) \\\\\natt &amp;= att \\times \\gamma + \\delta \\\\\natt &amp;= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &amp;= att.sigmoid() \\times x\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:6.84356em;vertical-align:-3.1717800000000005em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.67178em;\"><span style=\"top:-5.93934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span></span></span><span style=\"top:-4.43934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span></span></span><span style=\"top:-2.671779999999999em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span></span></span><span style=\"top:-0.5957799999999995em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">t</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.1717800000000005em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.67178em;\"><span style=\"top:-5.93934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\">m</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mclose\">)</span></span></span><span style=\"top:-4.43934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03785em;\">δ</span></span></span><span style=\"top:-2.671779999999999em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1075599999999999em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">m</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-0.5957799999999995em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span><span class=\"mord\">.</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">d</span><span class=\"mopen\">(</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.1717800000000005em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Channel_Att</span>(<span class=\"params\">nn.Module</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, channels, t=<span class=\"number\">16</span></span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(Channel_Att, self).__init__()</span><br><span class=\"line\">        self.channels = channels</span><br><span class=\"line\">        self.bn2 = nn.BatchNorm2d(self.channels, affine=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">forward</span>(<span class=\"params\">self, x</span>):</span></span><br><span class=\"line\">        residual = x</span><br><span class=\"line\">        x = self.bn2(x)</span><br><span class=\"line\">        weight_bn = self.bn2.weight.data.<span class=\"built_in\">abs</span>() / torch.<span class=\"built_in\">sum</span>(self.bn2.weight.data.<span class=\"built_in\">abs</span>())</span><br><span class=\"line\">        x = x.permute(<span class=\"number\">0</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>).contiguous()</span><br><span class=\"line\">        x = torch.mul(weight_bn, x)</span><br><span class=\"line\">        x = x.permute(<span class=\"number\">0</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>).contiguous()</span><br><span class=\"line\">        x = torch.sigmoid(x) * residual</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x</span><br></pre></td></tr></tbody></table></figure>\n<h4 id=\"关于权重稀疏性\"><span class=\"post-title-index\">1.4.1.2. </span><a class=\"markdownIt-Anchor\" href=\"#关于权重稀疏性\"></a> 关于权重稀疏性</h4>\n<blockquote>\n<p>It applies a weightsparsity penalty to the attention modules, thus, making\nthem more computational efficient while retaining similar performance.</p>\n<p>To suppress the less salient weights, we add a regularization term into the\nloss function.</p>\n</blockquote>\n<p class=\"katex-block\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><munder><mo>∑</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></munder><mi>l</mi><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>W</mi><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>p</mi><mo>∑</mo><mi>g</mi><mo stretchy=\"false\">(</mo><mi>γ</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>p</mi><mo>∑</mo><mi>g</mi><mo stretchy=\"false\">(</mo><mi>λ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Loss = \\sum_{(x,y)}l(f(x, W), y) + p\\sum g(\\gamma) + p \\sum g(\\lambda)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">L</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.5660100000000003em;vertical-align:-1.516005em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.050005em;\"><span style=\"top:-1.808995em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathdefault mtight\">x</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose mtight\">)</span></span></span></span><span style=\"top:-3.0500049999999996em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.516005em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">λ</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>第一项是正常的损失函数，第二项和第三项的<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>g</mi><mi mathvariant=\"normal\">（</mi><mi mathvariant=\"normal\">）</mi></mrow><annotation encoding=\"application/x-tex\">g（）</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord cjk_fallback\">（</span><span class=\"mord cjk_fallback\">）</span></span></span></span>是一范数，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span></span></span></span>是通道注意力中\nbn 的权重，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">λ</span></span></span></span>是空间注意力中 pix normalization 的权重。加上这两项使得通道\n和空间注意力都有了稀疏性。</p>\n<p><font color=\"deeppink\">loss 函数增加了权重的稀疏性，attention 把权重的稀疏性转换为\n了特征的稀疏性，然而这个稀疏性并不是丢弃了特征或者权重，为什么它能够带来\ncomputational efficient? 文章确实有 computational efficient，但是根据实验部分的\n列表，parameter 和 FLOPS 的优势都是这个注意力机制的结构带来的，相比于其他注意力\n机制，它是轻量而且计算低的。但是稀疏性和计算复杂度是无关的。</font></p>\n<h4 id=\"启发\"><span class=\"post-title-index\">1.4.1.3. </span><a class=\"markdownIt-Anchor\" href=\"#启发\"></a> 启发</h4>\n<p><font color=\"deeppink\">这篇文章给人一个启发是参数复用，神经网络中所有参数几乎不会\n复用。然而，除了文中提出的这个例子，是否还存在其他需要复用的场景或者理由\n。</font></p>\n<p><font color=\"deeppink\">参数复用可以看成另一种权值共享，卷积是层内的权值共享，参数\n复用是层间的权值共享，它是一种正则化，它对不变性产生什么影响？</font></p>\n<h1 id=\"regularization\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#regularization\"></a> Regularization</h1>\n<h2 id=\"adcm-attentnion-dropout-convolutional-module\"><span class=\"post-title-index\">2.1. </span><a class=\"markdownIt-Anchor\" href=\"#adcm-attentnion-dropout-convolutional-module\"></a> ADCM: Attentnion Dropout Convolutional Module</h2>\n<p><img src=\"ADCM.jpg\" alt=\"ADCM\"></p>\n<p>在 CBAM 的基础上加入了正则化，把 CBAM 产生的 attention weights 作为 Drop 的概率\n引导，来对 feature map 进行 drop。是一种对 attention 机制的正则化方法，很容以把\n它误解为 hard attention。</p>\n<div id=\"footnotes\"><hr><div id=\"footnotelist\"><ol><li id=\"fn:1\">2018,Learn to pay attention.<a href=\"#fnref:1\" rev=\"footnote\"> ↩</a></li><li id=\"fn:2\">2019, Approximating CNNs with bag-of-local-features models works\nsurprisingly well on ImageNet.<a href=\"#fnref:2\" rev=\"footnote\"> ↩</a></li></ol></div></div></body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"attention\"><a class=\"markdownIt-Anchor\" href=\"#attention\"></a> Attention</h1>\n<h2 id=\"hard-and-soft-attention\"><a class=\"markdownIt-Anchor\" href=\"#hard-and-soft-attention\"></a> Hard and Soft Attention</h2>\n<h3 id=\"attention-mechanisms-in-cv-a-survey\"><a class=\"markdownIt-Anchor\" href=\"#attention-mechanisms-in-cv-a-survey\"></a> Attention Mechanisms in CV: A Survey</h3>\n<h2 id=\"gumbel-softmax-hard-attention\"><a class=\"markdownIt-Anchor\" href=\"#gumbel-softmax-hard-attention\"></a> Gumbel-Softmax Hard Attention</h2>\n<h3 id=\"categorical-reparameterization-with-gumbel-softmax\"><a class=\"markdownIt-Anchor\" href=\"#categorical-reparameterization-with-gumbel-softmax\"></a> Categorical Reparameterization with Gumbel-Softmax</h3>\n<h4 id=\"文章引出了一类神经网络stochastic-neural-networks-with-discrete-random-variables\"><a class=\"markdownIt-Anchor\" href=\"#文章引出了一类神经网络stochastic-neural-networks-with-discrete-random-variables\"></a> 文章引出了一类神经网络，Stochastic Neural Networks with discrete random variables。</h4>\n<p>具有离散随机变量的随机神经网络</p>\n<h4 id=\"文章引出了一个方向stochastic-gradient-estimation\"><a class=\"markdownIt-Anchor\" href=\"#文章引出了一个方向stochastic-gradient-estimation\"></a> 文章引出了一个方向，Stochastic Gradient Estimation</h4>\n<p>随机梯度估计，主要的方法就有 dumbel-softmax, score function estimator, biased\npath derivative estimator。</p>\n<blockquote>\n<p>However, no existing gradient estimator has been formulated specifically for\ncategorical variables.</p>\n</blockquote>\n<h2 id=\"reinforce-learnning-hard-attention\"><a class=\"markdownIt-Anchor\" href=\"#reinforce-learnning-hard-attention\"></a> Reinforce Learnning Hard Attention</h2>\n<h3 id=\"2019-scacader-improving-accuracy-of-hard-attention-models-for-vision\"><a class=\"markdownIt-Anchor\" href=\"#2019-scacader-improving-accuracy-of-hard-attention-models-for-vision\"></a> 2019 Scacader: Improving Accuracy of Hard Attention Models for Vision</h3>\n<h4 id=\"hard-attention-选择相关的特征作为输入是真正具有可解释性的\"><a class=\"markdownIt-Anchor\" href=\"#hard-attention-选择相关的特征作为输入是真正具有可解释性的\"></a> Hard Attention 选择相关的特征作为输入，是真正具有可解释性的。</h4>\n<p>从下面第一段话，可以看出，hard attention 是真正和性能挂钩的。也一定和特征重要性\n是吻合的。但是 Soft Attention 不具有可解释性，小权重的特征并不一定不重\n要<div id=\"ap\"></div></p>\n<blockquote>\n<p>Our best models narrow the gap to common ImageNet baselines, achieving 75%\ntop-1 and 91% top-5 while attending to less than one-third of the image.We\nfurther demonstrate that occluding the image patches prposed by the Saccader\nmodel highly impairs classification, thus confirming these patches strong\nrelevance to the classification task.</p>\n</blockquote>\n<blockquote>\n<p>Typical soft attention mechanisms rescale features at one or more stages of\nthe network. The soft mask used for rescaling often to provide some insight\ninto the model’s decision-making process, but the model’s final decision may\nnonetheless rely on information provided by features with small weights &lt;sup id=“fnref:1”&gt;<a href=\"#fn:1\" rel=\"footnote\">1</a></sup></p>\n</blockquote>\n<p>\\</p>\n<h4 id=\"文中-glimpse-的含义可以理解成每一个位置即每一个-patch就是一个-glimpse\"><a class=\"markdownIt-Anchor\" href=\"#文中-glimpse-的含义可以理解成每一个位置即每一个-patch就是一个-glimpse\"></a> 文中 glimpse 的含义，可以理解成每一个位置，即每一个 patch，就是一个 glimpse。</h4>\n<blockquote>\n<p>Models that employ hard attention make decisions based on only a subset of\npixel in the input image, typically in the form of a series of glimpses.</p>\n</blockquote>\n<h4 id=\"文章提出了-hard-attention-与双阶段目标检测算法的相似性-他们都是截取图像块作为输入然后进行分类-不同的是目标检测算法对于目标的位置是有标签的而-hard-attention-是无标签的\"><a class=\"markdownIt-Anchor\" href=\"#文章提出了-hard-attention-与双阶段目标检测算法的相似性-他们都是截取图像块作为输入然后进行分类-不同的是目标检测算法对于目标的位置是有标签的而-hard-attention-是无标签的\"></a> 文章提出了 Hard Attention 与双阶段目标检测算法的相似性。他们都是截取图像块作为输入，然后进行分类。不同的是，目标检测算法对于目标的位置是有标签的，而 Hard Attention 是无标签的。</h4>\n<blockquote>\n<p>Altough our aim in this work is to perform classification with only\nimage-level class labels, out approach bears some resembalance to two-stage\nobject detection models.</p>\n</blockquote>\n<blockquote>\n<p>These models operate by generating many region proposals and then applying a\nclassification model to each proposal.</p>\n</blockquote>\n<blockquote>\n<p>Unlike our work, these approaches use ground-truth bounding boxes to train the\nclassification model, and modern architectures also use bounding boxes to\nsupervise the proposal generator.</p>\n</blockquote>\n<p><strong>目标检测和 Hard Attention 的相似之处在于，他们都同时关注目标的位置和类别。相比\n于目标检测，Hard Attention 可以做的更精细, i.e., 它可以像目标检测一样在图像域上\n挑选特征，它还可以在任意一个特征域里挑选特征；它不仅可以像目标检测一样，挑选空域\n的特征，还可以挑选通道域的特征。</strong></p>\n<h4 id=\"总结构\"><a class=\"markdownIt-Anchor\" href=\"#总结构\"></a> 总结构</h4>\n<img src=Saccader_Over.jpg width=80% height = 80%>\n<p>最上面的 rep. net 以及 logits per location 之前都属于 representation network。这\n部分挺常规，但是使用了‘BagNet’&lt;sup id=“fnref:2”&gt;<a href=\"#fn:2\" rel=\"footnote\">2</a></sup>的方法，该方法保持了输出特征图中每个像素的感\n受野大小。</p>\n<p>下面的 atten. net 就是几个卷积层的堆叠。没有 attention 机制。到 Sacadder cell 之\n前都是常规操作，除了一个 what 和 where 的 concat 得到 mixed。</p>\n<p>Saccader cell 是技术关键点。</p>\n<p><strong>coordinate at time t 的 slice 操作，对于坐标的选择而言，是一个不可导的操作。这\n里是强化学习介入的地方。而且注意，这里 t 是一个序列，最后的 prediction 是求平均\n。</strong></p>\n<p>\\</p>\n<h4 id=\"saccader-cell\"><a class=\"markdownIt-Anchor\" href=\"#saccader-cell\"></a> Saccader cell</h4>\n<img src=Saccader_Cell.jpg width=80% height = 80%>\n<p>值得注意的几点</p>\n<ol>\n<li>Cell state 是一个 state 的序列，每个 state 都是一个经过 2d softmax 的\nlogit。这个 logit 表示该 state 预测的位置。</li>\n</ol>\n<blockquote>\n<p>This cell produces a sequence of locations. Elements in the sequence\ncorrectpond to target locations.</p>\n</blockquote>\n<ol start=\"2\">\n<li>需要保证 cell state 中预测之间都是不同的。<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>记录了 t 时刻位置探索过的所有\n位置。那些位置的值是 1。所以<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">C^{t - 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>两次介入<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>的计算都乘以一个非常小的\n数<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>−</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">-10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span> ，这样就保证了在 2d softmax 的时候，探索过的位置无法胜出。</li>\n</ol>\n<blockquote>\n<p>The cell includes a 2D state (<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>) that keeps memory of the visited\nlocations until time t by placing 1 in the corresponding location in the cell\nstate. We use this state to prevent the network from returning to previously\nseen locations.</p>\n</blockquote>\n<p><strong>从这里也看出 state 和 sequence 是不同的。state 是记录探索过的位置。从途中可以\n看出 state 是非 01 的，而由 1 可知，sequence 应该是图中右边产生 logic。state 的\n目的，其实也是为了产生 logic。</strong></p>\n<ol start=\"3\">\n<li>\n<p>在制作<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>的过程中，信息来源有两个 mixed feature 和<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">C^{t - 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>。最后得到\n的<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">C^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span>通道是 1，所以 mixed feature 空间维度的压缩是必然的。在压缩的时候，选\n用了 channel attention 机制。channel attention 机制又需要先空间压缩，这里不\n像 SE-Net 一样直接压缩空间，而是又做了一个空间的 mask 压缩空间，这个 mask 用\n了<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">C^{t - 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">t</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>的信息，去除掉了已经探索的位置信息。</p>\n</li>\n<li>\n<blockquote>\n<p>At test time, the model extracts the logits at time <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span> from the\nrepresentation network at location <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mi>r</mi><mi>g</mi><mi>m</mi><mi>a</mi><mi>x</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow><mo stretchy=\"false\">(</mo><msup><mover accent=\"true\"><mi>R</mi><mo>^</mo></mover><mi>t</mi></msup><mi mathvariant=\"normal\">_</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">argmax\\_{i,j}(\\hat{R}^t\\_{i,j})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.25677em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">x</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9467699999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.00773em;\">R</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.16666em;\">^</span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span><span class=\"mclose\">)</span></span></span></span>.The\nfinal prediction is obtained by averaging the extracted logits across all\ntimes.</p>\n</blockquote>\n</li>\n</ol>\n<p><strong>Saccader Cell 的关键就在于产生一系列的 sequence。这些 sequence 可以用强化学习\n算法优化，使其可以预测物体的位置，从而就进行了 feature 的选择。</strong></p>\n<h4 id=\"训练策略\"><a class=\"markdownIt-Anchor\" href=\"#训练策略\"></a> 训练策略</h4>\n<blockquote>\n<p>The goal of our training is to learn a policy that predicts a sequence of\nvisual attentnion locations that is useful to the downsteam task (here image\nclassification) in absence of location labels.</p>\n<p>We performed a three step training procedure using only the training class\nlables as supervision.</p>\n</blockquote>\n<p><img src=\"Saccader_eq1.jpg\" alt=\"\" /></p>\n<ol>\n<li>预训练了 representation network</li>\n</ol>\n<p>这个公式增大了目标<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>的概率。增大的某个位置上<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>的概率，而且\n所有位置连乘之后的概率。这里假设 region of interest 的概率将会被增大的最多。通过\n这种方法就自动学习到了一些好的 position，在强化学习优化的时候，提供了一个好的探\n索的起点。</p>\n<blockquote>\n<p>Key to Saccader is a pretraining step that require only class lables and\nprovides initial attention locations for policy gradient optimization.</p>\n</blockquote>\n<blockquote>\n<p>Our pretraining procedure overcomes the sparse-reward problem that makes hard\nattention models difficult to optimize. It requires access to only class\nlables and prvides initial attention locations.These initial locations provide\nbetter rewards for the policy gradient learning.</p>\n</blockquote>\n<p><img src=\"Saccader_eq2.jpg\" alt=\"\" /></p>\n<ol start=\"2\">\n<li>训练了 location network (attention network, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>×</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1 \\times 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> mixing convolution\nand Sacader cell)</li>\n</ol>\n<p>这是一个自监督的预训练。提高了前 T = 12 次预测的点的概率。</p>\n<p>文中说排序了，我感觉排序的次序和预测的次序是一致的。第一次预测是概率最大的，最后\n一次预测是概率最小的。后面实验对比了该预训练对性能的影响。然而\n，<font color =deeppink>现在还并不能完全了解这个预训练的作用机制。 </font></p>\n<p><img src=\"Saccader_eq3.jpg\" alt=\"\" /></p>\n<ol start=\"3\">\n<li>\n<blockquote>\n<p>we trained the whole model to maximize the expected reward, where the\nreward (<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>r</mi><mo>∈</mo><mrow><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn></mrow></mrow><annotation encoding=\"application/x-tex\">r \\in {0, 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span></span></span></span></span>) represents whether the model final prediction\nafter 6 glimpses (T = 6) is correct.</p>\n</blockquote>\n</li>\n</ol>\n<p><font color=deeppink>这个公式并没有完全读懂。</font></p>\n<p>用的是策略网络的方法。<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mi>l</mi><mi>s</mi><mi>t</mi></msubsup></mrow><annotation encoding=\"application/x-tex\">l^t_s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.040556em;vertical-align:-0.247em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">s</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span></span></span></span>是按 saccader cell 输出的位置概率生成的位置。公式的\n第一行就是增大这个概率的值。当模型最后做出了正确预测的时候，r 权重大，损失函数以\n更大的权重增大这个预测的概率，这就是策略网络的方法。等式的第二行是修正分类网络，\n当预测正确的时候，那么有监督的增大这 T 个预测位置在<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>上的准确率\n。<div id=\"空间\"></div></p>\n<p><strong>由公式 1 和公式 3 看出，对于图像空间，loss 函数只是增大预测点<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mi mathvariant=\"normal\">_</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mrow><annotation encoding=\"application/x-tex\">y\\_{target}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9250799999999999em;vertical-align:-0.31em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span></span></span></span></span>的概\n率，然后不会理会，空间上其他点预测的是什么。</strong></p>\n<p>如果 saccader cell 的性能非常好，那么模型是没问题的。如果 saccader cell 预测会有\n误差，比如抗干扰能力不好，预测到目标以外的 patch 上，那么性能会被影响。</p>\n<p><strong>论文中说\n，<a href=\"#ap\">当预测的位置不存在的时候，模型的性能受到很大的影响。那么其实抑制预测之外的位置的，激活值会使得可以解释性更强？</a></strong></p>\n<h4 id=\"论文对比了-ordered-logits-policy-和-saccader\"><a class=\"markdownIt-Anchor\" href=\"#论文对比了-ordered-logits-policy-和-saccader\"></a> 论文对比了 ordered logits policy 和 Saccader</h4>\n<blockquote>\n<p>An ordered logits policy uses the BagNet model to pick the top K locations\nbased on the largest class logits.</p>\n</blockquote>\n<p>Ordered logits policy 选择了在空间上最大激活的位置，作为物体的位置，并把该预测作\n为物体类别的预测。</p>\n<blockquote>\n<p>The ordered logits policy strats off with accuracy much higher than a random\npolicy, suggesting that the patches it initially picks are meaningful to\nclassification.</p>\n<p>However, accuracy is still lower than the learned Saccader model, and\n<strong>performacne improves only slowly with additional glimpese. The ordered\nlogits policy is able to capture some of the features relevant to\nclassification, but it is a greedy policy that produces glimpses that cluster\naround a few top features (i.e., with low image coverage)</strong></p>\n</blockquote>\n<p>ordered logits policy 的缺陷在于，只关注了最重要的少数的特征。它的预测都围绕在这\n些最重要的特征周围，所以增加 glimpese 的时候，很少新的信息引入，所以 performance\n增长的很慢，而 Saccader 没有这个问题，它关注了完整的信息。</p>\n<h4 id=\"空间上其他位置\"><a class=\"markdownIt-Anchor\" href=\"#空间上其他位置\"></a> 空间上其他位置</h4>\n<p>如<a href=\"#%E7%A9%BA%E9%97%B4\">上文所说</a>，Sccader 只优化选中的位置，不管没有被选中的位置。那么当增加\nglimplese 的时候，它的性能应该会受到影响的。但是不是。</p>\n<blockquote>\n<p>In fact, increasing the number of glimpses beyond the number used for DRAM\npolicy training leads to drop in performane, ulike the Saccader model that\ngeneralizes to greater umbers of glimpses.</p>\n</blockquote>\n<img src=Saccader_gl.jpg width=50% height = 50%>\n<p>如图可以看出，增大 glimpses 的时候，准确率反而在增加。说明在训练的时候，没有被训\n练到的地方，Saccader 的预测也还可以，与<a href=\"#%E7%A9%BA%E9%97%B4\">上文所说</a>的理解不同\n。<font color=deeppink>原因是什么还有待探究。</font></p>\n<h3 id=\"hard-attention-for-scalable-image-classification\"><a class=\"markdownIt-Anchor\" href=\"#hard-attention-for-scalable-image-classification\"></a> Hard Attention for Scalable Image Classification</h3>\n<h4 id=\"介绍\"><a class=\"markdownIt-Anchor\" href=\"#介绍\"></a> 介绍</h4>\n<img src=Tnet_over.jpg width=50% height = 50%>\n<blockquote>\n<p>Muti-scale processing in the proposed TNet architecture. Starting from level\n1, the image is processed in low resolution to get a coarse description of its\ncontent (red cube). Extracted features are used for (hard) selection of image\nregions worth processing in higher resolution. The process is repeated\nrecursively (here to 2 additional levels). Features from all levels are\ncombined (arrows on the right) to create the final image representation used\nfor classificaiton (blue cube).</p>\n</blockquote>\n<p>先粗后细的粗粒不同尺度的图像，这篇文章使用和实现了 Saccader</p>\n<h2 id=\"soft-attention\"><a class=\"markdownIt-Anchor\" href=\"#soft-attention\"></a> Soft Attention</h2>\n<h3 id=\"nam-normalization-based-attention-module\"><a class=\"markdownIt-Anchor\" href=\"#nam-normalization-based-attention-module\"></a> NAM, Normalization-based Attention Module</h3>\n<h4 id=\"利用网络参数的信息进一步处理数据再利用\"><a class=\"markdownIt-Anchor\" href=\"#利用网络参数的信息进一步处理数据再利用\"></a> 利用网络参数的信息，进一步处理数据（再利用）</h4>\n<blockquote>\n<p>Those methods successfully exploit the mutual information from different\ndimensions of feawture. However, they lack consideration on the contributing\nfactors of weights, which is capable of furthr suppressing the insignificant\nchannels or pixels.</p>\n</blockquote>\n<p>网络参数本身是表达了一定的信息的，比如某个卷积核提取什么样的信息，本身也代表一种\n信息。神经网络中，每个参数都在图像的处理过程中使用一次，然而，<strong>一次是否就已经用\n完了该参数的信息。它是否还有其他价值？</strong></p>\n<p>文章重复利用了 bn 层中的权重，文章任务 bn 层的权重可以表达特征图的重要程度。然而\nattention 正好又需要特征图的重要程度。所以文章在 attention 中利用了 bn 层的权重\n。<strong>使得 bn 的权重出现重复利用的现象。</strong></p>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>a</mi><mi>t</mi><mi>t</mi><mo>×</mo><mi>γ</mi><mo>+</mo><mi>δ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>a</mi><mi>t</mi><mi>t</mi><mo>×</mo><mfrac><mi>γ</mi><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo stretchy=\"false\">(</mo><mi>γ</mi><mo stretchy=\"false\">)</mo></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>a</mi><mi>t</mi><mi>t</mi><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>o</mi><mi>i</mi><mi>d</mi><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">)</mo><mo>×</mo><mi>x</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\natt &amp;= norm(x) \\\\\natt &amp;= att \\times \\gamma + \\delta \\\\\natt &amp;= att \\times \\frac\\gamma{sum(\\gamma)} \\\\\nout &amp;= att.sigmoid() \\times x\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:6.84356em;vertical-align:-3.1717800000000005em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.67178em;\"><span style=\"top:-5.93934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span></span></span><span style=\"top:-4.43934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span></span></span><span style=\"top:-2.671779999999999em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span></span></span><span style=\"top:-0.5957799999999995em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">t</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.1717800000000005em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.67178em;\"><span style=\"top:-5.93934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\">m</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mclose\">)</span></span></span><span style=\"top:-4.43934em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03785em;\">δ</span></span></span><span style=\"top:-2.671779999999999em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1075599999999999em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">m</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-0.5957799999999995em;\"><span class=\"pstrut\" style=\"height:3.10756em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">t</span><span class=\"mord\">.</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">d</span><span class=\"mopen\">(</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.1717800000000005em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Channel_Att</span>(<span class=\"params\">nn.Module</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, channels, t=<span class=\"number\">16</span></span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(Channel_Att, self).__init__()</span><br><span class=\"line\">        self.channels = channels</span><br><span class=\"line\">        self.bn2 = nn.BatchNorm2d(self.channels, affine=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">forward</span>(<span class=\"params\">self, x</span>):</span></span><br><span class=\"line\">        residual = x</span><br><span class=\"line\">        x = self.bn2(x)</span><br><span class=\"line\">        weight_bn = self.bn2.weight.data.<span class=\"built_in\">abs</span>() / torch.<span class=\"built_in\">sum</span>(self.bn2.weight.data.<span class=\"built_in\">abs</span>())</span><br><span class=\"line\">        x = x.permute(<span class=\"number\">0</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>).contiguous()</span><br><span class=\"line\">        x = torch.mul(weight_bn, x)</span><br><span class=\"line\">        x = x.permute(<span class=\"number\">0</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>).contiguous()</span><br><span class=\"line\">        x = torch.sigmoid(x) * residual</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x</span><br></pre></td></tr></table></figure>\n<h4 id=\"关于权重稀疏性\"><a class=\"markdownIt-Anchor\" href=\"#关于权重稀疏性\"></a> 关于权重稀疏性</h4>\n<blockquote>\n<p>It applies a weightsparsity penalty to the attention modules, thus, making\nthem more computational efficient while retaining similar performance.</p>\n<p>To suppress the less salient weights, we add a regularization term into the\nloss function.</p>\n</blockquote>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><munder><mo>∑</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></munder><mi>l</mi><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>W</mi><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>p</mi><mo>∑</mo><mi>g</mi><mo stretchy=\"false\">(</mo><mi>γ</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>p</mi><mo>∑</mo><mi>g</mi><mo stretchy=\"false\">(</mo><mi>λ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Loss = \\sum_{(x,y)}l(f(x, W), y) + p\\sum g(\\gamma) + p \\sum g(\\lambda)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">L</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.5660100000000003em;vertical-align:-1.516005em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.050005em;\"><span style=\"top:-1.808995em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathdefault mtight\">x</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose mtight\">)</span></span></span></span><span style=\"top:-3.0500049999999996em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.516005em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">λ</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>第一项是正常的损失函数，第二项和第三项的<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>g</mi><mi mathvariant=\"normal\">（</mi><mi mathvariant=\"normal\">）</mi></mrow><annotation encoding=\"application/x-tex\">g（）</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord cjk_fallback\">（</span><span class=\"mord cjk_fallback\">）</span></span></span></span>是一范数，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05556em;\">γ</span></span></span></span>是通道注意力中\nbn 的权重，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">λ</span></span></span></span>是空间注意力中 pix normalization 的权重。加上这两项使得通道\n和空间注意力都有了稀疏性。</p>\n<p><font color=deeppink>loss 函数增加了权重的稀疏性，attention 把权重的稀疏性转换为\n了特征的稀疏性，然而这个稀疏性并不是丢弃了特征或者权重，为什么它能够带来\ncomputational efficient? 文章确实有 computational efficient，但是根据实验部分的\n列表，parameter 和 FLOPS 的优势都是这个注意力机制的结构带来的，相比于其他注意力\n机制，它是轻量而且计算低的。但是稀疏性和计算复杂度是无关的。</font></p>\n<h4 id=\"启发\"><a class=\"markdownIt-Anchor\" href=\"#启发\"></a> 启发</h4>\n<p><font color=deeppink>这篇文章给人一个启发是参数复用，神经网络中所有参数几乎不会\n复用。然而，除了文中提出的这个例子，是否还存在其他需要复用的场景或者理由\n。</font></p>\n<p><font color=deeppink>参数复用可以看成另一种权值共享，卷积是层内的权值共享，参数\n复用是层间的权值共享，它是一种正则化，它对不变性产生什么影响？</font></p>\n<h1 id=\"regularization\"><a class=\"markdownIt-Anchor\" href=\"#regularization\"></a> Regularization</h1>\n<h2 id=\"adcm-attentnion-dropout-convolutional-module\"><a class=\"markdownIt-Anchor\" href=\"#adcm-attentnion-dropout-convolutional-module\"></a> ADCM: Attentnion Dropout Convolutional Module</h2>\n<p><img src=\"ADCM.jpg\" alt=\"ADCM\" /></p>\n<p>在 CBAM 的基础上加入了正则化，把 CBAM 产生的 attention weights 作为 Drop 的概率\n引导，来对 feature map 进行 drop。是一种对 attention 机制的正则化方法，很容以把\n它误解为 hard attention。</p>\n<div id=\"footnotes\"><hr><div id=\"footnotelist\"><ol><li id=\"fn:1\">2018,Learn to pay attention.<a href=\"#fnref:1\" rev=\"footnote\"> ↩</a></li><li id=\"fn:2\">2019, Approximating CNNs with bag-of-local-features models works\nsurprisingly well on ImageNet.<a href=\"#fnref:2\" rev=\"footnote\"> ↩</a></li></ol></div></div>"},{"title":"Transformer and BERT","top":false,"cover":false,"toc":true,"mathjax":true,"description":"NLP, Transformer and BERT.","abbrlink":"e537690a","date":"2021-12-18T02:00:56.000Z","password":null,"summary":null,"_content":"\nI will introduce transformer and BERT according to their original papers. [^1]\n[^2]\n\n[^2]:\n    BERT: Pre-training of Deep Bidirectional Transformer for Language\n    Understanding\n\n[^1]: Attention is all you need\n\nBased on the two paper, we will also take the first step to NLP.\n\n# Transformer\n\n# BERT\n","source":"_posts/Transformer-and-BERT.md","raw":"---\ntitle: Transformer and BERT\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndescription: 'NLP, Transformer and BERT.'\ncategories:\n  - Machine Learning\n  - Applications\n  - Natural Language Processing\ntags:\n  - Natural Language Processing\n  - Transformer\n  - BERT\nabbrlink: e537690a\ndate: 2021-12-18 10:00:56\npassword:\nsummary:\n---\n\nI will introduce transformer and BERT according to their original papers. [^1]\n[^2]\n\n[^2]:\n    BERT: Pre-training of Deep Bidirectional Transformer for Language\n    Understanding\n\n[^1]: Attention is all you need\n\nBased on the two paper, we will also take the first step to NLP.\n\n# Transformer\n\n# BERT\n","slug":"Transformer-and-BERT","published":1,"updated":"2022-06-13T07:38:40.694Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgx001ey7mlfa5hcg4c","content":"<html><head></head><body><p>I will introduce transformer and BERT according to their original papers. <sup id=\"fnref:1\"><a href=\"#fn:1\" rel=\"footnote\">1</a></sup>\n<sup id=\"fnref:2\"><a href=\"#fn:2\" rel=\"footnote\">2</a></sup></p>\n<p>Based on the two paper, we will also take the first step to NLP.</p>\n<h1 id=\"transformer\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#transformer\"></a> Transformer</h1>\n<h1 id=\"bert\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#bert\"></a> BERT</h1>\n<div id=\"footnotes\"><hr><div id=\"footnotelist\"><ol><li id=\"fn:1\">Attention is all you need<a href=\"#fnref:1\" rev=\"footnote\"> ↩</a></li><li id=\"fn:2\">BERT: Pre-training of Deep Bidirectional Transformer for Language\nUnderstanding<a href=\"#fnref:2\" rev=\"footnote\"> ↩</a></li></ol></div></div></body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<p>I will introduce transformer and BERT according to their original papers. <sup id=\"fnref:1\"><a href=\"#fn:1\" rel=\"footnote\">1</a></sup>\n<sup id=\"fnref:2\"><a href=\"#fn:2\" rel=\"footnote\">2</a></sup></p>\n<p>Based on the two paper, we will also take the first step to NLP.</p>\n<h1 id=\"transformer\"><a class=\"markdownIt-Anchor\" href=\"#transformer\"></a> Transformer</h1>\n<h1 id=\"bert\"><a class=\"markdownIt-Anchor\" href=\"#bert\"></a> BERT</h1>\n<div id=\"footnotes\"><hr><div id=\"footnotelist\"><ol><li id=\"fn:1\">Attention is all you need<a href=\"#fnref:1\" rev=\"footnote\"> ↩</a></li><li id=\"fn:2\">BERT: Pre-training of Deep Bidirectional Transformer for Language\nUnderstanding<a href=\"#fnref:2\" rev=\"footnote\"> ↩</a></li></ol></div></div>"},{"title":"Windows","top":false,"cover":false,"toc":true,"description":"Some Configuration on Windows","abbrlink":"2c5abc07","date":"2022-06-10T10:31:06.000Z","password":null,"summary":null,"_content":"\n# Proxy\n\n## In WSL\n\n### Use the Windows proxy in WSL1\n\n```bash\nexport http_proxy=socks://127.0.0.1:10808\nexport https_proxy=socks://127.0.0.1:10808\n```\n\nFor fish user\n\n```fish\nif test $(grep Microsoft /proc/version)\n  set -x http_proxy socks://127.0.0.1:10808\n  set -x https_proxy socks://127.0.0.1:10808\nend\n```\n\nThen verify the setting with `curl google.com`.\n\nWhen `http(s)_proxy` is set you can see the log in your proxy on Windows when\nyou run `curl google.com`. Be careful about the `127.0.0.1` which is the loop\nback address of local host, the port `10808` which is defined in your windows\nproxy app, and `socks` is the protocol which also defined in your windows proxy\napp.\n\n# X server\n\n## On the Windows side: Xming\n\nI also tried VcXsrv. However, it failed to be launch. Thus I installed\n[xming](https://sourceforge.net/projects/xming/). After installing, notice that\n`No Access Control` may should be picked when start `Xlaunch`. Then a progress\n`xming server` will be started (see it in your task bar).\n\nWindows Side Done.\n\n## On the linux side: $DISPLAY\n\nThe DISPLAY variable should be set as `:0.0`. For bash shell, write\n`export DISPLAY=:0.0` in your `.bashrc`. For fish shell, write\n`set -x DISPLAY :0.0` in your fish configuration file.\n\nThen you can run a gui program on your linux and get the window on the Windows\nside.\n","source":"_posts/Windows.md","raw":"---\ntitle: Windows\ntop: false\ncover: false\ntoc: true\ndescription: Some Configuration on Windows\ncategories:\n  - Programming\n  - Tools\n  - Windows\ntags:\n  - Windows\nabbrlink: 2c5abc07\ndate: 2022-06-10 18:31:06\npassword:\nsummary:\n---\n\n# Proxy\n\n## In WSL\n\n### Use the Windows proxy in WSL1\n\n```bash\nexport http_proxy=socks://127.0.0.1:10808\nexport https_proxy=socks://127.0.0.1:10808\n```\n\nFor fish user\n\n```fish\nif test $(grep Microsoft /proc/version)\n  set -x http_proxy socks://127.0.0.1:10808\n  set -x https_proxy socks://127.0.0.1:10808\nend\n```\n\nThen verify the setting with `curl google.com`.\n\nWhen `http(s)_proxy` is set you can see the log in your proxy on Windows when\nyou run `curl google.com`. Be careful about the `127.0.0.1` which is the loop\nback address of local host, the port `10808` which is defined in your windows\nproxy app, and `socks` is the protocol which also defined in your windows proxy\napp.\n\n# X server\n\n## On the Windows side: Xming\n\nI also tried VcXsrv. However, it failed to be launch. Thus I installed\n[xming](https://sourceforge.net/projects/xming/). After installing, notice that\n`No Access Control` may should be picked when start `Xlaunch`. Then a progress\n`xming server` will be started (see it in your task bar).\n\nWindows Side Done.\n\n## On the linux side: $DISPLAY\n\nThe DISPLAY variable should be set as `:0.0`. For bash shell, write\n`export DISPLAY=:0.0` in your `.bashrc`. For fish shell, write\n`set -x DISPLAY :0.0` in your fish configuration file.\n\nThen you can run a gui program on your linux and get the window on the Windows\nside.\n","slug":"Windows","published":1,"updated":"2022-06-13T07:38:40.694Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4s7rpgy001gy7ml5nc20rsa","content":"<html><head></head><body><h1 id=\"proxy\"><span class=\"post-title-index\">1. </span><a class=\"markdownIt-Anchor\" href=\"#proxy\"></a> Proxy</h1>\n<h2 id=\"in-wsl\"><span class=\"post-title-index\">1.1. </span><a class=\"markdownIt-Anchor\" href=\"#in-wsl\"></a> In WSL</h2>\n<h3 id=\"use-the-windows-proxy-in-wsl1\"><span class=\"post-title-index\">1.1.1. </span><a class=\"markdownIt-Anchor\" href=\"#use-the-windows-proxy-in-wsl1\"></a> Use the Windows proxy in WSL1</h3>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> http_proxy=socks://127.0.0.1:10808</span><br><span class=\"line\"><span class=\"built_in\">export</span> https_proxy=socks://127.0.0.1:10808</span><br></pre></td></tr></tbody></table></figure>\n<p>For fish user</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if test $(grep Microsoft /proc/version)</span><br><span class=\"line\">  set -x http_proxy socks://127.0.0.1:10808</span><br><span class=\"line\">  set -x https_proxy socks://127.0.0.1:10808</span><br><span class=\"line\">end</span><br></pre></td></tr></tbody></table></figure>\n<p>Then verify the setting with <code>curl google.com</code>.</p>\n<p>When <code>http(s)_proxy</code> is set you can see the log in your proxy on Windows when\nyou run <code>curl google.com</code>. Be careful about the <code>127.0.0.1</code> which is the loop\nback address of local host, the port <code>10808</code> which is defined in your windows\nproxy app, and <code>socks</code> is the protocol which also defined in your windows proxy\napp.</p>\n<h1 id=\"x-server\"><span class=\"post-title-index\">2. </span><a class=\"markdownIt-Anchor\" href=\"#x-server\"></a> X server</h1>\n<h2 id=\"on-the-windows-side-xming\"><span class=\"post-title-index\">2.1. </span><a class=\"markdownIt-Anchor\" href=\"#on-the-windows-side-xming\"></a> On the Windows side: Xming</h2>\n<p>I also tried VcXsrv. However, it failed to be launch. Thus I installed\n<a href=\"https://sourceforge.net/projects/xming/\">xming</a>. After installing, notice that\n<code>No Access Control</code> may should be picked when start <code>Xlaunch</code>. Then a progress\n<code>xming server</code> will be started (see it in your task bar).</p>\n<p>Windows Side Done.</p>\n<h2 id=\"on-the-linux-side-display\"><span class=\"post-title-index\">2.2. </span><a class=\"markdownIt-Anchor\" href=\"#on-the-linux-side-display\"></a> On the linux side: $DISPLAY</h2>\n<p>The DISPLAY variable should be set as <code>:0.0</code>. For bash shell, write\n<code>export DISPLAY=:0.0</code> in your <code>.bashrc</code>. For fish shell, write\n<code>set -x DISPLAY :0.0</code> in your fish configuration file.</p>\n<p>Then you can run a gui program on your linux and get the window on the Windows\nside.</p>\n</body></html>","site":{"data":{}},"excerpt":"<html><head></head><body></body></html>","more":"<h1 id=\"proxy\"><a class=\"markdownIt-Anchor\" href=\"#proxy\"></a> Proxy</h1>\n<h2 id=\"in-wsl\"><a class=\"markdownIt-Anchor\" href=\"#in-wsl\"></a> In WSL</h2>\n<h3 id=\"use-the-windows-proxy-in-wsl1\"><a class=\"markdownIt-Anchor\" href=\"#use-the-windows-proxy-in-wsl1\"></a> Use the Windows proxy in WSL1</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> http_proxy=socks://127.0.0.1:10808</span><br><span class=\"line\"><span class=\"built_in\">export</span> https_proxy=socks://127.0.0.1:10808</span><br></pre></td></tr></table></figure>\n<p>For fish user</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if test $(grep Microsoft /proc/version)</span><br><span class=\"line\">  set -x http_proxy socks://127.0.0.1:10808</span><br><span class=\"line\">  set -x https_proxy socks://127.0.0.1:10808</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n<p>Then verify the setting with <code>curl google.com</code>.</p>\n<p>When <code>http(s)_proxy</code> is set you can see the log in your proxy on Windows when\nyou run <code>curl google.com</code>. Be careful about the <code>127.0.0.1</code> which is the loop\nback address of local host, the port <code>10808</code> which is defined in your windows\nproxy app, and <code>socks</code> is the protocol which also defined in your windows proxy\napp.</p>\n<h1 id=\"x-server\"><a class=\"markdownIt-Anchor\" href=\"#x-server\"></a> X server</h1>\n<h2 id=\"on-the-windows-side-xming\"><a class=\"markdownIt-Anchor\" href=\"#on-the-windows-side-xming\"></a> On the Windows side: Xming</h2>\n<p>I also tried VcXsrv. However, it failed to be launch. Thus I installed\n<a href=\"https://sourceforge.net/projects/xming/\">xming</a>. After installing, notice that\n<code>No Access Control</code> may should be picked when start <code>Xlaunch</code>. Then a progress\n<code>xming server</code> will be started (see it in your task bar).</p>\n<p>Windows Side Done.</p>\n<h2 id=\"on-the-linux-side-display\"><a class=\"markdownIt-Anchor\" href=\"#on-the-linux-side-display\"></a> On the linux side: $DISPLAY</h2>\n<p>The DISPLAY variable should be set as <code>:0.0</code>. For bash shell, write\n<code>export DISPLAY=:0.0</code> in your <code>.bashrc</code>. For fish shell, write\n<code>set -x DISPLAY :0.0</code> in your fish configuration file.</p>\n<p>Then you can run a gui program on your linux and get the window on the Windows\nside.</p>\n"}],"PostAsset":[{"_id":"source/_posts/An-Introduction-to-Git/git.jpg","slug":"git.jpg","post":"cl4s7rpg40003y7mldedibwd7","modified":0,"renderable":0},{"_id":"source/_posts/Arch-Linux/init.png","slug":"init.png","post":"cl4s7rpg80007y7ml0twaa2mq","modified":0,"renderable":0},{"_id":"source/_posts/Arch-Linux/init.png:Zone.Identifier","slug":"init.png:Zone.Identifier","post":"cl4s7rpg80007y7ml0twaa2mq","modified":0,"renderable":0},{"_id":"source/_posts/First-Step-to-RL/policy_network.py","slug":"policy_network.py","post":"cl4s7rpgi000iy7ml0q073rkm","modified":0,"renderable":0},{"_id":"source/_posts/First-Step-to-RL/q_learning.py","slug":"q_learning.py","post":"cl4s7rpgi000iy7ml0q073rkm","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/ADCM.jpg","slug":"ADCM.jpg","post":"cl4s7rpgw001cy7ml5clvadp1","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Saccader_Cell.jpg","slug":"Saccader_Cell.jpg","post":"cl4s7rpgw001cy7ml5clvadp1","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Saccader_Over.jpg","slug":"Saccader_Over.jpg","post":"cl4s7rpgw001cy7ml5clvadp1","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Saccader_eq1.jpg","slug":"Saccader_eq1.jpg","post":"cl4s7rpgw001cy7ml5clvadp1","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Saccader_eq2.jpg","slug":"Saccader_eq2.jpg","post":"cl4s7rpgw001cy7ml5clvadp1","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Saccader_eq3.jpg","slug":"Saccader_eq3.jpg","post":"cl4s7rpgw001cy7ml5clvadp1","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Saccader_gl.jpg","slug":"Saccader_gl.jpg","post":"cl4s7rpgw001cy7ml5clvadp1","modified":0,"renderable":0},{"_id":"source/_posts/Tips-in-Papers/Tnet_over.jpg","slug":"Tnet_over.jpg","post":"cl4s7rpgw001cy7ml5clvadp1","modified":0,"renderable":0}],"PostCategory":[{"post_id":"cl4s7rpfz0001y7mler7n4299","category_id":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rpgq000zy7ml1u860zgt"},{"post_id":"cl4s7rpfz0001y7mler7n4299","category_id":"cl4s7rpgm000py7mles300ti3","_id":"cl4s7rpgs0013y7mldscr6eeg"},{"post_id":"cl4s7rpgk000my7ml354o4mns","category_id":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rph2001wy7mleo0afj47"},{"post_id":"cl4s7rpgk000my7ml354o4mns","category_id":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rph3001yy7ml918i44cg"},{"post_id":"cl4s7rpgk000my7ml354o4mns","category_id":"cl4s7rph0001ny7mlhdb4aznq","_id":"cl4s7rph30021y7mle3gk86c5"},{"post_id":"cl4s7rpg90008y7mlhy2ibswm","category_id":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rph40023y7ml50m44md9"},{"post_id":"cl4s7rpg90008y7mlhy2ibswm","category_id":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rph40025y7ml0o5u0129"},{"post_id":"cl4s7rpg90008y7mlhy2ibswm","category_id":"cl4s7rph0001ny7mlhdb4aznq","_id":"cl4s7rph50027y7ml9uchcrtd"},{"post_id":"cl4s7rpgn000ry7mldhxy1tmw","category_id":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rph6002ay7ml3u1ydheo"},{"post_id":"cl4s7rpgn000ry7mldhxy1tmw","category_id":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rph6002cy7mlbfg276v7"},{"post_id":"cl4s7rpgn000ry7mldhxy1tmw","category_id":"cl4s7rph30020y7ml685xhevj","_id":"cl4s7rph6002ey7ml34gq5win"},{"post_id":"cl4s7rpga0009y7ml36q1eiid","category_id":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rph9002oy7mlf2wxdbyc"},{"post_id":"cl4s7rpga0009y7ml36q1eiid","category_id":"cl4s7rpgo000uy7mlaasg7smp","_id":"cl4s7rph9002qy7mld4tt6zb2"},{"post_id":"cl4s7rpga0009y7ml36q1eiid","category_id":"cl4s7rph7002iy7ml3xxwafov","_id":"cl4s7rph9002ry7mlgheoe837"},{"post_id":"cl4s7rpgd000cy7ml4glt1rwg","category_id":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rpha002wy7mlfhcz9h5x"},{"post_id":"cl4s7rpgd000cy7ml4glt1rwg","category_id":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rphb0030y7mldrrt6u2g"},{"post_id":"cl4s7rpgd000cy7ml4glt1rwg","category_id":"cl4s7rph9002ny7ml2lewfq9k","_id":"cl4s7rphc0032y7ml50md6ua7"},{"post_id":"cl4s7rpgs0014y7mlhy0scdls","category_id":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rphd0035y7mlgesp4otp"},{"post_id":"cl4s7rpgs0014y7mlhy0scdls","category_id":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rphd0036y7ml19f60ud7"},{"post_id":"cl4s7rpgs0014y7mlhy0scdls","category_id":"cl4s7rpha002ty7ml34ed565o","_id":"cl4s7rphe0039y7ml40jbh0f3"},{"post_id":"cl4s7rpgu0017y7ml2cmv59iz","category_id":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rphe003by7mlbb2e1wah"},{"post_id":"cl4s7rpgu0017y7ml2cmv59iz","category_id":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rphe003fy7mlcugwb75n"},{"post_id":"cl4s7rpgu0017y7ml2cmv59iz","category_id":"cl4s7rphb002yy7ml17x3gsui","_id":"cl4s7rphf003hy7mldyi7ex90"},{"post_id":"cl4s7rpg40003y7mldedibwd7","category_id":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rphf003jy7mlbr4p8fq2"},{"post_id":"cl4s7rpg40003y7mldedibwd7","category_id":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rphg003my7ml6pc3cy9g"},{"post_id":"cl4s7rpg40003y7mldedibwd7","category_id":"cl4s7rphd0037y7ml24rs3hnu","_id":"cl4s7rphg003oy7ml7ju78idb"},{"post_id":"cl4s7rpge000dy7ml19wyc1db","category_id":"cl4s7rpgw001by7ml2fk3g6y7","_id":"cl4s7rphh003ty7ml43tbeo8z"},{"post_id":"cl4s7rpge000dy7ml19wyc1db","category_id":"cl4s7rphg003ny7mlctaf8wx7","_id":"cl4s7rphi003wy7ml86vu0j65"},{"post_id":"cl4s7rpgy001gy7ml5nc20rsa","category_id":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rphi003xy7ml3ya00peo"},{"post_id":"cl4s7rpgy001gy7ml5nc20rsa","category_id":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rphi0040y7mlafhw8x5x"},{"post_id":"cl4s7rpgy001gy7ml5nc20rsa","category_id":"cl4s7rphh003ry7ml51fqezk0","_id":"cl4s7rphj0042y7mlcjfb1kmg"},{"post_id":"cl4s7rpgh000gy7ml4hc06vkz","category_id":"cl4s7rpgy001hy7ml8i3b4zzk","_id":"cl4s7rphj0045y7mlaf6pdtoq"},{"post_id":"cl4s7rpgh000gy7ml4hc06vkz","category_id":"cl4s7rphh003uy7mlg6kjd4uy","_id":"cl4s7rphj0047y7ml2c6valz7"},{"post_id":"cl4s7rpg80007y7ml0twaa2mq","category_id":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rphk004ay7ml6woib4aa"},{"post_id":"cl4s7rpg80007y7ml0twaa2mq","category_id":"cl4s7rpgj000jy7ml79i3g4yk","_id":"cl4s7rphk004by7ml8yp1fqd9"},{"post_id":"cl4s7rpg80007y7ml0twaa2mq","category_id":"cl4s7rphb002yy7ml17x3gsui","_id":"cl4s7rphk004dy7ml0rlt8rzv"},{"post_id":"cl4s7rpgp000vy7mlat752bsr","category_id":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rphl004gy7mla0tvgkfz"},{"post_id":"cl4s7rpgp000vy7mlat752bsr","category_id":"cl4s7rph60029y7mlfiju084b","_id":"cl4s7rphl004iy7mlf9d80zgn"},{"post_id":"cl4s7rpgp000vy7mlat752bsr","category_id":"cl4s7rphk004ey7ml6hdp1na2","_id":"cl4s7rphl004jy7mlhoqm800f"},{"post_id":"cl4s7rpgq000yy7mlgdcf052n","category_id":"cl4s7rpgy001hy7ml8i3b4zzk","_id":"cl4s7rphm004ly7ml1b5l6jhl"},{"post_id":"cl4s7rpgq000yy7mlgdcf052n","category_id":"cl4s7rphk004fy7mlad594ooh","_id":"cl4s7rphm004my7mlelh32a03"},{"post_id":"cl4s7rpgr0011y7ml37ekhd3o","category_id":"cl4s7rpg50004y7ml42kb04be","_id":"cl4s7rphm004oy7ml5g429q1x"},{"post_id":"cl4s7rpgr0011y7ml37ekhd3o","category_id":"cl4s7rph60029y7mlfiju084b","_id":"cl4s7rphm004py7mle3cu4d43"},{"post_id":"cl4s7rpgr0011y7ml37ekhd3o","category_id":"cl4s7rphl004hy7mlcija7onq","_id":"cl4s7rphn004ry7ml244c3520"},{"post_id":"cl4s7rpgw001cy7ml5clvadp1","category_id":"cl4s7rpgy001hy7ml8i3b4zzk","_id":"cl4s7rphn004sy7mlg8y8bmqm"},{"post_id":"cl4s7rpgw001cy7ml5clvadp1","category_id":"cl4s7rphk004fy7mlad594ooh","_id":"cl4s7rphn004uy7ml6baohy0o"},{"post_id":"cl4s7rpgi000iy7ml0q073rkm","category_id":"cl4s7rpgy001hy7ml8i3b4zzk","_id":"cl4s7rpho004wy7mlbevs3ylh"},{"post_id":"cl4s7rpgi000iy7ml0q073rkm","category_id":"cl4s7rphj0043y7mldhuqa3p0","_id":"cl4s7rpho004yy7ml2a55cqhp"},{"post_id":"cl4s7rpgi000iy7ml0q073rkm","category_id":"cl4s7rphn004ty7ml0mp74hcb","_id":"cl4s7rpho004zy7ml2z53aojf"},{"post_id":"cl4s7rpgl000oy7ml4ute8sbb","category_id":"cl4s7rpgy001hy7ml8i3b4zzk","_id":"cl4s7rphp0051y7ml59rg9jrb"},{"post_id":"cl4s7rpgl000oy7ml4ute8sbb","category_id":"cl4s7rphj0043y7mldhuqa3p0","_id":"cl4s7rphp0052y7ml319bhujn"},{"post_id":"cl4s7rpgl000oy7ml4ute8sbb","category_id":"cl4s7rphn004vy7ml361y58ay","_id":"cl4s7rphp0054y7ml1xfi6rjc"},{"post_id":"cl4s7rpgo000ty7ml0reb1t76","category_id":"cl4s7rpgy001hy7ml8i3b4zzk","_id":"cl4s7rphp0055y7mlb064bx83"},{"post_id":"cl4s7rpgo000ty7ml0reb1t76","category_id":"cl4s7rphj0043y7mldhuqa3p0","_id":"cl4s7rphq0056y7ml7m095a7o"},{"post_id":"cl4s7rpgo000ty7ml0reb1t76","category_id":"cl4s7rpho004xy7ml9dqv7g2z","_id":"cl4s7rphq0057y7mldif928y6"},{"post_id":"cl4s7rpgv0019y7ml1dsw1ypg","category_id":"cl4s7rpgy001hy7ml8i3b4zzk","_id":"cl4s7rphq0058y7ml64awersu"},{"post_id":"cl4s7rpgv0019y7ml1dsw1ypg","category_id":"cl4s7rphj0043y7mldhuqa3p0","_id":"cl4s7rphq0059y7ml4ctrbo0v"},{"post_id":"cl4s7rpgv0019y7ml1dsw1ypg","category_id":"cl4s7rpho0050y7mlbqo06kk3","_id":"cl4s7rphq005ay7mlgig6d4y6"},{"post_id":"cl4s7rpgx001ey7mlfa5hcg4c","category_id":"cl4s7rpgy001hy7ml8i3b4zzk","_id":"cl4s7rphq005by7ml5cng4n56"},{"post_id":"cl4s7rpgx001ey7mlfa5hcg4c","category_id":"cl4s7rphm004qy7mle0abcuwj","_id":"cl4s7rphq005cy7ml542hbrqu"},{"post_id":"cl4s7rpgx001ey7mlfa5hcg4c","category_id":"cl4s7rphp0053y7mlab1xg1gl","_id":"cl4s7rphq005dy7ml4ld92bg7"}],"PostTag":[{"post_id":"cl4s7rpfz0001y7mler7n4299","tag_id":"cl4s7rpg70005y7ml11yggte8","_id":"cl4s7rpgi000hy7ml582feyxh"},{"post_id":"cl4s7rpfz0001y7mler7n4299","tag_id":"cl4s7rpgb000by7mlc2xx3p0n","_id":"cl4s7rpgj000ky7mlhi412z8b"},{"post_id":"cl4s7rpg40003y7mldedibwd7","tag_id":"cl4s7rpgg000fy7mla2rz96im","_id":"cl4s7rpgl000ny7mlcjwhgfmr"},{"post_id":"cl4s7rpg80007y7ml0twaa2mq","tag_id":"cl4s7rpgk000ly7mlc8497p9b","_id":"cl4s7rpgn000sy7mldx5uabsz"},{"post_id":"cl4s7rpg90008y7mlhy2ibswm","tag_id":"cl4s7rpgm000qy7ml7jvade9t","_id":"cl4s7rpgq000xy7ml2b670d4d"},{"post_id":"cl4s7rpga0009y7ml36q1eiid","tag_id":"cl4s7rpgp000wy7ml5e0l35tw","_id":"cl4s7rpgt0015y7mldroa2j5m"},{"post_id":"cl4s7rpgd000cy7ml4glt1rwg","tag_id":"cl4s7rpgs0012y7ml73y1anow","_id":"cl4s7rpgv001ay7mldsli39h4"},{"post_id":"cl4s7rpge000dy7ml19wyc1db","tag_id":"cl4s7rpgu0018y7ml4gxibzj0","_id":"cl4s7rpgx001fy7mleng99yat"},{"post_id":"cl4s7rpgh000gy7ml4hc06vkz","tag_id":"cl4s7rpgx001dy7mlbbu02obi","_id":"cl4s7rph1001oy7ml5k2gfdw0"},{"post_id":"cl4s7rpgh000gy7ml4hc06vkz","tag_id":"cl4s7rpgz001iy7mleao11ut6","_id":"cl4s7rph1001py7ml3frefppo"},{"post_id":"cl4s7rpgh000gy7ml4hc06vkz","tag_id":"cl4s7rpgz001ky7ml3ghxasek","_id":"cl4s7rph1001ry7mlgxixcqi7"},{"post_id":"cl4s7rpgi000iy7ml0q073rkm","tag_id":"cl4s7rph0001my7mlbtkddd27","_id":"cl4s7rph2001ty7mlfk4nftcy"},{"post_id":"cl4s7rpgk000my7ml354o4mns","tag_id":"cl4s7rph1001qy7ml9pqt01q1","_id":"cl4s7rph3001xy7ml0o5t3muk"},{"post_id":"cl4s7rpgl000oy7ml4ute8sbb","tag_id":"cl4s7rph2001uy7ml5ehcejs0","_id":"cl4s7rph40022y7ml6jjhc8rb"},{"post_id":"cl4s7rpgn000ry7mldhxy1tmw","tag_id":"cl4s7rpgu0018y7ml4gxibzj0","_id":"cl4s7rph6002by7ml5p8x90uj"},{"post_id":"cl4s7rpgn000ry7mldhxy1tmw","tag_id":"cl4s7rph40024y7ml63t8gspf","_id":"cl4s7rph6002dy7mldd28hzqt"},{"post_id":"cl4s7rpgo000ty7ml0reb1t76","tag_id":"cl4s7rph50028y7ml3n5uf4wn","_id":"cl4s7rph7002hy7ml3mwe4i0l"},{"post_id":"cl4s7rpgp000vy7mlat752bsr","tag_id":"cl4s7rph6002fy7mlc8mkczr1","_id":"cl4s7rph8002ky7mlhfjj9dtd"},{"post_id":"cl4s7rpgq000yy7mlgdcf052n","tag_id":"cl4s7rpgx001dy7mlbbu02obi","_id":"cl4s7rpha002uy7ml8l4pens1"},{"post_id":"cl4s7rpgq000yy7mlgdcf052n","tag_id":"cl4s7rph8002ly7ml5aii02ad","_id":"cl4s7rpha002vy7mlapqx6rpx"},{"post_id":"cl4s7rpgq000yy7mlgdcf052n","tag_id":"cl4s7rpgz001ky7ml3ghxasek","_id":"cl4s7rphb002zy7ml6134hqnh"},{"post_id":"cl4s7rpgr0011y7ml37ekhd3o","tag_id":"cl4s7rph9002sy7ml7kke42wb","_id":"cl4s7rphb0031y7mlcfng1ry6"},{"post_id":"cl4s7rpgs0014y7mlhy0scdls","tag_id":"cl4s7rpha002xy7mlhm5z55in","_id":"cl4s7rphe003ay7ml02lhe5dc"},{"post_id":"cl4s7rpgs0014y7mlhy0scdls","tag_id":"cl4s7rphc0033y7mlc05y46pd","_id":"cl4s7rphe003cy7mlh6p97935"},{"post_id":"cl4s7rpgu0017y7ml2cmv59iz","tag_id":"cl4s7rphd0038y7mlbcbzh6nd","_id":"cl4s7rphf003gy7ml2ql83p34"},{"post_id":"cl4s7rpgv0019y7ml1dsw1ypg","tag_id":"cl4s7rphe003ey7mld2txaslv","_id":"cl4s7rphg003ly7mlbh9u3bwp"},{"post_id":"cl4s7rpgw001cy7ml5clvadp1","tag_id":"cl4s7rph8002ly7ml5aii02ad","_id":"cl4s7rphg003qy7ml5nykbego"},{"post_id":"cl4s7rpgx001ey7mlfa5hcg4c","tag_id":"cl4s7rphg003py7mlcav3bsel","_id":"cl4s7rphi0041y7ml78njf3l1"},{"post_id":"cl4s7rpgx001ey7mlfa5hcg4c","tag_id":"cl4s7rphh003sy7ml9go989yi","_id":"cl4s7rphj0044y7mlh8z7fl3v"},{"post_id":"cl4s7rpgx001ey7mlfa5hcg4c","tag_id":"cl4s7rphh003vy7mlbz3t4o92","_id":"cl4s7rphj0046y7mla3kx5mx1"},{"post_id":"cl4s7rpgy001gy7ml5nc20rsa","tag_id":"cl4s7rphi003zy7mlcgcs9yit","_id":"cl4s7rphj0048y7mlhx6jfr9g"}],"Tag":[{"name":"Algorithm","_id":"cl4s7rpg70005y7ml11yggte8"},{"name":"Programming","_id":"cl4s7rpgb000by7mlc2xx3p0n"},{"name":"Git","_id":"cl4s7rpgg000fy7mla2rz96im"},{"name":"Arch Linux","_id":"cl4s7rpgk000ly7mlc8497p9b"},{"name":"Bash","_id":"cl4s7rpgm000qy7ml7jvade9t"},{"name":"C","_id":"cl4s7rpgp000wy7ml5e0l35tw"},{"name":"Vim","_id":"cl4s7rpgs0012y7ml73y1anow"},{"name":"Hexo","_id":"cl4s7rpgu0018y7ml4gxibzj0"},{"name":"Personal Thought","_id":"cl4s7rpgx001dy7mlbbu02obi"},{"name":"Experiments","_id":"cl4s7rpgz001iy7mleao11ut6"},{"name":"private","_id":"cl4s7rpgz001ky7ml3ghxasek"},{"name":"Reinforcement Learning","_id":"cl4s7rph0001my7mlbtkddd27"},{"name":"Fish","_id":"cl4s7rph1001qy7ml9pqt01q1"},{"name":"Topological Data Analysis","_id":"cl4s7rph2001uy7ml5ehcejs0"},{"name":"Blog","_id":"cl4s7rph40024y7ml63t8gspf"},{"name":"Multi Task Training","_id":"cl4s7rph50028y7ml3n5uf4wn"},{"name":"Compile","_id":"cl4s7rph6002fy7mlc8mkczr1"},{"name":"Paper Reading","_id":"cl4s7rph8002ly7ml5aii02ad"},{"name":"Regex","_id":"cl4s7rph9002sy7ml7kke42wb"},{"name":"Revealjs","_id":"cl4s7rpha002xy7mlhm5z55in"},{"name":"PPT","_id":"cl4s7rphc0033y7mlc05y46pd"},{"name":"Linux","_id":"cl4s7rphd0038y7mlbcbzh6nd"},{"name":"Generative Adversarial Network","_id":"cl4s7rphe003ey7mld2txaslv"},{"name":"Natural Language Processing","_id":"cl4s7rphg003py7mlcav3bsel"},{"name":"Transformer","_id":"cl4s7rphh003sy7ml9go989yi"},{"name":"BERT","_id":"cl4s7rphh003vy7mlbz3t4o92"},{"name":"Windows","_id":"cl4s7rphi003zy7mlcgcs9yit"}]}}